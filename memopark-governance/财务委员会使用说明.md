# 财务委员会管理页面使用说明

## 📌 概述

财务委员会（Technical Committee / Instance2）负责审批国库支出提案、管理项目财务等重要财务治理事务。

**访问路径：** 委员会 → 财务委员会  
**URL：** http://localhost:5174/treasury-committee

---

## 🏗️ 系统配置

### Runtime 配置

```rust
// runtime/src/configs/mod.rs

type TechnicalCollective = pallet_collective::Instance2;

impl pallet_collective::Config<TechnicalCollective> for Runtime {
    type RuntimeEvent = RuntimeEvent;
    type RuntimeOrigin = RuntimeOrigin;
    type Proposal = RuntimeCall;
    type MotionDuration = TechnicalMotionDuration;
    type MaxProposals = TechnicalMaxProposals;
    type MaxMembers = TechnicalMaxMembers;
    // ... 其他配置
}
```

### 委员会实例

- **Instance1**: Council（委员会）
- **Instance2**: TechnicalCommittee（技术委员会/财务委员会）⭐
- **Instance3**: ContentCommittee（内容委员会）

---

## 📖 页面功能

### 1. 统计概览

显示三个核心指标：
- **委员会成员数**：当前财务委员会总成员数
- **进行中的提案**：待投票的提案数量
- **您的状态**：是否为委员会成员

### 2. 委员会成员管理

**功能：**
- 查看所有财务委员会成员列表
- 显示成员账户地址
- 标识当前登录账户
- 显示成员角色标签

**权限：**
- 所有人可查看
- 只有 sudo 可以修改成员（通过链上调用）

### 3. 提案投票

**功能：**
- 查看所有进行中的提案
- 对提案投赞成票或反对票
- 查看实时投票统计
- 关闭达到阈值的提案

**权限：**
- 只有财务委员会成员可以投票
- 任何人可以关闭达到阈值的提案

---

## 🔄 工作流程

### 典型财务审批流程

```
1. 财务提案发起
   ↓
2. 财务委员会成员发起投票提案
   ↓
3. 其他委员会成员投票
   ↓
4. 达到 2/3 阈值
   ↓
5. 关闭提案并执行
   ↓
6. 国库支出/财务操作执行
```

### 示例：批准国库支出

```javascript
// 1. 财务委员会成员 Alice 发起提案
api.tx.technicalCommittee.propose(
  2,                                    // threshold (2/3)
  api.tx.treasury.approveProposal(0),  // 批准国库提案 #0
  lengthBound
)

// 2. Bob 投赞成票
api.tx.technicalCommittee.vote(proposalHash, index, true)

// 3. Charlie 投赞成票（达到阈值）
api.tx.technicalCommittee.vote(proposalHash, index, true)

// 4. 关闭提案
api.tx.technicalCommittee.close(proposalHash, index, weightBound, lengthBound)
```

---

## 🎯 使用场景

### 1. 国库支出审批

**适用情况：**
- 项目资金申请
- 开发者奖励
- 基础设施费用
- 社区活动经费

**流程：**
1. 查看待审批的国库提案（在国库页面）
2. 财务委员会发起批准/驳回提案
3. 委员会成员投票
4. 达到阈值后执行

---

### 2. 财务参数调整

**适用情况：**
- 调整手续费参数
- 修改最低存款金额
- 变更财务政策

**流程：**
1. 发起参数修改提案
2. 委员会投票表决
3. 执行参数修改

---

### 3. 紧急财务干预

**适用情况：**
- 异常交易处理
- 紧急资金调配
- 安全事件响应

**流程：**
1. 快速发起紧急提案
2. 加速投票流程
3. 立即执行干预措施

---

## 🔧 初始化和配置

### 设置委员会成员（使用 sudo）

```bash
# 使用 Polkadot.js Apps
1. 打开 https://polkadot.js.org/apps/?rpc=ws://127.0.0.1:9944
2. Developer -> Sudo
3. 选择：technicalCommittee.setMembers(newMembers, prime, oldCount)
   - newMembers: 添加成员地址数组
   - prime: 主要成员（可选）
   - oldCount: 当前成员数
4. 提交交易
```

### 查看当前成员

```javascript
// 使用 @polkadot/api
const members = await api.query.technicalCommittee.members();
console.log('财务委员会成员:', members.map(m => m.toString()));
```

---

## 📊 页面截图说明

### 统计卡片区域
- 左侧：委员会成员数
- 中间：进行中的提案数
- 右侧：当前账户状态

### 委员会成员标签页
- 成员列表表格
- 账户地址（可复制）
- 账户名称标签
- 当前账户标识

### 进行中的提案标签页
- 提案描述
- 发起人信息
- 投票统计（赞成/反对/阈值）
- 操作按钮（赞成/反对/关闭）
- 可展开查看详情

---

## ⚠️ 注意事项

1. **权限要求**
   - 只有财务委员会成员可以投票
   - 非成员无法发起提案

2. **投票阈值**
   - 默认需要 2/3 多数同意
   - 达到阈值后才能关闭提案

3. **提案时效**
   - 提案有时间限制
   - 超时未关闭将自动失效

4. **执行确认**
   - 关闭提案前请仔细核对内容
   - 执行后无法撤销

5. **账户安全**
   - 确保使用官方钱包扩展
   - 谨慎保管私钥
   - 交易前仔细确认

---

## 🆚 与其他委员会的区别

| 委员会 | Instance | 职责 | 投票阈值 |
|--------|----------|------|----------|
| **委员会** | Instance1 | 整体治理、选举 | 2/3 |
| **财务委员会** | Instance2 | 财务审批、国库管理 | 2/3 |
| **内容委员会** | Instance3 | 内容审核、违规处理 | 2/3 |

---

## 🔗 相关链接

- **页面路径**：`src/pages/TreasuryCommittee/index.tsx`
- **访问地址**：http://localhost:5174/treasury-committee
- **Pallet 文档**：[Substrate Collective Pallet](https://paritytech.github.io/substrate/master/pallet_collective/)
- **国库管理**：http://localhost:5174/treasury（待实现）

---

## 📝 常见问题

### Q1: 如何成为财务委员会成员？

**A:** 需要通过 sudo 或委员会投票添加。在开发环境中，可以使用 Alice 的 sudo 权限直接添加。

### Q2: 提案如何发起？

**A:** 
1. 在相关业务页面（如国库页面）发起提案
2. 或使用 Polkadot.js Apps 手动创建
3. 或通过前端页面的"发起提案"功能（如果实现）

### Q3: 投票后可以修改吗？

**A:** 不可以。投票一旦提交无法修改，请谨慎投票。

### Q4: 如何查看历史提案？

**A:** 当前页面只显示进行中的提案。历史提案需要通过链上事件或区块浏览器查询。

### Q5: 财务委员会和委员会有什么区别？

**A:** 
- **委员会**（Instance1）：负责整体治理、成员选举等
- **财务委员会**（Instance2）：专注于财务审批、国库管理
- 两者职责不同，成员可以重叠

---

## 🚀 快速开始

### 1. 启动服务

```bash
# 启动链端（如未启动）
cd /home/xiaodong/文档/memopark
./target/release/memopark-node \
  --base-path ./my-chain-state \
  --chain dev \
  --alice \
  --rpc-external \
  --rpc-port 9944 \
  --rpc-cors=all \
  --rpc-methods=Unsafe

# 启动治理前端
cd /home/xiaodong/文档/memopark/memopark-governance
npm run dev
```

### 2. 访问页面

打开浏览器：**http://localhost:5174/treasury-committee**

### 3. 连接钱包

点击右上角"连接钱包"，选择财务委员会成员账户。

### 4. 开始使用

- 查看成员列表
- 查看提案并投票
- 关闭达到阈值的提案

---

## 🎓 技术实现

### 核心技术栈

- React 18 + TypeScript
- Ant Design 5
- @polkadot/api
- @polkadot/extension-dapp

### 主要功能实现

1. **成员查询**
   ```typescript
   const members = await api.query.technicalCommittee.members();
   ```

2. **提案查询**
   ```typescript
   const proposals = await api.query.technicalCommittee.proposals();
   ```

3. **投票**
   ```typescript
   api.tx.technicalCommittee.vote(hash, index, approve)
   ```

4. **关闭提案**
   ```typescript
   api.tx.technicalCommittee.close(hash, index, weightBound, lengthBound)
   ```

---

## 📅 更新日志

- **2025-10-14**: 初始版本发布
  - 实现财务委员会成员查看
  - 实现提案投票功能
  - 实现提案关闭功能
  - 添加统计概览
  - 添加到导航菜单

---

**技术支持：** Memopark 开发团队  
**文档版本：** v1.0.0

