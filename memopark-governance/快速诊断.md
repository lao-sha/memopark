# å¿«é€Ÿè¯Šæ–­ï¼šæ²»ç†å¹³å° Wasm Unreachable é”™è¯¯

## ğŸ” ç¬¬ä¸€æ­¥ï¼šåœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ

æ‰“å¼€æ²»ç†å¹³å° `http://localhost:3000`ï¼ŒæŒ‰ `F12` æ‰“å¼€æ§åˆ¶å°ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç ï¼š

```javascript
(async () => {
  console.group('ğŸ” å¿«é€Ÿè¯Šæ–­')
  
  try {
    const api = window.api || await new Promise(r => setTimeout(() => r(window.api), 1000))
    if (!api) throw new Error('API æœªåˆå§‹åŒ–')
    
    // 1. æ£€æŸ¥ mmId=1
    const mmId = 1
    const app = await api.query.marketMaker.applications(mmId)
    
    if (app.isNone) {
      console.error(`âŒ mmId=${mmId} ä¸å­˜åœ¨ï¼`)
      console.log('\nè§£å†³æ–¹æ³•ï¼š')
      console.log('  1. åˆ°ç”¨æˆ·ç«¯åˆ›å»ºç”³è¯·ï¼šhttp://localhost:5173/#/otc/market-maker-create')
      console.log('  2. å®Œæˆä¸¤æ­¥ï¼šè´¨æŠ¼ä¿è¯é‡‘ + æäº¤èµ„æ–™')
      console.log('  3. è®°å½•ç”Ÿæˆçš„ mmId')
      console.log('  4. å›åˆ°æ²»ç†å¹³å°åˆ›å»ºææ¡ˆ')
      return
    }
    
    const appData = app.unwrap().toJSON()
    console.log('âœ… mmId=' + mmId + ' å­˜åœ¨')
    console.log('çŠ¶æ€:', appData.status)
    console.log('ç”³è¯·äºº:', appData.owner)
    
    // 2. æ£€æŸ¥çŠ¶æ€
    if (appData.status !== 'PendingReview') {
      console.error('âŒ çŠ¶æ€ä¸å¯¹ï¼')
      console.log('å½“å‰çŠ¶æ€:', appData.status)
      console.log('éœ€è¦çŠ¶æ€: PendingReview')
      console.log('\nè§£å†³æ–¹æ³•ï¼š')
      if (appData.status === 'DepositLocked') {
        console.log('  çŠ¶æ€æ˜¯ DepositLockedï¼Œéœ€è¦æäº¤èµ„æ–™')
        console.log('  åˆ°ç”¨æˆ·ç«¯å®Œæˆç¬¬äºŒæ­¥ï¼šæäº¤èµ„æ–™')
      } else {
        console.log('  è¯¥ç”³è¯·å·²å¤„ç†å®Œæ¯•ï¼Œæ— éœ€åˆ›å»ºææ¡ˆ')
      }
      return
    }
    
    console.log('âœ… çŠ¶æ€æ­£ç¡®')
    
    // 3. æ£€æŸ¥æ—¶é—´
    const nowMs = await api.query.timestamp.now()
    const now = Number(nowMs.toString()) / 1000
    if (now > appData.reviewDeadline) {
      console.error('âŒ å·²è¿‡æœŸï¼')
      return
    }
    console.log('âœ… æœªè¿‡æœŸ')
    
    // 4. æ£€æŸ¥å§”å‘˜ä¼šæˆå‘˜
    const members = await api.query.council.members()
    const current = window.activeAccount
    if (!current) {
      console.error('âŒ æœªè¿æ¥é’±åŒ…')
      return
    }
    const isMember = members.toJSON().includes(current)
    console.log(isMember ? 'âœ… æ˜¯å§”å‘˜ä¼šæˆå‘˜' : 'âŒ ä¸æ˜¯å§”å‘˜ä¼šæˆå‘˜')
    
    if (!isMember) {
      console.log('\nè§£å†³æ–¹æ³•ï¼š')
      console.log('  åˆ‡æ¢åˆ°å§”å‘˜ä¼šæˆå‘˜è´¦æˆ·')
      return
    }
    
    // 5. æµ‹è¯• innerCall
    console.log('\næµ‹è¯• innerCall:')
    const innerCall = api.tx.marketMaker.approve(mmId)
    console.log('âœ… innerCall æ„å»ºæˆåŠŸ')
    console.log('  encodedLength:', innerCall.encodedLength)
    
    // 6. æµ‹è¯• propose
    const proposeTx = api.tx.council.propose(2, innerCall, innerCall.encodedLength)
    console.log('âœ… propose äº¤æ˜“æ„å»ºæˆåŠŸ')
    
    console.log('\nâœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼')
    console.log('å¦‚æœä»ç„¶å¤±è´¥ï¼Œå¯èƒ½æ˜¯é“¾ç«¯é—®é¢˜ã€‚')
    console.log('å»ºè®®ï¼š')
    console.log('  1. æŸ¥çœ‹é“¾ç«¯æ—¥å¿—')
    console.log('  2. é‡æ–°ç¼–è¯‘é“¾ç«¯')
    console.log('  3. æŸ¥çœ‹è¯¦ç»†è¯Šæ–­æŒ‡å—ï¼šdocs/æ²»ç†å¹³å°Wasm_Unreachableé”™è¯¯å®Œæ•´è¯Šæ–­æŒ‡å—.md')
    
  } catch (e) {
    console.error('è¯Šæ–­å¤±è´¥:', e)
  } finally {
    console.groupEnd()
  }
})()
```

---

## ğŸ“Š å¯èƒ½çš„ç»“æœ

### ç»“æœ 1ï¼šmmId ä¸å­˜åœ¨

```
âŒ mmId=1 ä¸å­˜åœ¨ï¼
è§£å†³æ–¹æ³•ï¼š
  1. åˆ°ç”¨æˆ·ç«¯åˆ›å»ºç”³è¯·
  2. å®Œæˆä¸¤æ­¥ï¼šè´¨æŠ¼ä¿è¯é‡‘ + æäº¤èµ„æ–™
  3. è®°å½•ç”Ÿæˆçš„ mmId
  4. å›åˆ°æ²»ç†å¹³å°åˆ›å»ºææ¡ˆ
```

**æ“ä½œ**ï¼š
```bash
cd /home/xiaodong/æ–‡æ¡£/memopark/memopark-dapp
npm run dev
# è®¿é—® http://localhost:5173/#/otc/market-maker-create
```

---

### ç»“æœ 2ï¼šçŠ¶æ€ä¸å¯¹

```
âœ… mmId=1 å­˜åœ¨
âŒ çŠ¶æ€ä¸å¯¹ï¼
å½“å‰çŠ¶æ€: DepositLocked
éœ€è¦çŠ¶æ€: PendingReview
```

**æ“ä½œ**ï¼šå›åˆ°ç”¨æˆ·ç«¯ï¼Œå®Œæˆç¬¬äºŒæ­¥"æäº¤èµ„æ–™"

---

### ç»“æœ 3ï¼šæ‰€æœ‰æ£€æŸ¥é€šè¿‡

```
âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼
å¦‚æœä»ç„¶å¤±è´¥ï¼Œå¯èƒ½æ˜¯é“¾ç«¯é—®é¢˜ã€‚
```

**æ“ä½œ**ï¼š

1. **æŸ¥çœ‹é“¾ç«¯æ—¥å¿—**ï¼š
   ```bash
   tail -f /home/xiaodong/æ–‡æ¡£/memopark/node.log | grep -i "market\|panic\|unreachable"
   ```

2. **é‡æ–°ç¼–è¯‘é“¾ç«¯**ï¼š
   ```bash
   cd /home/xiaodong/æ–‡æ¡£/memopark
   cargo build --release
   ./é“¾ç«¯å®Œå…¨é‡ç½®å¹¶å¯åŠ¨.sh
   ```

3. **æŸ¥çœ‹è¯¦ç»†æŒ‡å—**ï¼š
   - `docs/æ²»ç†å¹³å°Wasm_Unreachableé”™è¯¯å®Œæ•´è¯Šæ–­æŒ‡å—.md`

---

## ğŸš€ å¿«é€Ÿä¿®å¤ï¼ˆæ¨èï¼‰

å¦‚æœä¸ç¡®å®šé—®é¢˜åœ¨å“ªï¼Œç›´æ¥æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

```bash
# 1. å®Œå…¨é‡ç½®é“¾ç«¯ï¼ˆä¼šæ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼‰
cd /home/xiaodong/æ–‡æ¡£/memopark
cargo build --release
./é“¾ç«¯å®Œå…¨é‡ç½®å¹¶å¯åŠ¨.sh

# 2. é‡æ–°å¯åŠ¨ç”¨æˆ·ç«¯
cd memopark-dapp
npm run dev

# 3. åˆ›å»ºæµ‹è¯•ç”³è¯·
# è®¿é—® http://localhost:5173/#/otc/market-maker-create
# å®Œæˆè´¨æŠ¼ + æäº¤èµ„æ–™ï¼Œè®°å½• mmIdï¼ˆä¾‹å¦‚ï¼š0ï¼‰

# 4. é‡æ–°å¯åŠ¨æ²»ç†å¹³å°
cd ../memopark-governance
npm run dev

# 5. åˆ›å»ºææ¡ˆ
# è®¿é—® http://localhost:3000/proposals/create?mmId=0&type=approve
# å¡«å†™å¹¶æäº¤
```

---

**ç‰ˆæœ¬**: v1.2.0  
**æ›´æ–°**: 2025-10-15

