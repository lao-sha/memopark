# 治理平台钱包管理功能使用说明

## ✅ 功能已完成

治理平台现在已经完整支持钱包创建、恢复和管理功能。

---

## 📋 新增页面

### 1. 创建钱包

**路径：** `/wallet/create`  
**URL：** http://localhost:3000/wallet/create

**功能：**
- ✅ 自动生成12个单词的助记词
- ✅ 显示/隐藏助记词（隐私保护）
- ✅ 一键复制助记词
- ✅ 强制确认已备份
- ✅ 设置密码加密存储
- ✅ 自动保存到 localStorage
- ✅ 完成后自动跳转到首页

**使用流程：**
```
步骤1: 生成助记词 → 步骤2: 备份助记词 → 步骤3: 设置密码 → 完成
```

**安全提示：**
- 助记词只显示一次，请务必备份
- 密码至少8位，用于签名时验证
- 所有数据仅存储在本地，不上传服务器

---

### 2. 恢复钱包

**路径：** `/wallet/recover`  
**URL：** http://localhost:3000/wallet/recover

**功能：**
- ✅ 输入12个单词的助记词
- ✅ 自动验证助记词有效性
- ✅ 显示恢复的地址
- ✅ 设置新密码
- ✅ 保存到 localStorage
- ✅ 完成后自动跳转到首页

**使用流程：**
```
步骤1: 输入助记词 → 步骤2: 设置密码 → 完成
```

**注意事项：**
- 助记词必须是12个单词，用空格分隔
- 输入错误的助记词会生成不同的地址
- 密码可以设置为新密码，不需要与原密码相同

---

### 3. 钱包管理

**路径：** `/wallet/manage`  
**URL：** http://localhost:3000/wallet/manage

**功能：**
- ✅ 查看所有账户列表
- ✅ 显示每个账户的余额
- ✅ 切换当前使用的账户
- ✅ 设置账户别名（便于识别）
- ✅ 导出 Keystore JSON
- ✅ 删除账户（需确认）
- ✅ 刷新余额

**表格列说明：**
| 列名 | 说明 |
|------|------|
| 别名 | 自定义账户名称，点击编辑按钮可修改 |
| 地址 | 账户地址，点击复制按钮可复制完整地址 |
| 余额 | 当前账户的可用余额（MEMO） |
| 操作 | 切换、导出、删除 |

**安全功能：**
- ✅ 当前使用的账户无法删除（需先切换）
- ✅ 最后一个账户无法删除
- ✅ 删除前需要二次确认
- ✅ 提醒用户备份助记词

---

## 🎯 访问入口

### 方式1：侧边栏菜单

在主界面左侧导航栏中：

```
📁 钱包管理
  ├─ 我的钱包     → /wallet/manage
  ├─ 创建钱包     → /wallet/create
  └─ 恢复钱包     → /wallet/recover
```

### 方式2：顶部账户下拉菜单

点击顶部的账户地址 → 下拉菜单 → "管理钱包"

### 方式3：直接访问URL

- 创建钱包：http://localhost:3000/wallet/create
- 恢复钱包：http://localhost:3000/wallet/recover
- 管理钱包：http://localhost:3000/wallet/manage

---

## 💡 使用场景

### 场景1：首次使用治理平台

```
1. 打开治理平台
2. 点击侧边栏"钱包管理" → "创建钱包"
3. 按照步骤生成并备份助记词
4. 设置密码
5. 完成后自动跳转到首页，显示"已连接"
```

### 场景2：在其他设备恢复钱包

```
1. 打开治理平台
2. 点击侧边栏"钱包管理" → "恢复钱包"
3. 输入之前备份的12个单词助记词
4. 设置新密码（可以与原密码不同）
5. 完成后自动跳转到首页
```

### 场景3：管理多个账户

```
1. 打开"我的钱包"页面
2. 查看所有账户列表和余额
3. 点击"切换"切换到其他账户
4. 点击编辑按钮设置别名（如"开发账户"、"测试账户"）
5. 需要时可以导出 Keystore 或删除账户
```

### 场景4：快速切换账户

```
方式A: 顶部账户下拉菜单
1. 点击顶部的账户地址
2. 在下拉菜单中选择其他账户
3. 点击即可切换

方式B: 钱包管理页面
1. 进入"我的钱包"
2. 找到要切换的账户
3. 点击"切换"按钮
```

---

## 🔐 安全特性

### 数据存储

| 数据类型 | 存储位置 | 加密方式 |
|---------|---------|---------|
| 助记词 | localStorage | PBKDF2 (210,000次) + AES-GCM 256位 |
| 密码 | 不存储 | 仅在签名时输入 |
| 账户地址 | localStorage | 明文（公开信息） |
| 别名 | localStorage | 明文（本地标识） |

### 安全机制

1. **助记词加密**
   - 使用 PBKDF2 进行密钥派生（210,000次迭代）
   - 使用 AES-GCM 256位加密存储
   - 每次加密使用随机盐和IV

2. **密码保护**
   - 密码至少8位
   - 密码不存储在任何地方
   - 每次签名都需要输入密码

3. **备份提醒**
   - 创建时强制确认已备份
   - 删除前提醒备份助记词
   - 导出功能便于跨设备迁移

4. **操作保护**
   - 删除账户需要二次确认
   - 当前使用的账户无法删除
   - 最后一个账户无法删除

---

## 📊 数据结构

### localStorage 存储的数据

```javascript
// 所有账户的 keystore（加密）
"mp.keystores": [
  {
    "address": "5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY",
    "ciphertext": "base64...",  // 加密的助记词
    "salt": "base64...",
    "iv": "base64...",
    "createdAt": 1697000000000
  },
  // 其他账户...
]

// 当前选中的账户地址
"mp.current": "5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY"

// 账户别名
"mp.aliases": {
  "5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY": "开发账户",
  "5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty": "测试账户"
}
```

---

## 🎨 界面截图（文字描述）

### 创建钱包页面

```
┌─────────────────────────────────────────────┐
│  🔑 创建钱包                                │
├─────────────────────────────────────────────┤
│  进度：[🔑生成] → [💾备份] → [🔒密码]       │
├─────────────────────────────────────────────┤
│  步骤2：备份助记词                          │
│                                              │
│  ⚠️ 重要：请备份助记词                     │
│  助记词是恢复钱包的唯一方式...              │
│                                              │
│  ┌────────────────────────────────────┐    │
│  │ 您的助记词（12个单词）   [隐藏] [复制]│    │
│  ├────────────────────────────────────┤    │
│  │ word1 word2 word3 word4 word5      │    │
│  │ word6 word7 word8 word9 word10     │    │
│  │ word11 word12                       │    │
│  └────────────────────────────────────┘    │
│                                              │
│  ☑ 我已备份助记词，并理解...               │
│                                              │
│  [上一步]  [下一步]                        │
└─────────────────────────────────────────────┘
```

### 钱包管理页面

```
┌─────────────────────────────────────────────────────────────┐
│  💼 钱包管理  [2个账户]        [+创建钱包] [+恢复钱包]    │
├─────────────────────────────────────────────────────────────┤
│  别名      │ 地址                           │ 余额         │ 操作      │
│  ──────────┼────────────────────────────────┼─────────────┼──────────│
│  开发账户  │ 5GrwvaEF...KutQY [✓当前]      │ 1,234 MEMO  │ [导出][删除]│
│  [✏️]      │ [📋复制]                       │             │          │
│  ──────────┼────────────────────────────────┼─────────────┼──────────│
│  测试账户  │ 5FHneW4...M694ty               │ 567 MEMO    │ [切换][导出][删除]│
│  [✏️]      │ [📋复制]                       │             │          │
└─────────────────────────────────────────────────────────────┘
                          [刷新余额]
```

---

## ⚠️ 注意事项

### 1. 备份助记词

- ✅ **务必备份助记词**：助记词是恢复钱包的唯一方式
- ✅ **离线保存**：建议抄写在纸上并妥善保管
- ❌ **不要截图**：避免助记词被云备份或他人获取
- ❌ **不要分享**：任何人都不要分享助记词

### 2. 密码安全

- ✅ **使用强密码**：建议使用大小写字母、数字和符号组合
- ✅ **记住密码**：忘记密码可以用助记词恢复
- ❌ **不要使用弱密码**：避免使用生日、123456等简单密码

### 3. 跨设备使用

**方式A：使用助记词恢复**
```
1. 在新设备上打开治理平台
2. 点击"恢复钱包"
3. 输入助记词
4. 设置新密码
```

**方式B：导出 Keystore**
```
1. 在原设备上导出 Keystore JSON
2. 将文件传输到新设备（安全方式）
3. 在新设备上导入（功能待实现）
```

### 4. 删除账户

- ⚠️ **确保已备份**：删除前确认已备份助记词
- ⚠️ **无法撤销**：删除后无法恢复（除非有助记词）
- ⚠️ **转移资产**：删除前转移账户中的资产

---

## 🔧 常见问题

### Q1: 忘记密码怎么办？

**A:** 使用助记词恢复钱包
```
1. 进入"恢复钱包"页面
2. 输入您的12个单词助记词
3. 设置新密码
4. 原有账户和余额会完全恢复
```

### Q2: 助记词丢失了怎么办？

**A:** 无法恢复，请创建新钱包
- ❌ 助记词丢失后无法恢复账户
- ❌ 账户中的资产也无法找回
- ✅ 这就是为什么备份助记词如此重要

### Q3: 如何在多个设备上使用同一个钱包？

**A:** 使用助记词在每个设备上恢复
```
设备A: 创建钱包 → 备份助记词
设备B: 恢复钱包 → 输入助记词
设备C: 恢复钱包 → 输入助记词
```

### Q4: 别名会显示在链上吗？

**A:** 不会
- ✅ 别名仅在本地显示
- ✅ 不会上传到链上或服务器
- ✅ 不同设备的别名可以不同

### Q5: 如何删除最后一个账户？

**A:** 无法删除
- ❌ 为了防止误操作，最后一个账户无法删除
- ✅ 如果确实需要删除，可以：
  1. 先创建一个新账户
  2. 再删除原来的账户

---

## 📞 技术支持

如有问题，请查看：

1. **使用本地 Keystore 指南：**
   `/home/xiaodong/文档/memopark/memopark-governance/使用本地Keystore使用指南.md`

2. **改造完成报告：**
   `/home/xiaodong/文档/memopark/docs/治理平台改造完成报告.md`

3. **浏览器控制台：**
   - 按 F12 打开开发者工具
   - 查看 Console 标签的错误信息

4. **localStorage 检查：**
   ```javascript
   // 在控制台运行
   console.log('Keystores:', localStorage.getItem('mp.keystores'))
   console.log('Current:', localStorage.getItem('mp.current'))
   console.log('Aliases:', localStorage.getItem('mp.aliases'))
   ```

---

**最后更新：** 2025-10-15  
**功能状态：** ✅ 已完成  
**测试状态：** ⏳ 待验证

