# å…«å­—çŸ¥è¯†åº“ç³»ç»Ÿ

## ğŸ“š æ¦‚è¿°

æœ¬çŸ¥è¯†åº“ç³»ç»Ÿä¸º **Xuanxue Oracle** é¡¹ç›®æä¾›ä¸“ä¸šçš„å…«å­—å‘½ç†çŸ¥è¯†æ”¯æŒï¼Œé€šè¿‡ç»“æ„åŒ–çš„JSONæ•°æ®å’ŒRustä»£ç é›†æˆï¼Œå®ç°AIè§£è¯»çš„çŸ¥è¯†å¢å¼ºã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

- **å¤©å¹²åœ°æ”¯çŸ¥è¯†**: 10å¤©å¹² + 12åœ°æ”¯çš„å®Œæ•´å±æ€§ã€å…³ç³»ã€ç»å…¸ç†è®º
- **äº”è¡Œç†è®º**: é‡‘æœ¨æ°´ç«åœŸçš„ç›¸ç”Ÿç›¸å…‹ã€æ€§æ ¼å¥åº·ã€èŒä¸šæ–¹å‘
- **åç¥ä½“ç³»**: 10ç§åç¥çš„è±¡ä¹‰ã€å‰å‡¶ã€èŒä¸šå©šå§»å¥åº·åˆ†æ
- **æ ¼å±€ç†è®º**: æ­£å…«æ ¼åŠä»æ ¼çš„æˆè´¥æ¡ä»¶ã€äººç”Ÿå±‚æ¬¡åˆ¤å®š
- **è°ƒå€™ç”¨ç¥**: åŸºäºã€Šç©·é€šå®é‰´ã€‹çš„å››å­£è°ƒå€™ç†è®º
- **è§£è¯»è§„åˆ™**: äº‹ä¸šã€è´¢è¿ã€å©šå§»ã€å¥åº·çš„å…·ä½“è§£è¯»è§„åˆ™

## ğŸ“‚ ç›®å½•ç»“æ„

```
knowledge/
â”œâ”€â”€ bazi/                           # å…«å­—çŸ¥è¯†åº“
â”‚   â”œâ”€â”€ basics/                     # åŸºç¡€çŸ¥è¯†
â”‚   â”‚   â”œâ”€â”€ tiangan.json            # å¤©å¹²(10æ¡)
â”‚   â”‚   â”œâ”€â”€ dizhi.json              # åœ°æ”¯(12æ¡)
â”‚   â”‚   â”œâ”€â”€ wuxing.json             # äº”è¡Œç†è®º
â”‚   â”‚   â””â”€â”€ shishen.json            # åç¥ä½“ç³»(10ä¸ª)
â”‚   â”œâ”€â”€ patterns/                   # æ ¼å±€ç†è®º
â”‚   â”‚   â””â”€â”€ zhengge.json            # æ­£æ ¼ç†è®º(14ç§æ ¼å±€)
â”‚   â”œâ”€â”€ yongshen/                   # ç”¨ç¥ä½“ç³»
â”‚   â”‚   â””â”€â”€ tiaohuo.json            # è°ƒå€™ç”¨ç¥(40ç§ç»„åˆ)
â”‚   â””â”€â”€ interpretations/            # è§£è¯»è§„åˆ™
â”‚       â””â”€â”€ core_rules.json         # æ ¸å¿ƒè§„åˆ™(äº‹ä¸š/è´¢è¿/å©šå§»/å¥åº·)
â””â”€â”€ shared/
    â””â”€â”€ terminology.json            # æœ¯è¯­è¯å…¸(å¾…æ‰©å±•)
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åœ¨Rustä»£ç ä¸­ä½¿ç”¨

```rust
use crate::knowledge::BaziKnowledgeBase;

// åŠ è½½çŸ¥è¯†åº“
let kb = BaziKnowledgeBase::load()?;

// æŸ¥è¯¢å¤©å¹²ä¿¡æ¯
if let Some(jia_info) = kb.get_tiangan_info("ç”²") {
    println!("äº”è¡Œ: {}", jia_info.wuxing);
    println!("è±¡ä¹‰: {}", jia_info.image);
}

// æŸ¥è¯¢æ ¼å±€ä¿¡æ¯
if let Some(pattern) = kb.get_pattern_info("æ­£å®˜æ ¼") {
    println!("å®šä¹‰: {}", pattern.definition);
    println!("äººç”Ÿå±‚æ¬¡: {}", pattern.life_level);
}

// å¢å¼ºPrompt
let bazi_data = serde_json::json!({
    "day_master": "ç”²æœ¨",
    "geju": "æ­£å®˜æ ¼",
    "yongshen": "ç«"
});

let enriched_prompt = kb.enrich_prompt(base_prompt, &bazi_data);
```

### 2. PromptBuilderè‡ªåŠ¨é›†æˆ

`PromptBuilder`å·²è‡ªåŠ¨é›†æˆçŸ¥è¯†åº“ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ï¼š

```rust
let mut prompt_builder = PromptBuilder::new()?;  // è‡ªåŠ¨åŠ è½½çŸ¥è¯†åº“

let prompt = prompt_builder.build_prompt(
    DivinationType::Bazi,
    InterpretationType::Professional,
    &bazi_data
)?;  // è¿”å›çš„promptå·²ç»åŒ…å«çŸ¥è¯†åº“å¢å¼ºå†…å®¹
```

## ğŸ“Š çŸ¥è¯†åº“ç»Ÿè®¡

| ç±»åˆ« | æ¡ç›®æ•° | è¯´æ˜ |
|------|--------|------|
| å¤©å¹² | 10 | ç”²ä¹™ä¸™ä¸æˆŠå·±åºšè¾›å£¬ç™¸ |
| åœ°æ”¯ | 12 | å­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥ |
| æ ¼å±€ | 14+ | æ­£å…«æ ¼ã€ä»æ ¼ã€å»ºç¦„æ ¼ç­‰ |
| åç¥ | 10 | æ¯”åŠ«é£Ÿä¼¤è´¢å®˜å° |
| è°ƒå€™ | 40+ | 10å¤©å¹²Ã—4å­£èŠ‚çš„è°ƒå€™ç»„åˆ |
| äº”è¡Œ | å®Œæ•´ | ç›¸ç”Ÿç›¸å…‹ã€ç–¾ç—…ã€èŒä¸šç­‰ |
| è§£è¯»è§„åˆ™ | 50+ | äº‹ä¸š/è´¢è¿/å©šå§»/å¥åº·è§„åˆ™ |

## âœ… æµ‹è¯•éªŒè¯

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯çŸ¥è¯†åº“å®Œæ•´æ€§ï¼š

```bash
./test_knowledge.sh
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥
- âœ… JSONæ ¼å¼éªŒè¯
- âœ… å†…å®¹ç»Ÿè®¡
- âœ… æŸ¥è¯¢ç¤ºä¾‹

## ğŸ“– çŸ¥è¯†æ¥æº

æœ¬çŸ¥è¯†åº“åŸºäºä»¥ä¸‹ç»å…¸å‘½ç†è‘—ä½œç¼–æ’°ï¼š

1. **ã€Šå­å¹³çœŸè¯ ã€‹**(æ¸…Â·æ²ˆå­ç») - æ ¼å±€ç†è®ºæƒå¨
2. **ã€Šæ»´å¤©é«“ã€‹**(æ˜Â·åˆ˜ä¼¯æ¸©æ³¨) - å‘½ç†æœ€é«˜ç†è®º
3. **ã€Šç©·é€šå®é‰´ã€‹**(æ¸…Â·ä½™æ˜¥å°) - è°ƒå€™ç”¨ç¥æ ¸å¿ƒ
4. **ã€Šä¸‰å‘½é€šä¼šã€‹**(æ˜Â·ä¸‡æ°‘è‹±) - å‘½ç†ç™¾ç§‘å…¨ä¹¦
5. **ã€Šå‘½ç†æ¢æºã€‹**(æ°‘å›½Â·è¢æ ‘çŠ) - ç°ä»£å‘½ç†å¥ åŸº

## ğŸ”§ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„å¤©å¹²ä¿¡æ¯

ç¼–è¾‘ `knowledge/bazi/basics/tiangan.json`:

```json
{
  "æ–°å¤©å¹²": {
    "wuxing": "å±æ€§",
    "yinyang": "é˜´é˜³",
    "image": "è±¡ä¹‰",
    "classical_quotes": [
      {
        "source": "æ¥æº",
        "quote": "åŸæ–‡",
        "meaning": "é‡Šä¹‰"
      }
    ]
  }
}
```

### æ·»åŠ æ–°çš„æ ¼å±€

ç¼–è¾‘ `knowledge/bazi/patterns/zhengge.json`:

```json
{
  "æ–°æ ¼å±€å": {
    "definition": "å®šä¹‰",
    "formation_conditions": ["æ¡ä»¶1", "æ¡ä»¶2"],
    "success_marks": {},
    "failure_marks": {},
    "classical_theory": {
      "source": "æ¥æº",
      "quote": "å¼•ç”¨",
      "explanation": "è§£é‡Š"
    }
  }
}
```

### ä¿®æ”¹çŸ¥è¯†åº“åŠ è½½é€»è¾‘

ç¼–è¾‘ `src/knowledge/mod.rs` ä¸­çš„ `BaziKnowledgeBase::load()` æ–¹æ³•ã€‚

## ğŸ“ æ•°æ®å­—æ®µè¯´æ˜

### å¤©å¹² (TianganInfo)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| wuxing | String | äº”è¡Œå±æ€§ |
| yinyang | String | é˜´é˜³å±æ€§ |
| image | String | è±¡ä¹‰æè¿° |
| personality | Object | æ€§æ ¼ç‰¹å¾(positive/negative) |
| career_fields | Array | é€‚åˆèŒä¸š |
| classical_quotes | Array | ç»å…¸å¼•ç”¨ |
| season_strength | Map | å››å­£åŠ›é‡ |

### æ ¼å±€ (PatternInfo)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| definition | String | æ ¼å±€å®šä¹‰ |
| formation_conditions | Array | æˆæ ¼æ¡ä»¶ |
| success_marks | Object | æˆæ ¼æ ‡å¿— |
| failure_marks | Object | ç ´æ ¼æ ‡å¿— |
| life_level | String | äººç”Ÿå±‚æ¬¡ |
| classical_theory | Object | ç»å…¸ç†è®º |

## ğŸ“ˆ ç‰ˆæœ¬å†å²

- **v1.0** (2025-01-06): åˆå§‹ç‰ˆæœ¬
  - å®Œæˆ10å¤©å¹²ã€12åœ°æ”¯åŸºç¡€çŸ¥è¯†
  - å®Œæˆ14ç§æ ¼å±€ç†è®º
  - å®Œæˆ10ç¥ä½“ç³»
  - å®Œæˆäº”è¡Œç†è®º
  - å®Œæˆè°ƒå€™ç”¨ç¥
  - å®Œæˆæ ¸å¿ƒè§£è¯»è§„åˆ™
  - é›†æˆåˆ°PromptBuilder

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®æ›´å¤šå‘½ç†çŸ¥è¯†ï¼è¯·ç¡®ä¿ï¼š

1. JSONæ ¼å¼æ­£ç¡®ï¼ˆä½¿ç”¨ `python3 -m json.tool` éªŒè¯ï¼‰
2. å¼•ç”¨ç»å…¸åŸæ–‡å¹¶æ³¨æ˜å‡ºå¤„
3. å†…å®¹å‡†ç¡®ç¬¦åˆä¼ ç»Ÿå‘½ç†å­¦ç†è®º
4. è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯å®Œæ•´æ€§

## ğŸ“ License

æœ¬çŸ¥è¯†åº“å†…å®¹åŸºäºä¼ ç»Ÿå‘½ç†å­¦å…¬å¼€ç†è®ºæ•´ç†ï¼Œä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [Xuanxue Oracle é¡¹ç›®ä¸»é¡µ](../README.md)
- [PromptBuilder æ–‡æ¡£](../docs/PROMPT_OPTIMIZATION.md)
- [API æ–‡æ¡£](../docs/API.md)
