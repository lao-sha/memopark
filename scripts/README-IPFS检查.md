# IPFSæ ¸å¿ƒèŠ‚ç‚¹å…¬ç½‘è¿æ¥æ£€æŸ¥å·¥å…·

## ğŸ¯ å¿«é€Ÿä½¿ç”¨

### å‰ææ¡ä»¶

1. ç¡®ä¿å·²å®‰è£…å¿…è¦å·¥å…·ï¼š
```bash
# æ£€æŸ¥curl
which curl

# æ£€æŸ¥jqï¼ˆJSONå¤„ç†å·¥å…·ï¼‰
which jq

# å¦‚æœjqæœªå®‰è£…ï¼Œæ‰§è¡Œï¼š
sudo apt-get install jq -y
```

2. ç¡®ä¿IPFSèŠ‚ç‚¹æ­£åœ¨è¿è¡Œï¼š
```bash
# æ£€æŸ¥IPFSè¿›ç¨‹
ps aux | grep ipfs

# æˆ–æ£€æŸ¥systemdæœåŠ¡
systemctl status ipfs
```

### æ‰§è¡Œæ£€æŸ¥

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/xiaodong/æ–‡æ¡£/memopark

# è¿è¡Œæ£€æŸ¥è„šæœ¬
./scripts/check-ipfs-public-network.sh
```

### é¢„æœŸè¾“å‡º

```
========================================
IPFSæ ¸å¿ƒèŠ‚ç‚¹å…¬ç½‘è¿æ¥æ£€æŸ¥
========================================

========================================
æ£€æŸ¥èŠ‚ç‚¹ 1/3: Core Node 1
========================================

æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦åœ¨çº¿: Core Node 1 (http://localhost:5001)
âœ“ èŠ‚ç‚¹åœ¨çº¿

æ£€æŸ¥èŠ‚ç‚¹ä¿¡æ¯: Core Node 1
Peer ID: QmXXXXXXXXXXXXXXXX...

ç›‘å¬åœ°å€:
/ip4/127.0.0.1/tcp/4001
/ip4/192.168.1.100/tcp/4001
/ip4/203.0.113.10/tcp/4001
âœ“ æ£€æµ‹åˆ°å…¬ç½‘åœ°å€: /ip4/203.0.113.10/tcp/4001

æ£€æŸ¥Swarmå¯¹ç­‰èŠ‚ç‚¹: Core Node 1
æ€»å¯¹ç­‰èŠ‚ç‚¹æ•°: 156
  - å…¬ç½‘èŠ‚ç‚¹: 143
  - ç§æœ‰èŠ‚ç‚¹: 13
âœ“ è¿æ¥åˆ°è¶³å¤Ÿçš„å…¬ç½‘èŠ‚ç‚¹ (143ä¸ª)

æ£€æŸ¥DHTåŠŸèƒ½: Core Node 1
æµ‹è¯•DHTæŸ¥è¯¢ (CID: QmYwAPJzv5CZsnA625s3Xf2nemtYgPpHdWEz79ojWnPbdG)...
âœ“ DHTæŸ¥è¯¢æˆåŠŸ - æ‰¾åˆ° 8 ä¸ªæä¾›è€…

æ£€æŸ¥IPFSé…ç½®: Core Node 1
æ£€æŸ¥Routingé…ç½®...
âœ“ Routingç±»å‹: dht (DHTå·²å¯ç”¨)

========================================
æ£€æŸ¥å®Œæˆ
========================================

âœ“ æ‰€æœ‰æ ¸å¿ƒèŠ‚ç‚¹å‡å·²æ­£ç¡®è¿æ¥åˆ°IPFSå…¬ç½‘ âœ“

æŠ¥å‘Šå·²ä¿å­˜åˆ°: ipfs-public-network-check-20251027-143025.md

========================================
æŠ¥å‘Šä½ç½®
========================================
å®Œæ•´è·¯å¾„: /home/xiaodong/æ–‡æ¡£/memopark/ipfs-public-network-check-20251027-143025.md
```

### æŸ¥çœ‹æŠ¥å‘Š

```bash
# æŸ¥çœ‹æœ€æ–°çš„æ£€æŸ¥æŠ¥å‘Š
cat ipfs-public-network-check-*.md | tail -100

# æˆ–ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨
nano ipfs-public-network-check-*.md
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### è‡ªå®šä¹‰æ£€æŸ¥çš„èŠ‚ç‚¹

ç¼–è¾‘è„šæœ¬å¼€å¤´çš„é…ç½®éƒ¨åˆ†ï¼š

```bash
nano scripts/check-ipfs-public-network.sh
```

æ‰¾åˆ°å¹¶ä¿®æ”¹ï¼š
```bash
# é…ç½®ï¼š3ä¸ªæ ¸å¿ƒèŠ‚ç‚¹çš„APIåœ°å€
NODES=(
    "http://localhost:5001"      # èŠ‚ç‚¹1
    "http://localhost:5002"      # èŠ‚ç‚¹2
    "http://localhost:5003"      # èŠ‚ç‚¹3
)

# èŠ‚ç‚¹åç§°
NODE_NAMES=(
    "Core Node 1"
    "Core Node 2"
    "Core Node 3"
)
```

### å¦‚æœåªæœ‰1ä¸ªèŠ‚ç‚¹

```bash
NODES=(
    "http://localhost:5001"
)

NODE_NAMES=(
    "Main IPFS Node"
)
```

### å¦‚æœèŠ‚ç‚¹åœ¨è¿œç¨‹æœåŠ¡å™¨

```bash
NODES=(
    "http://192.168.1.100:5001"
    "http://192.168.1.101:5001"
    "http://192.168.1.102:5001"
)
```

**æ³¨æ„**: ç¡®ä¿é˜²ç«å¢™å…è®¸è®¿é—®è¿œç¨‹IPFS APIç«¯å£ï¼ˆé»˜è®¤5001ï¼‰ã€‚

---

## ğŸ“Š æ£€æŸ¥ç»“æœåˆ¤æ–­

### âœ… ç†æƒ³ç»“æœï¼ˆæ¨èï¼‰

æ‰€æœ‰æŒ‡æ ‡éƒ½åº”è¯¥æ˜¯ï¼š
- âœ“ èŠ‚ç‚¹åœ¨çº¿
- âœ“ å…¬ç½‘å¯¹ç­‰èŠ‚ç‚¹ > 50ä¸ª
- âœ“ DHTåŠŸèƒ½æ­£å¸¸
- âœ“ Routingé…ç½®ä¸º `dht`

### âš ï¸ éœ€è¦ä¼˜åŒ–

å¦‚æœçœ‹åˆ°ï¼š
- âš ï¸ å…¬ç½‘å¯¹ç­‰èŠ‚ç‚¹ < 10ä¸ª
- âš ï¸ DHTæŸ¥è¯¢è¶…æ—¶
- âš ï¸ Routingé…ç½®ä¸º `dhtclient`

**æ“ä½œ**: å‚è€ƒæ£€æŸ¥æŒ‡å—è¿›è¡Œä¼˜åŒ–

### âŒ éœ€è¦ç«‹å³ä¿®å¤

å¦‚æœçœ‹åˆ°ï¼š
- âŒ èŠ‚ç‚¹ç¦»çº¿
- âŒ å…¬ç½‘å¯¹ç­‰èŠ‚ç‚¹ = 0
- âŒ DHTæŸ¥è¯¢å¤±è´¥
- âŒ Routingé…ç½®ä¸º `none`

**æ“ä½œ**: æŒ‰ç…§æ£€æŸ¥æŒ‡å—ç´§æ€¥ä¿®å¤æ­¥éª¤æ“ä½œ

---

## ğŸ” å¸¸è§æ£€æŸ¥åœºæ™¯

### åœºæ™¯1ï¼šæ–°éƒ¨ç½²çš„IPFSèŠ‚ç‚¹

é¦–æ¬¡æ£€æŸ¥å¯èƒ½çœ‹åˆ°è¾ƒå°‘çš„å…¬ç½‘è¿æ¥ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚ç­‰å¾…5-10åˆ†é’Ÿåå†æ¬¡æ£€æŸ¥ï¼š

```bash
# ç­‰å¾…èŠ‚ç‚¹å‘ç°æ›´å¤špeers
sleep 600  # 10åˆ†é’Ÿ

# å†æ¬¡æ£€æŸ¥
./scripts/check-ipfs-public-network.sh
```

### åœºæ™¯2ï¼šä»ç§æœ‰ç½‘ç»œè¿ç§»åˆ°å…¬ç½‘

å¦‚æœèŠ‚ç‚¹ä¹‹å‰é…ç½®ä¸ºç§æœ‰ç½‘ç»œï¼Œéœ€è¦ï¼š

```bash
# 1. æ¸…ç†æ—§çš„é…ç½®
ipfs config --json Swarm.AddrFilters '[]'

# 2. å¯ç”¨å…¬ç½‘DHT
ipfs config Routing.Type dht

# 3. æ·»åŠ å…¬ç½‘å¼•å¯¼èŠ‚ç‚¹
ipfs bootstrap add --default

# 4. é‡å¯IPFS
ipfs shutdown
ipfs daemon &

# 5. ç­‰å¾…5åˆ†é’Ÿåæ£€æŸ¥
sleep 300
./scripts/check-ipfs-public-network.sh
```

### åœºæ™¯3ï¼šæ£€æŸ¥ç‰¹å®šåŠŸèƒ½

å¦‚æœåªæƒ³æ£€æŸ¥æŸä¸ªå…·ä½“åŠŸèƒ½ï¼š

```bash
# åªæ£€æŸ¥å¯¹ç­‰èŠ‚ç‚¹æ•°
curl -X POST "http://localhost:5001/api/v0/swarm/peers" | jq '.Peers | length'

# åªæ£€æŸ¥DHTåŠŸèƒ½
curl -X POST "http://localhost:5001/api/v0/dht/findprovs?arg=QmYwAPJzv5CZsnA625s3Xf2nemtYgPpHdWEz79ojWnPbdG"

# åªæ£€æŸ¥Routingé…ç½®
curl -X POST "http://localhost:5001/api/v0/config?arg=Routing.Type" | jq -r '.Value'
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šè„šæœ¬æŠ¥é”™ "jq: command not found"

**è§£å†³**:
```bash
sudo apt-get update
sudo apt-get install jq -y
```

### é—®é¢˜2ï¼šè„šæœ¬æŠ¥é”™ "curl: (7) Failed to connect"

**åŸå› **: IPFSèŠ‚ç‚¹æœªè¿è¡Œæˆ–ç«¯å£é”™è¯¯

**è§£å†³**:
```bash
# æ£€æŸ¥IPFSæ˜¯å¦è¿è¡Œ
ipfs id

# å¦‚æœæœªè¿è¡Œï¼Œå¯åŠ¨IPFS
ipfs daemon &

# æ£€æŸ¥APIç«¯å£
ipfs config Addresses.API
```

### é—®é¢˜3ï¼šæ‰€æœ‰èŠ‚ç‚¹æ˜¾ç¤º"ç¦»çº¿"

**è§£å†³**:
```bash
# 1. æ£€æŸ¥IPFSè¿›ç¨‹
ps aux | grep ipfs

# 2. å¦‚æœæ²¡æœ‰è¿›ç¨‹ï¼Œå¯åŠ¨IPFS
ipfs daemon &

# 3. ç­‰å¾…å¯åŠ¨å®Œæˆï¼ˆçº¦30ç§’ï¼‰
sleep 30

# 4. å†æ¬¡è¿è¡Œæ£€æŸ¥
./scripts/check-ipfs-public-network.sh
```

### é—®é¢˜4ï¼šæƒé™é”™è¯¯

**è§£å†³**:
```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x scripts/check-ipfs-public-network.sh

# å¦‚æœéœ€è¦è®¿é—®è¿œç¨‹èŠ‚ç‚¹ï¼Œç¡®ä¿ç½‘ç»œå¯è¾¾
ping <è¿œç¨‹èŠ‚ç‚¹IP>
telnet <è¿œç¨‹èŠ‚ç‚¹IP> 5001
```

---

## ğŸ“… å®šæœŸæ£€æŸ¥å»ºè®®

### è®¾ç½®è‡ªåŠ¨æ£€æŸ¥ï¼ˆæ¨èï¼‰

```bash
# 1. ç¼–è¾‘crontab
crontab -e

# 2. æ·»åŠ æ¯æ—¥æ£€æŸ¥ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
0 2 * * * cd /home/xiaodong/æ–‡æ¡£/memopark && ./scripts/check-ipfs-public-network.sh >> logs/ipfs-check.log 2>&1

# 3. æ·»åŠ æ¯å‘¨æ£€æŸ¥ï¼ˆæ¯å‘¨ä¸€ä¸Šåˆ9ç‚¹ï¼‰
0 9 * * 1 cd /home/xiaodong/æ–‡æ¡£/memopark && ./scripts/check-ipfs-public-network.sh && mail -s "IPFS Weekly Check" admin@example.com < ipfs-public-network-check-*.md

# 4. ä¿å­˜å¹¶é€€å‡º
```

### æ‰‹åŠ¨å®šæœŸæ£€æŸ¥

å»ºè®®é¢‘ç‡ï¼š
- **æ–°éƒ¨ç½²**: æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡ï¼ˆå‰24å°æ—¶ï¼‰
- **ç¨³å®šè¿è¡Œ**: æ¯å¤©æ£€æŸ¥ä¸€æ¬¡
- **ç”Ÿäº§ç¯å¢ƒ**: æ¯å‘¨æ£€æŸ¥ä¸€æ¬¡ + ç›‘æ§å‘Šè­¦

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [IPFSæ ¸å¿ƒèŠ‚ç‚¹å…¬ç½‘è¿æ¥æ£€æŸ¥æŒ‡å—](../docs/IPFSæ ¸å¿ƒèŠ‚ç‚¹å…¬ç½‘è¿æ¥æ£€æŸ¥æŒ‡å—.md)
- [memo-ipfsä¸‰éœ€æ±‚åˆ†ææŠ¥å‘Š](../docs/memo-ipfsä¸‰éœ€æ±‚åˆ†ææŠ¥å‘Š.md)
- [IPFSå®˜æ–¹æ–‡æ¡£ - Configuration](https://docs.ipfs.tech/how-to/configure-node/)
- [IPFSå®˜æ–¹æ–‡æ¡£ - DHT](https://docs.ipfs.tech/concepts/dht/)

---

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœæ£€æŸ¥åä»æœ‰é—®é¢˜ï¼š

1. **æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š**: æ£€æŸ¥ç”Ÿæˆçš„MarkdownæŠ¥å‘Šæ–‡ä»¶
2. **æ”¶é›†è¯Šæ–­ä¿¡æ¯**:
   ```bash
   # IPFSé…ç½®
   ipfs config show > ipfs-config.json
   
   # IPFSæ—¥å¿—
   ipfs log tail > ipfs-log.txt
   
   # ç½‘ç»œçŠ¶æ€
   netstat -tulpn | grep ipfs > network-status.txt
   ```

3. **æäº¤é—®é¢˜**:
   - é™„ä¸Šæ£€æŸ¥æŠ¥å‘Š
   - é™„ä¸Šè¯Šæ–­ä¿¡æ¯
   - æè¿°ç½‘ç»œç¯å¢ƒï¼ˆå…¬ç½‘/å†…ç½‘/NATç­‰ï¼‰

---

**å·¥å…·ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-27

