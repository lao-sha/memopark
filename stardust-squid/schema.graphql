# Phase 1优化：Subsquid GraphQL Schema
#
# 函数级详细中文注释：定义所有链上数据的查询结构
# - 提供高性能的GraphQL查询接口
# - 支持复杂的过滤、排序、分页
# - 历史数据完整保存

# ===================================================================
# OTC订单相关
# ===================================================================

"""
OTC订单实体
存储所有OTC交易订单的完整信息
"""
type Order @entity {
  "唯一标识: block-event"
  id: ID!
  
  "链上订单ID"
  orderId: BigInt! @index
  
  "买家账户地址"
  buyer: String! @index
  
  "卖家账户地址（做市商）"
  seller: String! @index
  
  "MEMO数量（精度10^12）"
  amount: BigInt!
  
  "USDT金额（精度10^6）"
  usdtAmount: BigInt!
  
  "订单状态"
  state: OrderState! @index
  
  "USDT单价（精度10^6）"
  price: BigInt!
  
  "创建时间"
  createdAt: DateTime! @index
  
  "支付时间"
  paidAt: DateTime
  
  "释放时间"
  releasedAt: DateTime
  
  "完成时间"
  completedAt: DateTime @index
  
  "做市商ID"
  makerId: BigInt @index
  
  "联系方式"
  contactInfo: String
}

"""订单状态枚举"""
enum OrderState {
  "已创建，等待支付"
  Created
  
  "已支付，等待释放"
  Paid
  
  "已释放（完成）"
  Released
  
  "已退款"
  Refunded
  
  "争议中"
  Disputed
  
  "已取消"
  Cancelled
  
  "已过期"
  Expired
}

# ===================================================================
# 申诉相关
# ===================================================================

"""
申诉实体
存储所有申诉记录
"""
type Appeal @entity {
  "唯一标识"
  id: ID!
  
  "链上申诉ID"
  appealId: BigInt! @index
  
  "提交人"
  submitter: String! @index
  
  "申诉域"
  domain: Int! @index
  
  "目标对象ID"
  target: BigInt! @index
  
  "操作类型"
  action: Int!
  
  "状态"
  status: AppealStatus! @index
  
  "提交时间"
  submittedAt: DateTime! @index
  
  "批准时间"
  approvedAt: DateTime
  
  "执行时间"
  executedAt: DateTime
  
  "撤回时间"
  withdrawnAt: DateTime
  
  "驳回时间"
  rejectedAt: DateTime
  
  "押金金额"
  depositAmount: BigInt
}

"""申诉状态枚举"""
enum AppealStatus {
  "待审核"
  Pending
  
  "已批准"
  Approved
  
  "已驳回"
  Rejected
  
  "已撤回"
  Withdrawn
  
  "已执行"
  Executed
  
  "重试耗尽"
  RetryExhausted
  
  "自动驳回"
  AutoDismissed
}

# ===================================================================
# 证据相关
# ===================================================================

"""
证据实体
存储所有证据记录
"""
type Evidence @entity {
  "唯一标识"
  id: ID!
  
  "链上证据ID"
  evidenceId: BigInt! @index
  
  "所有者"
  owner: String! @index
  
  "证据域"
  domain: Int! @index
  
  "目标对象ID"
  targetId: BigInt! @index
  
  "内容CID（IPFS）"
  contentCid: String!
  
  "内容类型"
  contentType: ContentType! @index
  
  "创建时间"
  createdAt: DateTime! @index
  
  "是否加密"
  isEncrypted: Boolean!
  
  "命名空间"
  namespace: String
}

"""内容类型枚举"""
enum ContentType {
  "图片"
  Image
  
  "视频"
  Video
  
  "文档"
  Document
  
  "混合（多种类型）"
  Mixed
}

# ===================================================================
# 逝者纪念相关
# ===================================================================

"""
逝者记录
"""
type Deceased @entity {
  "唯一标识"
  id: ID!
  
  "链上逝者ID"
  deceasedId: BigInt! @index
  
  "所有者"
  owner: String! @index
  
  "姓名"
  name: String!
  
  "创建时间"
  createdAt: DateTime! @index
  
  "最后更新时间"
  updatedAt: DateTime
  
  "隐私模式"
  privacyMode: PrivacyMode! @index
}

"""隐私模式枚举"""
enum PrivacyMode {
  "公开"
  Public
  
  "仅家人"
  Family
  
  "私密"
  Private
}

"""
供奉记录
"""
type Offering @entity {
  "唯一标识"
  id: ID!
  
  "链上供奉ID"
  offeringId: BigInt! @index
  
  "供奉人"
  offerer: String! @index
  
  "逝者ID"
  deceasedId: BigInt! @index
  
  "祭品类型"
  itemKind: Int! @index
  
  "供奉时间"
  offeredAt: DateTime! @index
  
  "持续周数"
  durationWeeks: Int
  
  "金额"
  amount: BigInt
  
  "到期时间"
  expiresAt: DateTime
}

# ===================================================================
# 做市商相关
# ===================================================================

"""
做市商记录
"""
type MarketMaker @entity {
  "唯一标识"
  id: ID!
  
  "链上做市商ID"
  makerId: BigInt! @index
  
  "所有者"
  owner: String! @index
  
  "TRON地址"
  tronAddress: String! @index
  
  "溢价率（基点）"
  premiumBps: Int!
  
  "状态"
  status: MakerStatus! @index
  
  "注册时间"
  registeredAt: DateTime! @index
  
  "总交易量"
  totalVolume: BigInt!
  
  "总订单数"
  totalOrders: Int!
}

"""做市商状态枚举"""
enum MakerStatus {
  "申请中"
  Applied
  
  "已批准"
  Approved
  
  "已拒绝"
  Rejected
  
  "已暂停"
  Suspended
}

# ===================================================================
# 统计相关
# ===================================================================

"""
每日统计
"""
type DailyStats @entity {
  "唯一标识: date"
  id: ID!
  
  "日期"
  date: DateTime! @index
  
  "新增订单数"
  newOrders: Int!
  
  "完成订单数"
  completedOrders: Int!
  
  "总交易量（MEMO）"
  totalVolume: BigInt!
  
  "总交易额（USDT）"
  totalValue: BigInt!
  
  "平均价格"
  avgPrice: BigInt!
  
  "新增用户数"
  newUsers: Int!
}

"""
用户统计
"""
type UserStats @entity {
  "用户地址"
  id: ID!
  
  "总订单数"
  totalOrders: Int!
  
  "完成订单数"
  completedOrders: Int!
  
  "总交易量"
  totalVolume: BigInt!
  
  "首次交易时间"
  firstTradeAt: DateTime!
  
  "最后交易时间"
  lastTradeAt: DateTime!
  
  "信用分"
  creditScore: Int
}

