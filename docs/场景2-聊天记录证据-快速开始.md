# åœºæ™¯2ï¼šèŠå¤©è®°å½•è¯æ® - 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### ç¬¬ä¸€æ­¥ï¼šé›†æˆåŠ å¯†å·¥å…·ï¼ˆå·²å®Œæˆï¼‰

åŠ å¯†å·¥å…·ç±»å·²è‡ªåŠ¨ç”Ÿæˆï¼š
```
âœ… stardust-dapp/src/utils/multiRecipientEncryption.ts
```

### ç¬¬äºŒæ­¥ï¼šé›†æˆå‰ç«¯ç»„ä»¶ï¼ˆå·²å®Œæˆï¼‰

ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶å·²è‡ªåŠ¨ç”Ÿæˆï¼š
```
âœ… stardust-dapp/src/components/Dispute/SubmitChatEvidence.tsx
âœ… stardust-dapp/src/components/Governance/ViewEncryptedEvidence.tsx
```

### ç¬¬ä¸‰æ­¥ï¼šåœ¨OTCè®¢å•é¡µé¢é›†æˆ

**æ–‡ä»¶**ï¼š`stardust-dapp/src/pages/OTC/OrderDetail.tsx`

```tsx
import { SubmitChatEvidence } from '@/components/Dispute/SubmitChatEvidence';

// åœ¨è®¢å•è¯¦æƒ…é¡µæ·»åŠ æŒ‰é’®
{order.status === 'Disputed' && order.buyer === currentAccount && (
  <>
    <Button
      type="primary"
      icon={<FileTextOutlined />}
      onClick={() => setShowSubmitEvidence(true)}
    >
      æäº¤èŠå¤©è®°å½•è¯æ®
    </Button>
    
    <SubmitChatEvidence
      orderId={order.id}
      makerAccountId={order.maker_account}
      visible={showSubmitEvidence}
      onClose={() => setShowSubmitEvidence(false)}
      onSuccess={() => {
        message.success('è¯æ®å·²æäº¤');
        refetchOrder();
      }}
    />
  </>
)}
```

### ç¬¬å››æ­¥ï¼šåœ¨å§”å‘˜ä¼šå®¡æ ¸é¡µé¢é›†æˆ

**æ–‡ä»¶**ï¼š`stardust-governance/src/pages/DisputeReview.tsx`

```tsx
import { ViewEncryptedEvidence } from '@/components/Governance/ViewEncryptedEvidence';

// åœ¨äº‰è®®åˆ—è¡¨æ·»åŠ æŸ¥çœ‹æŒ‰é’®
<Button
  type="link"
  onClick={() => {
    setSelectedEvidence({
      cid: dispute.evidence_cid,
      orderId: dispute.order_id
    });
  }}
>
  æŸ¥çœ‹åŠ å¯†è¯æ®
</Button>

<ViewEncryptedEvidence
  evidenceCid={selectedEvidence?.cid}
  orderId={selectedEvidence?.orderId}
  visible={!!selectedEvidence}
  onClose={() => setSelectedEvidence(null)}
/>
```

---

## ğŸ§ª å¿«é€Ÿæµ‹è¯•

### 1. ä¹°å®¶æäº¤è¯æ®

```bash
# 1. è®¿é—®è®¢å•è¯¦æƒ…é¡µ
http://localhost:5173/otc/order/123

# 2. ç‚¹å‡»"æäº¤èŠå¤©è®°å½•è¯æ®"
# 3. é€‰æ‹©ç›¸å…³èŠå¤©æ¶ˆæ¯
# 4. ç‚¹å‡»"åŠ å¯†å¹¶æäº¤"
# 5. ç­‰å¾…äº¤æ˜“ç¡®è®¤

# é¢„æœŸç»“æœï¼š
âœ… èŠå¤©è®°å½•å·²åŠ å¯†
âœ… å·²ä¸Šä¼ åˆ°IPFS
âœ… é“¾ä¸Šè®°å½•äº†è¯æ®CID
```

### 2. å§”å‘˜ä¼šå®¡æ ¸

```bash
# 1. è®¿é—®å§”å‘˜ä¼šå®¡æ ¸é¡µé¢
http://localhost:5173/governance/disputes

# 2. ç‚¹å‡»æŸä¸ªäº‰è®®çš„"æŸ¥çœ‹åŠ å¯†è¯æ®"
# 3. ç³»ç»Ÿè‡ªåŠ¨æ£€æŸ¥æƒé™
# 4. ç‚¹å‡»"è§£å¯†å¹¶æŸ¥çœ‹"
# 5. æˆæƒé’±åŒ…è®¿é—®

# é¢„æœŸç»“æœï¼š
âœ… æˆåŠŸè§£å¯†èŠå¤©è®°å½•
âœ… æ˜¾ç¤ºå®Œæ•´å¯¹è¯æ—¶é—´çº¿
âœ… é“¾ä¸Šè®°å½•äº†è®¿é—®æ—¥å¿—
```

---

## ğŸ“‹ ä¾èµ–æ£€æŸ¥

### NPMåŒ…ï¼ˆéœ€è¦å®‰è£…ï¼‰

```bash
cd stardust-dapp

# æ£€æŸ¥æ˜¯å¦å·²å®‰è£…
npm list tweetnacl @polkadot/util @polkadot/util-crypto

# å¦‚æœæœªå®‰è£…ï¼Œæ‰§è¡Œï¼š
npm install tweetnacl @polkadot/util @polkadot/util-crypto
```

### ç±»å‹å®šä¹‰

```bash
npm install --save-dev @types/node
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹åŠ å¯†æ•°æ®ç»“æ„

```typescript
import { MultiRecipientEncryption } from '@/utils/multiRecipientEncryption';

// åŠ å¯†åæŸ¥çœ‹ç»“æ„
console.log('åŠ å¯†æ•°æ®:', JSON.stringify(encrypted, null, 2));

// éªŒè¯æ•°æ®å®Œæ•´æ€§
const validation = MultiRecipientEncryption.validate(encrypted);
console.log('éªŒè¯ç»“æœ:', validation);

// æŸ¥çœ‹æˆæƒæ¥æ”¶æ–¹
const recipients = MultiRecipientEncryption.getRecipients(encrypted);
console.log('æˆæƒæ¥æ”¶æ–¹:', recipients);
```

### æ£€æŸ¥IPFSä¸Šä¼ 

```typescript
// ä¸Šä¼ å‰æ—¥å¿—
console.log('ğŸ“¤ æ­£åœ¨ä¸Šä¼ åˆ°IPFS...', encryptedData);

// ä¸Šä¼ åæ—¥å¿—
const cid = await uploadToIPFS(encryptedData);
console.log('âœ… IPFS CID:', cid);

// éªŒè¯ä¸‹è½½
const downloaded = await fetchFromIPFS(cid);
console.log('ğŸ“¥ ä»IPFSä¸‹è½½:', downloaded);
```

### æ£€æŸ¥å§”å‘˜ä¼šæˆå‘˜

```typescript
// æŸ¥è¯¢å§”å‘˜ä¼šæˆå‘˜
const members = await api.query.collective.members(3); // Instance3 = ContentCommittee
console.log('å§”å‘˜ä¼šæˆå‘˜åˆ—è¡¨:', members.toJSON());

// æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯å§”å‘˜ä¼šæˆå‘˜
const isMember = members.toJSON().includes(currentAccount.address);
console.log('æ˜¯å¦ä¸ºå§”å‘˜ä¼šæˆå‘˜:', isMember);
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: "å½“å‰è´¦æˆ·æ— æƒè§£å¯†æ­¤å†…å®¹"

**åŸå› **ï¼šå½“å‰è´¦æˆ·ä¸åœ¨å§”å‘˜ä¼šåå•ä¸­

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥æ˜¯å¦ä¸ºå§”å‘˜ä¼šæˆå‘˜
await api.query.collective.members(3); // ContentCommittee

# å¦‚æœä¸æ˜¯ï¼Œè¯·è”ç³»ç†äº‹ä¼šæ·»åŠ 
```

### Q2: "è§£å¯†AESå¯†é’¥å¤±è´¥"

**åŸå› **ï¼šç§é’¥ä¸åŒ¹é…æˆ–æŸå

**è§£å†³**ï¼š
```typescript
// ç¡®è®¤å…¬é’¥ä¸ç§é’¥åŒ¹é…
import { decodeAddress } from '@polkadot/util-crypto';
const publicKey = decodeAddress(accountId);
console.log('è´¦æˆ·å…¬é’¥:', publicKey);

// é‡æ–°è·å–ç§é’¥
const privateKey = await getPrivateKeyFromWallet(accountId);
```

### Q3: "ä»IPFSä¸‹è½½å¤±è´¥"

**åŸå› **ï¼šIPFSç½‘å…³ä¸å¯è¾¾æˆ–CIDæ— æ•ˆ

**è§£å†³**ï¼š
```typescript
// å°è¯•å¤šä¸ªIPFSç½‘å…³
const gateways = [
  'https://ipfs.io/ipfs/',
  'https://cloudflare-ipfs.com/ipfs/',
  'https://gateway.pinata.cloud/ipfs/',
];

for (const gateway of gateways) {
  try {
    const response = await fetch(`${gateway}${cid}`);
    if (response.ok) {
      return await response.json();
    }
  } catch (error) {
    console.error(`ç½‘å…³å¤±è´¥: ${gateway}`, error);
  }
}
```

### Q4: "èŠå¤©è®°å½•ä¸ºç©º"

**åŸå› **ï¼šä¼šè¯IDç”Ÿæˆä¸ä¸€è‡´

**è§£å†³**ï¼š
```typescript
// ç¡®ä¿ä¼šè¯IDç”Ÿæˆé€»è¾‘ä¸€è‡´
const participants = [account1, account2].sort(); // å¿…é¡»æ’åºï¼
const sessionId = api.createType('Hash', participants).toHex();
console.log('ä¼šè¯ID:', sessionId);

// æŸ¥è¯¢æ¶ˆæ¯
const messageIds = await api.query.chat.sessionMessages(sessionId);
console.log('æ¶ˆæ¯IDåˆ—è¡¨:', messageIds.toJSON());
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### åŠŸèƒ½æ‰©å±•

1. **æ”¯æŒé™„ä»¶è¯æ®**
   - å›¾ç‰‡ã€è§†é¢‘ã€æ–‡æ¡£
   - åŒæ ·ä½¿ç”¨å¤šæ¥æ”¶æ–¹åŠ å¯†

2. **è¯æ®å®¡æ ¸æµç¨‹**
   - å§”å‘˜ä¼šæŠ•ç¥¨æœºåˆ¶
   - å¤šæ•°é€šè¿‡åæ‰§è¡Œè£å†³

3. **è¯æ®æ°¸ä¹…å­˜å‚¨**
   - Filecoiné•¿æœŸå­˜å‚¨
   - è‡ªåŠ¨ç»­è´¹æœºåˆ¶

### æ€§èƒ½ä¼˜åŒ–

1. **IPFS PinæœåŠ¡é›†æˆ**
   - è‡ªåŠ¨piné‡è¦è¯æ®
   - é˜²æ­¢æ•°æ®ä¸¢å¤±

2. **å‰ç«¯ç¼“å­˜ä¼˜åŒ–**
   - IndexedDBå­˜å‚¨å·²ä¸‹è½½è¯æ®
   - å‡å°‘é‡å¤IPFSè¯·æ±‚

3. **æ‰¹é‡è§£å¯†ä¼˜åŒ–**
   - Web Workeråå°è§£å¯†
   - ä¸é˜»å¡UIçº¿ç¨‹

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´å®ç°æ–‡æ¡£](./åœºæ™¯2-èŠå¤©è®°å½•ä½œä¸ºäº‰è®®è¯æ®-å®Œæ•´å®ç°.md)
- [å¤šæ¥æ”¶æ–¹åŠ å¯†æ–¹æ¡ˆ](./å¤šæ¥æ”¶æ–¹åŠ å¯†æ–¹æ¡ˆ-å§”å‘˜ä¼šå®¡æ ¸åšå¸‚å•†èµ„æ–™.md)
- [pallet-chat README](../pallets/chat/README.md)
- [pallet-evidence README](../pallets/evidence/README.md)

---

**æœ€åæ›´æ–°**ï¼š2025-10-23  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆå®ç°

