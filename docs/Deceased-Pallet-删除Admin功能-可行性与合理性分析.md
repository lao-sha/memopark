# Deceased Pallet - åˆ é™¤AdminåŠŸèƒ½ï¼šå¯è¡Œæ€§ä¸åˆç†æ€§åˆ†æ

## ğŸ“‹ åˆ†ææ¦‚å†µ

**åˆ†æå¯¹è±¡**ï¼šDeceased Pallet ä¸­çš„ Admin è§’è‰²åŠŸèƒ½  
**åˆ†ææ—¶é—´**ï¼š2025-10-23  
**åˆ†æç›®çš„**ï¼šè¯„ä¼°åˆ é™¤ Admin è§’è‰²çš„å¯è¡Œæ€§ã€åˆç†æ€§åŠå½±å“èŒƒå›´

---

## ğŸ” ç°çŠ¶è°ƒç ”

### AdminåŠŸèƒ½å½“å‰ä½¿ç”¨æƒ…å†µ

#### 1. æ•°æ®ç»“æ„

```rust
/// FriendRole æšä¸¾ï¼šMember, Core, Admin
pub enum FriendRole {
    Member,  // 0ï¼šæ™®é€šæˆå‘˜
    Core,    // 1ï¼šæ ¸å¿ƒæˆå‘˜
    Admin,   // 2ï¼šç®¡ç†å‘˜
}
```

#### 2. æƒé™åˆ¤å®šå‡½æ•°

```rust
/// is_adminï¼šåˆ¤æ–­è´¦æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜
pub(crate) fn is_admin(deceased_id: T::DeceasedId, who: &T::AccountId) -> bool {
    // 1. owner å§‹ç»ˆæ˜¯ Adminï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰
    if let Some(d) = DeceasedOf::<T>::get(deceased_id) {
        if d.owner == *who {
            return true;
        }
    }
    // 2. æˆ–è€…åœ¨ FriendsOf ä¸­æœ‰ Admin è§’è‰²
    if let Some(rec) = FriendsOf::<T>::get(deceased_id, who) {
        matches!(rec.role, FriendRole::Admin)
    } else {
        false
    }
}
```

#### 3. éœ€è¦ Admin æƒé™çš„æ¥å£

| æ¥å£å | åŠŸèƒ½ | è°ƒç”¨åœºæ™¯ |
|--------|------|---------|
| `set_visibility` | è®¾ç½®å¯è§æ€§ | æ§åˆ¶é€è€…èµ„æ–™å…¬å¼€/ç§æœ‰ |
| `set_friend_policy` | è®¾ç½®äº²å‹å›¢ç­–ç•¥ | é…ç½®åŠ å…¥ç­–ç•¥ã€éšç§ã€ä¸Šé™ |
| `approve_join` | å®¡æ‰¹åŠ å…¥ | æ‰¹å‡†äº²å‹å›¢ç”³è¯· |
| `reject_join` | æ‹’ç»åŠ å…¥ | æ‹’ç»äº²å‹å›¢ç”³è¯· |
| `kick_friend` | ç§»å‡ºæˆå‘˜ | ç®¡ç†äº²å‹å›¢æˆå‘˜ |
| `set_friend_role` | è®¾ç½®æˆå‘˜è§’è‰² | æå‡/é™çº§æˆå‘˜ |

#### 4. Admin ç›¸å…³é€»è¾‘

| åŠŸèƒ½ç‚¹ | é€»è¾‘æè¿° |
|--------|---------|
| **é»˜è®¤è§’è‰²** | æ–°æˆå‘˜åŠ å…¥æ—¶é»˜è®¤ä¸º `Member` |
| **é€€å‡ºé™åˆ¶** | é owner çš„ Admin ä¸èƒ½ç›´æ¥é€€å‡ºï¼ˆéœ€é™çº§ï¼‰ |
| **ç§»é™¤é™åˆ¶** | é owner çš„ Admin ä¸èƒ½è¢«ç§»é™¤ï¼ˆé¿å…æƒé™äº‰å¤ºï¼‰ |
| **è§’è‰²è®¾ç½®** | Admin å¯ä»¥ä¸ºæˆå‘˜è®¾ç½®è§’è‰²ï¼ˆ0/1/2ï¼‰ |

---

## ğŸ’¡ åˆ é™¤Adminçš„åˆç†æ€§åˆ†æ

### æ ¸å¿ƒé—®é¢˜ï¼šAdmin å­˜åœ¨çš„ä»·å€¼æ˜¯ä»€ä¹ˆï¼Ÿ

#### å½“å‰è®¾è®¡å‡è®¾

1. **owner å¯èƒ½éœ€è¦åä½œç®¡ç†**
   - åœºæ™¯ï¼šowner å¤ªå¿™ï¼Œå¸Œæœ›æˆæƒå…¶ä»–äººå¸®å¿™ç®¡ç†
   - å®ç°ï¼šé€šè¿‡ `set_friend_role` å°†ä¿¡ä»»çš„äººæå‡ä¸º Admin

2. **Admin éœ€è¦ä¸ Member/Core åŒºåˆ†æƒé™**
   - Adminï¼šå¯ä»¥å®¡æ‰¹ã€ç§»é™¤ã€é…ç½®
   - Coreï¼šæ ¸å¿ƒæˆå‘˜ï¼ˆä½†æƒé™ä¸ Member ç›¸åŒï¼‰
   - Memberï¼šæ™®é€šæˆå‘˜

3. **é¿å…"å­¤å„¿é€è€…"é—®é¢˜**
   - ä¿æŠ¤æœºåˆ¶ï¼šAdmin ä¸èƒ½éšæ„é€€å‡ºæˆ–è¢«ç§»é™¤
   - ç›®çš„ï¼šç¡®ä¿è‡³å°‘æœ‰ç®¡ç†å‘˜

#### å®é™…ä½¿ç”¨åœºæ™¯åˆ†æ

##### åœºæ™¯1ï¼šowner ç‹¬è‡ªç®¡ç†ï¼ˆ90%+ï¼‰

```
é€è€…èµ„æ–™ç”±å®¶å±ï¼ˆownerï¼‰åˆ›å»ºå’Œç®¡ç†
- è®¾ç½®å¯è§æ€§ï¼šowner è‡ªå·±å†³å®š
- å®¡æ‰¹äº²å‹å›¢ï¼šowner è‡ªå·±å®¡æ‰¹
- ç®¡ç†æˆå‘˜ï¼šowner è‡ªå·±ç®¡ç†
```

**ç»“è®º**ï¼š**ä¸éœ€è¦é¢å¤–çš„ Admin**

##### åœºæ™¯2ï¼šowner æˆæƒä»–äººåä½œç®¡ç†ï¼ˆ<5%ï¼‰

```
owner å¤ªå¿™ï¼Œå¸Œæœ›æˆæƒé…å¶/å­å¥³å¸®å¿™ç®¡ç†
- å°†é…å¶è®¾ä¸º Admin
- é…å¶å¯ä»¥å®¡æ‰¹äº²å‹å›¢ã€ç®¡ç†æˆå‘˜
```

**è´¨ç–‘**ï¼š
1. **çœŸå®éœ€æ±‚å­˜åœ¨å—ï¼Ÿ**
   - é€è€…èµ„æ–™é€šå¸¸ç”±**ç›´ç³»äº²å±ç‹¬è‡ªç®¡ç†**
   - éœ€è¦"åä½œç®¡ç†"çš„åœºæ™¯**æå…¶ç½•è§**

2. **æ›¿ä»£æ–¹æ¡ˆæ˜¯å¦è¶³å¤Ÿï¼Ÿ**
   - owner å¯ä»¥é€šè¿‡ `transfer_deceased` è½¬ç§»æ‰€æœ‰æƒ
   - å¦‚æœownerç¡®å®å¤ªå¿™ï¼Œç›´æ¥è½¬ç»™ä¿¡ä»»çš„äººå³å¯

3. **å¤æ‚åº¦æ˜¯å¦å€¼å¾—ï¼Ÿ**
   - ä¸ºäº† <5% çš„åœºæ™¯ï¼Œå¼•å…¥ Admin è§’è‰²
   - å¢åŠ äº†ä»£ç å¤æ‚åº¦ã€ç”¨æˆ·ç†è§£æˆæœ¬ã€æµ‹è¯•æˆæœ¬

##### åœºæ™¯3ï¼šå¤šäººå…±åŒç®¡ç†ï¼ˆç†è®ºåœºæ™¯ï¼Œå®é™…å‡ ä¹ä¸å­˜åœ¨ï¼‰

```
å¤šä¸ªå­å¥³å…±åŒç®¡ç†çˆ¶æ¯çš„é€è€…èµ„æ–™
- è®¾ç½®å¤šä¸ª Admin
- å…±åŒå®¡æ‰¹ã€ç®¡ç†
```

**è´¨ç–‘**ï¼š
1. **å®é™…å¯è¡Œå—ï¼Ÿ**
   - å¤šäººå…±åŒç®¡ç†å®¹æ˜“äº§ç”Ÿå†²çª
   - "è°è¯´äº†ç®—"çš„é—®é¢˜éš¾ä»¥è§£å†³

2. **æ›´å¥½çš„æ–¹æ¡ˆï¼Ÿ**
   - æŒ‡å®šä¸€ä¸ªä¸»è¦è´Ÿè´£äººï¼ˆownerï¼‰
   - å…¶ä»–äººé€šè¿‡é“¾ä¸‹æ²Ÿé€šåè°ƒ
   - æˆ–é€šè¿‡ `transfer_deceased` è½®æµç®¡ç†

---

## âœ… åˆ é™¤Adminçš„åˆç†æ€§ç»“è®º

### åˆç†æ€§ï¼šâ­â­â­â­â­ éå¸¸åˆç†

#### ç†ç”±1ï¼šç®€åŒ–è®¾è®¡ï¼Œç¬¦åˆå®é™…éœ€æ±‚

- **90%+ çš„åœºæ™¯**ï¼šowner ç‹¬è‡ªç®¡ç†ï¼Œä¸éœ€è¦é¢å¤– Admin
- **<5% çš„åœºæ™¯**ï¼šå¯é€šè¿‡ `transfer_deceased` è§£å†³
- **ç†è®ºåœºæ™¯**ï¼šå¤šäººå…±ç®¡ä¸ç°å®ï¼Œä¸åº”ä¸ºæ­¤è®¾è®¡

#### ç†ç”±2ï¼šé™ä½å¤æ‚åº¦

| å¤æ‚åº¦ç±»å‹ | å½“å‰ï¼ˆæœ‰Adminï¼‰ | åˆ é™¤å |
|-----------|---------------|--------|
| **ä»£ç å¤æ‚åº¦** | éœ€è¦å¤„ç† Admin æˆæƒã€é€€å‡ºé™åˆ¶ã€ç§»é™¤é™åˆ¶ | åªéœ€å¤„ç† owner |
| **ç”¨æˆ·ç†è§£æˆæœ¬** | éœ€è¦ç†è§£ Member/Core/Admin çš„åŒºåˆ« | åªéœ€ç†è§£ Member/Core |
| **æµ‹è¯•æˆæœ¬** | éœ€è¦æµ‹è¯• Admin çš„å„ç§è¾¹ç•Œæƒ…å†µ | æµ‹è¯•ç”¨ä¾‹å‡å°‘ |

#### ç†ç”±3ï¼šé¿å…æƒé™äº‰å¤º

- **ç°æœ‰è®¾è®¡é—®é¢˜**ï¼šå¤šä¸ª Admin ä¹‹é—´æ— æ³•äº’ç›¸ç§»é™¤ï¼Œå¯èƒ½å¯¼è‡´**æƒé™åƒµå±€**
- **åˆ é™¤å**ï¼šåªæœ‰ owner æœ‰ç®¡ç†æƒé™ï¼Œ**è´£ä»»æ˜ç¡®**

#### ç†ç”±4ï¼šä¸"owner è¶…ç„¶åœ°ä½"è®¾è®¡ç†å¿µä¸€è‡´

- åˆšåˆšä¿®å¤çš„ P2 é—®é¢˜å¼ºè°ƒï¼š**owner çš„ç®¡ç†æƒé™æ¥è‡ª `DeceasedOf.owner`**
- æ—¢ç„¶ owner å·²ç»æœ‰è¶…ç„¶åœ°ä½ï¼Œ**ä¸ºä½•è¿˜éœ€è¦å…¶ä»– Adminï¼Ÿ**
- åˆ é™¤ Admin æ›´ç¬¦åˆ"owner æ˜¯å”¯ä¸€ç®¡ç†è€…"çš„è®¾è®¡ç†å¿µ

---

## ğŸ”§ åˆ é™¤Adminçš„å¯è¡Œæ€§åˆ†æ

### å¯è¡Œæ€§ï¼šâ­â­â­â­â­ å®Œå…¨å¯è¡Œ

#### å½±å“èŒƒå›´è¯„ä¼°

##### 1. å­˜å‚¨å±‚ä¿®æ”¹ï¼ˆç®€å•ï¼‰

```rust
// ä¿®æ”¹å‰
pub enum FriendRole {
    Member,  // 0
    Core,    // 1
    Admin,   // 2 â† åˆ é™¤
}

// ä¿®æ”¹å
pub enum FriendRole {
    Member,  // 0
    Core,    // 1
}
```

**å…¼å®¹æ€§**ï¼šâš ï¸ **ç ´åå¼ä¿®æ”¹**

- å·²æœ‰çš„ Admin è§’è‰²æˆå‘˜ä¼šå˜æˆä»€ä¹ˆï¼Ÿ
- éœ€è¦è¿ç§»é€»è¾‘å—ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ ¹æ®è§„åˆ™9ï¼š"ä¸»ç½‘æ²¡æœ‰ä¸Šçº¿ï¼Œç°åœ¨é›¶è¿ç§»ï¼Œæ— éœ€è¿ç§»é€»è¾‘ï¼Œå…è®¸ç ´åå¼è°ƒæ•´"
- âœ… ç›´æ¥åˆ é™¤ Adminï¼Œæ— éœ€è¿ç§»

##### 2. æƒé™åˆ¤å®šé€»è¾‘ä¿®æ”¹ï¼ˆæç®€ï¼‰

```rust
// ä¿®æ”¹å‰
pub(crate) fn is_admin(deceased_id: T::DeceasedId, who: &T::AccountId) -> bool {
    if let Some(d) = DeceasedOf::<T>::get(deceased_id) {
        if d.owner == *who {
            return true;
        }
    }
    if let Some(rec) = FriendsOf::<T>::get(deceased_id, who) {
        matches!(rec.role, FriendRole::Admin)  // â† è¿™æ®µé€»è¾‘åˆ é™¤
    } else {
        false
    }
}

// ä¿®æ”¹åï¼ˆæç®€ç‰ˆï¼‰
pub(crate) fn is_admin(deceased_id: T::DeceasedId, who: &T::AccountId) -> bool {
    if let Some(d) = DeceasedOf::<T>::get(deceased_id) {
        d.owner == *who  // âœ… åªæœ‰ owner æ˜¯ Admin
    } else {
        false
    }
}
```

##### 3. æ¥å£ä¿®æ”¹ï¼ˆç§»é™¤å†—ä½™æ£€æŸ¥ï¼‰

**å—å½±å“çš„æ¥å£**ï¼š

| æ¥å£å | å½“å‰æƒé™æ£€æŸ¥ | ä¿®æ”¹åæƒé™æ£€æŸ¥ |
|--------|-------------|--------------|
| `set_visibility` | `is_admin()` | `is_admin()` (é€»è¾‘å˜ç®€å•) |
| `set_friend_policy` | `is_admin()` | `is_admin()` (é€»è¾‘å˜ç®€å•) |
| `approve_join` | `is_admin()` | `is_admin()` (é€»è¾‘å˜ç®€å•) |
| `reject_join` | `is_admin()` | `is_admin()` (é€»è¾‘å˜ç®€å•) |
| `kick_friend` | `is_admin()` + ä¸èƒ½ç§»é™¤éownerçš„Admin | `is_admin()` (åˆ é™¤å¤æ‚é€»è¾‘) |
| `set_friend_role` | `is_admin()` | âœ… **å¯ä»¥åˆ é™¤æ­¤æ¥å£** |
| `leave_friend_group` | éownerçš„Adminä¸èƒ½é€€å‡º | âœ… **åˆ é™¤æ­¤é™åˆ¶** |

##### 4. å¯åˆ é™¤çš„å†—ä½™ä»£ç 

```rust
// âŒ å¯åˆ é™¤ï¼šset_friend_role æ¥å£ï¼ˆæ²¡æœ‰ Admin è§’è‰²åæ— éœ€è®¾ç½®ï¼‰
pub fn set_friend_role(...) { ... }

// âŒ å¯åˆ é™¤ï¼šleave_friend_group ä¸­çš„ Admin é€€å‡ºé™åˆ¶
if !is_owner {
    ensure!(
        !matches!(rec.role, FriendRole::Admin),  // â† åˆ é™¤
        Error::<T>::NotAuthorized
    );
}

// âŒ å¯åˆ é™¤ï¼škick_friend ä¸­çš„ Admin ç§»é™¤é™åˆ¶
if !is_owner {
    ensure!(
        !matches!(rec.role, FriendRole::Admin),  // â† åˆ é™¤
        Error::<T>::NotAuthorized
    );
}
```

**ä»£ç å‡å°‘é‡**ï¼šé¢„è®¡å‡å°‘ **~100 è¡Œä»£ç **

---

## ğŸ“Š åˆ é™¤Adminåçš„è®¾è®¡å¯¹æ¯”

### åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ç‚¹ | å½“å‰è®¾è®¡ï¼ˆæœ‰Adminï¼‰ | åˆ é™¤Adminå | è¯„ä»· |
|--------|-------------------|------------|------|
| **ç®¡ç†æƒé™** | owner + å¯æˆæƒçš„Admin | ä»… owner | âœ… æ›´ç®€æ´ |
| **äº²å‹å›¢è§’è‰²** | Member / Core / Admin | Member / Core | âœ… å¤Ÿç”¨ |
| **å®¡æ‰¹æƒé™** | owner å’Œ Admin | ä»… owner | âœ… è´£ä»»æ˜ç¡® |
| **æˆå‘˜ç®¡ç†** | owner å’Œ Admin | ä»… owner | âœ… é¿å…å†²çª |
| **è§’è‰²è®¾ç½®** | Admin å¯è®¾ç½®è§’è‰² | owner å¯è®¾ç½®è§’è‰² | âœ… åŠŸèƒ½ä¿ç•™ |
| **é€€å‡ºé™åˆ¶** | Admin ä¸èƒ½éšæ„é€€å‡º | æ— é™åˆ¶ | âœ… æ›´è‡ªç”± |
| **ç§»é™¤é™åˆ¶** | Admin ä¸èƒ½è¢«ç§»é™¤ | æ— é™åˆ¶ | âœ… æ›´ç®€æ´ |

### ç”¨æˆ·ä½“éªŒå¯¹æ¯”

| åœºæ™¯ | å½“å‰ï¼ˆæœ‰Adminï¼‰ | åˆ é™¤å | ä½“éªŒæ”¹å–„ |
|------|---------------|--------|---------|
| **åˆ›å»ºé€è€…** | owner é»˜è®¤æ˜¯ Adminï¼ˆé€šè¿‡is_adminåˆ¤å®šï¼‰ | owner æ˜¯å”¯ä¸€ç®¡ç†è€… | âœ… æ¦‚å¿µæ›´æ¸…æ™° |
| **å®¡æ‰¹åŠ å…¥** | owner æˆ– Admin å¯å®¡æ‰¹ | ä»… owner å¯å®¡æ‰¹ | âœ… è´£ä»»æ˜ç¡® |
| **ç®¡ç†æˆå‘˜** | owner æˆ– Admin å¯ç®¡ç† | ä»… owner å¯ç®¡ç† | âœ… é¿å…å†²çª |
| **è§’è‰²åŒºåˆ†** | éœ€è¦ç†è§£ Member/Core/Admin | åªéœ€ç†è§£ Member/Core | âœ… æ›´æ˜“ç†è§£ |
| **é€€å‡ºäº²å‹å›¢** | Admin ä¸èƒ½ç›´æ¥é€€å‡ºï¼ˆéœ€é™çº§ï¼‰ | ä»»ä½•æˆå‘˜å¯é€€å‡º | âœ… æ›´è‡ªç”± |

---

## âš ï¸ é£é™©ä¸æŒ‘æˆ˜

### é£é™©1ï¼šæ˜¯å¦çœŸçš„æ²¡æœ‰åä½œç®¡ç†éœ€æ±‚ï¼Ÿ

**åˆ†æ**ï¼š
- å³ä½¿æœ‰åä½œç®¡ç†éœ€æ±‚ï¼Œ`transfer_deceased` å·²ç»èƒ½è§£å†³
- å¦‚æœ owner çœŸçš„éœ€è¦é•¿æœŸæˆæƒï¼Œå¯ä»¥è€ƒè™‘**é“¾ä¸‹å¯†é’¥å…±äº«**
- ä¾‹å¦‚ï¼šowner å°†è´¦æˆ·ç§é’¥å®‰å…¨åœ°åˆ†äº«ç»™ä¿¡ä»»çš„å®¶äºº

**ç»“è®º**ï¼šâŒ ä¸æ˜¯çœŸæ­£çš„é£é™©

### é£é™©2ï¼šåˆ é™¤åå¦‚ä½•å¤„ç†å·²æœ‰çš„ Admin è§’è‰²æˆå‘˜ï¼Ÿ

**åˆ†æ**ï¼š
- æ ¹æ®è§„åˆ™9ï¼š"ä¸»ç½‘æ²¡æœ‰ä¸Šçº¿ï¼Œç°åœ¨é›¶è¿ç§»ï¼Œæ— éœ€è¿ç§»é€»è¾‘ï¼Œå…è®¸ç ´åå¼è°ƒæ•´"
- âœ… å¯ä»¥ç›´æ¥åˆ é™¤ï¼Œæ— éœ€è¿ç§»

**å®æ–½æ–¹æ¡ˆ**ï¼š
1. åˆ é™¤ `FriendRole::Admin` æšä¸¾å€¼
2. ä¿®æ”¹ `is_admin` å‡½æ•°ï¼Œåªè®¤ owner
3. åˆ é™¤ `set_friend_role` æ¥å£
4. ç§»é™¤ `leave_friend_group` å’Œ `kick_friend` ä¸­çš„ Admin é™åˆ¶

**ç»“è®º**ï¼šâŒ ä¸æ˜¯çœŸæ­£çš„é£é™©

### é£é™©3ï¼šCore è§’è‰²çš„å­˜åœ¨æ„ä¹‰ï¼Ÿ

**è´¨ç–‘**ï¼š
- æ—¢ç„¶åˆ é™¤äº† Adminï¼ŒCore è§’è‰²çš„å­˜åœ¨æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ
- Core å’Œ Member æœ‰ä»€ä¹ˆå®è´¨åŒºåˆ«ï¼Ÿ

**åˆ†æ**ï¼š
- **å½“å‰è®¾è®¡**ï¼šCore æ˜¯"æ ¸å¿ƒæˆå‘˜"æ ‡è¯†ï¼Œä½†**æ— ç‰¹æ®Šæƒé™**
- **å¯èƒ½ç”¨é€”**ï¼š
  - å‰ç«¯å±•ç¤ºæ—¶çªå‡ºæ˜¾ç¤º Core æˆå‘˜
  - æœªæ¥æ‰©å±•ï¼šCore å¯èƒ½æœ‰ç‰¹æ®Šæƒé™ï¼ˆå¦‚æŠ•ç¥¨æƒï¼‰
  - ç¤¾äº¤å±‚é¢ï¼šåŒºåˆ†"æ ¸å¿ƒäº²å‹"å’Œ"æ™®é€šå…³æ³¨è€…"

**å»ºè®®**ï¼š
- **ä¿ç•™ Core è§’è‰²**ï¼ˆä¸ºæœªæ¥æ‰©å±•ä¿ç•™ç©ºé—´ï¼‰
- æˆ–è€…**ä¸€å¹¶åˆ é™¤ Core**ï¼Œåªä¿ç•™ Member

**ç»“è®º**ï¼šâš ï¸ éœ€è¦è¿›ä¸€æ­¥è®¨è®º

---

## ğŸ¯ åˆ é™¤Adminçš„å®æ–½æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šä»…åˆ é™¤ Admin è§’è‰²ï¼ˆæ¨èï¼‰

#### ä¿®æ”¹æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | éš¾åº¦ |
|------|---------|------|
| `lib.rs` - FriendRole | åˆ é™¤ `Admin` æšä¸¾å€¼ | â­ ç®€å• |
| `lib.rs` - is_admin | ç®€åŒ–é€»è¾‘ï¼Œåªè®¤ owner | â­ ç®€å• |
| `lib.rs` - set_friend_role | åˆ é™¤æ­¤æ¥å£ | â­ ç®€å• |
| `lib.rs` - leave_friend_group | ç§»é™¤ Admin é€€å‡ºé™åˆ¶ | â­ ç®€å• |
| `lib.rs` - kick_friend | ç§»é™¤ Admin ç§»é™¤é™åˆ¶ | â­ ç®€å• |
| `README.md` | æ›´æ–°æ–‡æ¡£ | â­ ç®€å• |

#### ä»£ç ä¿®æ”¹é‡

- **åˆ é™¤è¡Œæ•°**ï¼š~120 è¡Œ
- **ä¿®æ”¹è¡Œæ•°**ï¼š~30 è¡Œ
- **å‡€å‡å°‘**ï¼š~90 è¡Œ

#### ä¼˜ç‚¹

- âœ… æå¤§ç®€åŒ–ä»£ç 
- âœ… é™ä½ç”¨æˆ·ç†è§£æˆæœ¬
- âœ… é¿å…æƒé™äº‰å¤ºé—®é¢˜
- âœ… ç¬¦åˆ"owner å”¯ä¸€ç®¡ç†è€…"ç†å¿µ

#### ç¼ºç‚¹

- âš ï¸ å¤±å»"åä½œç®¡ç†"èƒ½åŠ›ï¼ˆä½†å®é™…éœ€æ±‚æä½ï¼‰

---

### æ–¹æ¡ˆBï¼šåŒæ—¶åˆ é™¤ Admin å’Œ Core è§’è‰²

#### ä¿®æ”¹æ¸…å•

åœ¨æ–¹æ¡ˆAåŸºç¡€ä¸Šï¼Œ**é¢å¤–åˆ é™¤**ï¼š
- `FriendRole::Core` æšä¸¾å€¼
- æ‰€æœ‰ Core ç›¸å…³é€»è¾‘

#### ä»£ç ä¿®æ”¹é‡

- **åˆ é™¤è¡Œæ•°**ï¼š~150 è¡Œ
- **ä¿®æ”¹è¡Œæ•°**ï¼š~40 è¡Œ
- **å‡€å‡å°‘**ï¼š~110 è¡Œ

#### ä¼˜ç‚¹

- âœ… **æè‡´ç®€åŒ–**ï¼šåªæœ‰ owner å’Œ Member
- âœ… æ¦‚å¿µæ›´æ¸…æ™°ï¼šownerç®¡ç† + Memberæˆå‘˜
- âœ… ä»£ç æ›´ç®€æ´

#### ç¼ºç‚¹

- âš ï¸ å¤±å»"æ ¸å¿ƒæˆå‘˜"æ ‡è¯†
- âš ï¸ æœªæ¥æ‰©å±•ç©ºé—´å‡å°‘

#### è¯„ä¼°

**æ˜¯å¦åº”è¯¥åˆ é™¤ Coreï¼Ÿ**

| è€ƒè™‘å› ç´  | ä¿ç•™ Core | åˆ é™¤ Core |
|---------|-----------|-----------|
| **å½“å‰ä»·å€¼** | æ— å®è´¨æƒé™ï¼Œä»…æ ‡è¯† | - |
| **æœªæ¥æ‰©å±•** | å¯èƒ½æœ‰ç”¨ï¼ˆæŠ•ç¥¨æƒç­‰ï¼‰ | - |
| **ä»£ç å¤æ‚åº¦** | å‡ ä¹æ— å½±å“ | ç¨å¾®ç®€åŒ– |
| **ç”¨æˆ·ç†è§£** | éœ€è¦ç†è§£ Member/Core | åªéœ€ç†è§£ Member |

**å»ºè®®**ï¼š
- å¦‚æœ**æœªæ¥å¯èƒ½æ‰©å±•**ï¼ˆå¦‚å® ç‰©å…»æˆã€æŠ•ç¥¨ç­‰ï¼‰ï¼Œ**ä¿ç•™ Core**
- å¦‚æœ**ç¡®å®šä¸æ‰©å±•**ï¼Œ**åˆ é™¤ Core**

---

## ğŸ“ˆ åˆ é™¤Adminåçš„æ¶æ„ä¼˜åŒ–

### ç®€åŒ–åçš„æƒé™æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Deceased Pallet æƒé™å±‚çº§         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  [owner] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚                                 â”‚ â”‚
â”‚     â”‚  å”¯ä¸€ç®¡ç†è€…                     â”‚ â”‚
â”‚     â”‚  - åˆ›å»º/æ›´æ–°/åˆ é™¤é€è€…           â”‚ â”‚
â”‚     â”‚  - è®¾ç½®å¯è§æ€§                   â”‚ â”‚
â”‚     â”‚  - ç®¡ç†äº²å‹å›¢ï¼ˆå®¡æ‰¹/ç§»é™¤/é…ç½®ï¼‰ â”‚ â”‚
â”‚     â”‚  - è®¾ç½®æˆå‘˜è§’è‰²                 â”‚ â”‚
â”‚     â”‚                                 â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  [Member / Core]                        â”‚
â”‚     â”‚                                   â”‚
â”‚     â”‚  äº²å‹å›¢æˆå‘˜                       â”‚
â”‚     â”‚  - æŸ¥çœ‹é€è€…èµ„æ–™ï¼ˆæ ¹æ®å¯è§æ€§ï¼‰     â”‚
â”‚     â”‚  - å…³æ³¨/é€€å‡º                      â”‚
â”‚     â”‚  - äº’åŠ¨ï¼ˆæœªæ¥æ‰©å±•ï¼‰               â”‚
â”‚     â”‚                                   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç®€åŒ–åçš„æ¥å£æ¸…å•

| æ¥å£å | æƒé™è¦æ±‚ | åŠŸèƒ½ |
|--------|---------|------|
| `create_deceased` | ä»»ä½•äºº | åˆ›å»ºé€è€… |
| `update_deceased` | owner | æ›´æ–°é€è€…èµ„æ–™ |
| `set_main_image` | owner | è®¾ç½®ä¸»å›¾ |
| `set_visibility` | owner | è®¾ç½®å¯è§æ€§ |
| `transfer_deceased` | owner | è½¬ç§»æ‰€æœ‰æƒ |
| `set_friend_policy` | owner | è®¾ç½®äº²å‹å›¢ç­–ç•¥ |
| `request_join` | ä»»ä½•äºº | ç”³è¯·åŠ å…¥äº²å‹å›¢ |
| `approve_join` | owner | å®¡æ‰¹åŠ å…¥ |
| `reject_join` | owner | æ‹’ç»åŠ å…¥ |
| `leave_friend_group` | æˆå‘˜æœ¬äºº | é€€å‡ºäº²å‹å›¢ |
| `kick_friend` | owner | ç§»é™¤æˆå‘˜ |
| ~~`set_friend_role`~~ | ~~owner~~ | ~~âœ… å¯åˆ é™¤ï¼ˆåªå‰©Member/Coreï¼Œå¯é€šè¿‡æ­¤æ¥å£è®¾ç½®ï¼‰~~ |

**æ³¨æ„**ï¼š`set_friend_role` æ˜¯å¦åˆ é™¤å–å†³äºï¼š
- å¦‚æœ**ä¿ç•™ Core è§’è‰²**ï¼Œåˆ™**ä¿ç•™æ­¤æ¥å£**ï¼ˆç”¨äºè®¾ç½® Member â†” Coreï¼‰
- å¦‚æœ**åˆ é™¤ Core è§’è‰²**ï¼Œåˆ™**åˆ é™¤æ­¤æ¥å£**ï¼ˆåªæœ‰ Memberï¼Œæ— éœ€è®¾ç½®ï¼‰

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### æ¨èï¼šæ–¹æ¡ˆA - ä»…åˆ é™¤ Admin è§’è‰²

#### ç†ç”±

1. **åˆ é™¤ Admin**ï¼š
   - âœ… æå¤§ç®€åŒ–ä»£ç ï¼ˆ~90 è¡Œï¼‰
   - âœ… ç¬¦åˆå®é™…éœ€æ±‚ï¼ˆ90%+ çš„åœºæ™¯ï¼‰
   - âœ… é¿å…æƒé™äº‰å¤ºé—®é¢˜
   - âœ… ç¬¦åˆ"owner å”¯ä¸€ç®¡ç†è€…"ç†å¿µ

2. **ä¿ç•™ Core**ï¼š
   - âœ… ä¸ºæœªæ¥æ‰©å±•ä¿ç•™ç©ºé—´ï¼ˆæŠ•ç¥¨ã€ç‰¹æ®Šæƒé™ç­‰ï¼‰
   - âœ… ç¤¾äº¤å±‚é¢çš„"æ ¸å¿ƒäº²å‹"æ ‡è¯†
   - âœ… ä»£ç å¤æ‚åº¦å‡ ä¹æ— å½±å“

3. **ä¿ç•™ set_friend_role**ï¼š
   - âœ… owner å¯ä»¥è®¾ç½® Member â†” Core
   - âœ… ä¸ºæœªæ¥æ‰©å±•æä¾›æ¥å£

---

## ğŸ“ å®æ–½æ­¥éª¤ï¼ˆæ–¹æ¡ˆAï¼‰

### æ­¥éª¤1ï¼šåˆ é™¤ FriendRole::Admin

```rust
// ä¿®æ”¹å‰
pub enum FriendRole {
    Member,
    Core,
    Admin,  // â† åˆ é™¤
}

// ä¿®æ”¹å
pub enum FriendRole {
    Member,
    Core,
}
```

### æ­¥éª¤2ï¼šç®€åŒ– is_admin å‡½æ•°

```rust
// ä¿®æ”¹å‰
pub(crate) fn is_admin(deceased_id: T::DeceasedId, who: &T::AccountId) -> bool {
    if let Some(d) = DeceasedOf::<T>::get(deceased_id) {
        if d.owner == *who {
            return true;
        }
    }
    if let Some(rec) = FriendsOf::<T>::get(deceased_id, who) {
        matches!(rec.role, FriendRole::Admin)
    } else {
        false
    }
}

// ä¿®æ”¹å
pub(crate) fn is_admin(deceased_id: T::DeceasedId, who: &T::AccountId) -> bool {
    if let Some(d) = DeceasedOf::<T>::get(deceased_id) {
        d.owner == *who
    } else {
        false
    }
}
```

### æ­¥éª¤3ï¼šç®€åŒ– leave_friend_group

```rust
// ä¿®æ”¹å‰
if !is_owner {
    ensure!(
        !matches!(rec.role, FriendRole::Admin),
        Error::<T>::NotAuthorized
    );
}

// ä¿®æ”¹å
// âœ… åˆ é™¤æ­¤æ£€æŸ¥ï¼Œä»»ä½•æˆå‘˜éƒ½å¯ä»¥é€€å‡º
```

### æ­¥éª¤4ï¼šç®€åŒ– kick_friend

```rust
// ä¿®æ”¹å‰
if !is_owner {
    ensure!(
        !matches!(rec.role, FriendRole::Admin),
        Error::<T>::NotAuthorized
    );
}

// ä¿®æ”¹å
// âœ… åˆ é™¤æ­¤æ£€æŸ¥ï¼Œowner å¯ä»¥ç§»é™¤ä»»ä½•æˆå‘˜
```

### æ­¥éª¤5ï¼šä¿®æ”¹ set_friend_role

```rust
// ä¿®æ”¹å‰
r.role = match role {
    2 => FriendRole::Admin,  // â† åˆ é™¤
    1 => FriendRole::Core,
    _ => FriendRole::Member,
};

// ä¿®æ”¹å
r.role = match role {
    1 => FriendRole::Core,
    _ => FriendRole::Member,
};
```

### æ­¥éª¤6ï¼šæ›´æ–° README æ–‡æ¡£

- åˆ é™¤æ‰€æœ‰ Admin ç›¸å…³æè¿°
- æ›´æ–°æƒé™æ¨¡å‹è¯´æ˜
- æ›´æ–°æ¥å£æ–‡æ¡£

### æ­¥éª¤7ï¼šç¼–è¯‘éªŒè¯

```bash
cargo build --release -p pallet-deceased
```

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

### ä»£ç ç®€åŒ–

| æŒ‡æ ‡ | ä¿®æ”¹å‰ | ä¿®æ”¹å | æ”¹å–„ |
|------|--------|--------|------|
| **ä»£ç è¡Œæ•°** | ~2400 è¡Œ | ~2310 è¡Œ | â¬‡ï¸ -90 è¡Œ |
| **è§’è‰²ç±»å‹** | 3 ç§ï¼ˆMember/Core/Adminï¼‰ | 2 ç§ï¼ˆMember/Coreï¼‰ | â¬‡ï¸ -33% |
| **æƒé™æ£€æŸ¥å¤æ‚åº¦** | `is_admin` æ£€æŸ¥ owner + FriendsOf | `is_admin` åªæ£€æŸ¥ owner | â¬‡ï¸ -50% |

### ç”¨æˆ·ä½“éªŒ

| æŒ‡æ ‡ | ä¿®æ”¹å‰ | ä¿®æ”¹å | æ”¹å–„ |
|------|--------|--------|------|
| **ç†è§£æˆæœ¬** | éœ€è¦ç†è§£ Admin æˆæƒæœºåˆ¶ | åªéœ€çŸ¥é“ owner æ˜¯ç®¡ç†è€… | âœ… æ›´ç®€å• |
| **æ“ä½œé™åˆ¶** | Admin ä¸èƒ½éšæ„é€€å‡º/è¢«ç§»é™¤ | æˆå‘˜è‡ªç”±é€€å‡º | âœ… æ›´è‡ªç”± |
| **æƒé™å†²çª** | å¤šä¸ª Admin å¯èƒ½å†²çª | åªæœ‰ owner æœ‰ç®¡ç†æƒ | âœ… æ›´æ¸…æ™° |

### å®‰å…¨æ€§

| æŒ‡æ ‡ | ä¿®æ”¹å‰ | ä¿®æ”¹å | æ”¹å–„ |
|------|--------|--------|------|
| **æƒé™äº‰å¤ºé£é™©** | âš ï¸ å¤šä¸ª Admin äº’ç›¸åƒµæŒ | âœ… æ— é£é™©ï¼ˆåªæœ‰ ownerï¼‰ | âœ… æ›´å®‰å…¨ |
| **æ»¥ç”¨é£é™©** | âš ï¸ Admin å¯èƒ½æ»¥ç”¨æƒé™ | âœ… æ— é£é™©ï¼ˆowner è‡ªå·±ç®¡ç†ï¼‰ | âœ… æ›´å¯æ§ |

---

## ğŸ‰ æ€»ç»“

### åˆç†æ€§è¯„ä¼°ï¼šâ­â­â­â­â­ éå¸¸åˆç†

1. âœ… **ç¬¦åˆå®é™…éœ€æ±‚**ï¼š90%+ çš„åœºæ™¯ä¸éœ€è¦åä½œç®¡ç†
2. âœ… **ç®€åŒ–è®¾è®¡**ï¼šå‡å°‘ ~90 è¡Œä»£ç ï¼Œé™ä½å¤æ‚åº¦
3. âœ… **é¿å…é—®é¢˜**ï¼šæ¶ˆé™¤æƒé™äº‰å¤ºã€ç®¡ç†å†²çªç­‰é£é™©
4. âœ… **ç†å¿µä¸€è‡´**ï¼šç¬¦åˆ"owner å”¯ä¸€ç®¡ç†è€…"çš„è®¾è®¡ç†å¿µ

### å¯è¡Œæ€§è¯„ä¼°ï¼šâ­â­â­â­â­ å®Œå…¨å¯è¡Œ

1. âœ… **ç ´åå¼ä¿®æ”¹å…è®¸**ï¼šä¸»ç½‘æœªä¸Šçº¿ï¼Œæ— éœ€è¿ç§»
2. âœ… **å®æ–½ç®€å•**ï¼šçº¦ 6 ä¸ªæ­¥éª¤ï¼Œé¢„è®¡ 1-2 å°æ—¶
3. âœ… **é£é™©å¯æ§**ï¼šå½±å“èŒƒå›´æ˜ç¡®ï¼Œæ˜“äºæµ‹è¯•
4. âœ… **æ›¿ä»£æ–¹æ¡ˆå®Œå¤‡**ï¼š`transfer_deceased` å¯è§£å†³åä½œéœ€æ±‚

### æ¨èæ–¹æ¡ˆï¼šæ–¹æ¡ˆA - ä»…åˆ é™¤ Admin è§’è‰²

- åˆ é™¤ `FriendRole::Admin`
- ä¿ç•™ `FriendRole::Core`ï¼ˆä¸ºæœªæ¥æ‰©å±•ä¿ç•™ç©ºé—´ï¼‰
- ç®€åŒ– `is_admin` é€»è¾‘ï¼ˆåªè®¤ ownerï¼‰
- ç§»é™¤ `leave_friend_group` å’Œ `kick_friend` ä¸­çš„ Admin é™åˆ¶
- ä¿®æ”¹ `set_friend_role` æ¥å£ï¼ˆåªæ”¯æŒ Member/Coreï¼‰

---

## ğŸ¤” å¾…è®¨è®ºé—®é¢˜

### é—®é¢˜1ï¼šæ˜¯å¦åŒæ—¶åˆ é™¤ Core è§’è‰²ï¼Ÿ

**é€‰é¡¹A**ï¼šä¿ç•™ Coreï¼ˆæ¨èï¼‰
- ç†ç”±ï¼šä¸ºæœªæ¥æ‰©å±•ä¿ç•™ç©ºé—´ï¼ˆæŠ•ç¥¨ã€ç‰¹æ®Šæƒé™ç­‰ï¼‰

**é€‰é¡¹B**ï¼šåˆ é™¤ Core
- ç†ç”±ï¼šæè‡´ç®€åŒ–ï¼Œåªæœ‰ owner å’Œ Member

**å»ºè®®**ï¼šå…ˆé‡‡ç”¨**é€‰é¡¹A**ï¼Œå¦‚æœæœªæ¥ç¡®å®šä¸éœ€è¦ Coreï¼Œå†åˆ é™¤

---

### é—®é¢˜2ï¼šå‰ç«¯å¦‚ä½•é€‚é…ï¼Ÿ

**å½±å“**ï¼š
- å‰ç«¯ä¸åº”å†æ˜¾ç¤º"è®¾ä¸ºç®¡ç†å‘˜"é€‰é¡¹
- å‰ç«¯åªéœ€æ˜¾ç¤º"è®¾ä¸ºæ ¸å¿ƒæˆå‘˜"æˆ–"è®¾ä¸ºæ™®é€šæˆå‘˜"

**å®æ–½**ï¼š
- ä¿®æ”¹å‰ç«¯ `set_friend_role` è°ƒç”¨
- ç§»é™¤ `role=2` çš„é€‰é¡¹

---

**åˆ†æå®Œæˆæ—¶é—´**ï¼š2025-10-23  
**åˆ†æç»“è®º**ï¼šâœ… **å¼ºçƒˆæ¨èåˆ é™¤ Admin åŠŸèƒ½**  
**æ¨èæ–¹æ¡ˆ**ï¼šæ–¹æ¡ˆA - ä»…åˆ é™¤ Admin è§’è‰²ï¼Œä¿ç•™ Core è§’è‰²

