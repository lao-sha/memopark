# å¤šæ¥æ”¶æ–¹åŠ å¯†æ–¹æ¡ˆ - å§”å‘˜ä¼šå®¡æ ¸åšå¸‚å•†èµ„æ–™

## ä¸€ã€å½“å‰çŠ¶æ€åˆ†æ

### 1.1 pallet-chat çš„åŠ å¯†æœºåˆ¶

```typescript
// å½“å‰å®ç°ï¼šå•æ¥æ”¶æ–¹ç«¯åˆ°ç«¯åŠ å¯†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å‘é€æ–¹ (åšå¸‚å•†)                       â”‚
â”‚  - ç”Ÿæˆæ¶ˆæ¯å†…å®¹                                   â”‚
â”‚  - ä½¿ç”¨æ¥æ”¶æ–¹å…¬é’¥åŠ å¯†                             â”‚
â”‚  - ä¸Šä¼ åˆ° IPFS â†’ è·å– CID                         â”‚
â”‚  - è°ƒç”¨ send_message(CID)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          é“¾ä¸Šå­˜å‚¨ (pallet-chat)                   â”‚
â”‚  - æ¶ˆæ¯ID                                        â”‚
â”‚  - å‘é€æ–¹: åšå¸‚å•†è´¦æˆ·                             â”‚
â”‚  - æ¥æ”¶æ–¹: å•ä¸ªå§”å‘˜ä¼šæˆå‘˜                         â”‚
â”‚  - IPFS CID                                      â”‚
â”‚  - æ—¶é—´æˆ³                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ¥æ”¶æ–¹ (å•ä¸ªå§”å‘˜)                        â”‚
â”‚  - ä» IPFS ä¸‹è½½åŠ å¯†å†…å®¹                           â”‚
â”‚  - ä½¿ç”¨ç§é’¥è§£å¯†                                   â”‚
â”‚  - æ˜¾ç¤ºæ¶ˆæ¯                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜**ï¼šåªæœ‰å•ä¸ªæ¥æ”¶æ–¹å¯ä»¥è§£å¯†ï¼Œå…¶ä»–å§”å‘˜ä¼šæˆå‘˜æ— æ³•æŸ¥çœ‹ã€‚

---

### 1.2 åšå¸‚å•†ç”³è¯·èµ„æ–™çš„å­˜å‚¨

```rust
pub struct Application<AccountId, Balance> {
    // å…¬å¼€ä¿¡æ¯CIDï¼ˆæ‰€æœ‰ä¹°å®¶å¯è§ï¼‰
    pub public_cid: Cid,
    
    // ğŸ”’ æ•æ„Ÿä¿¡æ¯CIDï¼ˆä»…å®¡æ ¸å‘˜å¯è§ï¼‰
    pub private_cid: Cid,
    
    // é“¾ä¸Šå­˜å‚¨è„±æ•ä¿¡æ¯
    pub masked_full_name: BoundedVec<u8, ConstU32<64>>,      // "å¼ Ã—ä¸‰"
    pub masked_id_card: BoundedVec<u8, ConstU32<32>>,        // "1101****1234"
    pub masked_payment_info: BoundedVec<u8, ConstU32<512>>,  // è„±æ•æ”¶æ¬¾æ–¹å¼
}
```

**é—®é¢˜**ï¼š`private_cid` åŠ å¯†åï¼Œå¦‚ä½•è®©å¤šä¸ªå§”å‘˜ä¼šæˆå‘˜éƒ½èƒ½è§£å¯†ï¼Ÿ

---

## äºŒã€éœ€æ±‚åˆ†æ

### 2.1 æ ¸å¿ƒéœ€æ±‚

**åœºæ™¯1ï¼šåšå¸‚å•†ç”³è¯·å®¡æ ¸**
- åšå¸‚å•†æäº¤ `private_cid`ï¼ˆåŒ…å«å®Œæ•´èº«ä»½è¯ã€é“¶è¡Œå¡ç­‰æ•æ„Ÿä¿¡æ¯ï¼‰
- **æ‰€æœ‰å§”å‘˜ä¼šæˆå‘˜**éƒ½éœ€è¦èƒ½è§£å¯†æŸ¥çœ‹
- æ™®é€šç”¨æˆ·**ä¸èƒ½**è§£å¯†

**åœºæ™¯2ï¼šèŠå¤©è®°å½•å®¡æ ¸**
- OTC è®¢å•å‘ç”Ÿäº‰è®®
- ç”¨æˆ·å¯èƒ½æäº¤ä¹°å®¶ä¸åšå¸‚å•†çš„èŠå¤©è®°å½•ä½œä¸ºè¯æ®
- **å§”å‘˜ä¼šæˆå‘˜**éœ€è¦èƒ½æŸ¥çœ‹èŠå¤©å†…å®¹è¿›è¡Œä»²è£
- å½“äº‹äººä¹‹å¤–çš„æ™®é€šç”¨æˆ·**ä¸èƒ½**è§£å¯†

### 2.2 å®‰å…¨è¦æ±‚

âœ… **éšç§ä¿æŠ¤**ï¼šåªæœ‰æˆæƒçš„å§”å‘˜ä¼šæˆå‘˜å¯ä»¥è§£å¯†  
âœ… **çµæ´»æ€§**ï¼šæ”¯æŒå§”å‘˜ä¼šæˆå‘˜å˜æ›´ï¼ˆæ–°å¢/ç§»é™¤ï¼‰  
âœ… **é˜²ç¯¡æ”¹**ï¼šåŠ å¯†å†…å®¹åœ¨ IPFS ä¸Šä¸å¯ç¯¡æ”¹  
âœ… **å¯å®¡è®¡**ï¼šé“¾ä¸Šè®°å½•å“ªäº›å§”å‘˜ä¼šæˆå‘˜è®¿é—®è¿‡èµ„æ–™  
âœ… **æ€§èƒ½**ï¼šåŠ å¯†/è§£å¯†é€Ÿåº¦å¿«ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒ

---

## ä¸‰ã€æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆAï¼šå¤šæ¬¡å•ç‹¬åŠ å¯†ï¼ˆæœ€ç®€å•ï¼‰

#### å®ç°åŸç†

```typescript
// ä¸ºæ¯ä¸ªå§”å‘˜ä¼šæˆå‘˜ç‹¬ç«‹åŠ å¯†ä¸€ä»½
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åšå¸‚å•†                               â”‚
â”‚  1. ç”ŸæˆåŸå§‹å†…å®¹                                  â”‚
â”‚  2. è·å–æ‰€æœ‰å§”å‘˜ä¼šæˆå‘˜å…¬é’¥                         â”‚
â”‚  3. ä¸ºæ¯ä¸ªæˆå‘˜ç”¨å…¶å…¬é’¥åŠ å¯†ä¸€ä»½                     â”‚
â”‚  4. ä¸Šä¼ å¤šä¸ªåŠ å¯†æ–‡ä»¶åˆ° IPFS                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IPFSå­˜å‚¨ï¼š
- QmXXX1 â†’ ä¸ºå§”å‘˜AåŠ å¯†çš„å†…å®¹ï¼ˆç”¨å§”å‘˜Aå…¬é’¥ï¼‰
- QmXXX2 â†’ ä¸ºå§”å‘˜BåŠ å¯†çš„å†…å®¹ï¼ˆç”¨å§”å‘˜Bå…¬é’¥ï¼‰
- QmXXX3 â†’ ä¸ºå§”å‘˜CåŠ å¯†çš„å†…å®¹ï¼ˆç”¨å§”å‘˜Cå…¬é’¥ï¼‰
...

é“¾ä¸Šå­˜å‚¨ï¼š
{
  "member_cids": {
    "5GrwvaEF...": "QmXXX1",  // å§”å‘˜Açš„CID
    "5FHneW46...": "QmXXX2",  // å§”å‘˜Bçš„CID
    "5DAAnrj7...": "QmXXX3",  // å§”å‘˜Cçš„CID
  }
}
```

#### ä¼˜ç¼ºç‚¹

| é¡¹ç›® | è¯„ä¼° |
|------|------|
| âœ… å®ç°ç®€å• | å‰ç«¯ç›´æ¥ç”¨ç°æœ‰åŠ å¯†åº“ |
| âœ… å®‰å…¨æ€§é«˜ | æ¯ä¸ªæˆå‘˜ç‹¬ç«‹å¯†é’¥ï¼Œäº’ä¸å¹²æ‰° |
| âœ… çµæ´»æ€§å¥½ | æ–°å¢æˆå‘˜åªéœ€è¡¥å……åŠ å¯† |
| âŒ å­˜å‚¨æˆæœ¬é«˜ | Nä¸ªæˆå‘˜ = Nä»½åŠ å¯†æ–‡ä»¶ |
| âŒ åŠ å¯†è€—æ—¶ | éœ€è¦åŠ å¯†Næ¬¡ |
| âŒ IPFSå¼€é”€ | ä¸Šä¼ Nä¸ªæ–‡ä»¶ |

**é€‚ç”¨åœºæ™¯**ï¼šå§”å‘˜ä¼šæˆå‘˜æ•°é‡å°‘ï¼ˆ< 10äººï¼‰ï¼Œå†…å®¹è¾ƒå°ï¼ˆ< 1MBï¼‰

---

### æ–¹æ¡ˆBï¼šæ··åˆåŠ å¯†ï¼ˆå¯¹ç§°+éå¯¹ç§°ï¼Œæ¨èï¼‰

#### å®ç°åŸç†

```typescript
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åšå¸‚å•†                               â”‚
â”‚  1. ç”Ÿæˆéšæœºå¯¹ç§°å¯†é’¥ï¼ˆAES-256ï¼‰                    â”‚
â”‚  2. ä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†åŸå§‹å†…å®¹                       â”‚
â”‚  3. è·å–æ‰€æœ‰å§”å‘˜ä¼šæˆå‘˜å…¬é’¥                         â”‚
â”‚  4. ä¸ºæ¯ä¸ªæˆå‘˜ç”¨å…¶å…¬é’¥åŠ å¯†å¯¹ç§°å¯†é’¥                 â”‚
â”‚  5. ä¸Šä¼ åŠ å¯†å†…å®¹ + åŠ å¯†å¯†é’¥åˆ—è¡¨åˆ° IPFS             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IPFSå­˜å‚¨ç»“æ„ï¼š
{
  "encrypted_content": "...",  // AES-256åŠ å¯†çš„å®é™…å†…å®¹ï¼ˆåªæœ‰ä¸€ä»½ï¼‰
  "encrypted_keys": {
    "5GrwvaEF...": "å§”å‘˜Aå…¬é’¥åŠ å¯†çš„AESå¯†é’¥",
    "5FHneW46...": "å§”å‘˜Bå…¬é’¥åŠ å¯†çš„AESå¯†é’¥",
    "5DAAnrj7...": "å§”å‘˜Cå…¬é’¥åŠ å¯†çš„AESå¯†é’¥",
  }
}

è§£å¯†æµç¨‹ï¼š
1. å§”å‘˜Aä¸‹è½½IPFSæ–‡ä»¶
2. æ‰¾åˆ°è‡ªå·±å¯¹åº”çš„åŠ å¯†å¯†é’¥
3. ç”¨ç§é’¥è§£å¯†å¾—åˆ°AESå¯†é’¥
4. ç”¨AESå¯†é’¥è§£å¯†å®é™…å†…å®¹
```

#### ä¼˜ç¼ºç‚¹

| é¡¹ç›® | è¯„ä¼° |
|------|------|
| âœ… å­˜å‚¨ä¼˜åŒ– | å†…å®¹åªåŠ å¯†ä¸€æ¬¡ |
| âœ… æ€§èƒ½å¥½ | AESåŠ å¯†é€Ÿåº¦å¿« |
| âœ… å¯æ‰©å±• | æ–°å¢æˆå‘˜åªéœ€åŠ å¯†å¯†é’¥ |
| âœ… å®‰å…¨æ€§é«˜ | å¯¹ç§°+éå¯¹ç§°åŒé‡ä¿æŠ¤ |
| âš ï¸ å®ç°å¤æ‚ | éœ€è¦ç®¡ç†å¯¹ç§°å¯†é’¥ |

**é€‚ç”¨åœºæ™¯**ï¼šå§”å‘˜ä¼šæˆå‘˜è¾ƒå¤šï¼ˆ> 10äººï¼‰ï¼Œå†…å®¹è¾ƒå¤§ï¼ˆ> 1MBï¼‰ï¼Œ**æ¨èæ–¹æ¡ˆ**

---

### æ–¹æ¡ˆCï¼šé—¨é™åŠ å¯†ï¼ˆæœ€å…ˆè¿›ï¼Œæœªæ¥æ‰©å±•ï¼‰

#### å®ç°åŸç†

```typescript
// Shamirç§˜å¯†å…±äº«ï¼šNä¸ªæˆå‘˜ä¸­ä»»æ„Kä¸ªå¯ä»¥æ¢å¤å¯†é’¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åšå¸‚å•†                               â”‚
â”‚  1. ç”Ÿæˆä¸»å¯†é’¥                                    â”‚
â”‚  2. ä½¿ç”¨é—¨é™ç®—æ³•åˆ†å‰²ä¸ºNä»½ï¼ˆå¦‚5ä»½ï¼‰                 â”‚
â”‚  3. è®¾ç½®æ¢å¤é˜ˆå€¼Kï¼ˆå¦‚3ä»½ï¼‰                        â”‚
â”‚  4. ç”¨ä¸»å¯†é’¥åŠ å¯†å†…å®¹                              â”‚
â”‚  5. åˆ†åˆ«ç”¨æ¯ä¸ªæˆå‘˜å…¬é’¥åŠ å¯†å„è‡ªçš„åˆ†ç‰‡               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IPFSå­˜å‚¨ï¼š
{
  "encrypted_content": "...",  // ä¸»å¯†é’¥åŠ å¯†çš„å†…å®¹
  "key_shares": {
    "5GrwvaEF...": "å§”å‘˜Açš„å¯†é’¥åˆ†ç‰‡ï¼ˆåŠ å¯†ï¼‰",
    "5FHneW46...": "å§”å‘˜Bçš„å¯†é’¥åˆ†ç‰‡ï¼ˆåŠ å¯†ï¼‰",
    "5DAAnrj7...": "å§”å‘˜Cçš„å¯†é’¥åˆ†ç‰‡ï¼ˆåŠ å¯†ï¼‰",
    // ... å…±5ä»½
  },
  "threshold": 3  // ä»»æ„3ä»½å³å¯æ¢å¤
}

è§£å¯†æµç¨‹ï¼š
1. è‡³å°‘3ä¸ªå§”å‘˜ä¸‹è½½å¹¶è§£å¯†è‡ªå·±çš„åˆ†ç‰‡
2. ç»„åˆ3ä¸ªåˆ†ç‰‡æ¢å¤ä¸»å¯†é’¥
3. ç”¨ä¸»å¯†é’¥è§£å¯†å†…å®¹
```

#### ä¼˜ç¼ºç‚¹

| é¡¹ç›® | è¯„ä¼° |
|------|------|
| âœ… å®‰å…¨æ€§æœ€é«˜ | éœ€è¦å¤šäººåä½œæ‰èƒ½è§£å¯† |
| âœ… æŠ—å•ç‚¹æ•…éšœ | K-1ä¸ªæˆå‘˜ç¦»çº¿ä¹Ÿèƒ½è§£å¯† |
| âœ… é˜²æ­¢æ»¥ç”¨ | å•ä¸ªæˆå‘˜æ— æ³•ç‹¬è‡ªè§£å¯† |
| âŒ å®ç°æœ€å¤æ‚ | éœ€è¦ä¸“é—¨çš„é—¨é™åŠ å¯†åº“ |
| âŒ åä½œæˆæœ¬é«˜ | éœ€è¦è‡³å°‘Kä¸ªæˆå‘˜åœ¨çº¿ |

**é€‚ç”¨åœºæ™¯**ï¼šæé«˜å®‰å…¨è¦æ±‚ï¼ˆå¦‚å›½åº“èµ„é‡‘ã€é‡å¤§æ²»ç†å†³ç­–ï¼‰ï¼Œæœªæ¥æ‰©å±•

---

## å››ã€æ¨èå®æ–½æ–¹æ¡ˆï¼ˆæ–¹æ¡ˆBï¼šæ··åˆåŠ å¯†ï¼‰

### 4.1 æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰æ‹© | è¯´æ˜ |
|------|---------|------|
| å¯¹ç§°åŠ å¯† | AES-256-GCM | ä¸šç•Œæ ‡å‡†ï¼Œé€Ÿåº¦å¿«ï¼Œå®‰å…¨æ€§é«˜ |
| éå¯¹ç§°åŠ å¯† | X25519 (Curve25519) | Polkadot ä½¿ç”¨çš„åŠ å¯†æ›²çº¿ |
| å¯†é’¥æ´¾ç”Ÿ | HKDF | ä»è´¦æˆ·ç§é’¥æ´¾ç”ŸåŠ å¯†å¯†é’¥ |
| IPFS | ipfs-http-client | å®˜æ–¹åº“ |
| å‰ç«¯åº“ | TweetNaCl.js | è½»é‡çº§åŠ å¯†åº“ |

---

### 4.2 æ•°æ®ç»“æ„è®¾è®¡

#### 4.2.1 IPFS å­˜å‚¨æ ¼å¼

```typescript
interface MultiRecipientEncryptedData {
  version: string;                // ç‰ˆæœ¬å·ï¼Œå¦‚ "1.0"
  encrypted_content: string;      // Base64ç¼–ç çš„AESåŠ å¯†å†…å®¹
  nonce: string;                  // AES-GCM nonce (12å­—èŠ‚)
  encrypted_keys: {
    [accountId: string]: {
      encrypted_aes_key: string;  // Base64ç¼–ç çš„RSAåŠ å¯†AESå¯†é’¥
      encryption_method: string;  // åŠ å¯†æ–¹æ³•ï¼Œå¦‚ "X25519-XSalsa20-Poly1305"
    }
  };
  metadata: {
    content_type: string;         // å¦‚ "application/json"
    original_size: number;        // åŸå§‹å†…å®¹å¤§å°ï¼ˆå­—èŠ‚ï¼‰
    encrypted_at: number;         // åŠ å¯†æ—¶é—´æˆ³
    encryptor: string;            // åŠ å¯†è€…è´¦æˆ·ID
  };
}
```

**ç¤ºä¾‹**ï¼š

```json
{
  "version": "1.0",
  "encrypted_content": "q8F3ZxR7vT9nL...", // AESåŠ å¯†åçš„Base64
  "nonce": "A8k9F3mL5p0qW1x2", // 12å­—èŠ‚éšæœºæ•°
  "encrypted_keys": {
    "5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY": {
      "encrypted_aes_key": "xK8mL3nQ...",
      "encryption_method": "X25519-XSalsa20-Poly1305"
    },
    "5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty": {
      "encrypted_aes_key": "bN7pR2sT...",
      "encryption_method": "X25519-XSalsa20-Poly1305"
    }
  },
  "metadata": {
    "content_type": "application/json",
    "original_size": 2048,
    "encrypted_at": 1729670000,
    "encryptor": "5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY"
  }
}
```

---

#### 4.2.2 é“¾ä¸Šå­˜å‚¨æ ¼å¼ï¼ˆpallet-market-makerï¼‰

```rust
// ä¿®æ”¹ Application ç»“æ„
pub struct Application<AccountId, Balance> {
    // ... å…¶ä»–å­—æ®µ ...
    
    /// å…¬å¼€ä¿¡æ¯CIDï¼ˆæ‰€æœ‰ä¹°å®¶å¯è§ï¼‰
    pub public_cid: Cid,
    
    /// ğŸ†• å¤šæ¥æ”¶æ–¹åŠ å¯†çš„æ•æ„Ÿä¿¡æ¯CID
    /// - åŠ å¯†ç»™æ‰€æœ‰å§”å‘˜ä¼šæˆå‘˜
    /// - ä½¿ç”¨æ··åˆåŠ å¯†ï¼ˆAES + X25519ï¼‰
    pub private_multi_cid: Cid,
    
    /// ğŸ†• æˆæƒçš„æ¥æ”¶æ–¹åˆ—è¡¨ï¼ˆå§”å‘˜ä¼šæˆå‘˜è´¦æˆ·ï¼‰
    /// - è®°å½•å“ªäº›è´¦æˆ·å¯ä»¥è§£å¯†
    /// - ç”¨äºå‰ç«¯åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™
    pub authorized_recipients: BoundedVec<AccountId, ConstU32<50>>,
    
    // ... å…¶ä»–å­—æ®µ ...
}
```

---

### 4.3 å‰ç«¯å®ç°ç¤ºä¾‹

#### 4.3.1 åŠ å¯†å·¥å…·ç±»

```typescript
// src/utils/multiRecipientEncryption.ts

import nacl from 'tweetnacl';
import { u8aToHex, hexToU8a } from '@polkadot/util';
import { decodeAddress, encodeAddress } from '@polkadot/util-crypto';

/**
 * å¤šæ¥æ”¶æ–¹åŠ å¯†ç±»
 */
export class MultiRecipientEncryption {
  /**
   * åŠ å¯†æ•°æ®ç»™å¤šä¸ªæ¥æ”¶æ–¹
   * 
   * @param content - åŸå§‹å†…å®¹ï¼ˆJSONå¯¹è±¡æˆ–å­—ç¬¦ä¸²ï¼‰
   * @param recipientPublicKeys - æ¥æ”¶æ–¹å…¬é’¥åˆ—è¡¨ { accountId: publicKey }
   * @returns IPFSä¸Šä¼ çš„åŠ å¯†æ•°æ®ç»“æ„
   */
  static async encrypt(
    content: any,
    recipientPublicKeys: { [accountId: string]: Uint8Array }
  ): Promise<MultiRecipientEncryptedData> {
    // 1. ç”ŸæˆéšæœºAESå¯†é’¥ï¼ˆ32å­—èŠ‚ï¼‰
    const aesKey = nacl.randomBytes(32);
    
    // 2. ç”Ÿæˆéšæœºnonceï¼ˆ12å­—èŠ‚ï¼Œç”¨äºAES-GCMï¼‰
    const nonce = nacl.randomBytes(12);
    
    // 3. åºåˆ—åŒ–å†…å®¹
    const contentStr = typeof content === 'string' 
      ? content 
      : JSON.stringify(content);
    const contentBytes = new TextEncoder().encode(contentStr);
    
    // 4. ä½¿ç”¨AES-256-GCMåŠ å¯†å†…å®¹ï¼ˆä½¿ç”¨XSalsa20-Poly1305è¿‘ä¼¼ï¼‰
    const encryptedContent = nacl.secretbox(
      contentBytes,
      this.extendNonce(nonce),
      aesKey
    );
    
    // 5. ä¸ºæ¯ä¸ªæ¥æ”¶æ–¹åŠ å¯†AESå¯†é’¥
    const encryptedKeys: any = {};
    for (const [accountId, publicKey] of Object.entries(recipientPublicKeys)) {
      // ç”Ÿæˆä¸´æ—¶å¯†é’¥å¯¹
      const ephemeralKeyPair = nacl.box.keyPair();
      
      // ä½¿ç”¨æ¥æ”¶æ–¹å…¬é’¥åŠ å¯†AESå¯†é’¥
      const encryptedAesKey = nacl.box(
        aesKey,
        nacl.randomBytes(24), // nonce
        publicKey,
        ephemeralKeyPair.secretKey
      );
      
      encryptedKeys[accountId] = {
        encrypted_aes_key: this.toBase64(encryptedAesKey),
        encryption_method: 'X25519-XSalsa20-Poly1305',
        ephemeral_public_key: this.toBase64(ephemeralKeyPair.publicKey),
      };
    }
    
    // 6. æ„é€ è¿”å›æ•°æ®
    return {
      version: '1.0',
      encrypted_content: this.toBase64(encryptedContent),
      nonce: this.toBase64(nonce),
      encrypted_keys: encryptedKeys,
      metadata: {
        content_type: 'application/json',
        original_size: contentBytes.length,
        encrypted_at: Math.floor(Date.now() / 1000),
        encryptor: '', // è°ƒç”¨æ–¹å¡«å……
      },
    };
  }
  
  /**
   * è§£å¯†æ•°æ®
   * 
   * @param encryptedData - ä»IPFSä¸‹è½½çš„åŠ å¯†æ•°æ®
   * @param recipientAccountId - å½“å‰ç”¨æˆ·è´¦æˆ·ID
   * @param recipientSecretKey - å½“å‰ç”¨æˆ·ç§é’¥
   * @returns è§£å¯†åçš„åŸå§‹å†…å®¹
   */
  static async decrypt(
    encryptedData: MultiRecipientEncryptedData,
    recipientAccountId: string,
    recipientSecretKey: Uint8Array
  ): Promise<any> {
    // 1. æ£€æŸ¥æ˜¯å¦ä¸ºæˆæƒæ¥æ”¶æ–¹
    const keyInfo = encryptedData.encrypted_keys[recipientAccountId];
    if (!keyInfo) {
      throw new Error('å½“å‰è´¦æˆ·æ— æƒè§£å¯†æ­¤å†…å®¹');
    }
    
    // 2. è§£å¯†AESå¯†é’¥
    const encryptedAesKey = this.fromBase64(keyInfo.encrypted_aes_key);
    const ephemeralPublicKey = this.fromBase64(keyInfo.ephemeral_public_key);
    
    const aesKey = nacl.box.open(
      encryptedAesKey,
      nacl.randomBytes(24), // éœ€è¦å­˜å‚¨å®é™…çš„nonce
      ephemeralPublicKey,
      recipientSecretKey
    );
    
    if (!aesKey) {
      throw new Error('è§£å¯†AESå¯†é’¥å¤±è´¥');
    }
    
    // 3. è§£å¯†å†…å®¹
    const encryptedContent = this.fromBase64(encryptedData.encrypted_content);
    const nonce = this.fromBase64(encryptedData.nonce);
    
    const contentBytes = nacl.secretbox.open(
      encryptedContent,
      this.extendNonce(nonce),
      aesKey
    );
    
    if (!contentBytes) {
      throw new Error('è§£å¯†å†…å®¹å¤±è´¥');
    }
    
    // 4. ååºåˆ—åŒ–
    const contentStr = new TextDecoder().decode(contentBytes);
    
    try {
      return JSON.parse(contentStr);
    } catch {
      return contentStr;
    }
  }
  
  // è¾…åŠ©æ–¹æ³•
  private static toBase64(data: Uint8Array): string {
    return Buffer.from(data).toString('base64');
  }
  
  private static fromBase64(str: string): Uint8Array {
    return new Uint8Array(Buffer.from(str, 'base64'));
  }
  
  private static extendNonce(nonce: Uint8Array): Uint8Array {
    // XSalsa20éœ€è¦24å­—èŠ‚nonceï¼Œä»12å­—èŠ‚æ‰©å±•
    const extended = new Uint8Array(24);
    extended.set(nonce);
    return extended;
  }
}

// TypeScript æ¥å£å®šä¹‰
export interface MultiRecipientEncryptedData {
  version: string;
  encrypted_content: string;
  nonce: string;
  encrypted_keys: {
    [accountId: string]: {
      encrypted_aes_key: string;
      encryption_method: string;
      ephemeral_public_key: string;
    };
  };
  metadata: {
    content_type: string;
    original_size: number;
    encrypted_at: number;
    encryptor: string;
  };
}
```

---

#### 4.3.2 ä½¿ç”¨ç¤ºä¾‹ï¼šåšå¸‚å•†æäº¤ç”³è¯·

```typescript
// src/pages/MarketMaker/SubmitApplication.tsx

import { create as ipfsHttpClient } from 'ipfs-http-client';
import { MultiRecipientEncryption } from '@/utils/multiRecipientEncryption';

const ipfs = ipfsHttpClient({ url: 'https://ipfs.infura.io:5001' });

/**
 * æäº¤åšå¸‚å•†ç”³è¯·ï¼ˆåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰
 */
async function submitMarketMakerApplication() {
  // 1. è·å–æ‰€æœ‰å§”å‘˜ä¼šæˆå‘˜å…¬é’¥
  const committeeMembers = await api.query.collective.members(3); // Instance3 = ContentCommittee
  const publicKeys: { [accountId: string]: Uint8Array } = {};
  
  for (const member of committeeMembers) {
    const accountId = member.toString();
    // ä»é“¾ä¸Šè·å–å…¬é’¥ï¼ˆå‡è®¾å­˜å‚¨åœ¨Identityä¸­ï¼‰
    const identity = await api.query.identity.identityOf(member);
    if (identity.isSome) {
      // æˆ–è€…ä½¿ç”¨è´¦æˆ·åœ°å€ç›´æ¥æ´¾ç”Ÿå…¬é’¥
      publicKeys[accountId] = decodeAddress(accountId);
    }
  }
  
  // 2. å‡†å¤‡æ•æ„Ÿä¿¡æ¯
  const privateInfo = {
    full_name: 'å¼ ä¸‰',
    id_card: '110101199001011234',
    phone: '13800138000',
    email: 'maker@example.com',
    bank_accounts: [
      {
        bank_name: 'ä¸­å›½é“¶è¡Œ',
        account_number: '6214850123456789',
        account_holder: 'å¼ ä¸‰',
      }
    ],
    addresses: {
      residential: 'åŒ—äº¬å¸‚æœé˜³åŒºxxxè¡—é“xxxå·',
      business: 'åŒ—äº¬å¸‚æµ·æ·€åŒºxxxå¤§å¦xxxå®¤',
    },
    business_license: 'QmBusinessLicenseImageCID...',
    id_card_front: 'QmIdCardFrontImageCID...',
    id_card_back: 'QmIdCardBackImageCID...',
  };
  
  // 3. åŠ å¯†æ•æ„Ÿä¿¡æ¯
  const encryptedData = await MultiRecipientEncryption.encrypt(
    privateInfo,
    publicKeys
  );
  
  encryptedData.metadata.encryptor = currentAccount.address;
  
  // 4. ä¸Šä¼ åˆ°IPFS
  const result = await ipfs.add(JSON.stringify(encryptedData));
  const privateCid = result.path;
  
  console.log('åŠ å¯†æ•æ„Ÿä¿¡æ¯å·²ä¸Šä¼ :', privateCid);
  
  // 5. å‡†å¤‡å…¬å¼€ä¿¡æ¯ï¼ˆä¸åŠ å¯†ï¼‰
  const publicInfo = {
    business_name: 'ä¼˜è´¨åšå¸‚å•†æœåŠ¡',
    description: 'æä¾›ä¸“ä¸šçš„MEMO<->USDTå…‘æ¢æœåŠ¡',
    service_hours: '7x24å°æ—¶',
    languages: ['ä¸­æ–‡', 'English'],
    contact_telegram: '@maker_support',
  };
  
  const publicResult = await ipfs.add(JSON.stringify(publicInfo));
  const publicCid = publicResult.path;
  
  // 6. è°ƒç”¨é“¾ä¸Šæ¥å£æäº¤ç”³è¯·
  await api.tx.marketMaker.submitInfo(
    mmId,
    publicCid,
    privateCid,
    buyPremiumBps,
    sellPremiumBps,
    minAmount,
    tronAddress,
    'å¼ ä¸‰',          // å®Œæ•´å§“åï¼ˆé“¾ç«¯è‡ªåŠ¨è„±æ•ï¼‰
    '110101199001011234',  // å®Œæ•´èº«ä»½è¯ï¼ˆé“¾ç«¯è‡ªåŠ¨è„±æ•ï¼‰
    paymentInfoJson  // å¯é€‰
  ).signAndSend(currentAccount);
  
  console.log('âœ… ç”³è¯·å·²æäº¤ï¼Œæ•æ„Ÿä¿¡æ¯å·²åŠ å¯†ç»™æ‰€æœ‰å§”å‘˜ä¼šæˆå‘˜');
}
```

---

#### 4.3.3 ä½¿ç”¨ç¤ºä¾‹ï¼šå§”å‘˜ä¼šå®¡æ ¸èµ„æ–™

```typescript
// src/pages/Governance/ReviewApplication.tsx

/**
 * å§”å‘˜ä¼šæˆå‘˜å®¡æ ¸åšå¸‚å•†ç”³è¯·
 */
async function reviewMarketMakerApplication(mmId: number) {
  // 1. è·å–ç”³è¯·ä¿¡æ¯
  const application = await api.query.marketMaker.applications(mmId);
  const privateCid = application.private_multi_cid.toString();
  
  // 2. æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºæˆæƒæ¥æ”¶æ–¹
  const authorizedRecipients = application.authorized_recipients.toJSON();
  const currentAccountId = currentAccount.address;
  
  if (!authorizedRecipients.includes(currentAccountId)) {
    alert('æ‚¨æ— æƒæŸ¥çœ‹æ­¤ç”³è¯·çš„æ•æ„Ÿä¿¡æ¯');
    return;
  }
  
  // 3. ä»IPFSä¸‹è½½åŠ å¯†æ•°æ®
  const chunks = [];
  for await (const chunk of ipfs.cat(privateCid)) {
    chunks.push(chunk);
  }
  const encryptedDataStr = Buffer.concat(chunks).toString();
  const encryptedData: MultiRecipientEncryptedData = JSON.parse(encryptedDataStr);
  
  // 4. è·å–å½“å‰ç”¨æˆ·ç§é’¥ï¼ˆä»é’±åŒ…ï¼‰
  const pair = await web3FromAddress(currentAccountId);
  const secretKey = pair.secretKey; // éœ€è¦ç”¨æˆ·æˆæƒ
  
  // 5. è§£å¯†æ•æ„Ÿä¿¡æ¯
  try {
    const privateInfo = await MultiRecipientEncryption.decrypt(
      encryptedData,
      currentAccountId,
      secretKey
    );
    
    console.log('âœ… è§£å¯†æˆåŠŸï¼Œæ•æ„Ÿä¿¡æ¯ï¼š', privateInfo);
    
    // 6. æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯ä¾›å®¡æ ¸
    setReviewData({
      public: application.public_cid, // å…¬å¼€ä¿¡æ¯
      private: privateInfo,            // è§£å¯†åçš„æ•æ„Ÿä¿¡æ¯
    });
    
  } catch (error) {
    console.error('âŒ è§£å¯†å¤±è´¥ï¼š', error);
    alert('è§£å¯†å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ‚¨çš„æƒé™');
  }
}
```

---

### 4.4 é“¾ç«¯é€‚é…

#### 4.4.1 ä¿®æ”¹ pallet-market-maker

```rust
// pallets/market-maker/src/lib.rs

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šApplication ç»“æ„ä¿®æ”¹
#[derive(Clone, Encode, Decode, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub struct Application<AccountId, Balance> {
    // ... ä¿ç•™åŸæœ‰å­—æ®µ ...
    
    /// å…¬å¼€ä¿¡æ¯CIDï¼ˆæ‰€æœ‰ä¹°å®¶å¯è§ï¼‰
    pub public_cid: Cid,
    
    /// ğŸ†• å¤šæ¥æ”¶æ–¹åŠ å¯†çš„æ•æ„Ÿä¿¡æ¯CID
    /// - ä½¿ç”¨æ··åˆåŠ å¯†ï¼ˆAES-256 + X25519ï¼‰
    /// - åŠ å¯†ç»™æ‰€æœ‰å§”å‘˜ä¼šæˆå‘˜
    /// - IPFSå­˜å‚¨æ ¼å¼è§æ–‡æ¡£
    pub private_multi_cid: Cid,
    
    /// ğŸ†• æˆæƒçš„æ¥æ”¶æ–¹åˆ—è¡¨ï¼ˆå§”å‘˜ä¼šæˆå‘˜è´¦æˆ·ï¼‰
    /// - è®°å½•å“ªäº›è´¦æˆ·å¯ä»¥è§£å¯† private_multi_cid
    /// - ç”¨äºæƒé™æ ¡éªŒå’Œå‰ç«¯åˆ¤æ–­
    /// - æˆå‘˜å˜æ›´æ—¶éœ€è¦é‡æ–°åŠ å¯†å¹¶æ›´æ–°
    pub authorized_recipients: BoundedVec<AccountId, ConstU32<50>>,
    
    // ... å…¶ä»–å­—æ®µ ...
}

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šæäº¤åšå¸‚å•†ç”³è¯·ä¿¡æ¯ï¼ˆä¿®æ”¹ç‰ˆï¼‰
/// 
/// # æ–°å¢å‚æ•°
/// - private_multi_cid: å¤šæ¥æ”¶æ–¹åŠ å¯†çš„æ•æ„Ÿä¿¡æ¯CID
/// - authorized_recipients: æˆæƒçš„æ¥æ”¶æ–¹åˆ—è¡¨ï¼ˆé€šå¸¸æ˜¯å§”å‘˜ä¼šæˆå‘˜ï¼‰
#[pallet::call_index(1)]
#[pallet::weight(10_000)]
pub fn submit_info(
    origin: OriginFor<T>,
    mm_id: u64,
    public_root_cid: Vec<u8>,
    private_multi_cid: Vec<u8>,  // ğŸ†• å¤šæ¥æ”¶æ–¹åŠ å¯†CID
    authorized_recipients: Vec<T::AccountId>,  // ğŸ†• æˆæƒåˆ—è¡¨
    // ... å…¶ä»–å‚æ•° ...
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    // éªŒè¯æˆæƒåˆ—è¡¨ä¸ä¸ºç©ºä¸”ä¸è¶…è¿‡ä¸Šé™
    ensure!(!authorized_recipients.is_empty(), Error::<T>::EmptyRecipients);
    ensure!(
        authorized_recipients.len() <= 50,
        Error::<T>::TooManyRecipients
    );
    
    // ğŸ†• å¯é€‰ï¼šéªŒè¯æ‰€æœ‰æ¥æ”¶æ–¹éƒ½æ˜¯å§”å‘˜ä¼šæˆå‘˜
    for recipient in &authorized_recipients {
        ensure!(
            Self::is_committee_member(recipient),
            Error::<T>::NotCommitteeMember
        );
    }
    
    // æ›´æ–°ç”³è¯·
    Applications::<T>::try_mutate(mm_id, |maybe_app| -> DispatchResult {
        let app = maybe_app.as_mut().ok_or(Error::<T>::NotFound)?;
        ensure!(app.owner == who, Error::<T>::NotOwner);
        
        // è®¾ç½®å¤šæ¥æ”¶æ–¹åŠ å¯†CID
        app.private_multi_cid = private_multi_cid
            .try_into()
            .map_err(|_| Error::<T>::CidTooLong)?;
        
        // è®¾ç½®æˆæƒæ¥æ”¶æ–¹åˆ—è¡¨
        app.authorized_recipients = authorized_recipients
            .try_into()
            .map_err(|_| Error::<T>::TooManyRecipients)?;
        
        // ... å…¶ä»–é€»è¾‘ ...
        
        Ok(())
    })?;
    
    Ok(())
}

/// ğŸ†• è¾…åŠ©å‡½æ•°ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºå§”å‘˜ä¼šæˆå‘˜
fn is_committee_member(account: &T::AccountId) -> bool {
    // æ£€æŸ¥æ˜¯å¦åœ¨ ContentCommittee (Instance3) ä¸­
    pallet_collective::Members::<T, pallet_collective::Instance3>::get()
        .contains(account)
}
```

---

#### 4.4.2 æ–°å¢é”™è¯¯ç±»å‹

```rust
#[pallet::error]
pub enum Error<T> {
    // ... ç°æœ‰é”™è¯¯ ...
    
    /// ğŸ†• æˆæƒæ¥æ”¶æ–¹åˆ—è¡¨ä¸ºç©º
    EmptyRecipients,
    
    /// ğŸ†• æˆæƒæ¥æ”¶æ–¹æ•°é‡è¶…è¿‡ä¸Šé™
    TooManyRecipients,
    
    /// ğŸ†• è´¦æˆ·ä¸æ˜¯å§”å‘˜ä¼šæˆå‘˜
    NotCommitteeMember,
}
```

---

### 4.5 å§”å‘˜ä¼šæˆå‘˜å˜æ›´å¤„ç†

#### é—®é¢˜åœºæ™¯

- **æ–°å¢å§”å‘˜ä¼šæˆå‘˜**ï¼šæ–°æˆå‘˜æ— æ³•è§£å¯†å†å²èµ„æ–™
- **ç§»é™¤å§”å‘˜ä¼šæˆå‘˜**ï¼šå·²ç¦»èŒæˆå‘˜ä»å¯è§£å¯†å†å²èµ„æ–™

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆAï¼šé‡æ–°åŠ å¯†ï¼ˆå®‰å…¨ä½†æˆæœ¬é«˜ï¼‰**

```typescript
/**
 * å§”å‘˜ä¼šæˆå‘˜å˜æ›´åï¼Œé‡æ–°åŠ å¯†æ‰€æœ‰å†å²èµ„æ–™
 */
async function reencryptApplicationsForNewCommittee(
  newCommitteeMembers: string[]
) {
  // 1. è·å–æ‰€æœ‰å¾…å®¡æ ¸å’Œå·²æ‰¹å‡†çš„ç”³è¯·
  const applications = await api.query.marketMaker.applications.entries();
  
  for (const [key, app] of applications) {
    const mmId = key.args[0].toNumber();
    const privateCid = app.private_multi_cid.toString();
    
    // 2. ä»»æ„ç°æœ‰å§”å‘˜è§£å¯†
    const decryptedData = await decryptByCertainCommitteeMember(privateCid);
    
    // 3. è·å–æ–°å§”å‘˜ä¼šæˆå‘˜å…¬é’¥
    const newPublicKeys = await getPublicKeysForAccounts(newCommitteeMembers);
    
    // 4. é‡æ–°åŠ å¯†ç»™æ–°å§”å‘˜ä¼š
    const reencryptedData = await MultiRecipientEncryption.encrypt(
      decryptedData,
      newPublicKeys
    );
    
    // 5. ä¸Šä¼ åˆ°IPFS
    const newCid = await uploadToIPFS(reencryptedData);
    
    // 6. æ›´æ–°é“¾ä¸Šè®°å½•
    await api.tx.sudo.sudo(
      api.tx.marketMaker.updatePrivateCid(mmId, newCid, newCommitteeMembers)
    ).signAndSend(sudoAccount);
  }
  
  console.log('âœ… æ‰€æœ‰èµ„æ–™å·²é‡æ–°åŠ å¯†ç»™æ–°å§”å‘˜ä¼š');
}
```

**æ–¹æ¡ˆBï¼šåˆ†å±‚æˆæƒï¼ˆæ¨èï¼‰**

```typescript
// ä¸ºæ•æ„Ÿç¨‹åº¦ä¸åŒçš„èµ„æ–™è®¾ç½®ä¸åŒçš„è§£å¯†è¦æ±‚

interface LayeredEncryption {
  // åŸºç¡€ä¿¡æ¯ï¼šæ‰€æœ‰å§”å‘˜ä¼šæˆå‘˜å¯è§£å¯†
  basic_info_cid: string;
  basic_recipients: string[];
  
  // æ•æ„Ÿä¿¡æ¯ï¼šéœ€è¦2/3å§”å‘˜ä¼šæˆå‘˜å…±è¯†ï¼ˆé—¨é™åŠ å¯†ï¼‰
  sensitive_info_cid: string;
  threshold: number; // å¦‚ 3
  total_shares: number; // å¦‚ 5
  
  // æ ¸å¿ƒæœºå¯†ï¼šéœ€è¦Root + å§”å‘˜ä¼šä¸»å¸­å…±åŒè§£å¯†
  critical_info_cid: string;
  required_signers: string[]; // ["Root", "Chairman"]
}
```

---

## äº”ã€èŠå¤©è®°å½•å®¡æ ¸æ‰©å±•

### 5.1 åœºæ™¯è¯´æ˜

**OTC è®¢å•äº‰è®®ä»²è£**ï¼š
- ä¹°å®¶æäº¤ä¸åšå¸‚å•†çš„èŠå¤©è®°å½•ä½œä¸ºè¯æ®
- èŠå¤©è®°å½•åŸæœ¬æ˜¯ç«¯åˆ°ç«¯åŠ å¯†çš„ï¼ˆåªæœ‰ä¹°å®¶å’Œåšå¸‚å•†å¯è§ï¼‰
- å§”å‘˜ä¼šéœ€è¦æŸ¥çœ‹èŠå¤©è®°å½•è¿›è¡Œä»²è£

### 5.2 å®ç°æ–¹æ¡ˆ

#### æ–¹æ¡ˆï¼šè¯æ®æäº¤æ—¶é‡æ–°åŠ å¯†

```typescript
/**
 * ä¹°å®¶æäº¤èŠå¤©è®°å½•ä½œä¸ºäº‰è®®è¯æ®
 */
async function submitChatEvidenceForDispute(
  orderId: number,
  messageIds: number[]
) {
  // 1. è·å–èŠå¤©è®°å½•
  const messages = [];
  for (const msgId of messageIds) {
    const meta = await api.query.chat.messages(msgId);
    const cid = meta.content_cid.toString();
    
    // 2. ä¹°å®¶ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†
    const decryptedContent = await decryptMessage(cid, myPrivateKey);
    messages.push({
      id: msgId,
      sender: meta.sender.toString(),
      receiver: meta.receiver.toString(),
      content: decryptedContent,
      timestamp: meta.sent_at.toNumber(),
    });
  }
  
  // 3. è·å–å§”å‘˜ä¼šæˆå‘˜å…¬é’¥
  const committeePublicKeys = await getCommitteePublicKeys();
  
  // 4. é‡æ–°åŠ å¯†ç»™å§”å‘˜ä¼šæˆå‘˜
  const evidence = {
    order_id: orderId,
    messages: messages,
    submitted_by: currentAccount.address,
    submitted_at: Date.now(),
  };
  
  const encryptedEvidence = await MultiRecipientEncryption.encrypt(
    evidence,
    committeePublicKeys
  );
  
  // 5. ä¸Šä¼ åˆ°IPFS
  const evidenceCid = await uploadToIPFS(encryptedEvidence);
  
  // 6. æäº¤åˆ°ä»²è£æ¨¡å—
  await api.tx.arbitration.submitEvidence(
    orderId,
    evidenceCid
  ).signAndSend(currentAccount);
  
  console.log('âœ… èŠå¤©è®°å½•è¯æ®å·²æäº¤ï¼Œå§”å‘˜ä¼šå¯æŸ¥çœ‹');
}
```

---

## å…­ã€å®‰å…¨æ³¨æ„äº‹é¡¹

### 6.1 å¯†é’¥ç®¡ç†

âš ï¸ **ç§é’¥ä¿æŠ¤**
- ç§é’¥å§‹ç»ˆä¿å­˜åœ¨ç”¨æˆ·æœ¬åœ°ï¼ˆæµè§ˆå™¨æˆ–é’±åŒ…ï¼‰
- è§£å¯†æ—¶éœ€è¦ç”¨æˆ·æˆæƒï¼ˆç­¾åç¡®è®¤ï¼‰
- ä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­ç¡¬ç¼–ç ä»»ä½•å¯†é’¥

âš ï¸ **å…¬é’¥è·å–**
- å§”å‘˜ä¼šæˆå‘˜å…¬é’¥åº”ä»é“¾ä¸Šå¯ä¿¡æ¥æºè·å–
- å¯ä»¥ä½¿ç”¨ `pallet-identity` å­˜å‚¨å…¬é’¥
- æˆ–è€…ç›´æ¥ä»è´¦æˆ·åœ°å€æ´¾ç”Ÿï¼ˆPolkadoté»˜è®¤ï¼‰

### 6.2 è®¿é—®å®¡è®¡

```rust
/// ğŸ†• è®°å½•æ•æ„Ÿä¿¡æ¯è®¿é—®æ—¥å¿—
#[pallet::storage]
pub type AccessLog<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    u64, // mm_id
    BoundedVec<AccessRecord<T::AccountId, BlockNumberFor<T>>, ConstU32<100>>,
    ValueQuery,
>;

#[derive(Encode, Decode, TypeInfo, MaxEncodedLen)]
pub struct AccessRecord<AccountId, BlockNumber> {
    pub accessor: AccountId,
    pub accessed_at: BlockNumber,
    pub purpose: BoundedVec<u8, ConstU32<256>>, // "review", "audit", etc.
}

/// å§”å‘˜ä¼šæˆå‘˜æŸ¥çœ‹æ•æ„Ÿä¿¡æ¯å‰ï¼Œé“¾ä¸Šè®°å½•
#[pallet::call_index(10)]
pub fn log_private_access(
    origin: OriginFor<T>,
    mm_id: u64,
    purpose: Vec<u8>,
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    // éªŒè¯æ˜¯å§”å‘˜ä¼šæˆå‘˜
    ensure!(Self::is_committee_member(&who), Error::<T>::NotCommitteeMember);
    
    // è®°å½•è®¿é—®
    let now = <frame_system::Pallet<T>>::block_number();
    AccessLog::<T>::try_mutate(mm_id, |log| -> DispatchResult {
        log.try_push(AccessRecord {
            accessor: who.clone(),
            accessed_at: now,
            purpose: purpose.try_into().map_err(|_| Error::<T>::PurposeTooLong)?,
        })
        .map_err(|_| Error::<T>::TooManyAccessRecords)?;
        Ok(())
    })?;
    
    Self::deposit_event(Event::PrivateInfoAccessed { mm_id, accessor: who });
    Ok(())
}
```

### 6.3 æ€§èƒ½ä¼˜åŒ–

- **æ‰¹é‡åŠ å¯†**ï¼šä¸€æ¬¡æ€§ä¸ºæ‰€æœ‰å§”å‘˜ä¼šæˆå‘˜åŠ å¯†ï¼Œé¿å…å¤šæ¬¡è°ƒç”¨
- **CIDç¼“å­˜**ï¼šå‰ç«¯ç¼“å­˜å·²ä¸‹è½½çš„IPFSå†…å®¹
- **æ‡’åŠ è½½**ï¼šåªåœ¨ç”¨æˆ·ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"æ—¶æ‰è§£å¯†

---

## ä¸ƒã€è¿ç§»è·¯å¾„

### é˜¶æ®µ1ï¼šåç«¯å‡†å¤‡ï¼ˆ1å‘¨ï¼‰

- [ ] ä¿®æ”¹ `pallet-market-maker` æ•°æ®ç»“æ„
- [ ] æ·»åŠ å¤šæ¥æ”¶æ–¹æ”¯æŒ
- [ ] å®ç°è®¿é—®å®¡è®¡åŠŸèƒ½
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•

### é˜¶æ®µ2ï¼šå‰ç«¯å¼€å‘ï¼ˆ2å‘¨ï¼‰

- [ ] å®ç° `MultiRecipientEncryption` å·¥å…·ç±»
- [ ] ä¿®æ”¹åšå¸‚å•†ç”³è¯·è¡¨å•ï¼ˆåŠ å¯†é€»è¾‘ï¼‰
- [ ] å¼€å‘å§”å‘˜ä¼šå®¡æ ¸é¡µé¢ï¼ˆè§£å¯†é€»è¾‘ï¼‰
- [ ] æµ‹è¯•åŠ å¯†/è§£å¯†æµç¨‹

### é˜¶æ®µ3ï¼šæµ‹è¯•ä¸éƒ¨ç½²ï¼ˆ1å‘¨ï¼‰

- [ ] æµ‹è¯•ç½‘éƒ¨ç½²
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆæäº¤ç”³è¯· â†’ å®¡æ ¸ â†’ æ‰¹å‡†ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆ100ä¸ªå§”å‘˜ä¼šæˆå‘˜ï¼‰
- [ ] å®‰å…¨å®¡è®¡

### é˜¶æ®µ4ï¼šä¸»ç½‘ä¸Šçº¿ï¼ˆ1å‘¨ï¼‰

- [ ] ä¸»ç½‘éƒ¨ç½²
- [ ] å§”å‘˜ä¼šæˆå‘˜åŸ¹è®­
- [ ] ç›‘æ§è¿è¡ŒçŠ¶æ€
- [ ] æ”¶é›†åé¦ˆä¼˜åŒ–

---

## å…«ã€æ€»ç»“

### æ¨èæ–¹æ¡ˆ

âœ… **æ–¹æ¡ˆBï¼šæ··åˆåŠ å¯†ï¼ˆAES-256 + X25519ï¼‰**

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
1. âœ… å®‰å…¨æ€§é«˜ï¼šç»“åˆå¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†
2. âœ… æ€§èƒ½å¥½ï¼šå¤§å†…å®¹åªéœ€åŠ å¯†ä¸€æ¬¡
3. âœ… å¯æ‰©å±•ï¼šæ–°å¢å§”å‘˜ä¼šæˆå‘˜åªéœ€åŠ å¯†å¯†é’¥
4. âœ… å…¼å®¹æ€§å¥½ï¼šä½¿ç”¨ Polkadot æ ‡å‡†åŠ å¯†æ›²çº¿
5. âœ… å®ç°æˆç†Ÿï¼šæœ‰ç°æˆçš„åº“æ”¯æŒ

### å…³é”®è¦ç‚¹

1. **éšç§ä¿æŠ¤**ï¼šæ•æ„Ÿä¿¡æ¯åªæœ‰æˆæƒå§”å‘˜ä¼šæˆå‘˜å¯è§£å¯†
2. **çµæ´»æˆæƒ**ï¼šæ”¯æŒåŠ¨æ€æˆæƒåˆ—è¡¨
3. **è®¿é—®å®¡è®¡**ï¼šé“¾ä¸Šè®°å½•æ‰€æœ‰è®¿é—®è¡Œä¸º
4. **å‰ç«¯å‹å¥½**ï¼šæä¾›å®Œæ•´çš„å·¥å…·ç±»å’Œç¤ºä¾‹ä»£ç 

### åç»­æ‰©å±•

- **é—¨é™åŠ å¯†**ï¼šæé«˜å®‰å…¨è¦æ±‚çš„åœºæ™¯
- **é›¶çŸ¥è¯†è¯æ˜**ï¼šéªŒè¯ä¿¡æ¯æœ‰æ•ˆæ€§è€Œä¸æ³„éœ²å†…å®¹
- **é“¾ä¸‹ç´¢å¼•**ï¼šSubsquid ç´¢å¼•åŠ å¯†å…ƒæ•°æ®

---

**ç¼–å†™æ—¥æœŸ**ï¼š2025-10-23  
**ç‰ˆæœ¬**ï¼šv1.0  
**çŠ¶æ€**ï¼šå®æ–½æ–¹æ¡ˆ

