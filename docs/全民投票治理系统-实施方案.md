# å…¨æ°‘æŠ•ç¥¨æ²»ç†ç³»ç»Ÿ - å®æ–½æ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›**å…¨æ°‘æŠ•ç¥¨æ²»ç†ç³»ç»Ÿ**çš„å®Œæ•´å®æ–½æ–¹æ¡ˆï¼Œå®ç°å³æ—¶åˆ†æˆæ¯”ä¾‹ï¼ˆInstantLevelPercentsï¼‰çš„å”¯ä¸€ä¿®æ”¹é€šé“ã€‚

**æ ¸å¿ƒè¦æ±‚**ï¼š
- âœ… InstantLevelPercents **åªèƒ½é€šè¿‡å…¨æ°‘æŠ•ç¥¨**ä¿®æ”¹
- âœ… ç§»é™¤æ‰€æœ‰å…¶ä»–ä¿®æ”¹é€”å¾„ï¼ˆåŒ…æ‹¬ç®¡ç†å‘˜æ¥å£ï¼‰
- âœ… å®Œæ•´çš„ææ¡ˆã€æŠ•ç¥¨ã€æ‰§è¡Œæµç¨‹
- âœ… å®‰å…¨çš„æ²»ç†æœºåˆ¶

---

## ğŸ¯ å®æ–½çŠ¶æ€

### âœ… å·²å®Œæˆ

1. **è®¾è®¡æ–‡æ¡£**ï¼š`docs/å³æ—¶åˆ†æˆæ¯”ä¾‹å…¨æ°‘æŠ•ç¥¨æ²»ç†æ–¹æ¡ˆ.md`
2. **æ¥å£æ–‡æ¡£**ï¼š`palletsæ¥å£æ–‡æ¡£.md` ç¬¬18ç« 
3. **æ²»ç†æ•°æ®ç»“æ„**ï¼š`pallets/affiliate/src/governance.rs`

### ğŸš§ è¿›è¡Œä¸­

4. **é“¾ç«¯å®ç°**ï¼šæ·»åŠ  extrinsic å’Œ storage

### ğŸ“… å¾…å®Œæˆ

5. **Runtime é›†æˆ**
6. **å‰ç«¯å¼€å‘**
7. **æµ‹è¯•å’Œæ–‡æ¡£**

---

## ğŸ“¦ Phase 1: é“¾ç«¯å®ç°ï¼ˆæœ¬é˜¶æ®µï¼‰

### 1.1 æ·»åŠ æ¨¡å—å¯¼å…¥

**æ–‡ä»¶**: `pallets/affiliate/src/lib.rs`

åœ¨é¡¶éƒ¨æ·»åŠ æ²»ç†æ¨¡å—ï¼š

```rust
// åœ¨ç¬¬49è¡Œåæ·»åŠ 
mod governance;
pub use governance::*;
```

### 1.2 æ·»åŠ å­˜å‚¨é¡¹

**æ–‡ä»¶**: `pallets/affiliate/src/lib.rs`

åœ¨å­˜å‚¨åŒºåŸŸï¼ˆçº¦200è¡Œåï¼‰æ·»åŠ ï¼š

```rust
// === æ²»ç†å­˜å‚¨ï¼ˆ12ä¸ªï¼‰===

/// ä¸‹ä¸€ä¸ªææ¡ˆID
#[pallet::storage]
pub type NextProposalId<T: Config> = StorageValue<_, u64, ValueQuery>;

/// æ´»è·ƒææ¡ˆ
#[pallet::storage]
pub type ActiveProposals<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    u64,
    governance::PercentageAdjustmentProposal<T>,
>;

/// ææ¡ˆæŠ¼é‡‘
#[pallet::storage]
pub type ProposalDeposits<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    u64,
    (T::AccountId, BalanceOf<T>),
>;

/// æŠ•ç¥¨è®°å½•
#[pallet::storage]
pub type ProposalVotes<T: Config> = StorageDoubleMap<
    _,
    Blake2_128Concat,
    u64,
    Blake2_128Concat,
    T::AccountId,
    governance::VoteRecord<T>,
>;

/// æŠ•ç¥¨ç»Ÿè®¡
#[pallet::storage]
pub type VoteTally<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    u64,
    governance::VoteTally,
    ValueQuery,
>;

/// æŠ•ç¥¨å†å²ï¼ˆç”¨äºå‚ä¸æƒé‡è®¡ç®—ï¼‰
#[pallet::storage]
pub type VoteHistory<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::AccountId,
    BoundedVec<u64, ConstU32<100>>,
    ValueQuery,
>;

/// æ¯”ä¾‹å˜æ›´å†å²
#[pallet::storage]
pub type PercentageHistory<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    u64,
    governance::PercentageChangeRecord<T>,
>;

/// æ²»ç†æš‚åœæ ‡è®°
#[pallet::storage]
pub type GovernancePaused<T: Config> = StorageValue<_, bool, ValueQuery>;

/// æš‚åœåŸå› 
#[pallet::storage]
pub type PauseReason<T: Config> = StorageValue<_, BoundedVec<u8, ConstU32<64>>>;

/// è´¦æˆ·å†·å´æœŸï¼ˆææ¡ˆå¤±è´¥åï¼‰
#[pallet::storage]
pub type ProposalCooldown<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::AccountId,
    BlockNumberFor<T>,
>;

/// è´¦æˆ·æ´»è·ƒææ¡ˆæ•°
#[pallet::storage]
pub type ActiveProposalsByAccount<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::AccountId,
    BoundedVec<u64, ConstU32<3>>,
    ValueQuery,
>;

/// è´¦æˆ·æœ€åææ¡ˆåŒºå—
#[pallet::storage]
pub type LastProposalBlock<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::AccountId,
    BlockNumberFor<T>,
>;

/// å¾…æ‰§è¡Œææ¡ˆ
#[pallet::storage]
pub type ReadyForExecution<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    u64,
    governance::PercentageAdjustmentProposal<T>,
>;
```

### 1.3 æ·»åŠ äº‹ä»¶

**æ–‡ä»¶**: `pallets/affiliate/src/lib.rs`

åœ¨ Event æšä¸¾ä¸­æ·»åŠ ï¼ˆçº¦260è¡Œï¼‰ï¼š

```rust
// === æ²»ç†äº‹ä»¶ ===

/// ææ¡ˆå·²åˆ›å»º
PercentageAdjustmentProposed {
    proposal_id: u64,
    proposer: T::AccountId,
    change_magnitude: u32,
    is_major: bool,
},

/// æŠ•ç¥¨å·²æäº¤
VoteCast {
    proposal_id: u64,
    voter: T::AccountId,
    vote: governance::Vote,
    weight: u128,
},

/// ææ¡ˆå·²é€šè¿‡
ProposalPassed {
    proposal_id: u64,
    approval_rate: Perbill,
    participation_rate: Perbill,
    effective_block: BlockNumberFor<T>,
},

/// ææ¡ˆå·²æ‹’ç»
ProposalRejected {
    proposal_id: u64,
    approval_rate: Perbill,
    participation_rate: Perbill,
},

/// ææ¡ˆå·²å–æ¶ˆ
ProposalCancelled {
    proposal_id: u64,
    proposer: T::AccountId,
},

/// æ¯”ä¾‹è°ƒæ•´å·²æ‰§è¡Œ
PercentageAdjustmentExecuted {
    proposal_id: u64,
    new_percentages: types::LevelPercents,
    effective_block: BlockNumberFor<T>,
},

/// æ²»ç†ç´§æ€¥æš‚åœ
GovernanceEmergencyPaused {
    reason_cid: BoundedVec<u8, ConstU32<64>>,
},

/// æ²»ç†å·²æ¢å¤
GovernanceResumed {
    by: BoundedVec<u8, ConstU32<32>>,
},
```

### 1.4 æ·»åŠ é”™è¯¯ç 

**æ–‡ä»¶**: `pallets/affiliate/src/lib.rs`

åœ¨ Error æšä¸¾ä¸­æ·»åŠ ï¼š

```rust
// === æ²»ç†é”™è¯¯ ===

/// æ¯”ä¾‹æ•°ç»„é•¿åº¦å¿…é¡»ä¸º15
InvalidPercentageLength,

/// å•å±‚æ¯”ä¾‹è¶…è¿‡100%
PercentageTooHigh,

/// å‰3å±‚æ¯”ä¾‹ä¸èƒ½ä¸º0
CriticalLayerZero,

/// æ€»æ¯”ä¾‹ä½äº50%
TotalPercentageTooLow,

/// æ€»æ¯”ä¾‹è¶…è¿‡99%
TotalPercentageTooHigh,

/// å‰5å±‚æ¯”ä¾‹åº”é€’å‡
NonDecreasingPercentage,

/// L1æ¯”ä¾‹è¶…è¿‡50%
FirstLayerTooHigh,

/// ææ¡ˆæŠ¼é‡‘ä¸è¶³
InsufficientBalance,

/// ææ¡ˆä¸å­˜åœ¨
ProposalNotFound,

/// æŠ•ç¥¨æœŸæœªå¼€å§‹æˆ–å·²ç»“æŸ
VotingNotActive,

/// å·²ç»æŠ•è¿‡ç¥¨
AlreadyVoted,

/// ä¸æ˜¯ææ¡ˆå‘èµ·äºº
NotProposer,

/// æŠ•ç¥¨å¼€å§‹åä¸èƒ½å–æ¶ˆ
CannotCancelAfterVoting,

/// æ´»è·ƒææ¡ˆè¿‡å¤š
TooManyActiveProposals,

/// ææ¡ˆé—´éš”è¿‡çŸ­
ProposalTooFrequent,

/// å†·å´æœŸå†…ä¸èƒ½ææ¡ˆ
InCooldownPeriod,

/// æ²»ç†åŠŸèƒ½å·²æš‚åœ
GovernancePaused,

/// æƒé™ä¸è¶³
InsufficientAuthority,
```

### 1.5 æ·»åŠ  Extrinsic å‡½æ•°

**æ–‡ä»¶**: `pallets/affiliate/src/lib.rs`

åœ¨ `#[pallet::call]` impl å—ä¸­æ·»åŠ ï¼š

```rust
/// å‘èµ·åˆ†æˆæ¯”ä¾‹è°ƒæ•´ææ¡ˆ
///
/// æƒé™è¦æ±‚ï¼ˆæ»¡è¶³å…¶ä¸€ï¼‰:
/// - æŒå¸é‡ â‰¥ 10,000 DUSTï¼ˆå¤§æˆ·ææ¡ˆï¼‰
/// - â‰¥ 1000 äººè”ç½²ï¼ˆè”ç½²ææ¡ˆï¼‰
/// - æŠ€æœ¯å§”å‘˜ä¼šæˆå‘˜æè®®ï¼ˆå§”å‘˜ä¼šææ¡ˆï¼‰
///
/// å‚æ•°:
/// - `new_percentages`: æ–°çš„15å±‚åˆ†æˆæ¯”ä¾‹
/// - `title_cid`: ææ¡ˆæ ‡é¢˜ IPFS CID
/// - `description_cid`: ææ¡ˆè¯¦æƒ… IPFS CID
/// - `rationale_cid`: ææ¡ˆç†ç”± IPFS CID
#[pallet::call_index(50)]
#[pallet::weight(Weight::from_parts(10_000_000, 0))]
pub fn propose_percentage_adjustment(
    origin: OriginFor<T>,
    new_percentages: types::LevelPercents,
    title_cid: BoundedVec<u8, ConstU32<64>>,
    description_cid: BoundedVec<u8, ConstU32<64>>,
    rationale_cid: BoundedVec<u8, ConstU32<64>>,
) -> DispatchResult {
    let who = ensure_signed(origin)?;

    // æ£€æŸ¥æ²»ç†æ˜¯å¦æš‚åœ
    ensure!(
        !GovernancePaused::<T>::get(),
        Error::<T>::GovernancePaused
    );

    // éªŒè¯æ–°æ¯”ä¾‹æœ‰æ•ˆæ€§
    Self::validate_percentages(&new_percentages)?;

    // æ£€æŸ¥ååƒåœ¾ææ¡ˆé™åˆ¶
    Self::check_proposal_spam(&who)?;

    // éªŒè¯ææ¡ˆæƒé™ï¼ˆTODO: å®ç°å®Œæ•´çš„æƒé™æ£€æŸ¥ï¼‰
    // Self::ensure_proposal_authority(&who)?;

    // è®¡ç®—å˜åŒ–å¹…åº¦
    let current_percentages = InstantLevelPercents::<T>::get();
    let change_magnitude =
        Self::calculate_change_magnitude(&current_percentages, &new_percentages);

    // åˆ¤æ–­ææ¡ˆç±»å‹
    let is_major = change_magnitude > Self::minor_change_threshold();

    // è®¡ç®—æŠ¼é‡‘
    let deposit_amount = if is_major {
        10000u128.saturated_into() // 10000 DUST
    } else {
        1000u128.saturated_into() // 1000 DUST
    };

    // ç¼´çº³æŠ¼é‡‘
    T::Currency::reserve(&who, deposit_amount)?;

    // åˆ›å»ºææ¡ˆ
    let proposal_id = NextProposalId::<T>::get();
    let current_block = <frame_system::Pallet<T>>::block_number();

    let proposal = governance::PercentageAdjustmentProposal {
        proposal_id,
        proposer: who.clone(),
        title_cid,
        description_cid,
        new_percentages: new_percentages.clone(),
        effective_block: current_block + 43200u32.into(), // 3å¤©åç”Ÿæ•ˆ
        rationale_cid,
        impact_analysis_cid: None,
        status: governance::ProposalStatus::Discussion,
        is_major,
        created_at: current_block,
        voting_start: None,
        voting_end: None,
    };

    // å­˜å‚¨ææ¡ˆ
    ActiveProposals::<T>::insert(proposal_id, &proposal);
    ProposalDeposits::<T>::insert(proposal_id, (&who, deposit_amount));

    // æ›´æ–°è´¦æˆ·ææ¡ˆç»Ÿè®¡
    ActiveProposalsByAccount::<T>::try_mutate(&who, |proposals| -> DispatchResult {
        proposals
            .try_push(proposal_id)
            .map_err(|_| Error::<T>::TooManyActiveProposals)?;
        Ok(())
    })?;

    LastProposalBlock::<T>::insert(&who, current_block);
    NextProposalId::<T>::set(proposal_id + 1);

    // å‘å°„äº‹ä»¶
    Self::deposit_event(Event::PercentageAdjustmentProposed {
        proposal_id,
        proposer: who,
        change_magnitude,
        is_major,
    });

    Ok(())
}

/// å¯¹åˆ†æˆæ¯”ä¾‹ææ¡ˆæŠ•ç¥¨
///
/// å‚æ•°:
/// - `proposal_id`: ææ¡ˆID
/// - `vote`: æŠ•ç¥¨é€‰é¡¹ï¼ˆAye/Nay/Abstainï¼‰
/// - `conviction`: ä¿¡å¿µæŠ•ç¥¨ï¼ˆé”å®šæ—¶é•¿æ¢å–æƒé‡å€æ•°ï¼‰
#[pallet::call_index(51)]
#[pallet::weight(Weight::from_parts(5_000_000, 0))]
pub fn vote_on_percentage_proposal(
    origin: OriginFor<T>,
    proposal_id: u64,
    vote: governance::Vote,
    conviction: governance::Conviction,
) -> DispatchResult {
    let who = ensure_signed(origin)?;

    // æ£€æŸ¥æ²»ç†æ˜¯å¦æš‚åœ
    ensure!(
        !GovernancePaused::<T>::get(),
        Error::<T>::GovernancePaused
    );

    // éªŒè¯ææ¡ˆå­˜åœ¨ä¸”åœ¨æŠ•ç¥¨æœŸ
    let proposal = ActiveProposals::<T>::get(proposal_id)
        .ok_or(Error::<T>::ProposalNotFound)?;

    ensure!(
        proposal.status == governance::ProposalStatus::Voting,
        Error::<T>::VotingNotActive
    );

    // æ£€æŸ¥æ˜¯å¦å·²æŠ•ç¥¨
    ensure!(
        !ProposalVotes::<T>::contains_key(proposal_id, &who),
        Error::<T>::AlreadyVoted
    );

    // è®¡ç®—æŠ•ç¥¨æƒé‡
    let base_weight = Self::calculate_total_voting_power(&who);
    let conviction_multiplier = conviction.multiplier();
    let final_weight = base_weight
        .saturating_mul(conviction_multiplier)
        .saturating_div(10); // é™¤ä»¥10å› ä¸ºmultiplieræ˜¯10å€

    // TODO: é”å®šæŠ•ç¥¨èµ„é‡‘ï¼ˆå¦‚æœæœ‰ä¿¡å¿µæŠ•ç¥¨ï¼‰
    // if conviction != governance::Conviction::None {
    //     let lock_amount = Self::calculate_lock_amount(&who, &conviction);
    //     T::Currency::set_lock(...);
    // }

    // è®°å½•æŠ•ç¥¨
    let vote_record = governance::VoteRecord {
        voter: who.clone(),
        vote: vote.clone(),
        conviction,
        weight: final_weight,
        timestamp: <frame_system::Pallet<T>>::block_number(),
    };

    ProposalVotes::<T>::insert(proposal_id, &who, &vote_record);

    // æ›´æ–°ç»Ÿè®¡
    VoteTally::<T>::mutate(proposal_id, |tally| {
        match vote {
            governance::Vote::Aye => {
                tally.aye_votes = tally.aye_votes.saturating_add(final_weight);
            }
            governance::Vote::Nay => {
                tally.nay_votes = tally.nay_votes.saturating_add(final_weight);
            }
            governance::Vote::Abstain => {
                tally.abstain_votes = tally.abstain_votes.saturating_add(final_weight);
            }
        }
        tally.total_turnout = tally.total_turnout.saturating_add(final_weight);
    });

    // æ›´æ–°æŠ•ç¥¨å†å²
    VoteHistory::<T>::try_mutate(&who, |history| -> DispatchResult {
        history
            .try_push(proposal_id)
            .map_err(|_| Error::<T>::TooManyActiveProposals)?;
        Ok(())
    })?;

    // å‘å°„äº‹ä»¶
    Self::deposit_event(Event::VoteCast {
        proposal_id,
        voter: who,
        vote,
        weight: final_weight,
    });

    Ok(())
}

/// å–æ¶ˆææ¡ˆï¼ˆä»…ææ¡ˆå‘èµ·äººå¯è°ƒç”¨ï¼‰
#[pallet::call_index(52)]
#[pallet::weight(Weight::from_parts(3_000_000, 0))]
pub fn cancel_proposal(origin: OriginFor<T>, proposal_id: u64) -> DispatchResult {
    let who = ensure_signed(origin)?;

    let proposal = ActiveProposals::<T>::get(proposal_id)
        .ok_or(Error::<T>::ProposalNotFound)?;

    // æ£€æŸ¥æƒé™
    ensure!(proposal.proposer == who, Error::<T>::NotProposer);

    // åªèƒ½åœ¨æŠ•ç¥¨å‰å–æ¶ˆ
    ensure!(
        proposal.status == governance::ProposalStatus::Discussion,
        Error::<T>::CannotCancelAfterVoting
    );

    // é€€è¿˜æŠ¼é‡‘
    if let Some((_, deposit)) = ProposalDeposits::<T>::take(proposal_id) {
        T::Currency::unreserve(&who, deposit);
    }

    // ç§»é™¤ææ¡ˆ
    ActiveProposals::<T>::remove(proposal_id);

    // æ›´æ–°è´¦æˆ·ç»Ÿè®¡
    ActiveProposalsByAccount::<T>::mutate(&who, |proposals| {
        proposals.retain(|&id| id != proposal_id);
    });

    Self::deposit_event(Event::ProposalCancelled {
        proposal_id,
        proposer: who,
    });

    Ok(())
}

/// ç´§æ€¥æš‚åœæ²»ç†ï¼ˆä»…æŠ€æœ¯å§”å‘˜ä¼šè¶…çº§å¤šæ•°å¯è°ƒç”¨ï¼‰
#[pallet::call_index(60)]
#[pallet::weight(Weight::from_parts(2_000_000, 0))]
pub fn emergency_pause_governance(
    origin: OriginFor<T>,
    reason_cid: BoundedVec<u8, ConstU32<64>>,
) -> DispatchResult {
    // TODO: éªŒè¯æŠ€æœ¯å§”å‘˜ä¼šè¶…çº§å¤šæ•°ï¼ˆ5/7ï¼‰
    T::AdminOrigin::ensure_origin(origin)?;

    GovernancePaused::<T>::put(true);
    PauseReason::<T>::put(reason_cid.clone());

    Self::deposit_event(Event::GovernanceEmergencyPaused { reason_cid });

    Ok(())
}

/// æ¢å¤æ²»ç†æœºåˆ¶ï¼ˆä»… Root æˆ–å§”å‘˜ä¼šå…¨ç¥¨å¯è°ƒç”¨ï¼‰
#[pallet::call_index(61)]
#[pallet::weight(Weight::from_parts(2_000_000, 0))]
pub fn resume_governance(origin: OriginFor<T>) -> DispatchResult {
    // TODO: éªŒè¯ Root æˆ–å§”å‘˜ä¼šå…¨ç¥¨ï¼ˆ7/7ï¼‰
    T::AdminOrigin::ensure_origin(origin)?;

    GovernancePaused::<T>::kill();
    PauseReason::<T>::kill();

    Self::deposit_event(Event::GovernanceResumed {
        by: b"Admin".to_vec().try_into().unwrap(),
    });

    Ok(())
}
```

### 1.6 å®ç°è‡ªåŠ¨æ‰§è¡Œ Hook

**æ–‡ä»¶**: `pallets/affiliate/src/lib.rs`

åœ¨ `#[pallet::hooks]` impl å—ä¸­æ·»åŠ ï¼š

```rust
#[pallet::hooks]
impl<T: Config> Hooks<BlockNumberFor<T>> for Pallet<T> {
    fn on_finalize(block_number: BlockNumberFor<T>) {
        // æ£€æŸ¥æ˜¯å¦æœ‰éœ€è¦æ‰§è¡Œçš„ææ¡ˆ
        for (proposal_id, proposal) in ReadyForExecution::<T>::iter() {
            if proposal.effective_block <= block_number {
                if let Err(e) = Self::execute_percentage_change(&proposal_id, &proposal) {
                    log::error!(
                        "Failed to execute proposal {}: {:?}",
                        proposal_id,
                        e
                    );
                } else {
                    // æ‰§è¡ŒæˆåŠŸï¼Œæ¸…ç†çŠ¶æ€
                    ReadyForExecution::<T>::remove(&proposal_id);
                    Self::return_proposal_deposit(&proposal_id);

                    Self::deposit_event(Event::PercentageAdjustmentExecuted {
                        proposal_id,
                        new_percentages: proposal.new_percentages,
                        effective_block: block_number,
                    });
                }
            }
        }
    }
}
```

### 1.7 å®ç°è¾…åŠ©å‡½æ•°

**æ–‡ä»¶**: `pallets/affiliate/src/lib.rs`

åœ¨ `impl<T: Config> Pallet<T>` å—ä¸­æ·»åŠ ï¼š

```rust
/// æ‰§è¡Œæ¯”ä¾‹è°ƒæ•´
fn execute_percentage_change(
    proposal_id: &u64,
    proposal: &governance::PercentageAdjustmentProposal<T>,
) -> DispatchResult {
    // éªŒè¯æ–°æ¯”ä¾‹ä»ç„¶æœ‰æ•ˆ
    Self::validate_percentages(&proposal.new_percentages)?;

    // è·å–æ—§æ¯”ä¾‹
    let old_percentages = InstantLevelPercents::<T>::get();

    // âš ï¸ å”¯ä¸€ä¿®æ”¹é€šé“ï¼šé€šè¿‡æ²»ç†ææ¡ˆä¿®æ”¹
    InstantLevelPercents::<T>::set(&proposal.new_percentages);

    // è®°å½•å†å²
    let change_record = governance::PercentageChangeRecord {
        proposal_id: *proposal_id,
        old_percentages,
        new_percentages: proposal.new_percentages.clone(),
        executed_at: <frame_system::Pallet<T>>::block_number(),
        executed_by: b"Governance".to_vec().try_into().unwrap(),
    };

    PercentageHistory::<T>::insert(proposal_id, &change_record);

    Ok(())
}

/// é€€è¿˜ææ¡ˆæŠ¼é‡‘
fn return_proposal_deposit(proposal_id: &u64) {
    if let Some((account, deposit)) = ProposalDeposits::<T>::take(proposal_id) {
        T::Currency::unreserve(&account, deposit);
    }
}

/// æ£€æŸ¥ææ¡ˆé¢‘ç‡é™åˆ¶
fn check_proposal_spam(proposer: &T::AccountId) -> DispatchResult {
    // æ£€æŸ¥åŒæ—¶å‘èµ·çš„ææ¡ˆæ•°
    let active_proposals = ActiveProposalsByAccount::<T>::get(proposer);
    ensure!(
        active_proposals.len() <= 3,
        Error::<T>::TooManyActiveProposals
    );

    // æ£€æŸ¥æœ€è¿‘ææ¡ˆé—´éš”ï¼ˆ7å¤©ï¼‰
    if let Some(last_proposal_block) = LastProposalBlock::<T>::get(proposer) {
        let blocks_since =
            <frame_system::Pallet<T>>::block_number() - last_proposal_block;
        let min_interval = 100800u32.into(); // 7å¤©
        ensure!(
            blocks_since >= min_interval,
            Error::<T>::ProposalTooFrequent
        );
    }

    // æ£€æŸ¥å¤±è´¥å†·å´æœŸï¼ˆ30å¤©ï¼‰
    if let Some(cooldown_until) = ProposalCooldown::<T>::get(proposer) {
        ensure!(
            <frame_system::Pallet<T>>::block_number() > cooldown_until,
            Error::<T>::InCooldownPeriod
        );
    }

    Ok(())
}
```

### 1.8 ç§»é™¤æ—§çš„ç®¡ç†å‘˜ä¿®æ”¹æ¥å£

**å…³é”®æ­¥éª¤**ï¼šåˆ é™¤æˆ–æ³¨é‡Šæ‰æ‰€æœ‰éæ²»ç†é€”å¾„çš„ä¿®æ”¹æ¥å£ã€‚

**æ–‡ä»¶**: `pallets/affiliate/src/lib.rs`

æ‰¾åˆ°å¹¶åˆ é™¤/æ³¨é‡Šç±»ä¼¼ä»¥ä¸‹çš„å‡½æ•°ï¼š

```rust
// âŒ åˆ é™¤ï¼šç®¡ç†å‘˜ç›´æ¥ä¿®æ”¹æ¯”ä¾‹
// pub fn set_instant_percents(
//     origin: OriginFor<T>,
//     new_percentages: types::LevelPercents,
// ) -> DispatchResult {
//     T::AdminOrigin::ensure_origin(origin)?;
//     InstantLevelPercents::<T>::set(&new_percentages);
//     Ok(())
// }
```

**ç¡®ä¿**ï¼šæ•´ä¸ª pallet ä¸­ï¼Œåªæœ‰ `execute_percentage_change()` å‡½æ•°å¯ä»¥ä¿®æ”¹ `InstantLevelPercents`ã€‚

---

## ğŸ“¦ Phase 2: Runtime é›†æˆ

### 2.1 é…ç½® pallet-collectiveï¼ˆæŠ€æœ¯å§”å‘˜ä¼šï¼‰

**æ–‡ä»¶**: `runtime/src/configs/mod.rs`

```rust
// æŠ€æœ¯å§”å‘˜ä¼šé…ç½®
parameter_types! {
    pub const CouncilMotionDuration: BlockNumber = 7 * DAYS;
    pub const CouncilMaxProposals: u32 = 100;
    pub const CouncilMaxMembers: u32 = 7;
}

impl pallet_collective::Config<CouncilCollective> for Runtime {
    type RuntimeOrigin = RuntimeOrigin;
    type Proposal = RuntimeCall;
    type RuntimeEvent = RuntimeEvent;
    type MotionDuration = CouncilMotionDuration;
    type MaxProposals = CouncilMaxProposals;
    type MaxMembers = CouncilMaxMembers;
    type DefaultVote = pallet_collective::PrimeDefaultVote;
    type WeightInfo = ();
    type SetMembersOrigin = EnsureRoot<AccountId>;
    type MaxProposalWeight = MaxCollectivesProposalWeight;
}
```

### 2.2 é…ç½®æ²»ç†å‚æ•°

**æ–‡ä»¶**: `runtime/src/configs/mod.rs`

åœ¨ `pallet_affiliate::Config` ä¸­æ·»åŠ ï¼š

```rust
impl pallet_affiliate::Config for Runtime {
    // ç°æœ‰é…ç½®...

    // === æ–°å¢ï¼šæ²»ç†é…ç½® ===

    /// æ²»ç†èµ·æºï¼ˆæŠ€æœ¯å§”å‘˜ä¼š 2/3 å¤šæ•°ï¼‰
    type GovernanceOrigin = pallet_collective::EnsureProportionAtLeast<
        AccountId,
        CouncilCollective,
        2,
        3,
    >;

    /// ç´§æ€¥æš‚åœèµ·æºï¼ˆæŠ€æœ¯å§”å‘˜ä¼š 5/7 è¶…çº§å¤šæ•°ï¼‰
    type EmergencyOrigin = pallet_collective::EnsureProportionAtLeast<
        AccountId,
        CouncilCollective,
        5,
        7,
    >;

    /// æ—¶é—´å‚æ•°
    type DiscussionPeriod = ConstU32<100800>;   // 7å¤©
    type VotingPeriod = ConstU32<201600>;       // 14å¤©
    type EnactmentDelay = ConstU32<43200>;      // 3å¤©
    type EmergencyPeriod = ConstU32<14400>;     // 24å°æ—¶

    /// æŠ¼é‡‘å‚æ•°
    type MinorProposalDeposit = ConstU128<1000>;   // 1000 DUST
    type MajorProposalDeposit = ConstU128<10000>;  // 10000 DUST

    /// é˜ˆå€¼å‚æ•°
    type MinorChangeThreshold = ConstU32<10>;   // 10%å˜åŒ–
    type MinTurnout = Perbill::from_percent(15);  // æœ€ä½15%å‚ä¸ç‡
}
```

---

## ğŸ“± Phase 3: å‰ç«¯å¼€å‘

### 3.1 æ²»ç†ä»ªè¡¨æ¿

**æ–‡ä»¶**: `stardust-dapp/src/features/governance/GovernanceDashboard.tsx`

```typescript
import React, { useState, useEffect } from 'react';
import { Card, Progress, Tag, Button, List, Space, Typography } from 'antd';
import { useApi } from '@/hooks/useApi';

const { Text, Title } = Typography;

export const GovernanceDashboard: React.FC = () => {
  const { api } = useApi();
  const [activeProposals, setActiveProposals] = useState([]);
  const [myVotingPower, setMyVotingPower] = useState(0);
  const [currentPercentages, setCurrentPercentages] = useState([]);

  useEffect(() => {
    loadData();
  }, [api]);

  const loadData = async () => {
    if (!api) return;

    // åŠ è½½æ´»è·ƒææ¡ˆ
    const proposals = await api.query.affiliate.activeProposals.entries();
    const formatted = await Promise.all(
      proposals.map(async ([key, proposal]) => {
        const id = key.args[0].toNumber();
        const tally = await api.query.affiliate.voteTally(id);
        return {
          id,
          ...proposal.toJSON(),
          tally: tally.toJSON(),
        };
      })
    );
    setActiveProposals(formatted);

    // æŸ¥è¯¢å½“å‰æ¯”ä¾‹
    const percentages = await api.query.affiliate.instantLevelPercents();
    setCurrentPercentages(percentages.toJSON());

    // æŸ¥è¯¢æˆ‘çš„æŠ•ç¥¨æƒé‡ï¼ˆTODO: éœ€è¦RPCæ¥å£ï¼‰
    // const power = await api.rpc.affiliate.calculateVotingPower(myAccount);
    // setMyVotingPower(power.toNumber());
  };

  return (
    <div className="governance-dashboard">
      <Title level={2}>æ²»ç†ä»ªè¡¨æ¿</Title>

      <Card title="å½“å‰åˆ†æˆæ¯”ä¾‹" style={{ marginBottom: 16 }}>
        <Space direction="vertical" style={{ width: '100%' }}>
          {currentPercentages.map((percent, index) => (
            <div key={index}>
              <Text>L{index + 1}: {percent}%</Text>
              <Progress percent={percent} size="small" />
            </div>
          ))}
        </Space>
      </Card>

      <Card title="æˆ‘çš„æŠ•ç¥¨æƒé‡" extra={<Tag color="blue">{myVotingPower}</Tag>}>
        <Space direction="vertical">
          <Text>æŒå¸æƒé‡: {Math.floor(myVotingPower * 0.7)}</Text>
          <Text>å‚ä¸æƒé‡: {Math.floor(myVotingPower * 0.2)}</Text>
          <Text>è´¡çŒ®æƒé‡: {Math.floor(myVotingPower * 0.1)}</Text>
        </Space>
      </Card>

      <Card
        title="æ´»è·ƒææ¡ˆ"
        extra={
          <Button type="primary" onClick={() => window.location.hash = '#/governance/create'}>
            å‘èµ·ææ¡ˆ
          </Button>
        }
      >
        <List
          dataSource={activeProposals}
          renderItem={(proposal) => (
            <List.Item
              actions={[
                <Button type="link" onClick={() => viewProposal(proposal.id)}>
                  æŸ¥çœ‹è¯¦æƒ…
                </Button>,
                <Button onClick={() => voteOnProposal(proposal.id)}>
                  æŠ•ç¥¨
                </Button>,
              ]}
            >
              <List.Item.Meta
                title={`ææ¡ˆ #${proposal.id}`}
                description={
                  <Space>
                    <Tag color={proposal.is_major ? 'red' : 'green'}>
                      {proposal.is_major ? 'é‡å¤§ææ¡ˆ' : 'å¾®è°ƒææ¡ˆ'}
                    </Tag>
                    <Text type="secondary">
                      å‘èµ·äºº: {proposal.proposer.substring(0, 8)}...
                    </Text>
                  </Space>
                }
              />
              <div>
                <Progress
                  percent={Math.floor(
                    (proposal.tally.aye_votes /
                      (proposal.tally.aye_votes + proposal.tally.nay_votes)) *
                      100
                  )}
                  status={proposal.tally.aye_votes > proposal.tally.nay_votes ? 'success' : 'normal'}
                />
                <Space>
                  <Tag color="green">æ”¯æŒ: {proposal.tally.aye_votes}</Tag>
                  <Tag color="red">åå¯¹: {proposal.tally.nay_votes}</Tag>
                  <Tag>å¼ƒæƒ: {proposal.tally.abstain_votes}</Tag>
                </Space>
              </div>
            </List.Item>
          )}
        />
      </Card>
    </div>
  );
};

function viewProposal(id: number) {
  window.location.hash = `#/governance/proposal/${id}`;
}

function voteOnProposal(id: number) {
  window.location.hash = `#/governance/vote/${id}`;
}
```

### 3.2 ææ¡ˆåˆ›å»ºç•Œé¢

**æ–‡ä»¶**: `stardust-dapp/src/features/governance/CreateProposal.tsx`

```typescript
import React, { useState } from 'react';
import { Form, InputNumber, Button, Upload, message, Card } from 'antd';
import { useApi } from '@/hooks/useApi';
import { uploadToIPFS } from '@/utils/ipfs';

export const CreateProposalPage: React.FC = () => {
  const { api, currentAccount } = useApi();
  const [loading, setLoading] = useState(false);
  const [form] = Form.useForm();

  const handleSubmit = async (values) => {
    setLoading(true);
    try {
      // 1. ä¸Šä¼ ææ¡ˆè¯¦æƒ…åˆ° IPFS
      const titleCid = await uploadToIPFS({ text: values.title });
      const descriptionCid = await uploadToIPFS({ text: values.description });
      const rationaleCid = await uploadToIPFS({ text: values.rationale });

      // 2. æäº¤ææ¡ˆåˆ°é“¾ä¸Š
      const tx = api.tx.affiliate.proposePercentageAdjustment(
        values.percentages, // [L1, L2, ..., L15]
        titleCid,
        descriptionCid,
        rationaleCid
      );

      await tx.signAndSend(currentAccount, ({ status, events }) => {
        if (status.isInBlock) {
          // æŸ¥æ‰¾ PercentageAdjustmentProposed äº‹ä»¶
          const proposedEvent = events.find(
            (e) =>
              e.event.section === 'affiliate' &&
              e.event.method === 'PercentageAdjustmentProposed'
          );

          if (proposedEvent) {
            const proposalId = proposedEvent.event.data[0].toString();
            message.success(`ææ¡ˆå·²åˆ›å»ºï¼ææ¡ˆID: ${proposalId}`);
            window.location.hash = `#/governance/proposal/${proposalId}`;
          }
        }
      });
    } catch (error) {
      console.error('ææ¡ˆåˆ›å»ºå¤±è´¥:', error);
      message.error('ææ¡ˆåˆ›å»ºå¤±è´¥: ' + error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <Card title="å‘èµ·åˆ†æˆæ¯”ä¾‹è°ƒæ•´ææ¡ˆ">
      <Form form={form} layout="vertical" onFinish={handleSubmit}>
        <Form.Item label="ææ¡ˆæ ‡é¢˜" name="title" rules={[{ required: true }]}>
          <Input placeholder="ä¾‹å¦‚ï¼šè°ƒæ•´L1/L2æ¯”ä¾‹ä»¥æ¿€åŠ±é¡¶å±‚æ¨èäºº" />
        </Form.Item>

        <Form.Item label="ææ¡ˆè¯¦æƒ…" name="description" rules={[{ required: true }]}>
          <Input.TextArea rows={6} placeholder="è¯¦ç»†è¯´æ˜è°ƒæ•´ç†ç”±..." />
        </Form.Item>

        <Form.Item label="æ–°çš„åˆ†æˆæ¯”ä¾‹ï¼ˆ15å±‚ï¼‰" required>
          {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15].map((layer) => (
            <Form.Item
              key={layer}
              name={['percentages', layer - 1]}
              label={`L${layer}`}
              rules={[{ required: true, type: 'number', min: 0, max: 100 }]}
              style={{ display: 'inline-block', width: 'calc(20% - 8px)', marginRight: 8 }}
            >
              <InputNumber min={0} max={100} placeholder={`L${layer}%`} />
            </Form.Item>
          ))}
        </Form.Item>

        <Form.Item label="è°ƒæ•´ç†ç”±" name="rationale" rules={[{ required: true }]}>
          <Input.TextArea rows={4} placeholder="æ•°æ®åˆ†æã€é¢„æœŸæ•ˆæœ..." />
        </Form.Item>

        <Form.Item>
          <Button type="primary" htmlType="submit" loading={loading} size="large">
            æäº¤ææ¡ˆï¼ˆéœ€è¦æŠ¼é‡‘ï¼‰
          </Button>
        </Form.Item>
      </Form>
    </Card>
  );
};
```

### 3.3 æŠ•ç¥¨ç•Œé¢

**æ–‡ä»¶**: `stardust-dapp/src/features/governance/VoteProposal.tsx`

```typescript
import React, { useState, useEffect } from 'react';
import { Card, Radio, Button, message, Space, Typography, Slider } from 'antd';
import { useApi } from '@/hooks/useApi';
import { useParams } from 'react-router-dom';

const { Title, Text } = Typography;

export const VoteProposalPage: React.FC = () => {
  const { proposalId } = useParams<{ proposalId: string }>();
  const { api, currentAccount } = useApi();
  const [proposal, setProposal] = useState(null);
  const [vote, setVote] = useState('Aye');
  const [conviction, setConviction] = useState(0);
  const [loading, setLoading] = useState(false);

  const convictionOptions = [
    { value: 0, label: 'ä¸é”å®š (x1)', weeks: 0 },
    { value: 1, label: 'é”å®š1å‘¨ (x1.5)', weeks: 1 },
    { value: 2, label: 'é”å®š2å‘¨ (x2)', weeks: 2 },
    { value: 3, label: 'é”å®š4å‘¨ (x3)', weeks: 4 },
    { value: 4, label: 'é”å®š8å‘¨ (x4)', weeks: 8 },
    { value: 5, label: 'é”å®š16å‘¨ (x5)', weeks: 16 },
    { value: 6, label: 'é”å®š32å‘¨ (x6)', weeks: 32 },
  ];

  useEffect(() => {
    loadProposal();
  }, [proposalId, api]);

  const loadProposal = async () => {
    if (!api) return;
    const proposalData = await api.query.affiliate.activeProposals(proposalId);
    setProposal(proposalData.toJSON());
  };

  const handleVote = async () => {
    setLoading(true);
    try {
      const tx = api.tx.affiliate.voteOnPercentageProposal(
        proposalId,
        vote,
        convictionOptions[conviction].label.split(' ')[0] // 'None' | 'Locked1x' | ...
      );

      await tx.signAndSend(currentAccount, ({ status }) => {
        if (status.isInBlock) {
          message.success('æŠ•ç¥¨æˆåŠŸï¼');
          window.location.hash = `#/governance/proposal/${proposalId}`;
        }
      });
    } catch (error) {
      console.error('æŠ•ç¥¨å¤±è´¥:', error);
      message.error('æŠ•ç¥¨å¤±è´¥: ' + error.message);
    } finally {
      setLoading(false);
    }
  };

  if (!proposal) {
    return <Card loading />;
  }

  return (
    <Card title={`ææ¡ˆ #${proposalId} - æŠ•ç¥¨`}>
      <Space direction="vertical" style={{ width: '100%' }} size="large">
        <div>
          <Title level={4}>æ–°çš„åˆ†æˆæ¯”ä¾‹</Title>
          <Text>{proposal.new_percentages.join(', ')}%</Text>
        </div>

        <div>
          <Title level={4}>æŠ•ç¥¨é€‰é¡¹</Title>
          <Radio.Group value={vote} onChange={(e) => setVote(e.target.value)}>
            <Radio.Button value="Aye">âœ… æ”¯æŒ</Radio.Button>
            <Radio.Button value="Nay">âŒ åå¯¹</Radio.Button>
            <Radio.Button value="Abstain">âšª å¼ƒæƒ</Radio.Button>
          </Radio.Group>
        </div>

        <div>
          <Title level={4}>ä¿¡å¿µæŠ•ç¥¨ï¼ˆé”å®šæ¢å–æƒé‡ï¼‰</Title>
          <Slider
            min={0}
            max={6}
            value={conviction}
            onChange={setConviction}
            marks={convictionOptions.reduce(
              (acc, opt) => ({ ...acc, [opt.value]: opt.label }),
              {}
            )}
          />
          <Text type="secondary">
            é”å®š {convictionOptions[conviction].weeks} å‘¨ï¼Œæƒé‡å€æ•°:{' '}
            {convictionOptions[conviction].label.match(/x([\d.]+)/)[1]}
          </Text>
        </div>

        <Button type="primary" size="large" onClick={handleVote} loading={loading}>
          æäº¤æŠ•ç¥¨
        </Button>
      </Space>
    </Card>
  );
};
```

---

## ğŸ§ª Phase 4: æµ‹è¯•å’Œæ–‡æ¡£

### 4.1 å•å…ƒæµ‹è¯•

**æ–‡ä»¶**: `pallets/affiliate/src/tests.rs`

```rust
#[test]
fn governance_propose_adjustment_works() {
    new_test_ext().execute_with(|| {
        let proposer = 1;
        let new_percentages = vec![32, 23, 15, 10, 7, 3, 2, 2, 2, 1, 1, 1, 1, 1, 1];

        // ææ¡ˆåº”è¯¥æˆåŠŸ
        assert_ok!(Affiliate::propose_percentage_adjustment(
            RuntimeOrigin::signed(proposer),
            new_percentages.try_into().unwrap(),
            b"title".to_vec().try_into().unwrap(),
            b"description".to_vec().try_into().unwrap(),
            b"rationale".to_vec().try_into().unwrap(),
        ));

        // éªŒè¯ææ¡ˆå­˜åœ¨
        assert!(ActiveProposals::<Test>::contains_key(0));
    });
}

#[test]
fn governance_validate_percentages_works() {
    new_test_ext().execute_with(|| {
        // æœ‰æ•ˆæ¯”ä¾‹
        let valid = vec![30, 25, 15, 10, 7, 3, 2, 2, 2, 1, 1, 1, 1, 1, 1];
        assert_ok!(Affiliate::validate_percentages(&valid.try_into().unwrap()));

        // æ— æ•ˆï¼šæ€»å’Œè¶…è¿‡99%
        let invalid = vec![50, 50, 15, 10, 7, 3, 2, 2, 2, 1, 1, 1, 1, 1, 1];
        assert_err!(
            Affiliate::validate_percentages(&invalid.try_into().unwrap()),
            Error::<Test>::TotalPercentageTooHigh
        );

        // æ— æ•ˆï¼šL1è¶…è¿‡50%
        let invalid2 = vec![60, 10, 10, 5, 5, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1];
        assert_err!(
            Affiliate::validate_percentages(&invalid2.try_into().unwrap()),
            Error::<Test>::FirstLayerTooHigh
        );
    });
}
```

### 4.2 é›†æˆæµ‹è¯•

åˆ›å»ºå®Œæ•´çš„æ²»ç†æµç¨‹æµ‹è¯•è„šæœ¬ã€‚

**æ–‡ä»¶**: `tests/integration/governance-flow.js`

```javascript
const { ApiPromise, WsProvider } = require('@polkadot/api');

async function testGovernanceFlow() {
  const provider = new WsProvider('ws://localhost:9944');
  const api = await ApiPromise.create({ provider });

  console.log('=== æ²»ç†æµç¨‹é›†æˆæµ‹è¯• ===\n');

  // 1. åˆ›å»ºææ¡ˆ
  console.log('1. åˆ›å»ºææ¡ˆ...');
  const proposeTx = api.tx.affiliate.proposePercentageAdjustment(
    [32, 23, 15, 10, 7, 3, 2, 2, 2, 1, 1, 1, 1, 1, 1],
    'QmTitleCID',
    'QmDescriptionCID',
    'QmRationaleCID'
  );

  await proposeTx.signAndSend(alice, ({ status, events }) => {
    if (status.isInBlock) {
      console.log('âœ… ææ¡ˆå·²åˆ›å»º');
    }
  });

  // 2. æŠ•ç¥¨
  console.log('\n2. ç”¨æˆ·æŠ•ç¥¨...');
  const voteTx = api.tx.affiliate.voteOnPercentageProposal(0, 'Aye', 'Locked3x');
  await voteTx.signAndSend(bob);
  console.log('âœ… æŠ•ç¥¨æˆåŠŸ');

  // 3. æŸ¥è¯¢ç»Ÿè®¡
  console.log('\n3. æŸ¥è¯¢æŠ•ç¥¨ç»Ÿè®¡...');
  const tally = await api.query.affiliate.voteTally(0);
  console.log('æ”¯æŒç¥¨:', tally.aye_votes.toString());
  console.log('åå¯¹ç¥¨:', tally.nay_votes.toString());

  console.log('\n=== æµ‹è¯•å®Œæˆ ===');
  process.exit(0);
}

testGovernanceFlow();
```

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯åš

1. **æ·»åŠ å­˜å‚¨å’Œäº‹ä»¶**ï¼šå°†ä¸Šè¿°ä»£ç å¤åˆ¶åˆ° `pallets/affiliate/src/lib.rs`
2. **æ·»åŠ  extrinsic å‡½æ•°**ï¼šå¤åˆ¶ææ¡ˆåˆ›å»ºã€æŠ•ç¥¨ç­‰å‡½æ•°
3. **æµ‹è¯•ç¼–è¯‘**ï¼š`cargo build --release`

### éœ€è¦é…åˆ

4. **Runtime é›†æˆ**ï¼šé…ç½® pallet-collective
5. **å‰ç«¯å¼€å‘**ï¼šåˆ›å»ºæ²»ç†ç•Œé¢
6. **æµ‹è¯•éªŒè¯**ï¼šå•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•

---

## âš ï¸ å…³é”®å®‰å…¨ç‚¹

1. **âœ… å”¯ä¸€ä¿®æ”¹é€šé“**ï¼š`InstantLevelPercents` åªèƒ½é€šè¿‡ `execute_percentage_change()` ä¿®æ”¹
2. **âœ… åˆ é™¤æ—§æ¥å£**ï¼šç§»é™¤æ‰€æœ‰ç®¡ç†å‘˜ç›´æ¥ä¿®æ”¹æ¯”ä¾‹çš„å‡½æ•°
3. **âœ… ä¸¥æ ¼éªŒè¯**ï¼šææ¡ˆéªŒè¯ã€æƒé‡è®¡ç®—ã€é€šè¿‡æ¡ä»¶
4. **âœ… é˜²åƒåœ¾ææ¡ˆ**ï¼šæŠ¼é‡‘æœºåˆ¶ã€é¢‘ç‡é™åˆ¶ã€å†·å´æœŸ
5. **âœ… ç´§æ€¥æœºåˆ¶**ï¼šæŠ€æœ¯å§”å‘˜ä¼šå¯æš‚åœæ²»ç†

---

## ğŸ“Š å®æ–½æ—¶é—´è¡¨

| é˜¶æ®µ | é¢„è®¡æ—¶é—´ | çŠ¶æ€ |
|------|---------|------|
| Phase 1: é“¾ç«¯å®ç° | 1-2å‘¨ | ğŸš§ è¿›è¡Œä¸­ |
| Phase 2: Runtime é›†æˆ | 3-5å¤© | â³ å¾…å¼€å§‹ |
| Phase 3: å‰ç«¯å¼€å‘ | 2-3å‘¨ | â³ å¾…å¼€å§‹ |
| Phase 4: æµ‹è¯•å’Œæ–‡æ¡£ | 1å‘¨ | â³ å¾…å¼€å§‹ |
| **æ€»è®¡** | **4-6å‘¨** | |

---

## ğŸ“ æ”¯æŒ

- **è®¾è®¡æ–‡æ¡£**: `docs/å³æ—¶åˆ†æˆæ¯”ä¾‹å…¨æ°‘æŠ•ç¥¨æ²»ç†æ–¹æ¡ˆ.md`
- **æ¥å£æ–‡æ¡£**: `palletsæ¥å£æ–‡æ¡£.md` ç¬¬18ç« 
- **æ•°æ®ç»“æ„**: `pallets/affiliate/src/governance.rs`
- **å®æ–½æ–¹æ¡ˆ**: æœ¬æ–‡æ¡£

---

**åˆ›å»ºæ—¥æœŸ**: 2025-11-12
**ç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: ğŸš§ Phase 1 è¿›è¡Œä¸­

---

ğŸ’¡ **ä¸‹ä¸€æ­¥**ï¼šå°†ä»£ç æ·»åŠ åˆ° `pallets/affiliate/src/lib.rs`ï¼Œç„¶åæµ‹è¯•ç¼–è¯‘ã€‚
