# 押金与申诉治理系统 - 实施路线图

> 主文档：`押金与申诉治理系统-完整设计方案.md`

## 🎯 实施策略

### 核心原则

1. **渐进式实施** - 分阶段交付，降低风险
2. **并行开发** - 链端和前端同步进行
3. **持续测试** - 每个阶段完成后充分测试
4. **快速迭代** - MVP优先，逐步完善

### 总体时间线

```
Week 1-2: 基础设施层（pallet-deposits）
Week 2-3: 核心治理层（pallet-stardust-appeals重命名+集成）
Week 3-4: 前端开发
Week 4-5: 集成测试与优化
Week 5-6: 文档与培训
```

**总耗时**：约6周（1.5个月）

---

## 📅 详细实施计划

### Phase 1: 基础设施层开发（Week 1-2）

#### Week 1: pallet-deposits MVP

**目标**：完成通用押金模块核心功能

**任务清单**：

| 任务 | 负责人 | 工作量 | 优先级 |
|-----|--------|--------|--------|
| **Day 1-2: 架构设计** | 架构师 | 2天 | P0 |
| - 定义数据结构 | | 0.5天 | |
| - 设计存储布局 | | 0.5天 | |
| - 设计Trait接口 | | 0.5天 | |
| - 编写技术文档 | | 0.5天 | |
| **Day 3-4: 核心实现** | 开发者A | 2天 | P0 |
| - 实现reserve_deposit | | 0.5天 | |
| - 实现release_deposit | | 0.5天 | |
| - 实现slash_deposit | | 0.5天 | |
| - 实现查询接口 | | 0.5天 | |
| **Day 5: 单元测试** | 开发者A | 1天 | P0 |
| - 编写测试用例 | | 0.5天 | |
| - 测试覆盖率>90% | | 0.5天 | |

**交付物**：
- ✅ `pallets/deposits/src/lib.rs`
- ✅ 单元测试通过
- ✅ 技术文档
- ✅ README.md

**里程碑验证**：
```rust
// 测试通过
cargo test -p pallet-deposits
// 编译通过
cargo build --release
```

#### Week 2: 动态定价策略

**目标**：实现USD锚定动态定价

**任务清单**：

| 任务 | 负责人 | 工作量 | 优先级 |
|-----|--------|--------|--------|
| **Day 1: pallet-pricing集成** | 开发者A | 1天 | P0 |
| - 实现DepositPolicy trait | | 0.5天 | |
| - 集成pricing模块 | | 0.5天 | |
| **Day 2: 差异化定价** | 开发者A | 1天 | P0 |
| - 实现domain/action倍数表 | | 0.5天 | |
| - 实现动态计算逻辑 | | 0.5天 | |
| **Day 3: 测试验证** | 开发者A | 1天 | P0 |
| - 单元测试 | | 0.5天 | |
| - 集成测试 | | 0.5天 | |
| **Day 4-5: Runtime集成** | 开发者A | 2天 | P0 |
| - 配置Runtime | | 1天 | |
| - 本地测试链验证 | | 1天 | |

**交付物**：
- ✅ 动态定价实现
- ✅ Runtime配置
- ✅ 测试链验证报告

**里程碑验证**：
```bash
# 启动测试链
./target/release/node-template --dev

# 验证押金计算
# 应该返回：$10 / MEMO价格 × 倍数
```

---

### Phase 2: 核心治理层（Week 2-3）

#### Week 2.5: 模块重命名

**目标**：`pallet-memo-content-governance` → `pallet-stardust-appeals`

**任务清单**：

| 任务 | 负责人 | 工作量 | 优先级 |
|-----|--------|--------|--------|
| **Day 1: 链端重命名** | 开发者B | 1天 | P0 |
| - 重命名目录 | | 0.1天 | |
| - 修改Cargo.toml | | 0.2天 | |
| - 修改Runtime配置 | | 0.3天 | |
| - 更新注释文档 | | 0.4天 | |
| **Day 2: 编译测试** | 开发者B | 1天 | P0 |
| - 编译检查 | | 0.3天 | |
| - 单元测试 | | 0.3天 | |
| - 集成测试 | | 0.4天 | |

**交付物**：
- ✅ 重命名完成
- ✅ 编译通过
- ✅ 测试通过

#### Week 3: 集成pallet-deposits

**目标**：stardust-appeals使用deposits管理押金

**任务清单**：

| 任务 | 负责人 | 工作量 | 优先级 |
|-----|--------|--------|--------|
| **Day 1: 定义依赖** | 开发者B | 1天 | P0 |
| - Config添加DepositManager | | 0.3天 | |
| - 修改Appeal数据结构 | | 0.3天 | |
| - 编写适配代码 | | 0.4天 | |
| **Day 2-3: 迁移逻辑** | 开发者B | 2天 | P0 |
| - submit_appeal调用deposits | | 0.5天 | |
| - approve_appeal调用deposits | | 0.3天 | |
| - reject_appeal调用deposits | | 0.3天 | |
| - withdraw_appeal调用deposits | | 0.3天 | |
| - 清理旧押金代码 | | 0.6天 | |
| **Day 4-5: 测试验证** | 开发者B | 2天 | P0 |
| - 单元测试更新 | | 1天 | |
| - 集成测试 | | 1天 | |

**交付物**：
- ✅ appeals与deposits集成完成
- ✅ 旧押金代码清理
- ✅ 测试通过

**里程碑验证**：
```rust
// 测试流程
1. submit_appeal
   ↓ 应该调用pallet_deposits::reserve_deposit
   ↓ 返回deposit_id
   ↓ Appeal记录中包含deposit_id

2. approve_appeal
   ↓ 执行成功后
   ↓ 应该调用pallet_deposits::release_deposit
   ↓ 押金状态变为Released

3. reject_appeal
   ↓ 应该调用pallet_deposits::slash_deposit
   ↓ 30%入国库，70%退回
```

---

### Phase 3: 前端开发（Week 3-4）

#### Week 3.5: 前端基础搭建

**目标**：创建前端页面结构和基础组件

**任务清单**：

| 任务 | 负责人 | 工作量 | 优先级 |
|-----|--------|--------|--------|
| **Day 1: 目录重构** | 前端开发者A | 1天 | P0 |
| - 重命名ContentGovernance→Appeals | | 0.3天 | |
| - 创建Deposits目录结构 | | 0.3天 | |
| - 更新路由配置 | | 0.2天 | |
| - 添加重定向（兼容旧链接） | | 0.2天 | |
| **Day 2: 类型定义** | 前端开发者A | 1天 | P0 |
| - 定义Appeal类型 | | 0.3天 | |
| - 定义Deposit类型 | | 0.3天 | |
| - 定义API响应类型 | | 0.4天 | |

**交付物**：
- ✅ 前端目录结构
- ✅ TypeScript类型定义

#### Week 4: 核心功能开发

**任务清单**：

| 任务 | 负责人 | 工作量 | 优先级 |
|-----|--------|--------|--------|
| **Day 1-2: Hooks开发** | 前端开发者A | 2天 | P0 |
| - useMemoAppeals | | 0.5天 | |
| - useMemoDeposits | | 0.5天 | |
| - useDynamicPricing | | 1天 | |
| **Day 3-4: 页面开发** | 前端开发者B | 2天 | P0 |
| - 申诉列表页 | | 0.5天 | |
| - 申诉详情页 | | 0.5天 | |
| - 提交申诉页 | | 0.7天 | |
| - 我的押金页 | | 0.3天 | |
| **Day 5: 组件开发** | 前端开发者A+B | 1天 | P1 |
| - AppealCard | | 0.2天 | |
| - AppealStatus | | 0.1天 | |
| - AppealTimeline | | 0.2天 | |
| - DepositCalculator | | 0.3天 | |
| - DomainSelector | | 0.1天 | |
| - ActionSelector | | 0.1天 | |

**交付物**：
- ✅ 所有Hooks实现
- ✅ 4个核心页面
- ✅ 6个核心组件

---

### Phase 4: 集成测试与优化（Week 4-5）

#### Week 4.5: 功能测试

**目标**：端到端功能验证

**测试矩阵**：

| 场景 | 测试用例 | 预期结果 | 负责人 |
|-----|---------|---------|--------|
| **提交申诉** | | | 测试A |
| - 墓地申诉 | 提交清空封面申诉 | 押金冻结12.5 DUST | |
| - 逝者申诉 | 提交转让所有权申诉 | 押金冻结25 DUST | |
| - 限频测试 | 5分钟内提交6次 | 第6次失败 | |
| **审批申诉** | | | 测试B |
| - 委员会批准 | 2/3投票通过 | 进入公示期 | |
| - 委员会驳回 | 投票驳回 | 罚没30%押金 | |
| **自动执行** | | | 测试A |
| - 公示期到期 | 等待30天 | 自动执行 | |
| - 执行成功 | 清空封面成功 | 释放押金 | |
| - 执行失败 | 目标不存在 | 计划重试 | |
| **撤回申诉** | | | 测试B |
| - 主动撤回 | 申诉人撤回 | 罚没10%押金 | |
| **押金查询** | | | 测试A |
| - 我的押金列表 | 查询所有押金 | 显示正确 | |
| - 押金详情 | 查询单个押金 | 显示正确 | |
| **动态定价** | | | 测试B |
| - 价格变动 | MEMO价格×2 | 押金金额÷2 | |
| - 倍数差异 | 不同操作 | 不同倍数 | |

**工作量**：2天

#### Week 5: 性能优化

**目标**：优化性能和用户体验

**任务清单**：

| 任务 | 负责人 | 工作量 | 优先级 |
|-----|--------|--------|--------|
| **链端优化** | 开发者A | 2天 | P1 |
| - 存储读取优化 | | 0.5天 | |
| - 批量查询接口 | | 0.5天 | |
| - Weight优化 | | 0.5天 | |
| - 清理冗余代码 | | 0.5天 | |
| **前端优化** | 前端开发者A | 2天 | P1 |
| - 懒加载 | | 0.3天 | |
| - 虚拟滚动 | | 0.3天 | |
| - 缓存策略 | | 0.4天 | |
| - 加载状态优化 | | 0.3天 | |
| - 错误处理 | | 0.4天 | |
| - 响应式优化 | | 0.3天 | |
| **交互优化** | UI/UX设计师 | 1天 | P1 |
| - 动画效果 | | 0.3天 | |
| - 过渡效果 | | 0.2天 | |
| - 反馈提示 | | 0.3天 | |
| - 无障碍支持 | | 0.2天 | |

**交付物**：
- ✅ 性能测试报告
- ✅ 优化实施报告

---

### Phase 5: 文档与培训（Week 5-6）

#### Week 5.5: 文档编写

**目标**：完善所有文档

**任务清单**：

| 文档类型 | 内容 | 负责人 | 工作量 |
|---------|------|--------|--------|
| **用户文档** | | 文档工程师 | 2天 |
| - 申诉中心使用指南 | ✓ | | 0.5天 |
| - 提交申诉教程 | ✓ | | 0.5天 |
| - 押金管理指南 | ✓ | | 0.5天 |
| - FAQ常见问题 | ✓ | | 0.5天 |
| **开发者文档** | | 技术文档工程师 | 2天 |
| - pallet-deposits API文档 | ✓ | | 0.5天 |
| - pallet-stardust-appeals API文档 | ✓ | | 0.5天 |
| - 前端API文档 | ✓ | | 0.5天 |
| - 集成指南 | ✓ | | 0.5天 |
| **运维文档** | | 运维工程师 | 1天 |
| - 部署指南 | ✓ | | 0.3天 |
| - 监控指南 | ✓ | | 0.3天 |
| - 故障排查 | ✓ | | 0.4天 |

**交付物**：
- ✅ 用户手册（4篇）
- ✅ 开发者文档（4篇）
- ✅ 运维文档（3篇）

#### Week 6: 培训与上线准备

**目标**：团队培训，准备上线

**任务清单**：

| 任务 | 负责人 | 工作量 | 优先级 |
|-----|--------|--------|--------|
| **内部培训** | 技术负责人 | 2天 | P0 |
| - 后端开发培训 | | 0.5天 | |
| - 前端开发培训 | | 0.5天 | |
| - 测试团队培训 | | 0.5天 | |
| - 运维团队培训 | | 0.5天 | |
| **上线检查** | 项目经理 | 2天 | P0 |
| - 功能完整性检查 | | 0.5天 | |
| - 性能测试 | | 0.5天 | |
| - 安全审计 | | 0.5天 | |
| - 上线预案 | | 0.5天 | |
| **灰度发布** | 运维工程师 | 1天 | P0 |
| - 测试网部署 | | 0.3天 | |
| - 小范围试用 | | 0.4天 | |
| - 收集反馈 | | 0.3天 | |

**交付物**：
- ✅ 培训材料
- ✅ 上线检查表
- ✅ 灰度发布报告

---

## 📊 资源配置

### 人力资源

| 角色 | 人数 | 投入时间 | 总人天 |
|-----|------|---------|--------|
| **架构师** | 1人 | 20% | 6人天 |
| **后端开发** | 2人 | 100% | 60人天 |
| **前端开发** | 2人 | 100% | 60人天 |
| **UI/UX设计师** | 1人 | 30% | 9人天 |
| **测试工程师** | 2人 | 100% | 60人天 |
| **技术文档** | 1人 | 50% | 15人天 |
| **项目经理** | 1人 | 50% | 15人天 |
| **总计** | 10人 | - | **225人天** |

### 成本估算

| 项目 | 成本 |
|-----|------|
| 人力成本 | 225人天 |
| 测试环境 | 可忽略（使用dev链） |
| 第三方服务 | 0（无依赖） |
| 培训成本 | 包含在人力 |
| **总成本** | **≈ 225人天** |

---

## ⚠️ 风险管理

### 风险识别

| 风险 | 概率 | 影响 | 等级 |
|-----|------|------|------|
| **技术风险** | | | |
| - 动态定价不准确 | 中 | 高 | 🔴 高 |
| - 执行失败率高 | 中 | 中 | 🟡 中 |
| - 性能不达标 | 低 | 中 | 🟢 低 |
| **进度风险** | | | |
| - 前后端不同步 | 中 | 中 | 🟡 中 |
| - 测试时间不足 | 中 | 高 | 🔴 高 |
| - 文档延期 | 低 | 低 | 🟢 低 |
| **资源风险** | | | |
| - 人员变动 | 低 | 高 | 🟡 中 |
| - 并发冲突 | 中 | 低 | 🟢 低 |

### 缓解措施

**1. 动态定价不准确**
- 缓解：充分测试pricing集成，设置回退机制
- 应急：使用固定押金作为fallback

**2. 执行失败率高**
- 缓解：实现重试机制，完善错误处理
- 应急：手动执行备用方案

**3. 测试时间不足**
- 缓解：并行开发+测试，自动化测试
- 应急：延长测试周期，推迟上线

**4. 前后端不同步**
- 缓解：每日站会同步进度，API先行
- 应急：前端使用mock数据开发

---

## 📈 监控指标

### 开发阶段监控

| 指标 | 目标 | 监控频率 |
|-----|------|---------|
| **进度** | | |
| - 任务完成率 | 100% | 每天 |
| - 里程碑准时率 | >90% | 每周 |
| **质量** | | |
| - 单元测试覆盖率 | >90% | 每次提交 |
| - 集成测试通过率 | 100% | 每天 |
| - Bug修复率 | >95% | 每周 |
| **代码** | | |
| - 代码审查通过率 | 100% | 每次PR |
| - Linter错误数 | 0 | 每次提交 |

### 上线后监控

| 指标 | 目标 | 告警阈值 |
|-----|------|---------|
| **性能** | | |
| - 申诉提交响应时间 | <3s | >5s |
| - 押金冻结响应时间 | <2s | >4s |
| - 页面加载时间 | <2s | >4s |
| **可靠性** | | |
| - 申诉成功率 | >99% | <95% |
| - 执行成功率 | >98% | <90% |
| - 押金释放成功率 | >99.5% | <98% |
| **业务** | | |
| - 日均申诉量 | - | - |
| - 押金总额 | - | - |
| - 审批通过率 | - | - |

---

## ✅ 验收标准

### 功能验收

- [ ] 提交申诉功能正常（所有域）
- [ ] 委员会审批功能正常
- [ ] 自动执行功能正常
- [ ] 撤回申诉功能正常
- [ ] 押金管理功能正常
- [ ] 动态定价功能正常
- [ ] 查询接口功能正常
- [ ] 前端页面显示正常
- [ ] 响应式适配正常

### 性能验收

- [ ] 申诉提交 <3秒
- [ ] 押金冻结 <2秒
- [ ] 页面加载 <2秒
- [ ] 支持1000+申诉记录
- [ ] 支持100+并发用户

### 质量验收

- [ ] 单元测试覆盖率 >90%
- [ ] 集成测试通过率 100%
- [ ] 0个Critical Bug
- [ ] 0个Linter Error
- [ ] 文档完整性 100%

### 安全验收

- [ ] 权限控制正确
- [ ] 押金资金安全
- [ ] 防止恶意申诉
- [ ] 防止DoS攻击
- [ ] 数据加密传输

---

## 🚀 上线计划

### 灰度发布策略

**阶段1：内部测试（Week 6.1）**
```
用户范围：开发团队（10人）
功能范围：全部功能
持续时间：3天
成功标准：无Critical Bug
```

**阶段2：小范围试用（Week 6.2）**
```
用户范围：测试用户（50人）
功能范围：全部功能
持续时间：3天
成功标准：成功率>98%
```

**阶段3：正式上线（Week 6.3）**
```
用户范围：全部用户
功能范围：全部功能
持续时间：持续运行
成功标准：性能和可靠性达标
```

### 回滚预案

**触发条件**：
- Critical Bug导致资金安全问题
- 执行成功率<90%
- 系统不可用时间>30分钟

**回滚步骤**：
1. 暂停新申诉提交（5分钟内）
2. 回滚到上一版本（15分钟内）
3. 恢复服务（5分钟内）
4. 评估影响范围（1小时内）
5. 制定修复方案（4小时内）

---

## 📞 沟通计划

### 定期会议

| 会议 | 频率 | 参与者 | 时长 |
|-----|------|--------|------|
| **每日站会** | 每天 | 全体开发 | 15分钟 |
| **周会** | 每周 | 全体团队 | 1小时 |
| **里程碑评审** | 每阶段 | 全体+管理层 | 2小时 |
| **技术评审** | 按需 | 技术团队 | 1小时 |

### 沟通渠道

- **即时沟通**：企业微信/Slack
- **代码评审**：GitHub PR
- **问题跟踪**：JIRA/GitHub Issues
- **文档协作**：Notion/Confluence

---

**下一文档**：`押金与申诉治理系统-测试方案.md`

