# æ²»ç†æ¨¡å—è¿ç§»å®ŒæˆæŠ¥å‘Š

**æ‰§è¡Œæ—¥æœŸ**: 2025-11-13
**ä»»åŠ¡**: å°† governance.rs ä» pallet-affiliate è¿ç§»åˆ° pallet-membership
**çŠ¶æ€**: âœ… æ ¸å¿ƒæ¶æ„è¿ç§»å®Œæˆ

## ğŸ¯ è¿ç§»ç›®æ ‡

å°†æ²»ç†åŠŸèƒ½ä» pallet-affiliate ç§»åŠ¨åˆ° pallet-membershipï¼Œå®ç°æ›´åˆç†çš„æ¶æ„è®¾è®¡ï¼š
- **èŒè´£æ˜ç¡®**: membership ä½œä¸ºåŸºç¡€æ¨¡å—æ‰¿æ‹…æ²»ç†èŒè´£
- **ä¾èµ–åˆç†**: affiliate è°ƒç”¨ membership çš„æ²»ç†æœåŠ¡
- **ä»£ç å¤ç”¨**: ç»Ÿä¸€çš„æ²»ç†åŸºç¡€è®¾æ–½

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. **æ–‡ä»¶å¤‡ä»½**
- âœ… å¤‡ä»½äº†åŸå§‹çš„ `affiliate/src/governance.rs`
- âœ… æ–‡ä»¶ä½ç½®: `governance-backup-{timestamp}.rs`

### 2. **æ²»ç†æ¨¡å—è¿ç§»**
- âœ… åˆ›å»ºäº†æ–°çš„ `membership/src/governance.rs`
- âœ… é€‚é…äº† membership æ¨¡å—çš„ç±»å‹ç³»ç»Ÿ
- âœ… ç§»é™¤äº†å¯¹ affiliate ç‰¹å®šç±»å‹çš„ä¾èµ–
- âœ… å¢åŠ äº†æ¸…æ™°çš„æ¶æ„è¯´æ˜æ–‡æ¡£

### 3. **Membership æ¨¡å—æ›´æ–°**
- âœ… æ›´æ–°äº† `membership/src/lib.rs` çš„æ¨¡å—æ–‡æ¡£
- âœ… æ·»åŠ äº†æ²»ç†æ¨¡å—å¯¼å…¥ (`pub mod governance`)
- âœ… å¯¼å‡ºäº†æ ¸å¿ƒæ²»ç†ç±»å‹ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨
- âœ… æ·»åŠ äº†æ‰€æœ‰å¿…è¦çš„é”™è¯¯ç±»å‹

### 4. **æ ¸å¿ƒåŠŸèƒ½**

#### å·²è¿ç§»çš„æ²»ç†åŠŸèƒ½ï¼š
- âœ… **å¹´è´¹ä»·æ ¼æ²»ç†**: 4ä¸ªç­‰çº§çš„USDTä»·æ ¼è°ƒæ•´
- âœ… **åˆ†æˆæ¯”ä¾‹æ²»ç†**: 15å±‚è”ç›Ÿåˆ†æˆæ¯”ä¾‹è°ƒæ•´
- âœ… **æŠ•ç¥¨æœºåˆ¶**: åŠ æƒæŠ•ç¥¨ + ä¿¡å¿µæŠ•ç¥¨
- âœ… **ææ¡ˆéªŒè¯**:
  - å¹´è´¹ä»·æ ¼éªŒè¯ï¼ˆ10-1000 USDTï¼Œé€’å¢æ€§ï¼‰
  - åˆ†æˆæ¯”ä¾‹éªŒè¯ï¼ˆğŸ”¥ æ”¯æŒç¬¬3å±‚ä¸º0ï¼‰
- âœ… **æŠ•ç¥¨æƒé‡è®¡ç®—**: æŒå¸70% + å‚ä¸20% + è´¡çŒ®10%
- âœ… **é€šè¿‡æ£€æŸ¥**: 15%å‚ä¸ç‡ + è‡ªé€‚åº”æ”¯æŒç‡é˜ˆå€¼

## ğŸ“‹ å‰©ä½™å·¥ä½œï¼ˆéœ€è¦åç»­å®Œæˆï¼‰

### 1. **Affiliate æ¨¡å—æ›´æ–°**
```rust
// éœ€è¦ä¿®æ”¹ affiliate/src/lib.rs
// ä»ï¼š
pub mod governance;
pub use governance::{...};

// æ”¹ä¸ºï¼š
// ä½¿ç”¨ membership çš„æ²»ç†æœåŠ¡
pub use pallet_membership::governance::{
    Vote, Conviction, ProposalStatus,
    PercentageAdjustmentProposal, VoteRecord, PercentageChangeRecord,
    LevelPercents,
};
```

### 2. **åˆ é™¤ Affiliate çš„ Governance æ¨¡å—**
- åˆ é™¤ `pallets/affiliate/src/governance.rs`
- æ¸…ç†ç›¸å…³å¯¼å…¥å’Œå¼•ç”¨

### 3. **Runtime é…ç½®æ›´æ–°**
- æ›´æ–° `runtime/src/configs/mod.rs`
- é…ç½® membership çš„æ²»ç†åŠŸèƒ½
- ç¡®ä¿ affiliate å¯ä»¥è®¿é—® membership çš„æ²»ç†æœåŠ¡

### 4. **å­˜å‚¨é¡¹è¿ç§»**ï¼ˆå¦‚æœæœ‰ï¼‰
- æ£€æŸ¥ affiliate ä¸­æ˜¯å¦æœ‰æ²»ç†ç›¸å…³çš„å­˜å‚¨é¡¹
- è¿ç§»åˆ° membership æˆ–é€šè¿‡æ¥å£è®¿é—®

### 5. **æµ‹è¯•æ›´æ–°**
- æ›´æ–°å•å…ƒæµ‹è¯•ä»¥åæ˜ æ–°çš„æ¨¡å—ç»“æ„
- æ›´æ–°é›†æˆæµ‹è¯•
- éªŒè¯æ²»ç†åŠŸèƒ½åœ¨æ–°æ¶æ„ä¸‹æ­£å¸¸å·¥ä½œ

## ğŸ“Š æ¶æ„å¯¹æ¯”

### è¿ç§»å‰ï¼ˆæ—§æ¶æ„ï¼‰
```
pallets/affiliate/src/
â”œâ”€â”€ governance.rs       â† æ²»ç†åŠŸèƒ½ï¼ˆæ··æ·†èŒè´£ï¼‰
â”œâ”€â”€ instant.rs          â† å³æ—¶åˆ†æˆ
â”œâ”€â”€ weekly.rs           â† å‘¨ç»“ç®—
â””â”€â”€ lib.rs              â† ä¸»æ¨¡å—

pallets/membership/src/
â”œâ”€â”€ lib.rs              â† ä¼šå‘˜ç®¡ç†
â””â”€â”€ types.rs            â† ç±»å‹å®šä¹‰
```

**é—®é¢˜**:
- âŒ affiliate æ‰¿æ‹…äº†ä¸å±äºå®ƒçš„æ²»ç†èŒè´£
- âŒ membership ä¾èµ– affiliate æ¥ç®¡ç†è‡ªå·±çš„ä»·æ ¼
- âŒ ä¾èµ–å…³ç³»å€’ç½®

### è¿ç§»åï¼ˆæ–°æ¶æ„ï¼‰
```
pallets/membership/src/
â”œâ”€â”€ lib.rs              â† ä¼šå‘˜ç®¡ç† + ç»Ÿä¸€æ²»ç†
â”œâ”€â”€ governance.rs       â† ğŸ†• æ²»ç†ä¸­å¿ƒ
â””â”€â”€ types.rs            â† ç±»å‹å®šä¹‰

pallets/affiliate/src/
â”œâ”€â”€ instant.rs          â† å³æ—¶åˆ†æˆ
â”œâ”€â”€ weekly.rs           â† å‘¨ç»“ç®—
â””â”€â”€ lib.rs              â† ä¸»æ¨¡å—ï¼ˆè°ƒç”¨membershipçš„æ²»ç†æœåŠ¡ï¼‰
```

**ä¼˜åŠ¿**:
- âœ… **èŒè´£æ¸…æ™°**: membership ç®¡æ²»ç†ï¼Œaffiliate ç®¡åˆ†æˆ
- âœ… **ä¾èµ–åˆç†**: affiliate è°ƒç”¨ membership çš„æ²»ç†æœåŠ¡
- âœ… **å¤ç”¨æ€§å¥½**: å…¶ä»–æ¨¡å—ä¹Ÿå¯ä½¿ç”¨åŒä¸€å¥—æ²»ç†åŸºç¡€è®¾æ–½
- âœ… **è¯­ä¹‰æ­£ç¡®**: ä¼šå‘˜ç³»ç»Ÿè´Ÿè´£ç¤¾åŒºæ²»ç†

## ğŸ”¥ å…³é”®æ”¹è¿›

### 1. **ç¬¬ä¸‰å±‚åˆ†æˆæ¯”ä¾‹å¯ä¸º0**
```rust
// å‰2å±‚ä¸èƒ½ä¸º0ï¼Œç¬¬3å±‚å¯ä»¥ä¸º0ï¼ˆåŸºäºå…¨æ°‘æŠ•ç¥¨å†³å®šï¼‰
if index < 2 {
    ensure!(percentage > 0, ...);
}
```

### 2. **æŠ€æœ¯å§”å‘˜ä¼šæ— å¦å†³æƒ**
```rust
/// æ£€æŸ¥åˆ†æˆæ¯”ä¾‹ææ¡ˆæ˜¯å¦é€šè¿‡ï¼ˆæŠ€æœ¯å§”å‘˜ä¼šæ— æ³•å¦å†³ï¼‰
pub fn check_percentage_proposal_passed(...) -> bool {
    // ğŸ”¥ æ‰€æœ‰åˆ†æˆæ¯”ä¾‹ææ¡ˆéƒ½å¿…é¡»é€šè¿‡å…¨æ°‘æŠ•ç¥¨
    // æœ€ä½å‚ä¸ç‡é—¨æ§›ï¼š15%
    // è‡ªé€‚åº”é˜ˆå€¼ï¼šå‚ä¸ç‡è¶Šé«˜ï¼Œé€šè¿‡é—¨æ§›è¶Šä½
}
```

### 3. **ç»Ÿä¸€æŠ¼é‡‘**
```rust
// åˆ é™¤å¾®è°ƒ/é‡å¤§ææ¡ˆåŒºåˆ†
// ç»Ÿä¸€æŠ¼é‡‘ï¼š5000 DUST
let deposit_amount = 5000u128.saturated_into();
```

## ğŸš€ åç»­æ‰§è¡Œè®¡åˆ’

### Phase 1: å®Œæˆ Affiliate æ›´æ–°ï¼ˆä¼˜å…ˆï¼‰
1. æ›´æ–° affiliate/lib.rs çš„å¯¼å…¥
2. åˆ é™¤ affiliate/governance.rs
3. éªŒè¯ç¼–è¯‘é€šè¿‡

### Phase 2: Runtime é…ç½®ï¼ˆå¿…é¡»ï¼‰
1. æ›´æ–° runtime é…ç½®ä»¥æ”¯æŒæ–°æ¶æ„
2. ç¡®ä¿è·¨æ¨¡å—è°ƒç”¨æ­£å¸¸å·¥ä½œ

### Phase 3: æµ‹è¯•éªŒè¯ï¼ˆå…³é”®ï¼‰
1. å•å…ƒæµ‹è¯•
2. é›†æˆæµ‹è¯•
3. ç«¯åˆ°ç«¯æµ‹è¯•

### Phase 4: æ–‡æ¡£æ›´æ–°ï¼ˆé‡è¦ï¼‰
1. æ›´æ–° README
2. æ›´æ–° API æ–‡æ¡£
3. æ›´æ–°ç”¨æˆ·æŒ‡å—

## ğŸ’¡ å»ºè®®

1. **é€æ­¥è¿ç§»**: å»ºè®®åœ¨å•ç‹¬çš„åˆ†æ”¯ä¸Šå®Œæˆå‰©ä½™å·¥ä½œï¼Œå……åˆ†æµ‹è¯•åå†åˆå¹¶
2. **å‘åå…¼å®¹**: è€ƒè™‘ä¿ç•™ä¸€æ®µè¿‡æ¸¡æœŸï¼Œç¡®ä¿ç°æœ‰è°ƒç”¨æ–¹æœ‰æ—¶é—´é€‚é…
3. **ç›‘æ§éƒ¨ç½²**: éƒ¨ç½²åå¯†åˆ‡ç›‘æ§æ²»ç†åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ

## ğŸ“ å˜æ›´æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- âœ… `pallets/membership/src/governance.rs`
- âœ… `governance-backup-{timestamp}.rs` (å¤‡ä»½)

### ä¿®æ”¹æ–‡ä»¶
- âœ… `pallets/membership/src/lib.rs`

### å¾…ä¿®æ”¹æ–‡ä»¶
- â³ `pallets/affiliate/src/lib.rs`
- â³ `runtime/src/configs/mod.rs`

### å¾…åˆ é™¤æ–‡ä»¶
- â³ `pallets/affiliate/src/governance.rs`

---

**æ€»ç»“**: æ ¸å¿ƒæ¶æ„è¿ç§»å·²å®Œæˆï¼Œæ²»ç†æ¨¡å—ç°åœ¨ä½äºæ›´åˆç†çš„ membership æ¨¡å—ä¸­ã€‚å‰©ä½™å·¥ä½œä¸»è¦æ˜¯æ›´æ–°å¼•ç”¨å’Œåˆ é™¤æ—§ä»£ç ï¼Œå¯ä»¥ä½œä¸ºç‹¬ç«‹ä»»åŠ¡ç»§ç»­å®Œæˆã€‚

**ä¸‹ä¸€æ­¥**: å»ºè®®å…ˆéªŒè¯ membership pallet ç¼–è¯‘é€šè¿‡ï¼Œç„¶åå†è¿›è¡Œ affiliate æ¨¡å—çš„æ›´æ–°ã€‚