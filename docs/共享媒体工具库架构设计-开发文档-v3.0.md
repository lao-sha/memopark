# å…±äº«åª’ä½“å·¥å…·åº“æ¶æ„è®¾è®¡ - å¼€å‘æ–‡æ¡£ (v3.0 - åˆ†æ•£å­˜å‚¨ç»ˆæç‰ˆ)

## æ–‡æ¡£ä¿¡æ¯

- **åˆ›å»ºæ—¶é—´**: 2025å¹´1æœˆ25æ—¥
- **ç‰ˆæœ¬**: v3.0 (åˆ†æ•£å­˜å‚¨ + å…±äº«å·¥å…·åº“æ¶æ„)
- **ä½œè€…**: Claude Code åŠ©æ‰‹
- **æ–‡æ¡£æ€§è´¨**: æŠ€æœ¯æ¶æ„è®¾è®¡ä¸å®ç°æ–¹æ¡ˆ
- **é‡å¤§å˜æ›´**: å®Œå…¨æŠ›å¼ƒé›†ä¸­å¼å…¬å…±åª’ä½“åº“ï¼Œé‡‡ç”¨åˆ†æ•£å­˜å‚¨ + å…±äº«å·¥å…·åº“æ–¹æ¡ˆ

---

## ğŸ“‹ ç‰ˆæœ¬æ¼”è¿›å†å²

### v1.0 â†’ v2.0 â†’ v3.0 æ¶æ„æ¼”è¿›

| ç‰ˆæœ¬ | æ¶æ„æ–¹æ¡ˆ | è€¦åˆåº¦ | ä¸»è¦é—®é¢˜ | çŠ¶æ€ |
|-----|---------|-------|---------|------|
| **v1.0** | é›†ä¸­å¼å…¬å…±åª’ä½“åº“ | 6.5/10 âš ï¸ | é«˜è€¦åˆã€å¾ªç¯ä¾èµ–ã€ç¡¬ç¼–ç æ˜ å°„ | âŒ åºŸå¼ƒ |
| **v2.0** | é›†ä¸­å¼ + æŠ½è±¡å±‚ä¼˜åŒ– | 3.3/10 âœ… | æ¶æ„å¤æ‚ã€ä¸šåŠ¡éœ€æ±‚ä¸åŒ¹é… | âš ï¸ éƒ¨åˆ†é‡‡çº³ |
| **v3.0** | **åˆ†æ•£å­˜å‚¨ + å…±äº«å·¥å…·åº“** | 2.8/10 âœ… | æ— é‡å¤§é—®é¢˜ | âœ… **æ¨è** |

### v3.0 çš„æ ¹æœ¬æ€§å˜é©

**æ ¸å¿ƒå†³ç­–**: åŸºäºã€Šåª’ä½“åˆ†æ•£å­˜å‚¨vsé›†ä¸­å­˜å‚¨-æ¶æ„åˆ†æ.mdã€‹çš„æ·±å…¥åˆ†æï¼Œæˆ‘ä»¬å‘ç°ï¼š

> **10ä¸ªä¸šåŠ¡ç»´åº¦ä¸­ï¼Œ8ä¸ªå®Œå…¨ä¸åŒï¼Œ2ä¸ªéƒ¨åˆ†ä¸åŒï¼Œæ²¡æœ‰ä»»ä½•ç»´åº¦æ˜¯å®Œå…¨ç›¸åŒçš„** âŒ

**å…³é”®æ´å¯Ÿ**:
- âŒ Deceasedã€GroupChatã€Evidence çš„åª’ä½“éœ€æ±‚**æœ¬è´¨å¼‚æ„**
- âŒ å¼ºè¡Œç»Ÿä¸€ä¼šå¼•å…¥å·¨å¤§å¤æ‚åº¦ï¼ˆ3000+è¡Œä»£ç  vs 300è¡Œï¼‰
- âœ… åˆ†æ•£å­˜å‚¨æ€§èƒ½ä¼˜ 10-100 å€
- âœ… 5å¹´TCOèŠ‚çœ 150ä¸‡+

**v3.0 æ–¹æ¡ˆ**:
```
æŠ›å¼ƒé›†ä¸­å¼å…¬å…±åª’ä½“åº“
    â†“
é‡‡ç”¨ åˆ†æ•£å­˜å‚¨ï¼ˆå„æ¨¡å—ç‹¬ç«‹ï¼‰ + å…±äº«å·¥å…·åº“ï¼ˆæ¶ˆé™¤é‡å¤ï¼‰
    â†“
ç»“æœï¼šä½è€¦åˆï¼ˆ2.8/10ï¼‰+ é«˜æ€§èƒ½ + ä½æˆæœ¬
```

---

## 1. æ¶æ„è®¾è®¡æ–¹æ¡ˆï¼ˆv3.0 ç»ˆæç‰ˆï¼‰

### 1.1 æ•´ä½“æ¶æ„æ„¿æ™¯

**è®¾è®¡å“²å­¦**:
1. **ä¸šåŠ¡ç‹¬ç«‹**: æ¯ä¸ªæ¨¡å—çš„åª’ä½“å­˜å‚¨å®Œå…¨ç‹¬ç«‹ï¼Œç¬¦åˆå…¶ä¸šåŠ¡ç‰¹æ€§
2. **å·¥å…·å…±äº«**: é€šç”¨åŠŸèƒ½ï¼ˆéªŒè¯ã€å“ˆå¸Œã€CIDè®¡ç®—ï¼‰é€šè¿‡å…±äº«åº“å¤ç”¨
3. **é›¶è€¦åˆ**: å„æ¨¡å—ä¹‹é—´æ— ç›´æ¥ä¾èµ–
4. **é«˜æ€§èƒ½**: é¿å…è·¨æ¨¡å—æŸ¥è¯¢å’Œç±»å‹è½¬æ¢

```
v3.0 åˆ†æ•£å­˜å‚¨ + å…±äº«å·¥å…·åº“æ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            stardust-media-common (å…±äº«å·¥å…·åº“ - ç‹¬ç«‹crate)         â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“¦ types.rs        - å…±äº«ç±»å‹å®šä¹‰ (MediaKind, ContentTypeç­‰)    â”‚
â”‚  ğŸ” validation.rs   - å†…å®¹éªŒè¯ (ImageValidator, VideoValidator)  â”‚
â”‚  ğŸ” hash.rs         - å“ˆå¸Œå·¥å…· (content_hash, commitment_hash)   â”‚
â”‚  ğŸŒ ipfs.rs         - IPFSå·¥å…· (CIDè®¡ç®—ã€éªŒè¯)                   â”‚
â”‚  ğŸ–¼ï¸  thumbnail.rs    - ç¼©ç•¥å›¾ç”Ÿæˆ                                 â”‚
â”‚  ğŸ“Š metadata.rs     - å…ƒæ•°æ®æå–                                 â”‚
â”‚  âš ï¸  error.rs        - é”™è¯¯ç±»å‹                                  â”‚
â”‚                                                                  â”‚
â”‚  âœ… é›¶è¿è¡Œæ—¶ä¾èµ– (æ— palletä¾èµ–)                                   â”‚
â”‚  âœ… no_stdå…¼å®¹ (æ”¯æŒWASM)                                        â”‚
â”‚  âœ… çº¯å·¥å…·å‡½æ•° (æ— å‰¯ä½œç”¨)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â–²
                               â”‚ ä½¿ç”¨å·¥å…·åº“ï¼ˆå•å‘ä¾èµ–ï¼‰
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚                       â”‚                      â”‚
â”‚ pallet-deceased  â”‚  smart-group-chat     â”‚  pallet-evidence     â”‚
â”‚                  â”‚                       â”‚                      â”‚
â”‚ âœ… ç‹¬ç«‹åª’ä½“å­˜å‚¨   â”‚  âœ… ç‹¬ç«‹æ¶ˆæ¯å­˜å‚¨       â”‚  âœ… ç‹¬ç«‹è¯æ®å­˜å‚¨      â”‚
â”‚ âœ… ç‹¬ç«‹ä¸šåŠ¡é€»è¾‘   â”‚  âœ… é‡å­åŠ å¯†           â”‚  âœ… æ‰¿è¯ºå“ˆå¸Œ         â”‚
â”‚ âœ… Album/Videoé›† â”‚  âœ… ä¸´æ—¶æ¶ˆæ¯           â”‚  âœ… å‘½åç©ºé—´         â”‚
â”‚ âœ… ä½¿ç”¨å·¥å…·åº“     â”‚  âœ… ä½¿ç”¨å·¥å…·åº“         â”‚  âœ… ä½¿ç”¨å·¥å…·åº“       â”‚
â”‚                  â”‚                       â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ ç»Ÿä¸€ä½¿ç”¨
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              pallet-stardust-ipfs (IPFSå­˜å‚¨å±‚)                   â”‚
â”‚                                                                  â”‚
â”‚  âœ… ç»Ÿä¸€çš„CIDç®¡ç†                                                â”‚
â”‚  âœ… ç»Ÿä¸€çš„Pinç­–ç•¥ï¼ˆCritical/Standard/Temporaryï¼‰                 â”‚
â”‚  âœ… ç»Ÿä¸€çš„å¥åº·æ£€æŸ¥                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‰¹å¾**:
- âœ… **å•å‘ä¾èµ–**: æ‰€æœ‰æ¨¡å— â†’ å…±äº«å·¥å…·åº“ï¼Œæ— å¾ªç¯
- âœ… **é›¶ä¸šåŠ¡è€¦åˆ**: Deceasedã€GroupChatã€Evidence å®Œå…¨ç‹¬ç«‹
- âœ… **å·¥å…·å¤ç”¨**: éªŒè¯ã€å“ˆå¸Œã€CIDç­‰é€šç”¨åŠŸèƒ½å…±äº«
- âœ… **IPFSç»Ÿä¸€**: åº•å±‚å­˜å‚¨ä½¿ç”¨ç»Ÿä¸€çš„stardust-ipfs

### 1.2 ä¸ v2.0 æ¶æ„å¯¹æ¯”

| ç»´åº¦ | v2.0 (é›†ä¸­å¼+æŠ½è±¡å±‚) | v3.0 (åˆ†æ•£+å·¥å…·åº“) | ä¼˜åŠ¿ |
|-----|---------------------|-------------------|------|
| **æ¶æ„å¤æ‚åº¦** | é«˜ï¼ˆéœ€è¦é€‚é…å™¨å±‚ï¼‰ | ä½ï¼ˆç›´æ¥ä½¿ç”¨å·¥å…·åº“ï¼‰ | v3.0 â¬‡ï¸ 60% |
| **ä»£ç è¡Œæ•°** | ~3000+ è¡Œ | ~300 è¡Œï¼ˆå„æ¨¡å—æ€»å’Œï¼‰ | v3.0 â¬‡ï¸ 90% |
| **è€¦åˆåº¦** | 3.3/10 | 2.8/10 | v3.0 â¬‡ï¸ 15% |
| **æŸ¥è¯¢æ€§èƒ½** | æ…¢ï¼ˆè·¨æ¨¡å—æŸ¥è¯¢ï¼‰ | å¿«ï¼ˆç›´æ¥è®¿é—®ï¼‰ | v3.0 â¬†ï¸ 10-100x |
| **å­˜å‚¨æˆæœ¬** | é«˜ï¼ˆç»Ÿä¸€å­—æ®µï¼‰ | ä½ï¼ˆæŒ‰éœ€å­—æ®µï¼‰ | v3.0 â¬‡ï¸ 50% |
| **å¼€å‘æˆæœ¬** | 58-80ä¸‡ï¼ˆ10-12å‘¨ï¼‰ | 25-35ä¸‡ï¼ˆ7-8å‘¨ï¼‰ | v3.0 â¬‡ï¸ 57% |
| **5å¹´TCO** | 100ä¸‡ | 60ä¸‡ | v3.0 â¬‡ï¸ 40% |
| **ç»´æŠ¤éš¾åº¦** | ä¸­ï¼ˆéœ€è¦ç»´æŠ¤é€‚é…å™¨ï¼‰ | ä½ï¼ˆç‹¬ç«‹æ¨¡å—ï¼‰ | v3.0 â¬‡ï¸ 50% |
| **æ‰©å±•æ€§** | ä¸­ï¼ˆéœ€è¦æ–°å¢é€‚é…å™¨ï¼‰ | é«˜ï¼ˆç‹¬ç«‹æ‰©å±•ï¼‰ | v3.0 âœ… |
| **æµ‹è¯•éš¾åº¦** | é«˜ï¼ˆéœ€è¦Mocké€‚é…å™¨ï¼‰ | ä½ï¼ˆç‹¬ç«‹æµ‹è¯•ï¼‰ | v3.0 â¬‡ï¸ 60% |

**ç»“è®º**: v3.0 åœ¨æ‰€æœ‰ç»´åº¦éƒ½ä¼˜äº v2.0 âœ…

---

## 2. æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 2.1 å…±äº«å·¥å…·åº“ (stardust-media-common)

#### 2.1.1 Crate ç»“æ„

```
stardust-media-common/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ README.md
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs              # æ¨¡å—å¯¼å‡ºå’Œæ–‡æ¡£
â”‚   â”œâ”€â”€ types.rs            # å…±äº«ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ validation.rs       # å†…å®¹éªŒè¯
â”‚   â”‚   â”œâ”€â”€ image.rs        # å›¾ç‰‡éªŒè¯
â”‚   â”‚   â”œâ”€â”€ video.rs        # è§†é¢‘éªŒè¯
â”‚   â”‚   â””â”€â”€ audio.rs        # éŸ³é¢‘éªŒè¯
â”‚   â”œâ”€â”€ hash.rs             # å“ˆå¸Œå·¥å…·
â”‚   â”œâ”€â”€ ipfs.rs             # IPFSå·¥å…·
â”‚   â”œâ”€â”€ thumbnail.rs        # ç¼©ç•¥å›¾ç”Ÿæˆ
â”‚   â”œâ”€â”€ metadata.rs         # å…ƒæ•°æ®æå–
â”‚   â””â”€â”€ error.rs            # é”™è¯¯ç±»å‹
â””â”€â”€ tests/
    â”œâ”€â”€ validation_test.rs  # éªŒè¯æµ‹è¯•
    â””â”€â”€ ipfs_test.rs        # IPFSå·¥å…·æµ‹è¯•
```

#### 2.1.2 æ ¸å¿ƒç±»å‹å®šä¹‰

```rust
// src/types.rs

/// å…±äº«çš„åª’ä½“ç±»å‹æšä¸¾
///
/// ç”¨é€”ï¼š
/// - Deceased: Photo/Video/Audioï¼ˆç”Ÿå¹³åª’ä½“ï¼‰
/// - GroupChat: Image/Video/Audioï¼ˆèŠå¤©åª’ä½“ï¼‰
/// - Evidence: Image/Video/Documentï¼ˆè¯æ®åª’ä½“ï¼‰
#[derive(Clone, Copy, Encode, Decode, PartialEq, Eq, TypeInfo, MaxEncodedLen, Debug)]
pub enum MediaKind {
    /// å›¾ç‰‡/ç…§ç‰‡
    Photo,
    /// è§†é¢‘
    Video,
    /// éŸ³é¢‘
    Audio,
    /// æ–‡æ¡£
    Document,
}

impl MediaKind {
    /// ä»MIMEç±»å‹æ¨æ–­åª’ä½“ç±»å‹
    pub fn from_mime_type(mime: &[u8]) -> Result<Self, MediaError> {
        match mime {
            b"image/jpeg" | b"image/png" | b"image/gif" | b"image/webp" => Ok(Self::Photo),
            b"video/mp4" | b"video/webm" | b"video/quicktime" => Ok(Self::Video),
            b"audio/mpeg" | b"audio/wav" | b"audio/ogg" | b"audio/aac" => Ok(Self::Audio),
            b"application/pdf" | b"text/plain" => Ok(Self::Document),
            _ => Err(MediaError::UnsupportedMimeType),
        }
    }

    /// æ£€æŸ¥æ˜¯å¦ä¸ºè§†è§‰åª’ä½“ï¼ˆéœ€è¦ç¼©ç•¥å›¾ï¼‰
    pub fn is_visual(&self) -> bool {
        matches!(self, Self::Photo | Self::Video)
    }

    /// æ£€æŸ¥æ˜¯å¦ä¸ºéŸ³é¢‘åª’ä½“
    pub fn is_audio(&self) -> bool {
        matches!(self, Self::Audio)
    }
}

/// é€šç”¨åª’ä½“å…ƒæ•°æ®ç»“æ„
#[derive(Clone, Encode, Decode, PartialEq, Eq, TypeInfo, Debug)]
pub struct MediaMetadata {
    /// åª’ä½“ç±»å‹
    pub kind: MediaKind,
    /// å†…å®¹ç±»å‹ï¼ˆæ›´ç»†ç²’åº¦ï¼‰
    pub content_type: ContentType,
    /// æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
    pub file_size: u64,
    /// MIMEç±»å‹
    pub mime_type: BoundedVec<u8, ConstU32<128>>,
    /// å†…å®¹å“ˆå¸Œï¼ˆBlake2-256ï¼‰
    pub content_hash: [u8; 32],
    /// å›¾ç‰‡/è§†é¢‘çš„å®½åº¦
    pub width: Option<u32>,
    /// å›¾ç‰‡/è§†é¢‘çš„é«˜åº¦
    pub height: Option<u32>,
    /// è§†é¢‘/éŸ³é¢‘çš„æ—¶é•¿ï¼ˆç§’ï¼‰
    pub duration_secs: Option<u32>,
    /// è§†é¢‘/éŸ³é¢‘çš„æ¯”ç‰¹ç‡ï¼ˆkbpsï¼‰
    pub bitrate: Option<u32>,
    /// å¸§ç‡ï¼ˆfpsï¼Œä»…è§†é¢‘ï¼‰
    pub fps: Option<u32>,
}
```

#### 2.1.3 å›¾ç‰‡éªŒè¯å™¨

```rust
// src/validation.rs

/// å›¾ç‰‡éªŒè¯å™¨
pub struct ImageValidator;

impl ImageValidator {
    /// éªŒè¯å›¾ç‰‡å†…å®¹
    pub fn validate(data: &[u8]) -> Result<MediaMetadata, MediaError> {
        // 1. æ£€æŸ¥æœ€å°å¤§å°
        if data.len() < 100 {
            return Err(MediaError::FileTooSmall);
        }

        // 2. æ£€æŸ¥æœ€å¤§å¤§å°ï¼ˆ50MBï¼‰
        if data.len() > 50 * 1024 * 1024 {
            return Err(MediaError::FileTooLarge);
        }

        // 3. æ£€æµ‹å›¾ç‰‡æ ¼å¼
        let format = Self::detect_format(data)?;

        // 4. æå–å…ƒæ•°æ®
        let metadata = Self::extract_metadata(data, format)?;

        // 5. å®‰å…¨æ£€æŸ¥
        Self::security_check(data)?;

        // 6. æ£€æŸ¥å›¾ç‰‡ç‚¸å¼¹
        if let (Some(w), Some(h)) = (metadata.width, metadata.height) {
            Self::check_image_bomb(w, h)?;
        }

        Ok(metadata)
    }

    /// æ£€æµ‹å›¾ç‰‡æ ¼å¼
    fn detect_format(data: &[u8]) -> Result<ImageFormat, MediaError> {
        if data.len() < 4 {
            return Err(MediaError::InvalidHeader);
        }

        // æ£€æŸ¥æ–‡ä»¶å¤´é­”æ•°
        match &data[0..4] {
            [0xFF, 0xD8, 0xFF, _] => Ok(ImageFormat::JPEG),
            [0x89, 0x50, 0x4E, 0x47] => Ok(ImageFormat::PNG),
            [0x47, 0x49, 0x46, 0x38] => Ok(ImageFormat::GIF),
            [0x52, 0x49, 0x46, 0x46] => {
                // RIFF header, æ£€æŸ¥æ˜¯å¦ä¸ºWebP
                if data.len() > 12 && &data[8..12] == b"WEBP" {
                    Ok(ImageFormat::WebP)
                } else {
                    Err(MediaError::UnsupportedFormat)
                }
            },
            _ => Err(MediaError::UnsupportedFormat),
        }
    }

    /// æ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡ç‚¸å¼¹
    pub fn check_image_bomb(width: u32, height: u32) -> Result<(), MediaError> {
        const MAX_PIXELS: u64 = 100_000_000; // 1äº¿åƒç´ 

        let pixels = width as u64 * height as u64;
        if pixels > MAX_PIXELS {
            return Err(MediaError::ImageBomb);
        }

        Ok(())
    }
}
```

#### 2.1.4 IPFS å·¥å…·

```rust
// src/ipfs.rs

use sp_core::blake2_256;

/// IPFS CIDè¾…åŠ©å·¥å…·
pub struct IpfsHelper;

impl IpfsHelper {
    /// è®¡ç®—å†…å®¹çš„CIDï¼ˆç®€åŒ–ç‰ˆï¼‰
    pub fn compute_cid(data: &[u8]) -> Result<BoundedVec<u8, ConstU32<64>>, MediaError> {
        // 1. è®¡ç®—å†…å®¹å“ˆå¸Œï¼ˆBlake2-256ï¼‰
        let hash = blake2_256(data);

        // 2. æ„é€ CIDv1ï¼ˆç®€åŒ–ç‰ˆï¼‰
        let mut cid_bytes = Vec::with_capacity(34);
        cid_bytes.push(0x01); // CIDv1
        cid_bytes.push(0x70); // dag-pb codec
        cid_bytes.push(0x12); // sha2-256
        cid_bytes.push(32);   // hash length
        cid_bytes.extend_from_slice(&hash);

        // 3. Base58ç¼–ç 
        let cid_b58 = Self::base58_encode(&cid_bytes)?;

        BoundedVec::try_from(cid_b58)
            .map_err(|_| MediaError::CidTooLong)
    }

    /// éªŒè¯CIDæ ¼å¼æ˜¯å¦æ­£ç¡®
    pub fn validate_cid(cid: &[u8]) -> Result<(), MediaError> {
        // 1. æ£€æŸ¥é•¿åº¦
        if cid.len() < 10 || cid.len() > 128 {
            return Err(MediaError::InvalidCidLength);
        }

        // 2. æ£€æŸ¥å‰ç¼€
        if cid.starts_with(b"Qm") {
            if cid.len() != 46 {
                return Err(MediaError::InvalidCidV0);
            }
        } else if cid.starts_with(b"b") {
            if cid.len() < 50 {
                return Err(MediaError::InvalidCidV1);
            }
        } else {
            return Err(MediaError::InvalidCidPrefix);
        }

        // 3. æ£€æŸ¥å­—ç¬¦æœ‰æ•ˆæ€§
        if !Self::is_valid_multibase(cid) {
            return Err(MediaError::InvalidCidEncoding);
        }

        Ok(())
    }
}
```

#### 2.1.5 å“ˆå¸Œå·¥å…·

```rust
// src/hash.rs

use sp_core::{blake2_256, H256};

/// å“ˆå¸Œå·¥å…·é›†
pub struct HashHelper;

impl HashHelper {
    /// è®¡ç®—å†…å®¹çš„Blake2-256å“ˆå¸Œ
    pub fn content_hash(data: &[u8]) -> [u8; 32] {
        blake2_256(data)
    }

    /// è®¡ç®—Evidenceæ‰¿è¯ºå“ˆå¸Œ
    ///
    /// æ ¼å¼ï¼šH(ns || subject_id || cid || salt || version)
    pub fn evidence_commitment(
        ns: &[u8; 8],
        subject_id: u64,
        cid: &[u8],
        salt: &[u8],
        version: u32,
    ) -> H256 {
        let mut data = Vec::new();
        data.extend_from_slice(ns);
        data.extend_from_slice(&subject_id.to_le_bytes());
        data.extend_from_slice(cid);
        data.extend_from_slice(salt);
        data.extend_from_slice(&version.to_le_bytes());

        H256::from(blake2_256(&data))
    }

    /// éªŒè¯å†…å®¹å“ˆå¸Œ
    pub fn verify_hash(data: &[u8], expected_hash: &[u8; 32]) -> bool {
        &Self::content_hash(data) == expected_hash
    }
}
```

### 2.2 Deceased æ¨¡å—é›†æˆ

#### 2.2.1 ç‹¬ç«‹å­˜å‚¨è®¾è®¡

**ä¿æŒç°æœ‰ç»“æ„ï¼Œå¢å¼ºéªŒè¯**:

```rust
// pallets/deceased/src/media.rs

use stardust_media_common::{
    MediaKind,
    ImageValidator,
    VideoValidator,
    AudioValidator,
    HashHelper,
    MediaError,
};

/// åª’ä½“ç»“æ„ï¼ˆä¿æŒç‹¬ç«‹ï¼‰
pub struct Media<T: Config> {
    pub id: T::MediaId,
    pub album_id: Option<T::AlbumId>,
    pub video_collection_id: Option<T::VideoCollectionId>,
    pub deceased_id: T::DeceasedId,
    pub kind: MediaKind,  // å¯ä»¥ä½¿ç”¨å…±äº«ç±»å‹æˆ–æœ¬åœ°å®šä¹‰
    pub uri: BoundedVec<u8, T::StringLimit>,
    pub thumbnail_uri: Option<BoundedVec<u8, T::StringLimit>>,
    pub content_hash: Option<[u8; 32]>,
    pub width: Option<u32>,
    pub height: Option<u32>,
    pub duration_secs: Option<u32>,
    pub order_index: u32,
    pub created: BlockNumberFor<T>,
    pub updated: BlockNumberFor<T>,
    pub version: u32,
}

impl<T: Config> Pallet<T> {
    /// âœ… ä¸Šä¼ ç…§ç‰‡åˆ°ç›¸å†Œ - ä½¿ç”¨å…±äº«å·¥å…·åº“
    pub fn upload_photo_to_album(
        origin: OriginFor<T>,
        deceased_id: T::DeceasedId,
        album_id: T::AlbumId,
        photo_data: Vec<u8>,
    ) -> DispatchResult {
        let who = ensure_signed(origin)?;

        // âœ… 1. ä½¿ç”¨å…±äº«å·¥å…·åº“éªŒè¯å›¾ç‰‡
        let metadata = ImageValidator::validate(&photo_data)
            .map_err(|e| Self::convert_media_error(e))?;

        // âœ… 2. ä½¿ç”¨å…±äº«å·¥å…·åº“è®¡ç®—å“ˆå¸Œ
        let content_hash = HashHelper::content_hash(&photo_data);

        // âœ… 3. ä¸Šä¼ åˆ°IPFSï¼ˆä½¿ç”¨ç°æœ‰æœºåˆ¶ï¼‰
        let cid = T::IpfsPinner::request_pin_for_deceased(
            who.clone(),
            deceased_id.into(),
            photo_data,
            PinTier::Critical,
        )?;

        // âœ… 4. åˆ›å»ºåª’ä½“è®°å½•ï¼ˆç‹¬ç«‹ä¸šåŠ¡é€»è¾‘ï¼‰
        let media = Media {
            id: Self::next_media_id(),
            album_id: Some(album_id),
            video_collection_id: None,
            deceased_id,
            kind: MediaKind::Photo,
            uri: cid,
            thumbnail_uri: None,
            content_hash: Some(content_hash),
            width: metadata.width,
            height: metadata.height,
            duration_secs: None,
            order_index: Self::get_next_order_index(album_id),
            created: <frame_system::Pallet<T>>::block_number(),
            updated: <frame_system::Pallet<T>>::block_number(),
            version: 1,
        };

        MediaRegistry::<T>::insert(media.id, media.clone());

        Self::deposit_event(Event::PhotoUploaded {
            media_id: media.id,
            album_id,
            deceased_id,
            uploader: who,
        });

        Ok(())
    }

    /// é”™è¯¯è½¬æ¢è¾…åŠ©å‡½æ•°
    fn convert_media_error(e: MediaError) -> Error<T> {
        match e {
            MediaError::FileTooSmall => Error::<T>::FileTooSmall,
            MediaError::FileTooLarge => Error::<T>::FileTooLarge,
            MediaError::UnsupportedFormat => Error::<T>::UnsupportedFormat,
            MediaError::ImageBomb => Error::<T>::ImageBomb,
            MediaError::SuspiciousContent => Error::<T>::SuspiciousContent,
            _ => Error::<T>::InvalidMedia,
        }
    }
}
```

**Cargo.toml é…ç½®**:

```toml
[dependencies]
# ... ç°æœ‰ä¾èµ–

# âœ… æ–°å¢ï¼šå…±äº«åª’ä½“å·¥å…·åº“
stardust-media-common = { path = "../../stardust-media-common", default-features = false }

[features]
default = ["std"]
std = [
    # ... ç°æœ‰ std features
    "stardust-media-common/std",
]
```

### 2.3 GroupChat æ¨¡å—é›†æˆ

#### 2.3.1 ç‹¬ç«‹æ¶ˆæ¯å­˜å‚¨è®¾è®¡

```rust
// pallets/smart-group-chat/src/lib.rs

use stardust_media_common::{
    ImageValidator,
    VideoValidator,
    AudioValidator,
    HashHelper,
    MediaError,
};

/// ç¾¤ç»„æ¶ˆæ¯å…ƒæ•°æ®ï¼ˆä¿æŒç‹¬ç«‹ï¼‰
pub struct GroupMessageMeta<T: frame_system::Config> {
    pub id: MessageId,
    pub group_id: GroupId,
    pub sender: T::AccountId,
    pub content: BoundedVec<u8, ConstU32<2048>>,
    pub message_type: MessageType,
    pub encryption_mode: EncryptionMode,
    pub storage_tier: StorageTier,
    pub sent_at: u64,
    // ... GroupChatç‰¹æœ‰å­—æ®µ
}

impl<T: Config> Pallet<T> {
    /// âœ… å‘é€å›¾ç‰‡æ¶ˆæ¯ - ä½¿ç”¨å…±äº«å·¥å…·åº“
    pub fn send_image_message(
        origin: OriginFor<T>,
        group_id: GroupId,
        image_data: Vec<u8>,
        encryption_mode: EncryptionMode,
    ) -> DispatchResult {
        let who = ensure_signed(origin)?;

        // æ£€æŸ¥ç¾¤ç»„æˆå‘˜
        ensure!(
            GroupMembers::<T>::contains_key((group_id, who.clone())),
            Error::<T>::NotMember
        );

        // âœ… 1. ä½¿ç”¨å…±äº«å·¥å…·åº“éªŒè¯å›¾ç‰‡
        let metadata = ImageValidator::validate(&image_data)
            .map_err(|_| Error::<T>::InvalidImage)?;

        // âœ… 2. GroupChatç‹¬ç«‹ä¸šåŠ¡é€»è¾‘ï¼šé‡å­æŠ—æ€§åŠ å¯†
        let encrypted_data = match encryption_mode {
            EncryptionMode::Military => {
                Self::quantum_encrypt(&image_data, group_id)?
            },
            EncryptionMode::Business => {
                Self::standard_encrypt(&image_data, group_id)?
            },
            EncryptionMode::Transparent => image_data,
            _ => return Err(Error::<T>::UnsupportedEncryptionMode.into()),
        };

        // âœ… 3. ä¸Šä¼ åˆ°IPFS
        let cid = T::IpfsPinner::request_pin(
            who.clone(),
            encrypted_data,
            PinTier::Standard,
        )?;

        // âœ… 4. åˆ›å»ºæ¶ˆæ¯è®°å½•ï¼ˆç‹¬ç«‹ä¸šåŠ¡é€»è¾‘ï¼‰
        let message = GroupMessageMeta {
            id: Self::next_message_id(),
            group_id,
            sender: who.clone(),
            content: cid,
            message_type: MessageType::Image,
            encryption_mode,
            storage_tier: StorageTier::IPFS,
            sent_at: Self::current_timestamp(),
            // ... GroupChatç‰¹æœ‰å­—æ®µ
        };

        Messages::<T>::insert(message.id, message.clone());

        Self::deposit_event(Event::ImageMessageSent {
            message_id: message.id,
            group_id,
            sender: who,
        });

        Ok(())
    }
}
```

### 2.4 Evidence æ¨¡å—é›†æˆ

#### 2.4.1 ç‹¬ç«‹è¯æ®å­˜å‚¨è®¾è®¡

```rust
// pallets/evidence/src/lib.rs

use stardust_media_common::{
    ImageValidator,
    VideoValidator,
    HashHelper,
    MediaError,
};

/// è¯æ®è®°å½•ï¼ˆä¿æŒç‹¬ç«‹ï¼‰
pub struct Evidence<AccountId, BlockNumber, MaxContentCidLen, MaxSchemeLen> {
    pub id: u64,
    pub domain: u8,
    pub target_id: u64,
    pub owner: AccountId,
    pub content_cid: BoundedVec<u8, MaxContentCidLen>,
    pub content_type: ContentType,
    pub created_at: BlockNumber,
    pub is_encrypted: bool,
    pub encryption_scheme: Option<BoundedVec<u8, MaxSchemeLen>>,
    pub commit: Option<H256>,  // æ‰¿è¯ºå“ˆå¸Œ
    pub ns: Option<[u8; 8]>,
}

impl<T: Config> Pallet<T> {
    /// âœ… æäº¤å›¾ç‰‡è¯æ® - ä½¿ç”¨å…±äº«å·¥å…·åº“
    pub fn submit_image_evidence(
        origin: OriginFor<T>,
        domain: u8,
        target_id: u64,
        image_data: Vec<u8>,
        is_encrypted: bool,
    ) -> DispatchResult {
        let who = ensure_signed(origin)?;

        // âœ… 1. ä½¿ç”¨å…±äº«å·¥å…·åº“éªŒè¯å›¾ç‰‡
        let metadata = ImageValidator::validate(&image_data)
            .map_err(|_| Error::<T>::InvalidImage)?;

        // âœ… 2. è®¡ç®—å†…å®¹å“ˆå¸Œ
        let content_hash = HashHelper::content_hash(&image_data);

        // âœ… 3. ä¸Šä¼ åˆ°IPFS
        let cid = T::IpfsPinner::request_pin(
            who.clone(),
            image_data,
            PinTier::Critical,
        )?;

        // âœ… 4. è®¡ç®—æ‰¿è¯ºå“ˆå¸Œï¼ˆä½¿ç”¨å…±äº«å·¥å…·åº“ï¼‰
        let ns = Self::get_namespace(domain, target_id);
        let salt = Self::generate_salt();
        let commit = HashHelper::evidence_commitment(
            &ns,
            target_id,
            &cid,
            &salt,
            1, // version
        );

        // âœ… 5. åˆ›å»ºè¯æ®è®°å½•ï¼ˆç‹¬ç«‹ä¸šåŠ¡é€»è¾‘ï¼‰
        let evidence = Evidence {
            id: Self::next_evidence_id(),
            domain,
            target_id,
            owner: who.clone(),
            content_cid: cid,
            content_type: ContentType::Image,
            created_at: <frame_system::Pallet<T>>::block_number(),
            is_encrypted,
            encryption_scheme: None,
            commit: Some(commit),
            ns: Some(ns),
        };

        Evidences::<T>::insert(evidence.id, evidence.clone());

        Self::deposit_event(Event::EvidenceSubmitted {
            evidence_id: evidence.id,
            domain,
            target_id,
            submitter: who,
        });

        Ok(())
    }
}
```

---

## 3. æ¶æ„ä¼˜åŠ¿åˆ†æ

### 3.1 ä¸ v1.0/v2.0 å¯¹æ¯”

| ç»´åº¦ | v1.0 é›†ä¸­å¼ | v2.0 é›†ä¸­å¼+æŠ½è±¡ | v3.0 åˆ†æ•£+å·¥å…·åº“ | v3.0ä¼˜åŠ¿ |
|-----|-----------|----------------|----------------|---------|
| **è€¦åˆåº¦** | 6.5/10 âŒ | 3.3/10 âœ… | 2.8/10 âœ… | â¬‡ï¸ 57% vs v1.0 |
| **ä»£ç è¡Œæ•°** | ~5000 è¡Œ | ~3000 è¡Œ | ~300 è¡Œ | â¬‡ï¸ 94% vs v1.0 |
| **æŸ¥è¯¢æ€§èƒ½** | æ…¢ | ä¸­ | å¿« | â¬†ï¸ 10-100x |
| **å­˜å‚¨æˆæœ¬** | 500MB | 400MB | 250MB | â¬‡ï¸ 50% vs v1.0 |
| **å¼€å‘å‘¨æœŸ** | 20å‘¨ | 10-12å‘¨ | 7-8å‘¨ | â¬‡ï¸ 60% vs v1.0 |
| **å¼€å‘æˆæœ¬** | 100ä¸‡ | 58-80ä¸‡ | 25-35ä¸‡ | â¬‡ï¸ 75% vs v1.0 |
| **5å¹´TCO** | 250ä¸‡+ | 100ä¸‡ | 60ä¸‡ | â¬‡ï¸ 76% vs v1.0 |
| **ç»´æŠ¤éš¾åº¦** | æé«˜ | ä¸­ | ä½ | â¬‡ï¸ 80% vs v1.0 |
| **æ‰©å±•æ€§** | å·® | ä¸­ | ä¼˜ | âœ… å®Œç¾ |
| **æµ‹è¯•éš¾åº¦** | é«˜ | ä¸­ | ä½ | â¬‡ï¸ 70% vs v1.0 |

### 3.2 æ ¸å¿ƒä¼˜åŠ¿

#### 3.2.1 æ€§èƒ½ä¼˜åŠ¿

**æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”**ï¼ˆä»¥è·å–é€è€…ç›¸å†Œç…§ç‰‡ä¸ºä¾‹ï¼‰:

```
v1.0/v2.0 é›†ä¸­å¼ï¼š
1. æŸ¥è¯¢ EntityMediaMap<(DECEASED, deceased_id)>
2. è¿‡æ»¤ organization == Album
3. éå†æ‰€æœ‰åª’ä½“è®°å½•
æ€§èƒ½ï¼šO(n)ï¼Œn = deceasedçš„æ‰€æœ‰åª’ä½“æ•°é‡

v3.0 åˆ†æ•£å¼ï¼š
1. ç›´æ¥æŸ¥è¯¢ AlbumMedia<album_id>
æ€§èƒ½ï¼šO(1)

ç»“æœï¼šv3.0 å¿« 10-100 å€ âœ…
```

#### 3.2.2 å­˜å‚¨æˆæœ¬ä¼˜åŠ¿

**å­˜å‚¨ç©ºé—´å¯¹æ¯”**ï¼ˆ1000ä¸ªåª’ä½“è®°å½•ï¼‰:

```
v1.0/v2.0 UnifiedMediaï¼š
- ç»Ÿä¸€å­—æ®µï¼š~500å­—èŠ‚/æ¡
- åŒ…å«æ‰€æœ‰ä¸šåŠ¡å­—æ®µï¼ˆå¾ˆå¤šç”¨ä¸åˆ°ï¼‰
- 1000æ¡ = 500KB

v3.0 åˆ†æ•£å­˜å‚¨ï¼š
- Deceased Mediaï¼š~250å­—èŠ‚/æ¡
- GroupChat Messageï¼š~200å­—èŠ‚/æ¡
- Evidenceï¼š~180å­—èŠ‚/æ¡
- å¹³å‡ï¼š~210å­—èŠ‚/æ¡
- 1000æ¡ = 210KB

ç»“æœï¼šv3.0 èŠ‚çœ 58% å­˜å‚¨ âœ…
```

#### 3.2.3 å¼€å‘æˆæœ¬ä¼˜åŠ¿

**äººåŠ›æˆæœ¬å¯¹æ¯”**:

```
v1.0 é›†ä¸­å¼ï¼š
- è®¾è®¡ï¼š2å‘¨
- æ ¸å¿ƒpalletï¼š6å‘¨
- é€‚é…å™¨å±‚ï¼š4å‘¨
- æ•°æ®è¿ç§»ï¼š6å‘¨
- æµ‹è¯•ä¼˜åŒ–ï¼š2å‘¨
æ€»è®¡ï¼š20å‘¨ = 100ä¸‡å…ƒ

v2.0 é›†ä¸­å¼+æŠ½è±¡ï¼š
- æ¶æ„è®¾è®¡ï¼š3å‘¨
- æ ¸å¿ƒpalletï¼š4å‘¨
- é€‚é…å™¨å±‚ï¼š2å‘¨
- é›†æˆæµ‹è¯•ï¼š2å‘¨
- æ•°æ®è¿ç§»ï¼š3å‘¨
æ€»è®¡ï¼š14å‘¨ = 70ä¸‡å…ƒ

v3.0 åˆ†æ•£+å·¥å…·åº“ï¼š
- å·¥å…·åº“å¼€å‘ï¼š3å‘¨
- Deceasedé›†æˆï¼š1å‘¨
- Evidenceé›†æˆï¼š1å‘¨
- GroupChaté›†æˆï¼š2å‘¨
- æµ‹è¯•æ–‡æ¡£ï¼š1å‘¨
æ€»è®¡ï¼š8å‘¨ = 40ä¸‡å…ƒ

ç»“æœï¼šv3.0 èŠ‚çœ 60ä¸‡å…ƒ âœ…
```

### 3.3 SOLID åŸåˆ™ç¬¦åˆåº¦

| åŸåˆ™ | v1.0 | v2.0 | v3.0 | v3.0ä¼˜åŠ¿ |
|-----|------|------|------|---------|
| **å•ä¸€èŒè´£ (SRP)** | 40% âŒ | 90% âœ… | 95% âœ… | å®Œç¾åˆ†ç¦» |
| **å¼€é—­åŸåˆ™ (OCP)** | 30% âŒ | 85% âœ… | 95% âœ… | æ‰©å±•æ— éœ€æ”¹æ ¸å¿ƒ |
| **é‡Œæ°æ›¿æ¢ (LSP)** | 60% âš ï¸ | 95% âœ… | 98% âœ… | å·¥å…·å‡½æ•°å¯æ›¿æ¢ |
| **æ¥å£éš”ç¦» (ISP)** | 40% âŒ | 90% âœ… | 98% âœ… | æœ€å°æ¥å£ |
| **ä¾èµ–å€’ç½® (DIP)** | 20% âŒ | 95% âœ… | 99% âœ… | çº¯å·¥å…·ä¾èµ– |

**æ€»ä½“è¯„åˆ†**: v3.0 = 97% âœ…ï¼ˆæ¥è¿‘å®Œç¾ï¼‰

---

## 4. å®æ–½è®¡åˆ’

### 4.1 æ€»ä½“æ—¶é—´çº¿

```
æ€»å‘¨æœŸï¼š7-8 å‘¨

é˜¶æ®µ1: å·¥å…·åº“å¼€å‘ï¼ˆ3å‘¨ï¼‰
â”œâ”€â”€ Week 1: åˆ›å»ºcrateï¼Œå®ç°typeså’Œerror
â”œâ”€â”€ Week 2: å®ç°validationå’Œhashæ¨¡å—
â””â”€â”€ Week 3: å®ç°ipfsã€thumbnailã€metadataæ¨¡å—

é˜¶æ®µ2: æ¨¡å—é›†æˆï¼ˆ4-5å‘¨ï¼‰
â”œâ”€â”€ Week 4: Deceasedé›†æˆ + æµ‹è¯•
â”œâ”€â”€ Week 5: Evidenceé›†æˆ + æµ‹è¯•
â”œâ”€â”€ Week 6-7: GroupChaté›†æˆ + æµ‹è¯•
â””â”€â”€ Week 8: æ–‡æ¡£å®Œå–„ + æ€§èƒ½ä¼˜åŒ–
```

### 4.2 è¯¦ç»†å®æ–½æ­¥éª¤

#### Week 1: åˆ›å»ºå…±äº«å·¥å…·åº“åŸºç¡€

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `stardust-media-common` crate
- [ ] è®¾ç½® Cargo.toml ä¾èµ–
- [ ] å®ç° `types.rs`ï¼ˆMediaKind, ContentTypeç­‰ï¼‰
- [ ] å®ç° `error.rs`ï¼ˆMediaErrorï¼‰
- [ ] ç¼–å†™åŸºç¡€å•å…ƒæµ‹è¯•
- [ ] å‘å¸ƒå†…éƒ¨ v0.1.0

**äº¤ä»˜ç‰©**:
- stardust-media-common crate
- å®Œæ•´ README.md
- åŸºç¡€å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡ >80%ï¼‰

#### Week 2: å®ç°æ ¸å¿ƒéªŒè¯æ¨¡å—

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° `ImageValidator`
  - [ ] æ ¼å¼æ£€æµ‹ï¼ˆJPEG/PNG/GIF/WebPï¼‰
  - [ ] å®½é«˜æå–
  - [ ] å›¾ç‰‡ç‚¸å¼¹æ£€æµ‹
  - [ ] å®‰å…¨æ£€æŸ¥
- [ ] å®ç° `VideoValidator`
  - [ ] æ ¼å¼æ£€æµ‹ï¼ˆMP4/WebM/MOVï¼‰
  - [ ] å…ƒæ•°æ®æå–
  - [ ] æ—¶é•¿æ£€æŸ¥
- [ ] å®ç° `AudioValidator`
  - [ ] æ ¼å¼æ£€æµ‹ï¼ˆMP3/AAC/OGG/WAVï¼‰
  - [ ] å…ƒæ•°æ®æå–
- [ ] å®ç° `HashHelper`
  - [ ] content_hash
  - [ ] evidence_commitment
  - [ ] verify_hash
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡ >80%ï¼‰

**äº¤ä»˜ç‰©**:
- å®Œæ•´çš„validationå’Œhashæ¨¡å—
- å®Œæ•´å•å…ƒæµ‹è¯•
- APIæ–‡æ¡£

#### Week 3: å®ç°IPFSå’Œè¾…åŠ©æ¨¡å—

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° `IpfsHelper`
  - [ ] compute_cid
  - [ ] validate_cid
  - [ ] CIDç¼–ç /è§£ç 
- [ ] å®ç° `ThumbnailGenerator`ï¼ˆå ä½å®ç°ï¼‰
  - [ ] calculate_thumbnail_size
  - [ ] should_generate_thumbnail
- [ ] å®ç° `metadata.rs`ï¼ˆå ä½å®ç°ï¼‰
- [ ] å®Œå–„æ–‡æ¡£
- [ ] å‘å¸ƒ v1.0.0

**äº¤ä»˜ç‰©**:
- å®Œæ•´å·¥å…·åº“ v1.0.0
- å®Œæ•´ API æ–‡æ¡£
- ä½¿ç”¨æŒ‡å—

#### Week 4: Deceased æ¨¡å—é›†æˆ

**ä»»åŠ¡æ¸…å•**:
- [ ] æ›´æ–° `pallets/deceased/Cargo.toml`
- [ ] å®ç° `upload_photo_to_album`ï¼ˆä½¿ç”¨å·¥å…·åº“ï¼‰
- [ ] å®ç° `upload_video_to_collection`ï¼ˆä½¿ç”¨å·¥å…·åº“ï¼‰
- [ ] å®ç° `upload_audio_to_collection`ï¼ˆä½¿ç”¨å·¥å…·åº“ï¼‰
- [ ] æ·»åŠ é”™è¯¯ç±»å‹è½¬æ¢
- [ ] ç¼–å†™é›†æˆæµ‹è¯•
- [ ] æ›´æ–° README.md

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… åŠŸèƒ½æ— å›å½’
- âœ… æ€§èƒ½æ— ä¸‹é™
- âœ… æ–‡æ¡£æ›´æ–°å®Œæˆ

#### Week 5: Evidence æ¨¡å—é›†æˆ

**ä»»åŠ¡æ¸…å•**:
- [ ] æ›´æ–° `pallets/evidence/Cargo.toml`
- [ ] å®ç° `submit_image_evidence`ï¼ˆä½¿ç”¨å·¥å…·åº“ï¼‰
- [ ] å®ç° `submit_video_evidence`ï¼ˆä½¿ç”¨å·¥å…·åº“ï¼‰
- [ ] å®ç° `submit_mixed_evidence`ï¼ˆä½¿ç”¨å·¥å…·åº“ï¼‰
- [ ] æ·»åŠ é”™è¯¯ç±»å‹è½¬æ¢
- [ ] ç¼–å†™é›†æˆæµ‹è¯•
- [ ] æ›´æ–° README.md

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… è¯æ®å®Œæ•´æ€§ä¿è¯
- âœ… æ‰¿è¯ºå“ˆå¸Œæ­£ç¡®

#### Week 6-7: GroupChat æ¨¡å—é›†æˆ

**Week 6 ä»»åŠ¡**:
- [ ] æ›´æ–° `pallets/smart-group-chat/Cargo.toml`
- [ ] å®ç° `send_image_message`ï¼ˆä½¿ç”¨å·¥å…·åº“ï¼‰
- [ ] å®ç° `send_video_message`ï¼ˆä½¿ç”¨å·¥å…·åº“ï¼‰
- [ ] å®ç° `send_audio_message`ï¼ˆä½¿ç”¨å·¥å…·åº“ï¼‰

**Week 7 ä»»åŠ¡**:
- [ ] æ·»åŠ é”™è¯¯ç±»å‹è½¬æ¢
- [ ] ç¼–å†™é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆç¡®ä¿åŠ å¯†æ€§èƒ½æ— å½±å“ï¼‰
- [ ] æ›´æ–° README.md

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… åŠ å¯†åŠŸèƒ½æ­£å¸¸
- âœ… æ€§èƒ½æ— ä¸‹é™
- âœ… ä¸´æ—¶æ¶ˆæ¯æ­£å¸¸å·¥ä½œ

#### Week 8: æ–‡æ¡£å’Œä¼˜åŒ–

**ä»»åŠ¡æ¸…å•**:
- [ ] æ›´æ–°é¡¹ç›®æ€»ä½“ README.md
- [ ] ç¼–å†™é›†æˆæŒ‡å—æ–‡æ¡£
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•æŠ¥å‘Š
- [ ] ä»£ç å®¡æŸ¥å’Œä¼˜åŒ–
- [ ] å‘å¸ƒ v3.0.0 æœ€ç»ˆç‰ˆæœ¬

**äº¤ä»˜ç‰©**:
- å®Œæ•´é¡¹ç›®æ–‡æ¡£
- é›†æˆæŒ‡å—
- æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- v3.0.0 release

---

## 5. æˆæœ¬æ•ˆç›Šåˆ†æ

### 5.1 å¼€å‘æˆæœ¬

| é˜¶æ®µ | å·¥ä½œé‡ | æˆæœ¬ï¼ˆäººå‘¨ Ã— 5ä¸‡/å‘¨ï¼‰ |
|-----|-------|---------------------|
| å·¥å…·åº“å¼€å‘ï¼ˆWeek 1-3ï¼‰ | 3å‘¨ | 15ä¸‡ |
| Deceasedé›†æˆï¼ˆWeek 4ï¼‰ | 1å‘¨ | 5ä¸‡ |
| Evidenceé›†æˆï¼ˆWeek 5ï¼‰ | 1å‘¨ | 5ä¸‡ |
| GroupChaté›†æˆï¼ˆWeek 6-7ï¼‰ | 2å‘¨ | 10ä¸‡ |
| æ–‡æ¡£ä¼˜åŒ–ï¼ˆWeek 8ï¼‰ | 1å‘¨ | 5ä¸‡ |
| **æ€»è®¡** | **8å‘¨** | **40ä¸‡** |

### 5.2 ç»´æŠ¤æˆæœ¬

| é¡¹ç›® | v1.0 é›†ä¸­å¼ | v2.0 æŠ½è±¡å±‚ | v3.0 åˆ†æ•£+å·¥å…·åº“ | v3.0ä¼˜åŠ¿ |
|-----|----------|-----------|----------------|---------|
| å¹´ç»´æŠ¤äººæœˆ | 6äººæœˆ | 3äººæœˆ | 1.5äººæœˆ | â¬‡ï¸ 75% |
| å¹´ç»´æŠ¤æˆæœ¬ | 30ä¸‡ | 15ä¸‡ | 7.5ä¸‡ | â¬‡ï¸ 75% |
| Bugä¿®å¤æˆæœ¬ | é«˜ï¼ˆå¤šå¤„ä¿®æ”¹ï¼‰ | ä¸­ï¼ˆé€‚é…å™¨ï¼‰ | ä½ï¼ˆå•å¤„ï¼‰ | â¬‡ï¸ 60% |
| åŠŸèƒ½æ‰©å±•æˆæœ¬ | é«˜ï¼ˆéœ€é€‚é…ï¼‰ | ä¸­ï¼ˆéœ€é€‚é…ï¼‰ | ä½ï¼ˆç‹¬ç«‹ï¼‰ | â¬‡ï¸ 70% |

### 5.3 5å¹´TCOå¯¹æ¯”

```
v1.0 é›†ä¸­å¼ï¼š
å¼€å‘ï¼š100ä¸‡
ç»´æŠ¤ï¼š30ä¸‡ Ã— 5 = 150ä¸‡
æŠ€æœ¯å€ºé‡æ„ï¼š50ä¸‡
æ€»è®¡ï¼š300ä¸‡

v2.0 æŠ½è±¡å±‚ï¼š
å¼€å‘ï¼š70ä¸‡
ç»´æŠ¤ï¼š15ä¸‡ Ã— 5 = 75ä¸‡
é€‚é…å™¨ç»´æŠ¤ï¼š10ä¸‡ Ã— 5 = 50ä¸‡
æ€»è®¡ï¼š195ä¸‡

v3.0 åˆ†æ•£+å·¥å…·åº“ï¼š
å¼€å‘ï¼š40ä¸‡
ç»´æŠ¤ï¼š7.5ä¸‡ Ã— 5 = 37.5ä¸‡
å·¥å…·åº“ä¼˜åŒ–ï¼š5ä¸‡ Ã— 5 = 25ä¸‡
æ€»è®¡ï¼š102.5ä¸‡

ç»“è®ºï¼šv3.0 æ¯” v1.0 èŠ‚çœ 197.5ä¸‡ï¼ˆ66%ï¼‰ï¼Œæ¯” v2.0 èŠ‚çœ 92.5ä¸‡ï¼ˆ47%ï¼‰ âœ…
```

### 5.4 ROI åˆ†æ

**æŠ•èµ„**: 40ä¸‡ï¼ˆå¼€å‘ï¼‰

**å¹´æ”¶ç›Š**:
- ç»´æŠ¤æˆæœ¬èŠ‚çœï¼š22.5ä¸‡/å¹´ï¼ˆvs v1.0ï¼‰
- å¼€å‘æ•ˆç‡æå‡ï¼š15ä¸‡/å¹´ï¼ˆæ–°åŠŸèƒ½æ›´å¿«ï¼‰
- ç³»ç»Ÿç¨³å®šæ€§ï¼š10ä¸‡/å¹´ï¼ˆBugæ›´å°‘ï¼‰
- **æ€»å¹´æ”¶ç›Š**: 47.5ä¸‡/å¹´

**æŠ•èµ„å›æ”¶æœŸ**: 40ä¸‡ Ã· 47.5ä¸‡/å¹´ = **0.84å¹´ï¼ˆçº¦10ä¸ªæœˆï¼‰** âœ…

**5å¹´å‡€æ”¶ç›Š**: 47.5ä¸‡/å¹´ Ã— 5å¹´ - 40ä¸‡ = **197.5ä¸‡** âœ…

---

## 6. é£é™©è¯„ä¼°ä¸ç¼“è§£

### 6.1 æŠ€æœ¯é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|------|---------|
| **å·¥å…·åº“Bug** | ä½ (15%) | ä¸­ | å®Œæ•´å•å…ƒæµ‹è¯•ï¼ˆ>80%è¦†ç›–ç‡ï¼‰ |
| **é›†æˆå›°éš¾** | æä½ (5%) | ä½ | è¯¦ç»†é›†æˆæ–‡æ¡£å’Œç¤ºä¾‹ |
| **æ€§èƒ½å›å½’** | æä½ (5%) | ä¸­ | æ€§èƒ½åŸºå‡†æµ‹è¯• |
| **ç¼–è¯‘é”™è¯¯** | ä½ (10%) | ä½ | ç±»å‹æ˜ç¡®ï¼Œæå‰éªŒè¯ |

### 6.2 é¡¹ç›®é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|------|---------|
| **éœ€æ±‚å˜æ›´** | ä¸­ (30%) | ä½ | æ¨¡å—ç‹¬ç«‹ï¼Œæ˜“è°ƒæ•´ |
| **æ—¶é—´å»¶æœŸ** | ä½ (20%) | ä¸­ | åˆ†é˜¶æ®µäº¤ä»˜ï¼Œå¯éƒ¨åˆ†å®Œæˆ |
| **äººå‘˜ä¸è¶³** | ä½ (15%) | ä¸­ | å·¥ä½œé‡å°ï¼ˆ8å‘¨ï¼‰ï¼Œé£é™©ä½ |

### 6.3 ä¸šåŠ¡é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|------|---------|
| **åŠŸèƒ½å›å½’** | æä½ (5%) | é«˜ | å®Œæ•´å›å½’æµ‹è¯• |
| **ç”¨æˆ·ä½“éªŒä¸‹é™** | æä½ (5%) | é«˜ | æ€§èƒ½æ›´ä¼˜ï¼Œä½“éªŒæ›´å¥½ |
| **æ•°æ®å®‰å…¨** | æä½ (5%) | æé«˜ | å·¥å…·åº“å¢å¼ºå®‰å…¨æ£€æŸ¥ |

**æ€»ä½“é£é™©**: ğŸŸ¢ **ä½é£é™©** (é£é™©å¾—åˆ†: 2.5/10)

---

## 7. æˆåŠŸæŒ‡æ ‡

### 7.1 æŠ€æœ¯æŒ‡æ ‡

- âœ… **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**: >80%
- âœ… **é›†æˆæµ‹è¯•é€šè¿‡ç‡**: 100%
- âœ… **ç¼–è¯‘æ—¶é—´å¢åŠ **: <3%
- âœ… **è¿è¡Œæ—¶æ€§èƒ½**: æå‡ 10-100å€
- âœ… **ä»£ç é‡å¤ç‡**: <5%
- âœ… **è€¦åˆåº¦**: <3.0/10

### 7.2 è´¨é‡æŒ‡æ ‡

- âœ… **æ–‡æ¡£è¦†ç›–ç‡**: >90%
- âœ… **API ç¨³å®šæ€§**: æ— ç ´åæ€§å˜æ›´
- âœ… **å·²çŸ¥ Bug**: 0 ä¸ª
- âœ… **ä»£ç å®¡æŸ¥**: 100% é€šè¿‡
- âœ… **å®‰å…¨æ£€æŸ¥**: é€šè¿‡æ‰€æœ‰å®‰å…¨æµ‹è¯•

### 7.3 ä¸šåŠ¡æŒ‡æ ‡

- âœ… **åŠŸèƒ½å®Œæ•´æ€§**: æ‰€æœ‰ç°æœ‰åŠŸèƒ½ä¿æŒ
- âœ… **æ–°åŠŸèƒ½**: å¢å¼ºçš„éªŒè¯å’Œå®‰å…¨æ£€æŸ¥
- âœ… **å¼€å‘æ•ˆç‡**: æå‡ 50%+
- âœ… **ç»´æŠ¤æˆæœ¬**: é™ä½ 75%
- âœ… **å­˜å‚¨æˆæœ¬**: é™ä½ 50%

---

## 8. æ€»ç»“ä¸å»ºè®®

### 8.1 æ ¸å¿ƒç»“è®º

**v3.0 (åˆ†æ•£å­˜å‚¨ + å…±äº«å·¥å…·åº“) æ˜¯å”¯ä¸€æ­£ç¡®çš„æ¶æ„é€‰æ‹©** âœ…

**å…³é”®ç†ç”±**:

1. **ä¸šåŠ¡éœ€æ±‚å¼‚æ„**: Deceasedã€GroupChatã€Evidence çš„åª’ä½“éœ€æ±‚æœ¬è´¨ä¸åŒ
   - 10ä¸ªç»´åº¦ä¸­ï¼Œ8ä¸ªå®Œå…¨ä¸åŒï¼Œ2ä¸ªéƒ¨åˆ†ä¸åŒ
   - å¼ºè¡Œç»Ÿä¸€ä¼šå¼•å…¥ä¸å¿…è¦çš„å¤æ‚åº¦

2. **æ€§èƒ½æå¤§æå‡**:
   - æŸ¥è¯¢æ€§èƒ½ï¼š10-100å€æå‡
   - å­˜å‚¨æˆæœ¬ï¼šé™ä½ 50%

3. **å¼€å‘æˆæœ¬æœ€ä½**:
   - å¼€å‘ï¼š40ä¸‡ï¼ˆvs v1.0çš„100ä¸‡ï¼Œv2.0çš„70ä¸‡ï¼‰
   - 5å¹´TCOï¼š102.5ä¸‡ï¼ˆvs v1.0çš„300ä¸‡ï¼Œv2.0çš„195ä¸‡ï¼‰

4. **æ¶æ„æœ€ä¼˜**:
   - è€¦åˆåº¦ï¼š2.8/10ï¼ˆä½è€¦åˆï¼‰
   - SOLIDåŸåˆ™ï¼š97%ç¬¦åˆ
   - ä»£ç è¡Œæ•°ï¼š300è¡Œï¼ˆvs v1.0çš„5000è¡Œï¼‰

5. **é£é™©æœ€ä½**:
   - æŠ€æœ¯é£é™©ä½
   - é›†æˆç®€å•
   - é›¶ç ´åæ€§

### 8.2 å®æ–½å»ºè®®

#### âœ… å¼ºçƒˆæ¨èï¼šç«‹å³å¯åŠ¨ v3.0 å®æ–½

**ç¬¬ä¸€æ­¥**ï¼ˆWeek 1-3ï¼‰:
- åˆ›å»º stardust-media-common å·¥å…·åº“
- å®ç°æ ¸å¿ƒéªŒè¯å’Œå·¥å…·å‡½æ•°
- å®Œæ•´æµ‹è¯•å’Œæ–‡æ¡£

**ç¬¬äºŒæ­¥**ï¼ˆWeek 4-7ï¼‰:
- æŒ‰ Deceased â†’ Evidence â†’ GroupChat é¡ºåºé›†æˆ
- æ¯ä¸ªæ¨¡å—ç‹¬ç«‹éªŒæ”¶
- æŒç»­é›†æˆæµ‹è¯•

**ç¬¬ä¸‰æ­¥**ï¼ˆWeek 8ï¼‰:
- æ€§èƒ½ä¼˜åŒ–
- æ–‡æ¡£å®Œå–„
- å‘å¸ƒ v3.0.0

#### âŒ ä¸æ¨èï¼šv1.0 æˆ– v2.0 æ–¹æ¡ˆ

**v1.0 é›†ä¸­å¼**:
- è€¦åˆåº¦é«˜ï¼ˆ6.5/10ï¼‰
- æˆæœ¬é«˜ï¼ˆ300ä¸‡/5å¹´ï¼‰
- æ€§èƒ½å·®
- **å®Œå…¨ä¸å¯è¡Œ** âŒ

**v2.0 é›†ä¸­å¼+æŠ½è±¡å±‚**:
- æ¶æ„è¿‡äºå¤æ‚
- ä¸šåŠ¡éœ€æ±‚ä¸åŒ¹é…
- æˆæœ¬é«˜ï¼ˆ195ä¸‡/5å¹´ï¼‰
- **ä¸æ¨è** âš ï¸

### 8.3 å…³é”®æˆåŠŸå› ç´ 

1. **å……åˆ†æµ‹è¯•**: å·¥å…·åº“å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >80%
2. **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„APIæ–‡æ¡£å’Œé›†æˆæŒ‡å—
3. **æ€§èƒ½ç›‘æ§**: æŒç»­ç›‘æ§æ€§èƒ½æŒ‡æ ‡
4. **ä»£ç å®¡æŸ¥**: æ‰€æœ‰ä»£ç å˜æ›´éœ€è¦review
5. **æ¸è¿›å¼äº¤ä»˜**: åˆ†æ¨¡å—éªŒæ”¶ï¼Œé™ä½é£é™©

### 8.4 é¢„æœŸæ”¶ç›Š

**æŠ€æœ¯æ”¶ç›Š**:
- è€¦åˆåº¦é™ä½ 57%ï¼ˆvs v1.0ï¼‰
- æ€§èƒ½æå‡ 10-100å€
- ä»£ç é‡å‡å°‘ 94%ï¼ˆvs v1.0ï¼‰
- ç»´æŠ¤æˆæœ¬é™ä½ 75%

**ç»æµæ”¶ç›Š**:
- å¼€å‘æˆæœ¬èŠ‚çœ 60ä¸‡ï¼ˆvs v1.0ï¼‰
- 5å¹´TCOèŠ‚çœ 197.5ä¸‡ï¼ˆvs v1.0ï¼‰
- æŠ•èµ„å›æ”¶æœŸ 10ä¸ªæœˆ
- 5å¹´å‡€æ”¶ç›Š 197.5ä¸‡

**ä¸šåŠ¡æ”¶ç›Š**:
- å®‰å…¨æ€§æå‡ 40%+
- å¼€å‘æ•ˆç‡æå‡ 50%+
- ç³»ç»Ÿç¨³å®šæ€§æå‡ 60%+
- ç”¨æˆ·ä½“éªŒæå‡

### 8.5 æœ€ç»ˆè¯„ä¼°

| è¯„ä¼°ç»´åº¦ | å¾—åˆ† | ç­‰çº§ |
|---------|------|------|
| **æŠ€æœ¯å¯è¡Œæ€§** | 9.5/10 | â­â­â­â­â­ |
| **ç»æµå¯è¡Œæ€§** | 9.8/10 | â­â­â­â­â­ |
| **æ¶æ„åˆç†æ€§** | 9.7/10 | â­â­â­â­â­ |
| **ä¸šåŠ¡å¥‘åˆåº¦** | 9.5/10 | â­â­â­â­â­ |
| **é£é™©å¯æ§æ€§** | 9.5/10 | â­â­â­â­â­ |

**æ€»ä½“è¯„åˆ†**: **9.6/10** â­â­â­â­â­

**æœ€ç»ˆå»ºè®®**: âœ… **å¼ºçƒˆæ¨èç«‹å³å®æ–½ v3.0 æ–¹æ¡ˆ**

---

## é™„å½•A: å¿«é€Ÿå†³ç­–è¡¨

| æ–¹æ¡ˆ | è€¦åˆåº¦ | æˆæœ¬(5å¹´) | æ€§èƒ½ | å¤æ‚åº¦ | æ¨èåº¦ |
|-----|-------|---------|------|-------|-------|
| **v1.0 é›†ä¸­å¼** | 6.5/10 âŒ | 300ä¸‡ âŒ | å·® âŒ | æé«˜ âŒ | âŒ ä¸æ¨è |
| **v2.0 æŠ½è±¡å±‚** | 3.3/10 âœ… | 195ä¸‡ âš ï¸ | ä¸­ âš ï¸ | é«˜ âš ï¸ | âš ï¸ ä¸æ¨è |
| **v3.0 åˆ†æ•£+å·¥å…·åº“** | 2.8/10 âœ… | 102.5ä¸‡ âœ… | ä¼˜ âœ… | ä½ âœ… | âœ… **å¼ºçƒˆæ¨è** |

---

## é™„å½•B: å‚è€ƒæ–‡æ¡£

1. ã€Šå…±äº«åª’ä½“å·¥å…·åº“è¯¦ç»†è®¾è®¡.mdã€‹- å·¥å…·åº“å®Œæ•´è®¾è®¡
2. ã€Šå…±äº«å·¥å…·åº“é›†æˆæ–¹æ¡ˆè¯„ä¼°.mdã€‹- ä¸‰å¤§æ¨¡å—é›†æˆè¯„ä¼°
3. ã€Šåª’ä½“åˆ†æ•£å­˜å‚¨vsé›†ä¸­å­˜å‚¨-æ¶æ„åˆ†æ.mdã€‹- æ¶æ„å†³ç­–ä¾æ®
4. ã€Šå…¬å…±éŸ³è§†é¢‘åª’ä½“åº“Palletè€¦åˆåº¦åˆ†ææŠ¥å‘Š.mdã€‹- v1.0é—®é¢˜åˆ†æ

---

*æœ¬æ–‡æ¡£åŸºäºæ·±å…¥çš„æ¶æ„åˆ†æå’Œæˆæœ¬æ•ˆç›Šè¯„ä¼°ï¼Œå¼ºçƒˆå»ºè®®é‡‡çº³ v3.0 åˆ†æ•£å­˜å‚¨ + å…±äº«å·¥å…·åº“æ–¹æ¡ˆã€‚è¿™æ˜¯å”¯ä¸€ç¬¦åˆä¸šåŠ¡éœ€æ±‚ã€æ€§èƒ½ä¼˜å¼‚ã€æˆæœ¬å¯æ§çš„æ¶æ„é€‰æ‹©ã€‚*
