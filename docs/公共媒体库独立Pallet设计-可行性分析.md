# å…¬å…±åª’ä½“åº“ç‹¬ç«‹ Pallet è®¾è®¡ - å¯è¡Œæ€§ä¸åˆç†æ€§åˆ†æ

## ä¸€ã€èƒŒæ™¯ä¸é—®é¢˜

### 1.1 å½“å‰éœ€æ±‚

å…¬å…±åª’ä½“åº“ï¼ˆéŸ³é¢‘+è§†é¢‘ï¼‰å°†è¢«å¤šä¸ªä¸šåŠ¡åœºæ™¯ä½¿ç”¨ï¼š

#### éŸ³é¢‘ä½¿ç”¨åœºæ™¯
1. **é€è€…çºªå¿µé¦†**ï¼ˆDeceased Memorialï¼‰- èƒŒæ™¯éŸ³ä¹
2. **å¢“åœ°è¯¦æƒ…é¡µ**ï¼ˆGraveï¼‰- æ°›å›´éŸ³ä¹
3. **é™µå›­ä¸»é¡µ**ï¼ˆParkï¼‰- å…¥å£éŸ³ä¹
4. **çºªå¿µç©ºé—´**ï¼ˆMemorial Spaceï¼‰- å†¥æƒ³éŸ³ä¹
5. **å® ç‰©çºªå¿µ**ï¼ˆPet Memorialï¼‰- çºªå¿µéŸ³ä¹
6. **äº‹ä»¶é¦†**ï¼ˆEvent Hallï¼‰- ä¸»é¢˜éŸ³ä¹

#### è§†é¢‘ä½¿ç”¨åœºæ™¯
1. **é€è€…çºªå¿µé¦†**ï¼ˆDeceased Memorialï¼‰- ç”Ÿå¹³è§†é¢‘ã€çºªå½•ç‰‡
2. **äº‹ä»¶é¦†**ï¼ˆEvent Hallï¼‰- å†å²å½±åƒã€çºªå®è§†é¢‘
3. **é™µå›­ä¸»é¡µ**ï¼ˆParkï¼‰- é™µå›­å®£ä¼ ç‰‡ã€å¯¼è§ˆè§†é¢‘
4. **æ•™è‚²åœºæ™¯**ï¼ˆEducationï¼‰- ç”Ÿå‘½æ•™è‚²ã€æ–‡åŒ–ä¼ æ‰¿è§†é¢‘
5. **ç›´æ’­è¿½æ‚¼ä¼š**ï¼ˆLive Memorialï¼‰- å½•æ’­å›æ”¾
6. **è™šæ‹Ÿç¥­ç¥€**ï¼ˆVirtual Ritualï¼‰- ä»ªå¼å¼•å¯¼è§†é¢‘

### 1.2 è®¾è®¡é€‰æ‹©

**æ–¹æ¡ˆA**: é›†æˆåˆ° `pallet-deceased`
**æ–¹æ¡ˆB**: ç‹¬ç«‹åˆ›å»º `pallet-public-media`ï¼ˆæ¨èï¼‰- ç»Ÿä¸€ç®¡ç†éŸ³é¢‘+è§†é¢‘

---

## äºŒã€ä½¿ç”¨åœºæ™¯åˆ†æ

### 2.1 è·¨ Pallet ä½¿ç”¨åœºæ™¯

#### éŸ³é¢‘ä½¿ç”¨åœºæ™¯

| Pallet | ä½¿ç”¨åœºæ™¯ | éŸ³é¢‘éœ€æ±‚ | ä¼˜å…ˆçº§ |
|--------|---------|---------|--------|
| **pallet-deceased** | é€è€…çºªå¿µé¦†èƒŒæ™¯éŸ³ä¹ | å“€ä¹ã€ä½›ä¹ã€è½»éŸ³ä¹ | â­â­â­â­â­ |
| **pallet-stardust-grave** | å¢“åœ°è¯¦æƒ…é¡µæ°›å›´éŸ³ä¹ | å“€ä¹ã€ç¯å¢ƒéŸ³ä¹ | â­â­â­â­ |
| **pallet-stardust-park** | é™µå›­å…¥å£èƒŒæ™¯éŸ³ä¹ | è½»éŸ³ä¹ã€è‡ªç„¶éŸ³ | â­â­â­â­ |
| **pallet-memorial-space** | çºªå¿µç©ºé—´æ°›å›´è¥é€  | å¤å…¸éŸ³ä¹ã€å†¥æƒ³éŸ³ä¹ | â­â­â­ |
| **pallet-memorial** | ä¾›å¥‰ä»ªå¼éŸ³ä¹ | å®—æ•™éŸ³ä¹ã€ä»ªå¼éŸ³ä¹ | â­â­â­ |
| **æœªæ¥æ‰©å±•** | ç›´æ’­è¿½æ‚¼ä¼šã€è™šæ‹Ÿç¥­ç¥€ | å¤šæ ·åŒ–éŸ³ä¹ | â­â­ |

#### è§†é¢‘ä½¿ç”¨åœºæ™¯

| Pallet | ä½¿ç”¨åœºæ™¯ | è§†é¢‘éœ€æ±‚ | ä¼˜å…ˆçº§ |
|--------|---------|---------|--------|
| **pallet-deceased** | é€è€…ç”Ÿå¹³è§†é¢‘ã€çºªå½•ç‰‡ | ç”Ÿå¹³å›é¡¾ã€å®¶æ—è§†é¢‘ | â­â­â­â­â­ |
| **pallet-stardust-park** | é™µå›­å®£ä¼ ç‰‡ã€å¯¼è§ˆè§†é¢‘ | ç¯å¢ƒä»‹ç»ã€æœåŠ¡å±•ç¤º | â­â­â­â­ |
| **pallet-memorial-space** | ä»ªå¼å¼•å¯¼è§†é¢‘ | ç¥­ç¥€æµç¨‹ã€æ–‡åŒ–æ•™è‚² | â­â­â­â­ |
| **pallet-memorial** | ä¾›å¥‰ä»ªå¼è§†é¢‘ã€è¿½æ‚¼è§†é¢‘ | ä»ªå¼è®°å½•ã€è¿½æ€å½±åƒ | â­â­â­â­ |
| **pallet-deceased** | æ•™è‚²è§†é¢‘ã€æ–‡åŒ–ä¼ æ‰¿ | ç”Ÿå‘½æ•™è‚²ã€å†å²æ–‡åŒ– | â­â­â­ |
| **æœªæ¥æ‰©å±•** | ç›´æ’­è¿½æ‚¼ä¼šå½•æ’­ã€AR/VRè™šæ‹Ÿç¥­ç¥€ | é«˜æ¸…è§†é¢‘ã€360Â°å…¨æ™¯ | â­â­ |

**ç»“è®º**: å…¬å…±åª’ä½“åº“æ˜¯**è·¨é¢†åŸŸçš„åŸºç¡€è®¾æ–½**ï¼Œä¸åº”ç»‘å®šåˆ°ç‰¹å®šä¸šåŠ¡ Palletã€‚

---

### 2.2 åª’ä½“åº“åŠŸèƒ½éœ€æ±‚

#### æ ¸å¿ƒåŠŸèƒ½
1. **åª’ä½“ç®¡ç†**: å¢åˆ æ”¹æŸ¥å…¬å…±éŸ³é¢‘/è§†é¢‘
2. **åˆ†ç±»ç®¡ç†**: æŒ‰åª’ä½“ç±»å‹ã€æƒ…ç»ªã€åœºæ™¯ã€æ–‡åŒ–åˆ†ç±»
3. **æƒé™æ§åˆ¶**: Root/æ²»ç†å§”å‘˜ä¼šç®¡ç†
4. **çŠ¶æ€æ§åˆ¶**: å¯ç”¨/ç¦ç”¨åª’ä½“
5. **æŸ¥è¯¢æ¥å£**:
   - æŒ‰åª’ä½“ç±»å‹æŸ¥è¯¢ï¼ˆéŸ³é¢‘/è§†é¢‘ï¼‰
   - æŒ‰åˆ†ç±»æŸ¥è¯¢
   - éšæœºæ¨è
   - æ‰¹é‡æŸ¥è¯¢

#### éŸ³é¢‘ç‰¹å®šåŠŸèƒ½
6. **éŸ³é¢‘æ—¶é•¿**: è®°å½•éŸ³é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
7. **éŸ³é¢‘åˆ†ç±»**: å“€ä¹ã€ä½›ä¹ã€è½»éŸ³ä¹ã€å¤å…¸ã€ç¯å¢ƒéŸ³ã€æ°‘æ—ã€å®—æ•™ã€å†¥æƒ³

#### è§†é¢‘ç‰¹å®šåŠŸèƒ½
8. **è§†é¢‘åˆ†è¾¨ç‡**: è®°å½•è§†é¢‘åˆ†è¾¨ç‡ï¼ˆ720p, 1080p, 4Kç­‰ï¼‰
9. **è§†é¢‘æ—¶é•¿**: è®°å½•è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
10. **è§†é¢‘åˆ†ç±»**: ç”Ÿå¹³çºªå½•ã€å†å²å½±åƒã€æ•™è‚²è§†é¢‘ã€ä»ªå¼å¼•å¯¼ã€å®£ä¼ ç‰‡ã€å…¨æ™¯è§†é¢‘

#### æ‰©å±•åŠŸèƒ½ï¼ˆPhase 2ï¼‰
11. **æ’­æ”¾ç»Ÿè®¡**: è®°å½•æ’­æ”¾æ¬¡æ•°
12. **ç”¨æˆ·è¯„åˆ†**: åª’ä½“è´¨é‡åé¦ˆ
13. **AIæ¨è**: æ ¹æ®åœºæ™¯æ™ºèƒ½æ¨è
14. **ç‰ˆæƒç®¡ç†**: è®°å½•åª’ä½“æ¥æºå’Œæˆæƒ
15. **å­—å¹•æ”¯æŒ**: è§†é¢‘å­—å¹•CIDå­˜å‚¨ï¼ˆå¤šè¯­è¨€ï¼‰

---

## ä¸‰ã€æ–¹æ¡ˆå¯¹æ¯”åˆ†æ

### 3.1 æ–¹æ¡ˆAï¼šé›†æˆåˆ° pallet-deceased

#### ä¼˜ç‚¹
- âœ… æ— éœ€æ–°å»º Palletï¼Œå¼€å‘å¿«
- âœ… é€è€…çºªå¿µé¦†ç›´æ¥è°ƒç”¨ï¼Œæ— è·¨ Pallet ä¾èµ–

#### ç¼ºç‚¹
- âŒ **èŒè´£ä¸æ¸…**: Deceased ç®¡ç†é€è€…æ¡£æ¡ˆï¼Œä¸åº”ç®¡éŸ³ä¹åº“
- âŒ **è€¦åˆåº¦é«˜**: å…¶ä»– Pallet éœ€è¦ä¾èµ– Deceased
- âŒ **å¯ç»´æŠ¤æ€§å·®**: éŸ³ä¹åŠŸèƒ½ä¸é€è€…ä¸šåŠ¡æ··åˆ
- âŒ **æ‰©å±•æ€§å·®**: éŸ³ä¹åº“æ›´æ–°éœ€è¦ä¿®æ”¹ Deceased
- âŒ **è¯­ä¹‰ä¸ç¬¦**: å¢“åœ°ã€é™µå›­è°ƒç”¨ Deceased æ¥å£ä¸åˆç†

#### ä¾èµ–å…³ç³»å›¾
```
pallet-stardust-grave â”€â”€â”
pallet-stardust-park â”€â”€â”€â”¼â”€â”€> pallet-deceased (âŒ ä¸åˆç†ä¾èµ–)
pallet-memorial-space â”€â”€â”˜       â””â”€> å…¬å…±éŸ³ä¹åº“
```

---

### 3.2 æ–¹æ¡ˆB:ç‹¬ç«‹ pallet-public-mediaï¼ˆæ¨èï¼‰

#### ä¼˜ç‚¹
- âœ… **èŒè´£å•ä¸€**: ä¸“æ³¨åª’ä½“ç®¡ç†ï¼ˆéŸ³é¢‘+è§†é¢‘ï¼‰ï¼Œç¬¦åˆå•ä¸€èŒè´£åŸåˆ™
- âœ… **ä½è€¦åˆ**: å„ Pallet ç‹¬ç«‹ä¾èµ–åª’ä½“åº“
- âœ… **æ˜“ç»´æŠ¤**: åª’ä½“åŠŸèƒ½ç‹¬ç«‹æ¼”è¿›
- âœ… **æ˜“æ‰©å±•**: æ”¯æŒæœªæ¥æ›´å¤šåœºæ™¯å’Œåª’ä½“ç±»å‹
- âœ… **è¯­ä¹‰æ¸…æ™°**: åç§°æ˜ç¡®è¡¨è¾¾åŠŸèƒ½
- âœ… **å¯å¤ç”¨**: å…¶ä»–é¡¹ç›®å¯ç›´æ¥å¤ç”¨
- âœ… **ç»Ÿä¸€ç®¡ç†**: éŸ³é¢‘å’Œè§†é¢‘ä½¿ç”¨ç»Ÿä¸€æ¥å£å’Œæ•°æ®ç»“æ„

#### ç¼ºç‚¹
- âš ï¸ éœ€è¦æ–°å»º Palletï¼ˆå¼€å‘æˆæœ¬+2å¤©ï¼‰
- âš ï¸ éœ€è¦åœ¨ Runtime ä¸­é›†æˆï¼ˆé…ç½®æˆæœ¬+30åˆ†é’Ÿï¼‰

#### ä¾èµ–å…³ç³»å›¾
```
pallet-deceased â”€â”€â”€â”€â”€â”€â”€â”€â”
pallet-stardust-grave â”€â”€â”¤
pallet-stardust-park â”€â”€â”€â”¼â”€â”€> pallet-public-media (âœ… æ¸…æ™°ä¾èµ–)
pallet-memorial-space â”€â”€â”¤      â””â”€> éŸ³é¢‘åº“ + è§†é¢‘åº“
pallet-memorial â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€æŠ€æœ¯æ¶æ„è®¾è®¡

### 4.1 Pallet ç»“æ„

```
stardust/pallets/public-media/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ README.md
â””â”€â”€ src/
    â”œâ”€â”€ lib.rs          # ä¸»é€»è¾‘
    â”œâ”€â”€ types.rs        # ç±»å‹å®šä¹‰ï¼ˆéŸ³é¢‘+è§†é¢‘ï¼‰
    â”œâ”€â”€ tests.rs        # å•å…ƒæµ‹è¯•
    â””â”€â”€ benchmarking.rs # æ€§èƒ½æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
```

---

### 4.2 æ ¸å¿ƒæ•°æ®ç»“æ„

```rust
// src/types.rs

/// åª’ä½“ç±»å‹
#[derive(Encode, Decode, Clone, Copy, PartialEq, Eq, TypeInfo, MaxEncodedLen, RuntimeDebug)]
pub enum MediaType {
    /// éŸ³é¢‘
    Audio = 0,
    /// è§†é¢‘
    Video = 1,
}

impl Default for MediaType {
    fn default() -> Self {
        Self::Audio
    }
}

/// éŸ³é¢‘åˆ†ç±»
#[derive(Encode, Decode, Clone, Copy, PartialEq, Eq, TypeInfo, MaxEncodedLen, RuntimeDebug)]
pub enum AudioCategory {
    /// å“€ä¹ï¼ˆè¿½æ€ã€æ‚¼å¿µï¼‰
    Requiem = 0,
    /// ä½›ä¹ï¼ˆä½›æ•™éŸ³ä¹ã€ç»æ–‡ï¼‰
    Buddhist = 1,
    /// è½»éŸ³ä¹ï¼ˆæŠ’æƒ…ã€å¹³å’Œï¼‰
    Light = 2,
    /// å¤å…¸éŸ³ä¹ï¼ˆåº„é‡ã€è‚ƒç©†ï¼‰
    Classical = 3,
    /// ç¯å¢ƒéŸ³ä¹ï¼ˆè‡ªç„¶éŸ³ã€ç™½å™ªéŸ³ï¼‰
    Ambient = 4,
    /// æ°‘æ—éŸ³ä¹ï¼ˆä¼ ç»Ÿã€åœ°æ–¹ç‰¹è‰²ï¼‰
    Ethnic = 5,
    /// å®—æ•™éŸ³ä¹ï¼ˆå¤šå®—æ•™é€šç”¨ï¼‰
    Religious = 6,
    /// å†¥æƒ³éŸ³ä¹ï¼ˆç¦…ä¿®ã€é™å¿ƒï¼‰
    Meditation = 7,
}

impl Default for AudioCategory {
    fn default() -> Self {
        Self::Requiem
    }
}

/// è§†é¢‘åˆ†ç±»
#[derive(Encode, Decode, Clone, Copy, PartialEq, Eq, TypeInfo, MaxEncodedLen, RuntimeDebug)]
pub enum VideoCategory {
    /// ç”Ÿå¹³çºªå½•ï¼ˆä¸ªäººç”Ÿå¹³ã€å›å¿†å½•ï¼‰
    Biography = 0,
    /// å†å²å½±åƒï¼ˆå†å²äº‹ä»¶ã€æ¡£æ¡ˆï¼‰
    Historical = 1,
    /// æ•™è‚²è§†é¢‘ï¼ˆç”Ÿå‘½æ•™è‚²ã€æ–‡åŒ–ä¼ æ‰¿ï¼‰
    Educational = 2,
    /// ä»ªå¼å¼•å¯¼ï¼ˆç¥­ç¥€æµç¨‹ã€æ“ä½œæŒ‡å—ï¼‰
    Ritual = 3,
    /// å®£ä¼ ç‰‡ï¼ˆé™µå›­ä»‹ç»ã€æœåŠ¡å±•ç¤ºï¼‰
    Promotional = 4,
    /// çºªå½•ç‰‡ï¼ˆæ·±åº¦è®°å½•ã€ä¸“é¢˜ç‰‡ï¼‰
    Documentary = 5,
    /// å…¨æ™¯è§†é¢‘ï¼ˆ360Â°ã€VR/ARï¼‰
    Panoramic = 6,
    /// è¿½æ‚¼è§†é¢‘ï¼ˆè¿½æ€ä¼šã€æ‚¼å¿µä»ªå¼ï¼‰
    Memorial = 7,
}

impl Default for VideoCategory {
    fn default() -> Self {
        Self::Biography
    }
}

/// åª’ä½“åˆ†ç±»ï¼ˆéŸ³é¢‘æˆ–è§†é¢‘ï¼‰
#[derive(Encode, Decode, Clone, Copy, PartialEq, Eq, TypeInfo, MaxEncodedLen, RuntimeDebug)]
pub enum MediaCategory {
    /// éŸ³é¢‘åˆ†ç±»
    Audio(AudioCategory),
    /// è§†é¢‘åˆ†ç±»
    Video(VideoCategory),
}

impl Default for MediaCategory {
    fn default() -> Self {
        Self::Audio(AudioCategory::default())
    }
}

/// è§†é¢‘è´¨é‡/åˆ†è¾¨ç‡
#[derive(Encode, Decode, Clone, Copy, PartialEq, Eq, TypeInfo, MaxEncodedLen, RuntimeDebug)]
pub enum VideoQuality {
    /// æ ‡æ¸… 480p
    SD = 480,
    /// é«˜æ¸… 720p
    HD = 720,
    /// å…¨é«˜æ¸… 1080p
    FullHD = 1080,
    /// 2K
    TwoK = 1440,
    /// 4K Ultra HD
    FourK = 2160,
}

/// åª’ä½“æ¡ç›®
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen)]
#[scale_info(skip_type_params(T))]
pub struct MediaEntry<T: Config> {
    /// åª’ä½“ID
    pub id: u32,
    /// åª’ä½“ç±»å‹ï¼ˆéŸ³é¢‘/è§†é¢‘ï¼‰
    pub media_type: MediaType,
    /// åª’ä½“åç§°
    pub name: BoundedVec<u8, T::StringLimit>,
    /// åª’ä½“CIDï¼ˆIPFSï¼‰
    pub media_cid: BoundedVec<u8, T::CidLimit>,
    /// å°é¢å›¾CIDï¼ˆå¯é€‰ï¼‰
    pub cover_cid: Option<BoundedVec<u8, T::CidLimit>>,
    /// æ—¶é•¿ï¼ˆç§’ï¼‰
    pub duration: u32,
    /// åˆ†ç±»
    pub category: MediaCategory,
    /// è§†é¢‘ä¸“å±ï¼šåˆ†è¾¨ç‡ï¼ˆéŸ³é¢‘ä¸ºNoneï¼‰
    pub quality: Option<VideoQuality>,
    /// è§†é¢‘ä¸“å±ï¼šå­—å¹•CIDï¼ˆå¯é€‰ï¼Œå¤šè¯­è¨€ï¼‰
    pub subtitle_cid: Option<BoundedVec<u8, T::CidLimit>>,
    /// æ˜¯å¦å¯ç”¨
    pub enabled: bool,
    /// åˆ›å»ºè€…ï¼ˆRoot/æ²»ç†å§”å‘˜ä¼šï¼‰
    pub creator: T::AccountId,
    /// åˆ›å»ºæ—¶é—´
    pub created_at: BlockNumberFor<T>,
    /// æ›´æ–°æ—¶é—´
    pub updated_at: BlockNumberFor<T>,
}

/// åª’ä½“ç»Ÿè®¡ï¼ˆå¯é€‰ï¼ŒPhase 2ï¼‰
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen, Default)]
pub struct MediaStats {
    /// æ€»æ’­æ”¾æ¬¡æ•°
    pub play_count: u64,
    /// æ€»ç‚¹èµæ•°
    pub like_count: u32,
    /// æœ€åæ’­æ”¾æ—¶é—´
    pub last_played_at: Option<u32>,  // BlockNumber
}
```

---

### 4.3 å­˜å‚¨è®¾è®¡

```rust
#[pallet::storage]
#[pallet::getter(fn media_library)]
pub type MediaLibrary<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    u32,  // media_id
    MediaEntry<T>,
>;

#[pallet::storage]
#[pallet::getter(fn next_media_id)]
pub type NextMediaId<T: Config> = StorageValue<_, u32, ValueQuery>;

#[pallet::storage]
#[pallet::getter(fn media_by_category)]
pub type MediaByCategory<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    MediaCategory,
    BoundedVec<u32, ConstU32<100>>,  // æ¯åˆ†ç±»æœ€å¤š100ä¸ªåª’ä½“
    ValueQuery,
>;

// æŒ‰åª’ä½“ç±»å‹ç´¢å¼•ï¼ˆä¾¿äºå¿«é€ŸæŸ¥è¯¢æ‰€æœ‰éŸ³é¢‘æˆ–æ‰€æœ‰è§†é¢‘ï¼‰
#[pallet::storage]
#[pallet::getter(fn media_by_type)]
pub type MediaByType<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    MediaType,
    BoundedVec<u32, ConstU32<500>>,  // æ¯ç±»å‹æœ€å¤š500ä¸ª
    ValueQuery,
>;

// å¯é€‰ï¼šå¯ç”¨çš„åª’ä½“ç´¢å¼•
#[pallet::storage]
pub type EnabledMediaIds<T: Config> = StorageValue<
    _,
    BoundedVec<u32, ConstU32<1000>>,  // æœ€å¤š1000ä¸ªå¯ç”¨åª’ä½“
    ValueQuery,
>;

// å¯é€‰ï¼šåª’ä½“ç»Ÿè®¡ï¼ˆPhase 2ï¼‰
#[pallet::storage]
pub type MediaStatsOf<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    u32,  // media_id
    MediaStats,
    ValueQuery,
>;
```

---

### 4.4 Config Trait

```rust
#[pallet::config]
pub trait Config: frame_system::Config {
    /// äº‹ä»¶ç±»å‹
    type RuntimeEvent: From<Event<Self>> + IsType<<Self as frame_system::Config>::RuntimeEvent>;

    /// å­—ç¬¦ä¸²é•¿åº¦é™åˆ¶
    #[pallet::constant]
    type StringLimit: Get<u32>;

    /// CIDé•¿åº¦é™åˆ¶
    #[pallet::constant]
    type CidLimit: Get<u32>;

    /// ç®¡ç†å‘˜æƒé™ï¼ˆRootæˆ–æ²»ç†å§”å‘˜ä¼šï¼‰
    type AdminOrigin: EnsureOrigin<Self::RuntimeOrigin>;

    /// æƒé‡ä¿¡æ¯
    type WeightInfo: WeightInfo;
}
```

---

### 4.5 æ ¸å¿ƒæ¥å£

```rust
#[pallet::call]
impl<T: Config> Pallet<T> {
    /// æ·»åŠ å…¬å…±åª’ä½“ï¼ˆéŸ³é¢‘æˆ–è§†é¢‘ï¼‰
    #[pallet::weight(T::WeightInfo::add_media())]
    pub fn add_media(
        origin: OriginFor<T>,
        media_type: MediaType,
        name: Vec<u8>,
        media_cid: Vec<u8>,
        cover_cid: Option<Vec<u8>>,
        duration: u32,
        category: MediaCategory,
        // è§†é¢‘ä¸“å±å‚æ•°
        quality: Option<VideoQuality>,
        subtitle_cid: Option<Vec<u8>>,
    ) -> DispatchResult {
        T::AdminOrigin::ensure_origin(origin.clone())?;
        let creator = ensure_signed(origin)?;

        // éªŒè¯å‚æ•°
        ensure!(duration > 0, Error::<T>::InvalidDuration);
        ensure!(!name.is_empty(), Error::<T>::EmptyName);

        // éªŒè¯åˆ†ç±»ä¸åª’ä½“ç±»å‹çš„ä¸€è‡´æ€§
        match (&media_type, &category) {
            (MediaType::Audio, MediaCategory::Audio(_)) => {},
            (MediaType::Video, MediaCategory::Video(_)) => {},
            _ => return Err(Error::<T>::MediaTypeMismatch.into()),
        }

        // è½¬æ¢ä¸º BoundedVec
        let name_bounded: BoundedVec<u8, T::StringLimit> = name
            .try_into()
            .map_err(|_| Error::<T>::NameTooLong)?;
        let media_cid_bounded: BoundedVec<u8, T::CidLimit> = media_cid
            .try_into()
            .map_err(|_| Error::<T>::CidTooLong)?;
        let cover_cid_bounded = cover_cid
            .map(|cid| cid.try_into())
            .transpose()
            .map_err(|_| Error::<T>::CidTooLong)?;
        let subtitle_cid_bounded = subtitle_cid
            .map(|cid| cid.try_into())
            .transpose()
            .map_err(|_| Error::<T>::CidTooLong)?;

        // åˆ›å»ºåª’ä½“æ¡ç›®
        let media_id = Self::next_media_id();
        let now = <frame_system::Pallet<T>>::block_number();

        let entry = MediaEntry {
            id: media_id,
            media_type,
            name: name_bounded,
            media_cid: media_cid_bounded,
            cover_cid: cover_cid_bounded,
            duration,
            category,
            quality,
            subtitle_cid: subtitle_cid_bounded,
            enabled: true,
            creator,
            created_at: now,
            updated_at: now,
        };

        // å­˜å‚¨
        MediaLibrary::<T>::insert(media_id, entry);
        NextMediaId::<T>::put(media_id + 1);

        // æ·»åŠ åˆ°åˆ†ç±»ç´¢å¼•
        MediaByCategory::<T>::try_mutate(category, |ids| {
            ids.try_push(media_id)
        })?;

        // æ·»åŠ åˆ°ç±»å‹ç´¢å¼•
        MediaByType::<T>::try_mutate(media_type, |ids| {
            ids.try_push(media_id)
        })?;

        // æ·»åŠ åˆ°å¯ç”¨ç´¢å¼•
        EnabledMediaIds::<T>::try_mutate(|ids| {
            ids.try_push(media_id)
        })?;

        // è§¦å‘äº‹ä»¶
        Self::deposit_event(Event::MediaAdded {
            media_id,
            media_type,
            category,
        });

        Ok(())
    }

    /// æ›´æ–°åª’ä½“ä¿¡æ¯
    #[pallet::weight(T::WeightInfo::update_media())]
    pub fn update_media(
        origin: OriginFor<T>,
        media_id: u32,
        name: Option<Vec<u8>>,
        cover_cid: Option<Vec<u8>>,
        duration: Option<u32>,
        subtitle_cid: Option<Vec<u8>>,  // ä»…è§†é¢‘ä½¿ç”¨
    ) -> DispatchResult {
        T::AdminOrigin::ensure_origin(origin)?;

        MediaLibrary::<T>::try_mutate(media_id, |entry| {
            let e = entry.as_mut().ok_or(Error::<T>::MediaNotFound)?;

            if let Some(n) = name {
                e.name = n.try_into().map_err(|_| Error::<T>::NameTooLong)?;
            }
            if let Some(cid) = cover_cid {
                e.cover_cid = Some(cid.try_into().map_err(|_| Error::<T>::CidTooLong)?);
            }
            if let Some(d) = duration {
                ensure!(d > 0, Error::<T>::InvalidDuration);
                e.duration = d;
            }
            if let Some(sub_cid) = subtitle_cid {
                e.subtitle_cid = Some(sub_cid.try_into().map_err(|_| Error::<T>::CidTooLong)?);
            }

            e.updated_at = <frame_system::Pallet<T>>::block_number();

            Self::deposit_event(Event::MediaUpdated { media_id });
            Ok(())
        })
    }

    /// è®¾ç½®åª’ä½“çŠ¶æ€ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
    #[pallet::weight(T::WeightInfo::set_media_status())]
    pub fn set_media_status(
        origin: OriginFor<T>,
        media_id: u32,
        enabled: bool,
    ) -> DispatchResult {
        T::AdminOrigin::ensure_origin(origin)?;

        MediaLibrary::<T>::try_mutate(media_id, |entry| {
            let e = entry.as_mut().ok_or(Error::<T>::MediaNotFound)?;
            e.enabled = enabled;
            e.updated_at = <frame_system::Pallet<T>>::block_number();

            // æ›´æ–°å¯ç”¨ç´¢å¼•
            if enabled {
                EnabledMediaIds::<T>::try_mutate(|ids| {
                    if !ids.contains(&media_id) {
                        ids.try_push(media_id)
                    } else {
                        Ok(())
                    }
                })?;
            } else {
                EnabledMediaIds::<T>::mutate(|ids| {
                    ids.retain(|&id| id != media_id);
                });
            }

            Self::deposit_event(Event::MediaStatusChanged { media_id, enabled });
            Ok(())
        })
    }

    /// åˆ é™¤åª’ä½“ï¼ˆè½¯åˆ é™¤ï¼šä»…ç¦ç”¨ï¼‰
    #[pallet::weight(T::WeightInfo::remove_media())]
    pub fn remove_media(
        origin: OriginFor<T>,
        media_id: u32,
    ) -> DispatchResult {
        T::AdminOrigin::ensure_origin(origin)?;

        // è½¯åˆ é™¤ï¼šä»…ç¦ç”¨ï¼Œä¿ç•™è®°å½•
        Self::set_media_status(origin, media_id, false)?;

        Self::deposit_event(Event::MediaRemoved { media_id });
        Ok(())
    }

    /// è®°å½•æ’­æ”¾æ¬¡æ•°ï¼ˆå¯é€‰ï¼ŒPhase 2ï¼‰
    #[pallet::weight(T::WeightInfo::record_play())]
    pub fn record_play(
        origin: OriginFor<T>,
        media_id: u32,
    ) -> DispatchResult {
        ensure_signed(origin)?;

        ensure!(
            MediaLibrary::<T>::contains_key(media_id),
            Error::<T>::MediaNotFound
        );

        MediaStatsOf::<T>::mutate(media_id, |stats| {
            stats.play_count = stats.play_count.saturating_add(1);
            stats.last_played_at = Some(<frame_system::Pallet<T>>::block_number().saturated_into());
        });

        Self::deposit_event(Event::MediaPlayed { media_id });
        Ok(())
    }
}
```

---

### 4.6 è¾…åŠ©æŸ¥è¯¢å‡½æ•°

```rust
impl<T: Config> Pallet<T> {
    /// è·å–æŒ‡å®šåˆ†ç±»çš„æ‰€æœ‰å¯ç”¨åª’ä½“
    pub fn get_media_by_category(category: MediaCategory) -> Vec<u32> {
        let all_ids = MediaByCategory::<T>::get(category);
        all_ids.into_iter()
            .filter(|&id| {
                MediaLibrary::<T>::get(id)
                    .map(|e| e.enabled)
                    .unwrap_or(false)
            })
            .collect()
    }

    /// è·å–æŒ‡å®šç±»å‹çš„æ‰€æœ‰å¯ç”¨åª’ä½“ï¼ˆéŸ³é¢‘æˆ–è§†é¢‘ï¼‰
    pub fn get_media_by_type(media_type: MediaType) -> Vec<u32> {
        let all_ids = MediaByType::<T>::get(media_type);
        all_ids.into_iter()
            .filter(|&id| {
                MediaLibrary::<T>::get(id)
                    .map(|e| e.enabled)
                    .unwrap_or(false)
            })
            .collect()
    }

    /// éšæœºè·å–æŒ‡å®šåˆ†ç±»çš„åª’ä½“
    pub fn get_random_media(category: MediaCategory) -> Option<u32> {
        let media_ids = Self::get_media_by_category(category);
        if media_ids.is_empty() {
            return None;
        }

        // ä½¿ç”¨åŒºå—å“ˆå¸Œä½œä¸ºéšæœºæ•°ç§å­
        let block_hash = <frame_system::Pallet<T>>::block_hash(
            <frame_system::Pallet<T>>::block_number()
        );
        let seed = block_hash.as_ref()[0] as usize;
        let index = seed % media_ids.len();

        media_ids.get(index).copied()
    }

    /// éšæœºè·å–æŒ‡å®šç±»å‹çš„åª’ä½“ï¼ˆç”¨äºå¿«é€ŸæŸ¥è¯¢æ‰€æœ‰éŸ³é¢‘æˆ–æ‰€æœ‰è§†é¢‘ï¼‰
    pub fn get_random_media_by_type(media_type: MediaType) -> Option<u32> {
        let media_ids = Self::get_media_by_type(media_type);
        if media_ids.is_empty() {
            return None;
        }

        let block_hash = <frame_system::Pallet<T>>::block_hash(
            <frame_system::Pallet<T>>::block_number()
        );
        let seed = block_hash.as_ref()[0] as usize;
        let index = seed % media_ids.len();

        media_ids.get(index).copied()
    }

    /// è·å–æ‰€æœ‰å¯ç”¨çš„åª’ä½“ID
    pub fn get_all_enabled_media() -> Vec<u32> {
        EnabledMediaIds::<T>::get().into_inner()
    }

    /// æ£€æŸ¥åª’ä½“æ˜¯å¦å­˜åœ¨ä¸”å¯ç”¨
    pub fn is_media_available(media_id: u32) -> bool {
        MediaLibrary::<T>::get(media_id)
            .map(|e| e.enabled)
            .unwrap_or(false)
    }

    /// è·å–åª’ä½“è¯¦ç»†ä¿¡æ¯
    pub fn get_media_info(media_id: u32) -> Option<MediaEntry<T>> {
        MediaLibrary::<T>::get(media_id)
    }
}
```

---

### 4.7 äº‹ä»¶å®šä¹‰

```rust
#[pallet::event]
#[pallet::generate_deposit(pub(super) fn deposit_event)]
pub enum Event<T: Config> {
    /// åª’ä½“å·²æ·»åŠ 
    MediaAdded {
        media_id: u32,
        media_type: MediaType,
        category: MediaCategory,
    },
    /// åª’ä½“å·²æ›´æ–°
    MediaUpdated {
        media_id: u32,
    },
    /// åª’ä½“çŠ¶æ€å·²å˜æ›´
    MediaStatusChanged {
        media_id: u32,
        enabled: bool,
    },
    /// åª’ä½“å·²åˆ é™¤
    MediaRemoved {
        media_id: u32,
    },
    /// åª’ä½“å·²æ’­æ”¾ï¼ˆå¯é€‰ï¼ŒPhase 2ï¼‰
    MediaPlayed {
        media_id: u32,
    },
}
```

---

### 4.8 é”™è¯¯å®šä¹‰

```rust
#[pallet::error]
pub enum Error<T> {
    /// åª’ä½“ä¸å­˜åœ¨
    MediaNotFound,
    /// åª’ä½“åç§°ä¸ºç©º
    EmptyName,
    /// åª’ä½“åç§°è¿‡é•¿
    NameTooLong,
    /// CIDè¿‡é•¿
    CidTooLong,
    /// æ—¶é•¿æ— æ•ˆ
    InvalidDuration,
    /// åˆ†ç±»å·²æ»¡
    CategoryFull,
    /// åª’ä½“åº“å·²æ»¡
    MediaLibraryFull,
    /// åª’ä½“ç±»å‹ä¸åˆ†ç±»ä¸åŒ¹é…
    MediaTypeMismatch,
}
```

---

## äº”ã€å…¶ä»– Pallet é›†æˆç¤ºä¾‹

### 5.1 pallet-deceased é›†æˆï¼ˆéŸ³é¢‘+è§†é¢‘ï¼‰

```rust
// pallets/deceased/src/lib.rs

#[pallet::config]
pub trait Config: frame_system::Config {
    // ... ç°æœ‰é…ç½®

    /// å…¬å…±åª’ä½“åº“æ¥å£
    type PublicMedia: PublicMediaProvider;
}

// ä½¿ç”¨ç¤ºä¾‹
impl<T: Config> Pallet<T> {
    /// è·å–é€è€…çºªå¿µé¦†æ¨èèƒŒæ™¯éŸ³ä¹
    pub fn get_memorial_audio(deceased_id: u64) -> Option<u32> {
        // 1. æ£€æŸ¥æ˜¯å¦æœ‰èƒŒæ™¯éŸ³ä¹è®¾ç½®
        if let Some(deceased) = DeceasedOf::<T>::get(deceased_id) {
            if deceased.background_music_id.is_some() {
                return deceased.background_music_id;
            }
        }

        // 2. ä½¿ç”¨å…¬å…±åª’ä½“åº“çš„é»˜è®¤éŸ³ä¹
        T::PublicMedia::get_random_media(MediaCategory::Audio(AudioCategory::Requiem))
    }

    /// è·å–é€è€…çºªå¿µé¦†ç”Ÿå¹³è§†é¢‘
    pub fn get_memorial_video(deceased_id: u64) -> Option<u32> {
        // 1. æ£€æŸ¥æ˜¯å¦æœ‰ç”Ÿå¹³è§†é¢‘è®¾ç½®
        if let Some(deceased) = DeceasedOf::<T>::get(deceased_id) {
            if deceased.biography_video_id.is_some() {
                return deceased.biography_video_id;
            }
        }

        // 2. ä½¿ç”¨å…¬å…±åª’ä½“åº“çš„é»˜è®¤è§†é¢‘
        T::PublicMedia::get_random_media(MediaCategory::Video(VideoCategory::Biography))
    }
}
```

---

### 5.2 pallet-stardust-park é›†æˆï¼ˆé™µå›­å®£ä¼ è§†é¢‘+ç¯å¢ƒéŸ³ä¹ï¼‰

```rust
// pallets/stardust-park/src/lib.rs

#[pallet::config]
pub trait Config: frame_system::Config {
    // ... ç°æœ‰é…ç½®

    /// å…¬å…±åª’ä½“åº“æ¥å£
    type PublicMedia: PublicMediaProvider;
}

impl<T: Config> Pallet<T> {
    /// è·å–é™µå›­å…¥å£èƒŒæ™¯éŸ³ä¹
    pub fn get_park_entrance_audio(park_id: u64) -> Option<u32> {
        // é™µå›­ä½¿ç”¨è½»éŸ³ä¹æˆ–ç¯å¢ƒéŸ³ä¹
        T::PublicMedia::get_random_media(MediaCategory::Audio(AudioCategory::Ambient))
    }

    /// è·å–é™µå›­å®£ä¼ è§†é¢‘
    pub fn get_park_promotional_video(park_id: u64) -> Option<u32> {
        // é™µå›­ä½¿ç”¨å®£ä¼ ç‰‡
        T::PublicMedia::get_random_media(MediaCategory::Video(VideoCategory::Promotional))
    }
}
```

---

### 5.3 Trait å®šä¹‰ï¼ˆåœ¨ primitives ä¸­ï¼‰

```rust
// primitives/src/traits.rs

/// å…¬å…±åª’ä½“åº“æ¥å£ï¼ˆéŸ³é¢‘+è§†é¢‘ï¼‰
pub trait PublicMediaProvider {
    /// è·å–æŒ‡å®šåˆ†ç±»çš„éšæœºåª’ä½“
    fn get_random_media(category: MediaCategory) -> Option<u32>;

    /// è·å–æŒ‡å®šç±»å‹çš„éšæœºåª’ä½“ï¼ˆéŸ³é¢‘æˆ–è§†é¢‘ï¼‰
    fn get_random_media_by_type(media_type: MediaType) -> Option<u32>;

    /// è·å–æŒ‡å®šåˆ†ç±»çš„æ‰€æœ‰åª’ä½“
    fn get_media_by_category(category: MediaCategory) -> Vec<u32>;

    /// è·å–æŒ‡å®šç±»å‹çš„æ‰€æœ‰åª’ä½“
    fn get_media_by_type(media_type: MediaType) -> Vec<u32>;

    /// æ£€æŸ¥åª’ä½“æ˜¯å¦å¯ç”¨
    fn is_media_available(media_id: u32) -> bool;

    /// è·å–åª’ä½“ä¿¡æ¯
    fn get_media_info(media_id: u32) -> Option<MediaInfo>;
}

/// åª’ä½“ä¿¡æ¯ï¼ˆç®€åŒ–ç‰ˆï¼Œç”¨äºè·¨ Pallet ä¼ é€’ï¼‰
pub struct MediaInfo {
    pub id: u32,
    pub media_type: MediaType,
    pub name: Vec<u8>,
    pub media_cid: Vec<u8>,
    pub duration: u32,
    pub category: MediaCategory,
    pub quality: Option<VideoQuality>,  // ä»…è§†é¢‘æœ‰å€¼
}
```

---

## å…­ã€Runtime é›†æˆ

```rust
// runtime/src/lib.rs

// 1. æ·»åŠ  Pallet
pub use pallet_public_media;

// 2. é…ç½®
impl pallet_public_media::Config for Runtime {
    type RuntimeEvent = RuntimeEvent;
    type StringLimit = ConstU32<128>;
    type CidLimit = ConstU32<64>;
    type AdminOrigin = EnsureRootOrHalfCouncil;
    type WeightInfo = pallet_public_media::weights::SubstrateWeight<Runtime>;
}

// 3. é›†æˆåˆ° Runtime
construct_runtime!(
    pub struct Runtime {
        // ... ç°æœ‰ Pallets
        PublicMedia: pallet_public_media,
    }
);

// 4. ä¸º Deceased é…ç½®åª’ä½“åº“æ¥å£
impl pallet_deceased::Config for Runtime {
    // ... ç°æœ‰é…ç½®
    type PublicMedia = PublicMedia;
}

// 5. ä¸º Park é…ç½®åª’ä½“åº“æ¥å£
impl pallet_stardust_park::Config for Runtime {
    // ... ç°æœ‰é…ç½®
    type PublicMedia = PublicMedia;
}
```

---

## ä¸ƒã€å¯è¡Œæ€§è¯„ä¼°

### 7.1 æŠ€æœ¯å¯è¡Œæ€§

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **å¼€å‘éš¾åº¦** | â­â­ | ç®€å•ï¼Œæ ‡å‡† Pallet ç»“æ„ |
| **æµ‹è¯•éš¾åº¦** | â­â­ | å•å…ƒæµ‹è¯•ç®€å• |
| **é›†æˆéš¾åº¦** | â­â­ | Runtime é…ç½®ç®€å• |
| **ç»´æŠ¤æˆæœ¬** | â­ | ç‹¬ç«‹ç»´æŠ¤ï¼Œæˆæœ¬ä½ |

**ç»“è®º**: âœ… æŠ€æœ¯å¯è¡Œæ€§æé«˜

---

### 7.2 åˆç†æ€§è¯„ä¼°

#### æ¶æ„åˆç†æ€§ â­â­â­â­â­

**ä¼˜ç‚¹**:
1. **ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™**: ä¸“æ³¨åª’ä½“ç®¡ç†ï¼ˆéŸ³é¢‘+è§†é¢‘ï¼‰
2. **ä½è€¦åˆé«˜å†…èš**: ä¸ä¸šåŠ¡ Pallet è§£è€¦
3. **æ˜“äºæ‰©å±•**: æ”¯æŒæœªæ¥æ›´å¤šåœºæ™¯å’Œåª’ä½“ç±»å‹
4. **å¯å¤ç”¨æ€§å¼º**: å…¶ä»–é¡¹ç›®å¯ç›´æ¥ä½¿ç”¨
5. **ç»Ÿä¸€æ¥å£**: éŸ³é¢‘å’Œè§†é¢‘ä½¿ç”¨ç›¸åŒçš„ç®¡ç†æ¨¡å¼

#### ä¸šåŠ¡åˆç†æ€§ â­â­â­â­â­

**ä¼˜ç‚¹**:
1. **è·¨é¢†åŸŸåŸºç¡€è®¾æ–½**: å¤šä¸ª Pallet å…±äº«ï¼ˆéŸ³é¢‘+è§†é¢‘ï¼‰
2. **è¯­ä¹‰æ¸…æ™°**: åç§°æ˜ç¡®è¡¨è¾¾åŠŸèƒ½
3. **æ˜“äºæ²»ç†**: ç»Ÿä¸€ç®¡ç†åª’ä½“èµ„æº
4. **ç‰ˆæƒç®¡ç†**: é›†ä¸­å¤„ç†ç‰ˆæƒé—®é¢˜
5. **åŠŸèƒ½å®Œæ•´**: åŒæ—¶æ”¯æŒéŸ³é¢‘æ°›å›´å’Œè§†é¢‘å±•ç¤ºéœ€æ±‚

#### æˆæœ¬æ•ˆç›Šåˆ†æ â­â­â­â­â­

| æˆæœ¬ | æ”¶ç›Š |
|------|------|
| å¼€å‘æˆæœ¬: 2-3å¤© | æ¶æ„æ¸…æ™°ï¼Œæ˜“ç»´æŠ¤ |
| é›†æˆæˆæœ¬: 0.5å¤© | å¤š Pallet å¤ç”¨ï¼ˆéŸ³é¢‘+è§†é¢‘ï¼‰ |
| ç»´æŠ¤æˆæœ¬: æä½ | ç‹¬ç«‹æ¼”è¿›ï¼Œç»Ÿä¸€æ¥å£ |
| åˆå§‹åª’ä½“å‡†å¤‡: 1å¤© | ä¸°å¯Œçš„åª’ä½“èµ„æºåº“ |

**ROI**: æé«˜ï¼ˆæŠ•å…¥3-4å¤©ï¼Œé•¿æœŸæ”¶ç›Šæ˜¾è‘—ï¼‰

---

## å…«ã€ä¸æ–¹æ¡ˆAçš„å¯¹æ¯”

| ç»´åº¦ | æ–¹æ¡ˆAï¼ˆé›†æˆåˆ° Deceasedï¼‰ | æ–¹æ¡ˆBï¼ˆç‹¬ç«‹ Palletï¼‰ | èƒœè€… |
|------|------------------------|---------------------|------|
| **å¼€å‘æˆæœ¬** | 1å¤© | 3å¤© | A |
| **æ”¯æŒåª’ä½“ç±»å‹** | ä»…éŸ³é¢‘ | éŸ³é¢‘+è§†é¢‘ | B |
| **æ¶æ„æ¸…æ™°åº¦** | â­â­ | â­â­â­â­â­ | B |
| **å¯ç»´æŠ¤æ€§** | â­â­ | â­â­â­â­â­ | B |
| **å¯æ‰©å±•æ€§** | â­â­ | â­â­â­â­â­ | B |
| **ä¾èµ–åˆç†æ€§** | â­ | â­â­â­â­â­ | B |
| **å¤ç”¨æ€§** | â­ | â­â­â­â­â­ | B |
| **é•¿æœŸæˆæœ¬** | é«˜ | ä½ | B |

**ç»¼åˆè¯„åˆ†**:
- æ–¹æ¡ˆA: â­â­ (ä»…é€‚åˆå¿«é€ŸåŸå‹ï¼ŒåŠŸèƒ½å—é™)
- æ–¹æ¡ˆB: â­â­â­â­â­ (ç”Ÿäº§çº§è®¾è®¡ï¼ŒåŠŸèƒ½å®Œæ•´)

---

## ä¹ã€å®æ–½è®¡åˆ’

### Phase 1: æ ¸å¿ƒåŠŸèƒ½ï¼ˆ3å¤©ï¼‰

**Day 1**:
- âœ… åˆ›å»º `pallet-public-media` ç»“æ„
- âœ… å®ç°æ•°æ®ç»“æ„ï¼ˆMediaType, AudioCategory, VideoCategoryï¼‰
- âœ… å®ç°å­˜å‚¨è®¾è®¡ï¼ˆMediaLibrary, MediaByType, MediaByCategoryï¼‰
- âœ… ç¼–å†™ç±»å‹ç³»ç»Ÿå•å…ƒæµ‹è¯•

**Day 2**:
- âœ… å®ç°æ ¸å¿ƒæ¥å£ï¼ˆadd_media/update_media/set_media_statusï¼‰
- âœ… å®ç°è¾…åŠ©æŸ¥è¯¢å‡½æ•°ï¼ˆæŒ‰ç±»å‹ã€æŒ‰åˆ†ç±»æŸ¥è¯¢ï¼‰
- âœ… ç¼–å†™åŠŸèƒ½å•å…ƒæµ‹è¯•ï¼ˆéŸ³é¢‘å’Œè§†é¢‘åˆ†åˆ«æµ‹è¯•ï¼‰

**Day 3**:
- âœ… å®šä¹‰ `PublicMediaProvider` Trait
- âœ… Runtime é›†æˆ
- âœ… ç¼–å†™é›†æˆæµ‹è¯•ï¼ˆè·¨ Pallet è°ƒç”¨æµ‹è¯•ï¼‰
- âœ… å‡†å¤‡åˆå§‹åª’ä½“èµ„æºï¼ˆ5ä¸ªéŸ³é¢‘ + 5ä¸ªè§†é¢‘ï¼‰

---

### Phase 2: æ‰©å±•åŠŸèƒ½ï¼ˆ1å‘¨ï¼Œå¯é€‰ï¼‰

**Day 4-5**:
- æ’­æ”¾ç»Ÿè®¡åŠŸèƒ½ï¼ˆéŸ³é¢‘å’Œè§†é¢‘ï¼‰
- ç”¨æˆ·è¯„åˆ†åŠŸèƒ½
- åª’ä½“æ¨èç®—æ³•ï¼ˆåŸºäºåœºæ™¯å’Œç”¨æˆ·åå¥½ï¼‰

**Day 6-8**:
- ç‰ˆæƒä¿¡æ¯ç®¡ç†ï¼ˆéŸ³é¢‘å’Œè§†é¢‘ç‰ˆæƒè¿½è¸ªï¼‰
- åª’ä½“å®¡æ ¸æµç¨‹ï¼ˆæ²»ç†å§”å‘˜ä¼šå®¡æ ¸ï¼‰
- å­—å¹•ç®¡ç†ï¼ˆè§†é¢‘å¤šè¯­è¨€å­—å¹•ï¼‰
- å¤šåˆ†è¾¨ç‡æ”¯æŒï¼ˆè§†é¢‘è´¨é‡è‡ªé€‚åº”ï¼‰

---

## åã€é£é™©ä¸åº”å¯¹

### 10.1 æŠ€æœ¯é£é™©

| é£é™© | ç­‰çº§ | åº”å¯¹æªæ–½ |
|------|------|---------|
| **å­˜å‚¨è†¨èƒ€** | ğŸŸ¡ ä¸­ | é™åˆ¶åª’ä½“æ•°é‡ï¼ˆéŸ³é¢‘500ä¸ª+è§†é¢‘500ä¸ªï¼‰ï¼Œä»…å­˜CID |
| **æŸ¥è¯¢æ€§èƒ½** | ğŸŸ¢ ä½ | ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–ï¼Œåˆ†ç±»å’Œç±»å‹æŸ¥è¯¢O(1) |
| **å¹¶å‘å†²çª** | ğŸŸ¢ ä½ | ä½¿ç”¨ `try_mutate` ä¿è¯åŸå­æ€§ |
| **è§†é¢‘å¤§å°** | ğŸŸ¡ ä¸­ | å»ºè®®è§†é¢‘æ—¶é•¿â‰¤5åˆ†é’Ÿï¼Œåˆ†è¾¨ç‡â‰¤1080p |

### 10.2 ä¸šåŠ¡é£é™©

| é£é™© | ç­‰çº§ | åº”å¯¹æªæ–½ |
|------|------|---------|
| **ç‰ˆæƒçº çº·** | ğŸ”´ é«˜ | ä½¿ç”¨CC0/CC-BYåª’ä½“ï¼Œè®°å½•æ¥æºå’Œæˆæƒä¿¡æ¯ |
| **å†…å®¹å®¡æ ¸** | ğŸŸ¡ ä¸­ | æ²»ç†å§”å‘˜ä¼šå®¡æ ¸ï¼Œç”¨æˆ·ä¸¾æŠ¥æœºåˆ¶ |
| **æ»¥ç”¨é£é™©** | ğŸŸ¢ ä½ | Root/æ²»ç†å§”å‘˜ä¼šæƒé™æ§åˆ¶ |
| **å¸¦å®½æˆæœ¬** | ğŸŸ¡ ä¸­ | IPFSå…¬å…±ç½‘å…³ï¼Œè§†é¢‘é‡‡ç”¨æµåª’ä½“åè®® |

---

## åä¸€ã€æ€»ç»“ä¸å»ºè®®

### 11.1 æ ¸å¿ƒç»“è®º

âœ… **å¼ºçƒˆæ¨èç‹¬ç«‹åˆ›å»º `pallet-public-media`ï¼ˆéŸ³é¢‘+è§†é¢‘ç»Ÿä¸€ç®¡ç†ï¼‰**

**ç†ç”±**:
1. **æ¶æ„ä¼˜é›…**: ä½è€¦åˆã€é«˜å†…èšã€ç¬¦åˆè®¾è®¡åŸåˆ™
2. **åŠŸèƒ½å®Œæ•´**: åŒæ—¶æ”¯æŒéŸ³é¢‘æ°›å›´è¥é€ å’Œè§†é¢‘å†…å®¹å±•ç¤º
3. **é•¿æœŸæ”¶ç›Š**: å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§ã€å¤ç”¨æ€§æé«˜
4. **æˆæœ¬å¯æ§**: å¼€å‘3å¤©ï¼Œä½†é•¿æœŸç»´æŠ¤æˆæœ¬ä½
5. **ä¸šåŠ¡åˆç†**: è·¨é¢†åŸŸåŸºç¡€è®¾æ–½ï¼Œç‹¬ç«‹ç®¡ç†æœ€åˆç†
6. **ç»Ÿä¸€æ¥å£**: éŸ³é¢‘å’Œè§†é¢‘ä½¿ç”¨ç›¸åŒç®¡ç†æ¨¡å¼ï¼Œé™ä½å­¦ä¹ æˆæœ¬

### 11.2 å®æ–½å»ºè®®

**ç«‹å³è¡ŒåŠ¨**:
1. âœ… åˆ›å»º `pallet-public-media`ï¼ˆç»Ÿä¸€éŸ³é¢‘+è§†é¢‘ï¼‰
2. âœ… å®ç°æ ¸å¿ƒåŠŸèƒ½ï¼ˆ3å¤©ï¼‰
3. âœ… Runtime é›†æˆ
4. âœ… å‡†å¤‡åˆå§‹åª’ä½“åº“ï¼ˆ5ä¸ªéŸ³é¢‘ + 5ä¸ªè§†é¢‘ï¼‰

**åç»­è¿­ä»£**:
5. æ·»åŠ æ’­æ”¾ç»Ÿè®¡ï¼ˆPhase 2ï¼‰
6. å®ç°åª’ä½“æ¨èï¼ˆPhase 3ï¼‰
7. ç‰ˆæƒç®¡ç†ç³»ç»Ÿï¼ˆPhase 4ï¼‰
8. è§†é¢‘å­—å¹•å’Œå¤šåˆ†è¾¨ç‡æ”¯æŒï¼ˆPhase 5ï¼‰

---

### 11.3 æˆåŠŸæ¡ˆä¾‹å‚è€ƒ

ç±»ä¼¼çš„ç‹¬ç«‹åŸºç¡€è®¾æ–½ Pallet:
- `pallet-balances`: è´§å¸ç®¡ç†ï¼Œè¢«æ‰€æœ‰ Pallet ä½¿ç”¨
- `pallet-assets`: èµ„äº§ç®¡ç†ï¼Œè·¨é¢†åŸŸå¤ç”¨
- `pallet-nfts`: NFTç®¡ç†ï¼Œå¤šåœºæ™¯ä½¿ç”¨
- **`pallet-public-media`**: åª’ä½“ç®¡ç†ï¼ˆéŸ³é¢‘+è§†é¢‘ï¼‰ï¼Œè·¨ä¸šåŠ¡å¤ç”¨ âœ¨

---

**åˆ†æå®Œæˆæ—¶é—´**: 2025-11-23
**åˆ†æäºº**: Claude Code
**æ¨èæ–¹æ¡ˆ**: â­â­â­â­â­ æ–¹æ¡ˆB - ç‹¬ç«‹ Palletï¼ˆç»Ÿä¸€éŸ³é¢‘+è§†é¢‘ï¼‰
**ä¼˜å…ˆçº§**: é«˜ï¼ˆå»ºè®®ç«‹å³å®æ–½ï¼‰
