# æŠ¼é‡‘ç®¡ç†æ¨¡å—æ¶æ„æ·±åº¦åˆ†æ - é‡æ–°å®¡è§†

## ğŸ¯ é—®é¢˜é‡è¿°

**ç”¨æˆ·çš„æ ¸å¿ƒè´¨ç–‘**ï¼š
> æ—¢ç„¶ `pallet-memo-content-governance` å¯ä»¥ä½œä¸º**é€šç”¨æ¨¡å—**å¤„ç†æ‰€æœ‰palletçš„ç”³è¯‰æµç¨‹ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æœ‰ä¸€ä¸ª**ä¸“é—¨çš„æŠ¼é‡‘ç®¡ç†æ¨¡å—**å¤„ç†æ‰€æœ‰palletçš„æŠ¼é‡‘åŠŸèƒ½ï¼Ÿè¿™æ ·çš„è®¾è®¡æ˜¯å¦å­˜åœ¨é€»è¾‘çŸ›ç›¾ï¼Ÿ

**è¿™ä¸ªè´¨ç–‘éå¸¸æœ‰é“ç†ï¼**

---

## ğŸ” é‡æ–°åˆ†æï¼šä¸¤ç§ç†è§£

### ç†è§£Aï¼šé€šç”¨æŠ¼é‡‘ç®¡ç†æ¨¡å—ï¼ˆè·¨æ‰€æœ‰åœºæ™¯ï¼‰

```
pallet-depositsï¼ˆé€šç”¨æŠ¼é‡‘ç®¡ç†ï¼‰
    â†“
å¤„ç†æ‰€æœ‰æŠ¼é‡‘åœºæ™¯ï¼š
- ç”³è¯‰æŠ¼é‡‘ï¼ˆcontent-governanceï¼‰
- æ°‘ä¸»æŠ•ç¥¨æŠ¼é‡‘ï¼ˆdemocracyï¼‰
- å›½åº“ææ¡ˆæŠ¼é‡‘ï¼ˆtreasuryï¼‰
- èµé‡‘æŠ¼é‡‘ï¼ˆbountiesï¼‰
- èº«ä»½éªŒè¯æŠ¼é‡‘ï¼ˆidentityï¼‰
- ä¾›å¥‰å“å®¡æ ¸æŠ¼é‡‘ï¼ˆofferingsï¼‰
- ç”¨æˆ·è‡ªå®šä¹‰åœºæ™¯æŠ¼é‡‘
```

**è¿™ç§ç†è§£ä¸‹ï¼Œä¸“é—¨çš„æŠ¼é‡‘æ¨¡å—æ˜¯æœ‰æ„ä¹‰çš„ï¼**

### ç†è§£Bï¼šä»…ç”³è¯‰æŠ¼é‡‘ç®¡ç†æ¨¡å—

```
pallet-appeal-depositsï¼ˆä»…ç”³è¯‰æŠ¼é‡‘ï¼‰
    â†“
åªå¤„ç†ç”³è¯‰ç›¸å…³æŠ¼é‡‘ï¼š
- å†»ç»“/è§£å†»
- ç½šæ²¡/é€€è¿˜
- åˆ†è´¦é€»è¾‘
```

**è¿™ç§ç†è§£ä¸‹ï¼Œä¸“é—¨çš„æ¨¡å—æ„ä¹‰ä¸å¤§ï¼ˆå› ä¸ºä¸ç”³è¯‰æµç¨‹ç´§è€¦åˆï¼‰**

---

## ğŸ“Š é€»è¾‘å¯¹æ¯”åˆ†æ

### å½“å‰æ¶æ„çš„é€»è¾‘

| æ¨¡å— | å¤„ç†èŒƒå›´ | é€šç”¨æ€§ | ç†ç”± |
|-----|---------|-------|------|
| **pallet-memo-content-governance** | æ‰€æœ‰palletçš„ç”³è¯‰ | âœ… é€šç”¨ | ç”³è¯‰æµç¨‹ç‹¬ç«‹äºå…·ä½“ä¸šåŠ¡ |
| **æŠ¼é‡‘ç®¡ç†** | ä»…æœ¬æ¨¡å—ç”³è¯‰æŠ¼é‡‘ | âŒ ä¸é€šç”¨ | ä¸ç”³è¯‰æµç¨‹è€¦åˆ |

**å­˜åœ¨çš„é€»è¾‘é—®é¢˜**ï¼š
- âŒ ç”³è¯‰ç®¡ç†æ˜¯é€šç”¨çš„ï¼Œä½†æŠ¼é‡‘ç®¡ç†ä¸é€šç”¨
- âŒ å…¶ä»–æ¨¡å—ï¼ˆdemocracyã€treasuryç­‰ï¼‰å„è‡ªç®¡ç†æŠ¼é‡‘ï¼Œé‡å¤ä»£ç 
- âŒ ç¼ºä¹ç»Ÿä¸€çš„æŠ¼é‡‘ç­–ç•¥ï¼ˆåŠ¨æ€æŠ¼é‡‘ã€ç½šæ²¡æ¯”ä¾‹ç­‰ï¼‰

---

## ğŸ—ï¸ ä¸‰ç§æ¶æ„æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ1ï¼šå½“å‰æ¶æ„ï¼ˆåˆ†æ•£å¼ï¼‰

```
pallet-memo-content-governance
â”œâ”€ ç”³è¯‰æµç¨‹ç®¡ç†ï¼ˆé€šç”¨ï¼‰
â””â”€ æŠ¼é‡‘ç®¡ç†ï¼ˆä»…ç”³è¯‰ï¼‰

pallet-democracy
â”œâ”€ æŠ•ç¥¨æµç¨‹ç®¡ç†
â””â”€ æŠ¼é‡‘ç®¡ç†ï¼ˆä»…æŠ•ç¥¨ï¼‰

pallet-treasury
â”œâ”€ ææ¡ˆæµç¨‹ç®¡ç†
â””â”€ æŠ¼é‡‘ç®¡ç†ï¼ˆä»…ææ¡ˆï¼‰

pallet-memo-offerings
â”œâ”€ ä¾›å¥‰å“å®¡æ ¸æµç¨‹
â””â”€ æŠ¼é‡‘ç®¡ç†ï¼ˆä»…å®¡æ ¸ï¼‰
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç®€å•ç›´æ¥
- âœ… æ¨¡å—è‡ªåŒ…å«

**ç¼ºç‚¹**ï¼š
- âŒ é‡å¤ä»£ç ï¼ˆæ¯ä¸ªæ¨¡å—éƒ½å®ç°æŠ¼é‡‘é€»è¾‘ï¼‰
- âŒ ç­–ç•¥ä¸ç»Ÿä¸€ï¼ˆæ¯ä¸ªæ¨¡å—æŠ¼é‡‘è§„åˆ™ä¸åŒï¼‰
- âŒ éš¾ä»¥ç»´æŠ¤ï¼ˆä¿®æ”¹æŠ¼é‡‘é€»è¾‘éœ€è¦æ”¹å¤šä¸ªæ¨¡å—ï¼‰
- âŒ é€»è¾‘ä¸ä¸€è‡´ï¼ˆcontent-governanceæ˜¯é€šç”¨çš„ï¼ŒæŠ¼é‡‘å´ä¸æ˜¯ï¼‰

---

### æ–¹æ¡ˆ2ï¼šå‚ç›´æ‹†åˆ†ï¼ˆä»…ç”³è¯‰æŠ¼é‡‘ç‹¬ç«‹ï¼‰

```
pallet-memo-content-governance
â”œâ”€ ç”³è¯‰æµç¨‹ç®¡ç†ï¼ˆé€šç”¨ï¼‰
â””â”€ è°ƒç”¨ â†“

pallet-appeal-deposits
â””â”€ ç”³è¯‰æŠ¼é‡‘ç®¡ç†ï¼ˆä»…ç”³è¯‰ï¼‰

pallet-democracy
â”œâ”€ æŠ•ç¥¨æµç¨‹ç®¡ç†
â””â”€ æŠ¼é‡‘ç®¡ç†ï¼ˆä»…æŠ•ç¥¨ï¼‰

pallet-treasury
â”œâ”€ ææ¡ˆæµç¨‹ç®¡ç†
â””â”€ æŠ¼é‡‘ç®¡ç†ï¼ˆä»…ææ¡ˆï¼‰
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç”³è¯‰æŠ¼é‡‘é€»è¾‘ç‹¬ç«‹

**ç¼ºç‚¹**ï¼š
- âŒ **åªè§£å†³äº†ä¸€ä¸ªåœºæ™¯**ï¼ˆç”³è¯‰ï¼‰
- âŒ democracyã€treasuryç­‰ä»å„è‡ªç®¡ç†æŠ¼é‡‘
- âŒ å¢åŠ æ¨¡å—é—´è€¦åˆï¼ˆgovernanceä¾èµ–depositsï¼‰
- âŒ æ”¶ç›Šä¸æ˜æ˜¾ï¼ˆä»…ä¸€ä¸ªåœºæ™¯å—ç›Šï¼‰

**ç»“è®º**ï¼šè¿™ä¸ªæ–¹æ¡ˆç¡®å®æ„ä¹‰ä¸å¤§ï¼ˆæˆ‘ä¹‹å‰çš„å›ç­”åŸºäºæ­¤ç†è§£ï¼‰

---

### æ–¹æ¡ˆ3ï¼šé€šç”¨æŠ¼é‡‘ç®¡ç†ï¼ˆæ¨ªå‘æŠ½è±¡ï¼‰âœ… æ¨è

```
pallet-depositsï¼ˆé€šç”¨æŠ¼é‡‘ç®¡ç†ï¼‰
    â†“ æä¾›æŠ¼é‡‘æœåŠ¡
    â”œâ”€ pallet-memo-content-governanceï¼ˆç”³è¯‰ï¼‰
    â”œâ”€ pallet-democracyï¼ˆæŠ•ç¥¨ï¼‰
    â”œâ”€ pallet-treasuryï¼ˆææ¡ˆï¼‰
    â”œâ”€ pallet-bountiesï¼ˆèµé‡‘ï¼‰
    â”œâ”€ pallet-memo-offeringsï¼ˆä¾›å¥‰å“å®¡æ ¸ï¼‰
    â””â”€ ç”¨æˆ·è‡ªå®šä¹‰pallet
```

**æ¶æ„è®¾è®¡**ï¼š

```rust
// pallet-deposits/src/lib.rs

/// é€šç”¨æŠ¼é‡‘åœºæ™¯æšä¸¾
pub enum DepositPurpose<AccountId> {
    /// ç”³è¯‰æŠ¼é‡‘
    ContentAppeal { 
        appeal_id: u64,
        domain: u8,
        target: u64,
    },
    /// æ°‘ä¸»æŠ•ç¥¨æŠ¼é‡‘
    DemocracyProposal {
        proposal_index: u32,
    },
    /// å›½åº“ææ¡ˆæŠ¼é‡‘
    TreasuryProposal {
        proposal_id: u32,
    },
    /// ä¾›å¥‰å“å®¡æ ¸æŠ¼é‡‘
    OfferingReview {
        kind_code: u8,
    },
    /// ç”¨æˆ·è‡ªå®šä¹‰
    Custom {
        pallet_name: Vec<u8>,
        purpose_id: u64,
        metadata: Vec<u8>,
    },
}

/// æŠ¼é‡‘è®°å½•
pub struct DepositRecord<AccountId, Balance, BlockNumber> {
    pub who: AccountId,
    pub amount: Balance,
    pub purpose: DepositPurpose<AccountId>,
    pub reserved_at: BlockNumber,
    pub can_release_at: Option<BlockNumber>,
    pub status: DepositStatus,
}

pub enum DepositStatus {
    Reserved,      // å·²å†»ç»“
    Released,      // å·²é‡Šæ”¾
    Slashed,       // å·²ç½šæ²¡
    PartiallySlashed { amount: Balance },  // éƒ¨åˆ†ç½šæ²¡
}

#[pallet::call]
impl<T: Config> Pallet<T> {
    /// å†»ç»“æŠ¼é‡‘
    pub fn reserve_deposit(
        pallet_id: Vec<u8>,
        who: AccountId,
        amount: Balance,
        purpose: DepositPurpose<AccountId>,
    ) -> DispatchResult {
        // 1. å†»ç»“æŠ¼é‡‘
        T::Currency::reserve(&who, amount)?;
        
        // 2. è®°å½•æŠ¼é‡‘ä¿¡æ¯
        let deposit_id = NextDepositId::<T>::get();
        Deposits::<T>::insert(deposit_id, DepositRecord {
            who: who.clone(),
            amount,
            purpose: purpose.clone(),
            reserved_at: now,
            can_release_at: None,
            status: DepositStatus::Reserved,
        });
        
        // 3. å»ºç«‹ç´¢å¼•
        DepositsByPallet::<T>::append(pallet_id.clone(), deposit_id);
        DepositsByAccount::<T>::append(who.clone(), deposit_id);
        
        Self::deposit_event(Event::DepositReserved {
            deposit_id,
            who,
            amount,
            purpose,
        });
        
        Ok(())
    }
    
    /// é‡Šæ”¾æŠ¼é‡‘
    pub fn release_deposit(
        deposit_id: u64,
    ) -> DispatchResult {
        let mut deposit = Deposits::<T>::get(deposit_id)
            .ok_or(Error::<T>::DepositNotFound)?;
        
        ensure!(
            deposit.status == DepositStatus::Reserved,
            Error::<T>::InvalidStatus
        );
        
        // é‡Šæ”¾æŠ¼é‡‘
        T::Currency::unreserve(&deposit.who, deposit.amount);
        
        // æ›´æ–°çŠ¶æ€
        deposit.status = DepositStatus::Released;
        Deposits::<T>::insert(deposit_id, deposit.clone());
        
        Self::deposit_event(Event::DepositReleased {
            deposit_id,
            who: deposit.who,
            amount: deposit.amount,
        });
        
        Ok(())
    }
    
    /// ç½šæ²¡æŠ¼é‡‘
    pub fn slash_deposit(
        deposit_id: u64,
        slash_ratio: Perbill,
        beneficiary: AccountId,
    ) -> DispatchResult {
        let mut deposit = Deposits::<T>::get(deposit_id)
            .ok_or(Error::<T>::DepositNotFound)?;
        
        ensure!(
            deposit.status == DepositStatus::Reserved,
            Error::<T>::InvalidStatus
        );
        
        // è®¡ç®—ç½šæ²¡é‡‘é¢
        let slash_amount = slash_ratio * deposit.amount;
        let refund_amount = deposit.amount - slash_amount;
        
        // 1. é‡Šæ”¾æŠ¼é‡‘
        T::Currency::unreserve(&deposit.who, deposit.amount);
        
        // 2. ç½šæ²¡éƒ¨åˆ†è½¬è´¦
        if !slash_amount.is_zero() {
            T::Currency::transfer(
                &deposit.who,
                &beneficiary,
                slash_amount,
                ExistenceRequirement::KeepAlive,
            )?;
        }
        
        // 3. æ›´æ–°çŠ¶æ€
        deposit.status = if refund_amount.is_zero() {
            DepositStatus::Slashed
        } else {
            DepositStatus::PartiallySlashed { amount: slash_amount }
        };
        Deposits::<T>::insert(deposit_id, deposit.clone());
        
        Self::deposit_event(Event::DepositSlashed {
            deposit_id,
            who: deposit.who,
            slashed: slash_amount,
            refunded: refund_amount,
        });
        
        Ok(())
    }
}
```

**è°ƒç”¨æ–¹å¼**ï¼š

```rust
// pallet-memo-content-governance/src/lib.rs

#[pallet::call]
impl<T: Config> Pallet<T> {
    pub fn submit_appeal(...) -> DispatchResult {
        let who = ensure_signed(origin)?;
        
        // è°ƒç”¨é€šç”¨æŠ¼é‡‘æ¨¡å—
        let deposit_id = T::DepositManager::reserve_deposit(
            b"ContentGovernance".to_vec(),
            who.clone(),
            deposit_amount,
            DepositPurpose::ContentAppeal {
                appeal_id: id,
                domain,
                target,
            },
        )?;
        
        // ç”³è¯‰è®°å½•ä¸­å­˜å‚¨deposit_id
        Appeals::<T>::insert(id, Appeal {
            deposit_id,
            // ... å…¶ä»–å­—æ®µ
        });
        
        Ok(())
    }
    
    pub fn approve_appeal(...) -> DispatchResult {
        // ... å®¡æ‰¹é€»è¾‘ ...
        
        // æ‰§è¡ŒæˆåŠŸåé‡Šæ”¾æŠ¼é‡‘
        T::DepositManager::release_deposit(appeal.deposit_id)?;
        
        Ok(())
    }
    
    pub fn reject_appeal(...) -> DispatchResult {
        // ... æ‹’ç»é€»è¾‘ ...
        
        // ç½šæ²¡æŠ¼é‡‘
        T::DepositManager::slash_deposit(
            appeal.deposit_id,
            Perbill::from_percent(30),  // 30%ç½šæ²¡
            T::TreasuryAccount::get(),
        )?;
        
        Ok(())
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… **é€»è¾‘ä¸€è‡´**ï¼šåƒgovernanceä¸€æ ·ï¼Œæ˜¯é€šç”¨çš„æ¨ªå‘æœåŠ¡
- âœ… **æ¶ˆé™¤é‡å¤**ï¼šæ‰€æœ‰palletå…±äº«æŠ¼é‡‘é€»è¾‘
- âœ… **ç»Ÿä¸€ç­–ç•¥**ï¼šåŠ¨æ€æŠ¼é‡‘ã€ç½šæ²¡æ¯”ä¾‹å¯ç»Ÿä¸€é…ç½®
- âœ… **æ˜“äºç»´æŠ¤**ï¼šä¿®æ”¹æŠ¼é‡‘é€»è¾‘åªéœ€æ”¹ä¸€ä¸ªæ¨¡å—
- âœ… **æ˜“äºæ‰©å±•**ï¼šæ–°palletç›´æ¥å¤ç”¨
- âœ… **æ•°æ®å¯è§†åŒ–**ï¼šç»Ÿä¸€æŸ¥è¯¢æ‰€æœ‰æŠ¼é‡‘çŠ¶æ€
- âœ… **å®¡è®¡å‹å¥½**ï¼šæ‰€æœ‰æŠ¼é‡‘æ“ä½œé›†ä¸­è®°å½•

**ç¼ºç‚¹**ï¼š
- âš ï¸ å¢åŠ ä¸€ä¸ªæ¨¡å—ï¼ˆä½†æ”¶ç›Šè¿œå¤§äºæˆæœ¬ï¼‰
- âš ï¸ æ‰€æœ‰ä¾èµ–æŠ¼é‡‘çš„æ¨¡å—éœ€è¦é‡æ„ï¼ˆä½†æ˜¯ä¸€æ¬¡æ€§å·¥ä½œï¼‰

---

## ğŸ¯ å›ç­”ç”¨æˆ·è´¨ç–‘

### æˆ‘ä¹‹å‰å›ç­”çš„é—®é¢˜

**æˆ‘ä¹‹å‰çš„ç†è§£**ï¼š
- æˆ‘ç†è§£çš„æ˜¯"ä»…ç”³è¯‰æŠ¼é‡‘ç‹¬ç«‹"ï¼ˆæ–¹æ¡ˆ2ï¼‰
- è¿™ç¡®å®æ„ä¹‰ä¸å¤§

**æˆ‘åº”è¯¥ç†è§£çš„**ï¼š
- ç”¨æˆ·å¯èƒ½åœ¨é—®"é€šç”¨æŠ¼é‡‘ç®¡ç†"ï¼ˆæ–¹æ¡ˆ3ï¼‰
- è¿™ç¡®å®å¾ˆæœ‰ä»·å€¼ï¼

### é€»è¾‘çŸ›ç›¾åˆ†æ

**ç”¨æˆ·çš„é€»è¾‘æ˜¯å¯¹çš„**ï¼š

| åŠŸèƒ½ | å½“å‰è®¾è®¡ | åˆç†æ€§ |
|-----|---------|-------|
| **ç”³è¯‰ç®¡ç†** | âœ… é€šç”¨æ¨¡å—ï¼ˆgovernanceï¼‰ | åˆç† |
| **æŠ¼é‡‘ç®¡ç†** | âŒ åˆ†æ•£åœ¨å„ä¸ªæ¨¡å— | **ä¸åˆç†ï¼** |

**åº”è¯¥æ˜¯**ï¼š

| åŠŸèƒ½ | åº”æœ‰è®¾è®¡ | ç†ç”± |
|-----|---------|------|
| **ç”³è¯‰ç®¡ç†** | âœ… é€šç”¨æ¨¡å—ï¼ˆgovernanceï¼‰ | ç”³è¯‰æµç¨‹ç‹¬ç«‹äºä¸šåŠ¡ |
| **æŠ¼é‡‘ç®¡ç†** | âœ… é€šç”¨æ¨¡å—ï¼ˆdepositsï¼‰ | **æŠ¼é‡‘é€»è¾‘ä¹Ÿç‹¬ç«‹äºä¸šåŠ¡ï¼** |

**ç»“è®º**ï¼šç”¨æˆ·çš„è´¨ç–‘æ˜¯æ­£ç¡®çš„ï¼Œå½“å‰æ¶æ„å­˜åœ¨ä¸ä¸€è‡´æ€§ï¼

---

## ğŸ“Š Substrateç”Ÿæ€ä¸­çš„ä¾‹å­

### å®˜æ–¹palletçš„æŠ¼é‡‘å¤„ç†

è®©æˆ‘ä»¬çœ‹çœ‹Substrateå®˜æ–¹palletæ˜¯å¦‚ä½•å¤„ç†æŠ¼é‡‘çš„ï¼š

#### 1. pallet-democracy

```rust
// æ¯ä¸ªpalletè‡ªå·±ç®¡ç†æŠ¼é‡‘
#[pallet::storage]
pub type DepositOf<T> = StorageMap<
    _,
    Twox64Concat,
    PropIndex,
    (Vec<T::AccountId>, BalanceOf<T>),
>;

// è‡ªå·±å®ç°å†»ç»“/é‡Šæ”¾
pub fn note_preimage(...) {
    T::Currency::reserve(&who, deposit)?;
    // ...
}
```

#### 2. pallet-treasury

```rust
// ä¹Ÿæ˜¯è‡ªå·±ç®¡ç†æŠ¼é‡‘
#[pallet::storage]
pub type Proposals<T> = StorageMap<
    _,
    Twox64Concat,
    ProposalIndex,
    Proposal<T::AccountId, BalanceOf<T>>,
>;

// è‡ªå·±å®ç°ç½šæ²¡é€»è¾‘
pub fn reject_proposal(...) {
    let deposit = proposal.bond;
    let _ = T::Currency::slash_reserved(&proposal.proposer, deposit);
}
```

#### 3. pallet-bounties

```rust
// åŒæ ·å„è‡ªç®¡ç†
#[pallet::storage]
pub type Bounties<T> = StorageMap<
    _,
    Twox64Concat,
    BountyIndex,
    Bounty<T::AccountId, BalanceOf<T>, BlockNumber>,
>;
```

**ç°çŠ¶**ï¼š
- âŒ æ¯ä¸ªpalleté‡å¤å®ç°æŠ¼é‡‘é€»è¾‘ï¼ˆreserve/unreserve/slashï¼‰
- âŒ æŠ¼é‡‘ç­–ç•¥ä¸ç»Ÿä¸€ï¼ˆæœ‰çš„ç½šæ²¡100%ï¼Œæœ‰çš„ç½šæ²¡éƒ¨åˆ†ï¼‰
- âŒ éš¾ä»¥ç»Ÿä¸€æŸ¥è¯¢"ç”¨æˆ·æ‰€æœ‰æŠ¼é‡‘"
- âŒ ä»£ç é‡å¤ï¼Œç»´æŠ¤æˆæœ¬é«˜

**ä¸ºä»€ä¹ˆSubstrateå®˜æ–¹è¿™æ ·è®¾è®¡ï¼Ÿ**
- å†å²åŸå› ï¼šæœ€åˆæ²¡æœ‰é€šç”¨æŠ¼é‡‘éœ€æ±‚
- ç®€å•æ€§ï¼šæ¯ä¸ªpalletè‡ªåŒ…å«ï¼Œé™ä½è€¦åˆ
- çµæ´»æ€§ï¼šæ¯ä¸ªpalletå¯ä»¥å®šåˆ¶æŠ¼é‡‘é€»è¾‘

**ä½†è¿™ä¸ä»£è¡¨è¿™æ˜¯æœ€ä½³å®è·µï¼**

---

## ğŸš€ é€šç”¨æŠ¼é‡‘æ¨¡å—çš„ä»·å€¼

### 1. æ¶ˆé™¤ä»£ç é‡å¤

**å½“å‰**ï¼š
```rust
// pallet-democracy
T::Currency::reserve(&who, deposit)?;
// ... 100è¡ŒæŠ¼é‡‘é€»è¾‘ ...

// pallet-treasury  
T::Currency::reserve(&who, deposit)?;
// ... 100è¡ŒæŠ¼é‡‘é€»è¾‘ ...ï¼ˆé‡å¤ï¼ï¼‰

// pallet-bounties
T::Currency::reserve(&who, deposit)?;
// ... 100è¡ŒæŠ¼é‡‘é€»è¾‘ ...ï¼ˆé‡å¤ï¼ï¼‰

// pallet-memo-content-governance
T::Currency::reserve(&who, deposit)?;
// ... 100è¡ŒæŠ¼é‡‘é€»è¾‘ ...ï¼ˆé‡å¤ï¼ï¼‰
```

**é€šç”¨æ¨¡å—**ï¼š
```rust
// pallet-depositsï¼ˆå”¯ä¸€å®ç°ï¼‰
T::Currency::reserve(&who, deposit)?;
// ... 100è¡ŒæŠ¼é‡‘é€»è¾‘ ...

// æ‰€æœ‰å…¶ä»–pallet
T::DepositManager::reserve_deposit(...)?;  // 1è¡Œè°ƒç”¨ï¼
```

**ä»£ç å‡å°‘**ï¼šå‡è®¾10ä¸ªpalletä½¿ç”¨æŠ¼é‡‘ï¼Œæ¯ä¸ª100è¡Œé€»è¾‘
- å½“å‰ï¼š1000è¡Œä»£ç 
- é€šç”¨æ¨¡å—ï¼š100è¡Œæ ¸å¿ƒ + 10è¡Œè°ƒç”¨ = 110è¡Œ
- **å‡å°‘89%ä»£ç ï¼**

### 2. ç»Ÿä¸€æŠ¼é‡‘ç­–ç•¥

**é€šç”¨æŠ¼é‡‘ç­–ç•¥é…ç½®**ï¼š
```rust
// runtime/src/configs/mod.rs

parameter_types! {
    // ç»Ÿä¸€é…ç½®
    pub const DefaultSlashRatio: Perbill = Perbill::from_percent(10);
    pub const MaxDepositAmount: Balance = 1_000_000 * UNIT;
    pub const MinDepositAmount: Balance = 10 * UNIT;
}

impl pallet_deposits::Config for Runtime {
    type DefaultSlashRatio = DefaultSlashRatio;
    type MaxDepositAmount = MaxDepositAmount;
    type MinDepositAmount = MinDepositAmount;
    type TreasuryAccount = TreasuryAccount;
    // åŠ¨æ€æŠ¼é‡‘ç­–ç•¥ï¼ˆå¯æ’æ‹”ï¼‰
    type DepositPolicy = DynamicDepositPolicy;
}
```

**å„palletå¤ç”¨**ï¼š
```rust
// æ‰€æœ‰palletä½¿ç”¨ç»Ÿä¸€ç­–ç•¥
T::DepositManager::reserve_deposit_with_policy(
    purpose,
    who,
    None,  // ä½¿ç”¨é»˜è®¤ç­–ç•¥
)?;
```

### 3. ç»Ÿä¸€æŸ¥è¯¢æ¥å£

**ç”¨æˆ·ä½“éªŒæå‡**ï¼š

```typescript
// å‰ç«¯ï¼šæŸ¥è¯¢ç”¨æˆ·æ‰€æœ‰æŠ¼é‡‘
const deposits = await api.query.deposits.depositsByAccount(user);

// è¿”å›ï¼š
[
  {
    id: 1,
    amount: 100_000_000_000,
    purpose: 'ContentAppeal',
    status: 'Reserved',
    canReleaseAt: 12345678
  },
  {
    id: 2,
    amount: 50_000_000_000,
    purpose: 'DemocracyProposal',
    status: 'Reserved',
    canReleaseAt: null
  },
  {
    id: 3,
    amount: 200_000_000_000,
    purpose: 'TreasuryProposal',
    status: 'Released',
    canReleaseAt: null
  }
]

// ç”¨æˆ·å¯ä»¥çœ‹åˆ°ï¼š
// - æˆ‘åœ¨å“ªäº›åœ°æ–¹æœ‰æŠ¼é‡‘
// - é‡‘é¢æ˜¯å¤šå°‘
// - ä»€ä¹ˆæ—¶å€™å¯ä»¥å–å›
// - å½“å‰çŠ¶æ€å¦‚ä½•
```

**å½“å‰æ–¹æ¡ˆ**ï¼šç”¨æˆ·éœ€è¦æŸ¥è¯¢å¤šä¸ªpallet
```typescript
// æŸ¥è¯¢democracyæŠ¼é‡‘
const democracyDeposits = await api.query.democracy.depositOf(proposalId);

// æŸ¥è¯¢treasuryæŠ¼é‡‘
const treasuryProposal = await api.query.treasury.proposals(proposalId);

// æŸ¥è¯¢content-governanceæŠ¼é‡‘
const appeal = await api.query.memoContentGovernance.appeals(appealId);

// ç”¨æˆ·éœ€è¦çŸ¥é“åœ¨å“ªäº›palletæœ‰æŠ¼é‡‘ï¼
```

### 4. å®¡è®¡å’Œç›‘æ§

**é›†ä¸­å¼å®¡è®¡**ï¼š
```typescript
// æŸ¥è¯¢æ‰€æœ‰æŠ¼é‡‘æ“ä½œå†å²
const events = await api.query.deposits.depositHistory(startBlock, endBlock);

// ç»Ÿè®¡
const stats = {
  totalReserved: 1_000_000 * UNIT,
  totalSlashed: 50_000 * UNIT,
  totalReleased: 800_000 * UNIT,
  byPurpose: {
    ContentAppeal: 300_000 * UNIT,
    Democracy: 400_000 * UNIT,
    Treasury: 300_000 * UNIT,
  }
};

// ç›‘æ§å‘Šè­¦
if (stats.totalSlashed > threshold) {
  alert('æŠ¼é‡‘ç½šæ²¡å¼‚å¸¸å¢å¤šï¼');
}
```

### 5. åŠ¨æ€æŠ¼é‡‘ç­–ç•¥

**ç»Ÿä¸€çš„åŠ¨æ€æŠ¼é‡‘**ï¼š
```rust
// pallet-deposits/src/policy.rs

pub trait DepositPolicy {
    fn calculate_deposit(
        purpose: &DepositPurpose,
        who: &AccountId,
        context: &DepositContext,
    ) -> Balance;
}

// å®ç°ç¾å…ƒé”šå®šæŠ¼é‡‘
pub struct UsdBasedPolicy;
impl DepositPolicy for UsdBasedPolicy {
    fn calculate_deposit(...) -> Balance {
        match purpose {
            DepositPurpose::ContentAppeal { .. } => {
                // 10ç¾å…ƒç­‰å€¼MEMO
                10_000_000 / pricing::get_price()
            }
            DepositPurpose::DemocracyProposal { .. } => {
                // 100ç¾å…ƒç­‰å€¼MEMO
                100_000_000 / pricing::get_price()
            }
            DepositPurpose::TreasuryProposal { amount } => {
                // ææ¡ˆé‡‘é¢çš„1%
                amount / 100
            }
            _ => DefaultDeposit::get()
        }
    }
}
```

**æ‰€æœ‰palletè‡ªåŠ¨äº«å—åŠ¨æ€æŠ¼é‡‘ï¼**

---

## ğŸ“ æœ€ä½³å®è·µå»ºè®®

### æ¶æ„æ¼”è¿›è·¯å¾„

#### Phase 1ï¼šä¿æŒç°çŠ¶ï¼ˆçŸ­æœŸï¼‰
- âœ… ç»§ç»­ä½¿ç”¨å½“å‰åˆ†æ•£å¼æ¶æ„
- âœ… ä¸“æ³¨ä¸šåŠ¡åŠŸèƒ½å¼€å‘
- â±ï¸ æ—¶é—´æˆæœ¬ï¼š0

#### Phase 2ï¼šæ–°palletä½¿ç”¨é€šç”¨æŠ¼é‡‘ï¼ˆä¸­æœŸï¼‰
- âœ… å¼€å‘ `pallet-deposits`
- âœ… æ–°å¢çš„palletä½¿ç”¨é€šç”¨æŠ¼é‡‘
- âœ… è€palletä¿æŒä¸å˜
- â±ï¸ æ—¶é—´æˆæœ¬ï¼š2å‘¨å¼€å‘

#### Phase 3ï¼šé€æ­¥è¿ç§»è€palletï¼ˆé•¿æœŸï¼‰
- âœ… é€ä¸ªè¿ç§»ç°æœ‰palletåˆ°é€šç”¨æŠ¼é‡‘
- âœ… democracy â†’ treasury â†’ bounties â†’ ...
- â±ï¸ æ—¶é—´æˆæœ¬ï¼šæ¯ä¸ªpallet 1-2å¤©

### æ¨èæ–¹æ¡ˆ

**å¯¹äºMemoMarté¡¹ç›®**ï¼š

è€ƒè™‘åˆ°ï¼š
1. âœ… å·²æœ‰6ä¸ªpalletä½¿ç”¨æŠ¼é‡‘ï¼ˆgovernanceã€offeringsã€textã€mediaç­‰ï¼‰
2. âœ… æœªæ¥ä¼šæœ‰æ›´å¤špalletï¼ˆNFTã€ç¤¾äº¤ã€å¸‚åœºç­‰ï¼‰
3. âœ… éœ€è¦ç»Ÿä¸€çš„æŠ¼é‡‘ç­–ç•¥ï¼ˆåŠ¨æ€ç¾å…ƒé”šå®šï¼‰
4. âœ… éœ€è¦ç»Ÿä¸€çš„ç”¨æˆ·ä½“éªŒï¼ˆæŸ¥è¯¢æ‰€æœ‰æŠ¼é‡‘ï¼‰

**å»ºè®®**ï¼š
- ğŸ¯ **å¼€å‘é€šç”¨æŠ¼é‡‘æ¨¡å—**ï¼ˆpallet-depositsï¼‰
- ğŸ¯ **æ–°palletç›´æ¥ä½¿ç”¨**
- ğŸ¯ **è€palleté€æ­¥è¿ç§»**ï¼ˆä¸ç€æ€¥ï¼ŒæŒ‰ä¼˜å…ˆçº§ï¼‰

**ä¼˜å…ˆçº§æ’åº**ï¼š
1. âœ… pallet-memo-content-governanceï¼ˆæœ€å¤æ‚ï¼Œæ”¶ç›Šæœ€å¤§ï¼‰
2. âœ… pallet-memo-offeringsï¼ˆå®¡æ ¸æŠ¼é‡‘ï¼‰
3. â° pallet-deceased-textï¼ˆæŠ•è¯‰æŠ¼é‡‘ï¼‰
4. â° pallet-deceased-mediaï¼ˆæŠ•è¯‰æŠ¼é‡‘ï¼‰
5. â° æœªæ¥çš„æ–°palletï¼ˆç›´æ¥ä½¿ç”¨ï¼‰

---

## âœ… æœ€ç»ˆç»“è®º

### å›ç­”ç”¨æˆ·è´¨ç–‘

**é—®é¢˜**ï¼šæ—¢ç„¶governanceå¯ä»¥å¤„ç†æ‰€æœ‰palletçš„ç”³è¯‰ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æœ‰é€šç”¨æŠ¼é‡‘æ¨¡å—ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
- âœ… **ä½ æ˜¯å¯¹çš„ï¼**
- âœ… **åº”è¯¥æœ‰é€šç”¨æŠ¼é‡‘æ¨¡å—ï¼**
- âœ… **å½“å‰æ¶æ„ç¡®å®å­˜åœ¨é€»è¾‘ä¸ä¸€è‡´ï¼**

### æˆ‘ä¹‹å‰å›ç­”çš„é—®é¢˜

**é—®é¢˜å‡ºåœ¨å“ª**ï¼š
- âŒ æˆ‘ç†è§£æˆäº†"ä»…ç”³è¯‰æŠ¼é‡‘ç‹¬ç«‹"ï¼ˆæ–¹æ¡ˆ2ï¼‰
- âŒ æ²¡æœ‰è€ƒè™‘"é€šç”¨æŠ¼é‡‘ç®¡ç†"ï¼ˆæ–¹æ¡ˆ3ï¼‰
- âŒ æ²¡æœ‰ä»å…¨å±€è§†è§’å®¡è§†æ¶æ„ä¸€è‡´æ€§

**åº”è¯¥çš„å›ç­”**ï¼š

| é—®é¢˜ | æ—§ç­”æ¡ˆ | æ–°ç­”æ¡ˆ |
|-----|-------|-------|
| æ˜¯å¦éœ€è¦ä¸“é—¨æŠ¼é‡‘æ¨¡å—ï¼Ÿ | âŒ ä¸éœ€è¦ | âœ… **éœ€è¦ï¼** |
| ç†ç”± | æŠ¼é‡‘ä¸ç”³è¯‰æµç¨‹è€¦åˆ | âœ… **é€šç”¨æŠ¼é‡‘æ˜¯æ¨ªå‘æœåŠ¡**<br>âœ… **ä¸governanceé€»è¾‘ä¸€è‡´**<br>âœ… **æ¶ˆé™¤ä»£ç é‡å¤**<br>âœ… **ç»Ÿä¸€æŠ¼é‡‘ç­–ç•¥** |

### æ¶æ„ä¸€è‡´æ€§

**æ­£ç¡®çš„æ¶æ„åº”è¯¥æ˜¯**ï¼š

```
æ¨ªå‘é€šç”¨æœåŠ¡å±‚ï¼š
â”œâ”€ pallet-depositsï¼ˆé€šç”¨æŠ¼é‡‘ç®¡ç†ï¼‰
â””â”€ pallet-memo-content-governanceï¼ˆé€šç”¨ç”³è¯‰ç®¡ç†ï¼‰
    â†“ æä¾›æœåŠ¡
å‚ç›´ä¸šåŠ¡palletå±‚ï¼š
â”œâ”€ pallet-stardust-grave
â”œâ”€ pallet-deceased  
â”œâ”€ pallet-deceased-text
â”œâ”€ pallet-deceased-media
â”œâ”€ pallet-stardust-park
â”œâ”€ pallet-memo-offerings
â””â”€ ç”¨æˆ·è‡ªå®šä¹‰pallet
```

**é€»è¾‘ä¸€è‡´**ï¼š
- âœ… governanceæ˜¯æ¨ªå‘æœåŠ¡ â†’ depositsä¹Ÿåº”è¯¥æ˜¯æ¨ªå‘æœåŠ¡
- âœ… governanceé€šç”¨åŒ– â†’ depositsä¹Ÿåº”è¯¥é€šç”¨åŒ–
- âœ… governanceè§£è€¦ä¸šåŠ¡ â†’ depositsä¹Ÿåº”è¯¥è§£è€¦ä¸šåŠ¡

---

## ğŸš€ å®æ–½å»ºè®®

### ç«‹å³å¯åš

1. âœ… è®¤å¯æ¶æ„é—®é¢˜
2. âœ… è§„åˆ’é€šç”¨æŠ¼é‡‘æ¨¡å—
3. âœ… è®¾è®¡ç»Ÿä¸€çš„æŠ¼é‡‘æ¥å£

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰

4. âœ… å¼€å‘ `pallet-deposits`
5. âœ… å®ç°æ ¸å¿ƒåŠŸèƒ½ï¼š
   - reserve_deposit
   - release_deposit
   - slash_deposit
   - queryæ¥å£

### ä¸­æœŸï¼ˆ1-2æœˆï¼‰

6. âœ… è¿ç§» governance åˆ°é€šç”¨æŠ¼é‡‘
7. âœ… è¿ç§» offerings åˆ°é€šç”¨æŠ¼é‡‘
8. âœ… æ–°palletç›´æ¥ä½¿ç”¨é€šç”¨æŠ¼é‡‘

### é•¿æœŸï¼ˆæŒ‰éœ€ï¼‰

9. âœ… é€æ­¥è¿ç§»å…¶ä»–pallet
10. âœ… å®ç°åŠ¨æ€æŠ¼é‡‘ç­–ç•¥
11. âœ… å®Œå–„æŸ¥è¯¢å’Œç›‘æ§åŠŸèƒ½

---

## ğŸ“š æ€»ç»“

### å…³é”®è®¤è¯†

1. **ç”¨æˆ·çš„è´¨ç–‘æ˜¯æ­£ç¡®çš„** âœ…
   - å½“å‰æ¶æ„ç¡®å®å­˜åœ¨é€»è¾‘ä¸ä¸€è‡´
   - governanceé€šç”¨ï¼Œä½†depositsä¸é€šç”¨

2. **åº”è¯¥æœ‰é€šç”¨æŠ¼é‡‘æ¨¡å—** âœ…
   - æ¶ˆé™¤ä»£ç é‡å¤
   - ç»Ÿä¸€æŠ¼é‡‘ç­–ç•¥
   - æå‡ç”¨æˆ·ä½“éªŒ
   - ä¾¿äºå®¡è®¡ç›‘æ§

3. **æˆ‘ä¹‹å‰çš„å›ç­”ä¸å¤Ÿå…¨é¢** âŒ
   - åªè€ƒè™‘äº†"ä»…ç”³è¯‰æŠ¼é‡‘"åœºæ™¯
   - æ²¡æœ‰è€ƒè™‘"é€šç”¨æŠ¼é‡‘"çš„ä»·å€¼
   - å¿½ç•¥äº†æ¶æ„ä¸€è‡´æ€§é—®é¢˜

4. **æ­£ç¡®çš„æ¶æ„æ˜¯** âœ…
   ```
   æ¨ªå‘æœåŠ¡å±‚ï¼ˆé€šç”¨ï¼‰
   â”œâ”€ governanceï¼ˆç”³è¯‰ç®¡ç†ï¼‰
   â””â”€ depositsï¼ˆæŠ¼é‡‘ç®¡ç†ï¼‰
       â†“
   å‚ç›´ä¸šåŠ¡å±‚ï¼ˆå…·ä½“ï¼‰
   â””â”€ å„ä¸ªä¸šåŠ¡pallet
   ```

### æ„Ÿè°¢ç”¨æˆ·çš„è´¨ç–‘

- âœ… å¸®åŠ©å‘ç°æ¶æ„é—®é¢˜
- âœ… ä¿ƒè¿›æ›´æ·±å…¥æ€è€ƒ
- âœ… å¾—åˆ°æ›´ä¼˜çš„è®¾è®¡æ–¹æ¡ˆ

**è¿™æ­£æ˜¯å¼€æºåä½œçš„ä»·å€¼æ‰€åœ¨ï¼**

---

*é‡æ–°åˆ†ææŠ¥å‘Š | ç”Ÿæˆæ—¶é—´ï¼š2025-10-25*
*ç»“è®ºï¼šåº”è¯¥å¼€å‘é€šç”¨æŠ¼é‡‘ç®¡ç†æ¨¡å— `pallet-deposits`*

