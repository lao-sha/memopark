# å‰ç«¯å¼€å‘æŒ‡å—

## ğŸ“¦ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: React 18 + TypeScript
- **UI åº“**: Ant Design 5
- **çŠ¶æ€ç®¡ç†**: React Query + Zustand
- **Web3**: ethers.js + @polkadot/api
- **è·¯ç”±**: React Router v6
- **æ ·å¼**: Tailwind CSS
- **æ„å»º**: Vite

## ğŸ— é¡¹ç›®ç»“æ„

```
stardust-dapp/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # å…±äº«ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Bridge/          # æ¡¥æ¥ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Trading/         # AI äº¤æ˜“ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Governance/      # æ²»ç†ç›¸å…³ç»„ä»¶
â”‚   â”‚   â””â”€â”€ Common/          # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ hooks/               # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ useBridge.ts     # æ¡¥æ¥é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ useTrading.ts    # äº¤æ˜“é€»è¾‘
â”‚   â”‚   â””â”€â”€ useGovernance.ts # æ²»ç†é€»è¾‘
â”‚   â”œâ”€â”€ services/            # API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ substrate.ts     # Substrate API
â”‚   â”‚   â”œâ”€â”€ ethereum.ts      # Ethereum/Arbitrum API
â”‚   â”‚   â””â”€â”€ ipfs.ts          # IPFS æœåŠ¡
â”‚   â”œâ”€â”€ types/               # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ pages/               # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Bridge/          # æ¡¥æ¥é¡µé¢
â”‚   â”‚   â”œâ”€â”€ Trading/         # äº¤æ˜“é¡µé¢
â”‚   â”‚   â”œâ”€â”€ Governance/      # æ²»ç†é¡µé¢
â”‚   â”‚   â””â”€â”€ Dashboard/       # ä»ªè¡¨æ¿
â”‚   â”œâ”€â”€ App.tsx              # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â””â”€â”€ main.tsx             # å…¥å£æ–‡ä»¶
â”œâ”€â”€ public/                  # é™æ€èµ„æº
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ vite.config.ts
```

## ğŸ¨ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. é’±åŒ…è¿æ¥

```typescript
// src/hooks/useWallet.ts
import { useState, useEffect } from 'react';
import { ethers } from 'ethers';
import { ApiPromise, WsProvider } from '@polkadot/api';

export const useWallet = () => {
  const [ethAddress, setEthAddress] = useState<string | null>(null);
  const [substrateAddress, setSubstrateAddress] = useState<string | null>(null);
  const [ethProvider, setEthProvider] = useState<ethers.providers.Web3Provider | null>(null);
  const [substrateApi, setSubstrateApi] = useState<ApiPromise | null>(null);

  // è¿æ¥ MetaMask
  const connectEthereum = async () => {
    if (typeof window.ethereum !== 'undefined') {
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send('eth_requestAccounts', []);
      const signer = provider.getSigner();
      const address = await signer.getAddress();
      
      setEthProvider(provider);
      setEthAddress(address);
    }
  };

  // è¿æ¥ Substrate (Polkadot.js)
  const connectSubstrate = async () => {
    const { web3Accounts, web3Enable } = await import('@polkadot/extension-dapp');
    const extensions = await web3Enable('Stardust DApp');
    
    if (extensions.length === 0) {
      throw new Error('No extension installed');
    }

    const accounts = await web3Accounts();
    if (accounts.length > 0) {
      setSubstrateAddress(accounts[0].address);
      
      // è¿æ¥åˆ° Substrate èŠ‚ç‚¹
      const wsProvider = new WsProvider('wss://rpc.stardust.network');
      const api = await ApiPromise.create({ provider: wsProvider });
      setSubstrateApi(api);
    }
  };

  return {
    ethAddress,
    substrateAddress,
    ethProvider,
    substrateApi,
    connectEthereum,
    connectSubstrate,
  };
};
```

### 2. æ¡¥æ¥ç•Œé¢

```typescript
// src/components/Bridge/BridgeForm.tsx
import React, { useState } from 'react';
import { Form, Input, Button, Select, message } from 'antd';
import { useBridge } from '../../hooks/useBridge';

export const BridgeForm: React.FC = () => {
  const { bridgeToArbitrum, bridgeToSubstrate } = useBridge();
  const [loading, setLoading] = useState(false);

  const onFinish = async (values: any) => {
    setLoading(true);
    try {
      if (values.direction === 'to-arbitrum') {
        await bridgeToArbitrum(values.amount, values.ethAddress);
        message.success('æ¡¥æ¥è¯·æ±‚å·²æäº¤');
      } else {
        await bridgeToSubstrate(values.amount, values.substrateAddress);
        message.success('é”€æ¯äº¤æ˜“å·²æäº¤');
      }
    } catch (error) {
      message.error('æ“ä½œå¤±è´¥ï¼š' + error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <Form onFinish={onFinish} layout="vertical">
      <Form.Item
        label="æ¡¥æ¥æ–¹å‘"
        name="direction"
        rules={[{ required: true }]}
      >
        <Select>
          <Select.Option value="to-arbitrum">
            Stardust â†’ Arbitrum
          </Select.Option>
          <Select.Option value="to-substrate">
            Arbitrum â†’ Stardust
          </Select.Option>
        </Select>
      </Form.Item>

      <Form.Item
        label="é‡‘é¢ (DUST)"
        name="amount"
        rules={[{ required: true }]}
      >
        <Input type="number" placeholder="1000" />
      </Form.Item>

      <Form.Item
        label="ç›®æ ‡åœ°å€"
        name="address"
        rules={[{ required: true }]}
      >
        <Input placeholder="0x... æˆ– 5Grw..." />
      </Form.Item>

      <Form.Item>
        <Button type="primary" htmlType="submit" loading={loading} block>
          æäº¤æ¡¥æ¥
        </Button>
      </Form.Item>
    </Form>
  );
};
```

### 3. AI äº¤æ˜“å‚ä¸

```typescript
// src/components/Trading/DepositForm.tsx
import React, { useState } from 'react';
import { Form, InputNumber, Button, Slider, message, Card } from 'antd';
import { useTrading } from '../../hooks/useTrading';

export const DepositForm: React.FC = () => {
  const { depositWithDUST, dustBalance, estimateStUSDC } = useTrading();
  const [amount, setAmount] = useState(0);
  const [estimatedStUSDC, setEstimatedStUSDC] = useState(0);

  const handleAmountChange = async (value: number) => {
    setAmount(value);
    const estimated = await estimateStUSDC(value);
    setEstimatedStUSDC(estimated);
  };

  const onDeposit = async () => {
    try {
      await depositWithDUST(amount);
      message.success('å­˜æ¬¾æˆåŠŸï¼');
    } catch (error) {
      message.error('å­˜æ¬¾å¤±è´¥ï¼š' + error.message);
    }
  };

  return (
    <Card title="å‚ä¸ AI äº¤æ˜“">
      <Form layout="vertical">
        <Form.Item label="å­˜æ¬¾é‡‘é¢ (DUST)">
          <InputNumber
            value={amount}
            onChange={handleAmountChange}
            min={0}
            max={dustBalance}
            style={{ width: '100%' }}
          />
          <Slider
            value={amount}
            onChange={handleAmountChange}
            min={0}
            max={dustBalance}
            marks={{
              0: '0',
              [dustBalance / 2]: '50%',
              [dustBalance]: 'Max',
            }}
          />
        </Form.Item>

        <Form.Item label="é¢„è®¡è·å¾— stUSDC">
          <div style={{ fontSize: '24px', fontWeight: 'bold' }}>
            {estimatedStUSDC.toFixed(2)} stUSDC
          </div>
        </Form.Item>

        <Form.Item>
          <Button 
            type="primary" 
            onClick={onDeposit}
            disabled={amount === 0}
            block
          >
            ç¡®è®¤å­˜æ¬¾
          </Button>
        </Form.Item>
      </Form>
    </Card>
  );
};
```

### 4. æ²»ç†æŠ•ç¥¨

```typescript
// src/components/Governance/ProposalCard.tsx
import React from 'react';
import { Card, Button, Progress, Tag, Space } from 'antd';
import { useGovernance } from '../../hooks/useGovernance';

interface ProposalCardProps {
  proposal: {
    id: number;
    type: string;
    description: string;
    ayeVotes: number;
    nayVotes: number;
    status: string;
    deadline: number;
  };
}

export const ProposalCard: React.FC<ProposalCardProps> = ({ proposal }) => {
  const { vote, hasVoted } = useGovernance();
  const totalVotes = proposal.ayeVotes + proposal.nayVotes;
  const ayePercent = totalVotes > 0 ? (proposal.ayeVotes / totalVotes) * 100 : 0;

  return (
    <Card
      title={`#${proposal.id} - ${proposal.type}`}
      extra={<Tag color="blue">{proposal.status}</Tag>}
    >
      <p>{proposal.description}</p>

      <Progress
        percent={ayePercent}
        success={{ percent: ayePercent }}
        format={() => `${ayePercent.toFixed(1)}% èµæˆ`}
      />

      <div style={{ marginTop: '16px' }}>
        <Space>
          <span>èµæˆ: {proposal.ayeVotes} DUST</span>
          <span>åå¯¹: {proposal.nayVotes} DUST</span>
        </Space>
      </div>

      {!hasVoted(proposal.id) && proposal.status === 'Active' && (
        <Space style={{ marginTop: '16px' }}>
          <Button type="primary" onClick={() => vote(proposal.id, 'Aye')}>
            èµæˆ
          </Button>
          <Button danger onClick={() => vote(proposal.id, 'Nay')}>
            åå¯¹
          </Button>
          <Button onClick={() => vote(proposal.id, 'Abstain')}>
            å¼ƒæƒ
          </Button>
        </Space>
      )}
    </Card>
  );
};
```

### 5. æ•°æ®ä»ªè¡¨æ¿

```typescript
// src/components/Dashboard/StatsOverview.tsx
import React from 'react';
import { Row, Col, Statistic, Card } from 'antd';
import { ArrowUpOutlined, ArrowDownOutlined } from '@ant-design/icons';
import { useStats } from '../../hooks/useStats';

export const StatsOverview: React.FC = () => {
  const { stats, loading } = useStats();

  return (
    <Row gutter={[16, 16]}>
      <Col xs={24} sm={12} lg={6}>
        <Card>
          <Statistic
            title="æ€»é”å®šä»·å€¼ (TVL)"
            value={stats.tvl}
            prefix="$"
            precision={2}
          />
        </Card>
      </Col>

      <Col xs={24} sm={12} lg={6}>
        <Card>
          <Statistic
            title="24h æ¡¥æ¥é‡"
            value={stats.bridgeVolume24h}
            suffix="DUST"
          />
        </Card>
      </Col>

      <Col xs={24} sm={12} lg={6}>
        <Card>
          <Statistic
            title="AI ç­–ç•¥æ”¶ç›Š"
            value={stats.aiStrategyReturn}
            precision={2}
            suffix="%"
            valueStyle={{ color: stats.aiStrategyReturn > 0 ? '#3f8600' : '#cf1322' }}
            prefix={stats.aiStrategyReturn > 0 ? <ArrowUpOutlined /> : <ArrowDownOutlined />}
          />
        </Card>
      </Col>

      <Col xs={24} sm={12} lg={6}>
        <Card>
          <Statistic
            title="stUSDC ä»·æ ¼"
            value={stats.stUsdcPrice}
            prefix="$"
            precision={4}
          />
        </Card>
      </Col>
    </Row>
  );
};
```

## ğŸ”— API é›†æˆ

### Substrate API

```typescript
// src/services/substrate.ts
import { ApiPromise } from '@polkadot/api';

export class SubstrateService {
  private api: ApiPromise;

  constructor(api: ApiPromise) {
    this.api = api;
  }

  // æ¡¥æ¥åˆ° Arbitrum
  async bridgeToArbitrum(account, amount: string, ethAddress: string) {
    const tx = this.api.tx.dustBridge.bridgeToArbitrum(amount, ethAddress);
    return await tx.signAndSend(account);
  }

  // æŸ¥è¯¢æ¡¥æ¥è¯·æ±‚
  async getBridgeRequest(id: number) {
    return await this.api.query.dustBridge.bridgeRequests(id);
  }

  // è®¢é˜…äº‹ä»¶
  subscribeToEvents(callback: (events: any[]) => void) {
    return this.api.query.system.events((events) => {
      const bridgeEvents = events.filter((record) => {
        const { event } = record;
        return event.section === 'dustBridge';
      });
      callback(bridgeEvents);
    });
  }
}
```

### Ethereum/Arbitrum API

```typescript
// src/services/ethereum.ts
import { ethers } from 'ethers';
import DUSTBridgeABI from '../abis/DUSTBridge.json';
import StardustVaultRouterABI from '../abis/StardustVaultRouter.json';

export class EthereumService {
  private provider: ethers.providers.Provider;
  private signer: ethers.Signer;

  constructor(provider: ethers.providers.Provider, signer: ethers.Signer) {
    this.provider = provider;
    this.signer = signer;
  }

  // è·å–åˆçº¦å®ä¾‹
  getBridgeContract(address: string) {
    return new ethers.Contract(address, DUSTBridgeABI, this.signer);
  }

  getRouterContract(address: string) {
    return new ethers.Contract(address, StardustVaultRouterABI, this.signer);
  }

  // ç”¨ DUST å­˜æ¬¾
  async depositWithDUST(routerAddress: string, amount: string, minUsdcOut: string) {
    const router = this.getRouterContract(routerAddress);
    const tx = await router.depositWithDUST(amount, minUsdcOut);
    return await tx.wait();
  }

  // æå–åˆ° DUST
  async withdrawToDUST(routerAddress: string, stUsdcAmount: string, minDustOut: string) {
    const router = this.getRouterContract(routerAddress);
    const tx = await router.withdrawToDUST(stUsdcAmount, minDustOut);
    return await tx.wait();
  }
}
```

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```typescript
// src/hooks/__tests__/useBridge.test.ts
import { renderHook, act } from '@testing-library/react-hooks';
import { useBridge } from '../useBridge';

describe('useBridge', () => {
  it('should bridge to Arbitrum', async () => {
    const { result } = renderHook(() => useBridge());

    await act(async () => {
      await result.current.bridgeToArbitrum('1000', '0x123...');
    });

    expect(result.current.loading).toBe(false);
  });
});
```

### E2E æµ‹è¯•

```typescript
// cypress/e2e/bridge.cy.ts
describe('Bridge Flow', () => {
  it('should complete bridge to Arbitrum', () => {
    cy.visit('/bridge');
    cy.get('[data-testid="connect-wallet"]').click();
    cy.get('[data-testid="amount-input"]').type('1000');
    cy.get('[data-testid="eth-address-input"]').type('0x123...');
    cy.get('[data-testid="submit-button"]').click();
    cy.contains('æ¡¥æ¥è¯·æ±‚å·²æäº¤').should('be.visible');
  });
});
```

## ğŸ“± å“åº”å¼è®¾è®¡

ä½¿ç”¨ Ant Design çš„å“åº”å¼æ …æ ¼ç³»ç»Ÿï¼š

```typescript
<Row gutter={[16, 16]}>
  <Col xs={24} sm={24} md={12} lg={8}>
    {/* ç§»åŠ¨ç«¯å…¨å®½ï¼Œå¹³æ¿åŠå®½ï¼Œæ¡Œé¢1/3å®½ */}
  </Col>
</Row>
```

## ğŸš€ éƒ¨ç½²

### æ„å»º

```bash
npm run build
```

### éƒ¨ç½²åˆ° IPFS

```bash
# ä½¿ç”¨ Pinata æˆ– Infura
npx pinata-upload-cli dist/
```

### éƒ¨ç½²åˆ° Vercel

```bash
vercel --prod
```

## âœ… å¼€å‘æ£€æŸ¥æ¸…å•

- [ ] é’±åŒ…è¿æ¥ï¼ˆMetaMask + Polkadot.jsï¼‰
- [ ] æ¡¥æ¥ç•Œé¢å®Œæˆ
- [ ] AI äº¤æ˜“å‚ä¸ç•Œé¢å®Œæˆ
- [ ] æ²»ç†æŠ•ç¥¨ç•Œé¢å®Œæˆ
- [ ] æ•°æ®ä»ªè¡¨æ¿å®Œæˆ
- [ ] ç§»åŠ¨ç«¯é€‚é…
- [ ] å•å…ƒæµ‹è¯•ç¼–å†™
- [ ] E2E æµ‹è¯•ç¼–å†™
- [ ] æ–‡æ¡£å®Œå–„

## ğŸ“š å‚è€ƒèµ„æº

- [Ant Design æ–‡æ¡£](https://ant.design/)
- [ethers.js æ–‡æ¡£](https://docs.ethers.io/)
- [@polkadot/api æ–‡æ¡£](https://polkadot.js.org/docs/)
- [React Query æ–‡æ¡£](https://tanstack.com/query/latest)

---

**æ³¨æ„**: å‰ç«¯å¼€å‘éœ€è¦ä¸åˆçº¦å’Œ pallet ç´§å¯†é…åˆï¼Œç¡®ä¿ ABI å’Œç±»å‹å®šä¹‰åŒæ­¥ã€‚

