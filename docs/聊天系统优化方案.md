# èŠå¤©ç³»ç»Ÿä¼˜åŒ–æ–¹æ¡ˆï¼ˆæ–¹æ¡ˆ1ï¼šä¼˜åŒ–ç°æœ‰ç§èŠï¼‰

> **åˆ›å»ºæ—¥æœŸ**: 2025-11-08  
> **ä¼˜åŒ–ç›®æ ‡**: åœ¨ç°æœ‰pallet-chatåŸºç¡€ä¸Šä¼˜åŒ–ä½“éªŒ  
> **ä¼˜å…ˆçº§**: â­â­â­â­â­ å¼ºçƒˆæ¨è  
> **æŠ•å…¥**: 1-2å¤©  
> **äº§å‡º**: æ˜¾è‘—æå‡èŠå¤©ä½“éªŒ  

---

## ğŸ“‹ ç›®å½•

1. [å½“å‰å®ç°åˆ†æ](#1-å½“å‰å®ç°åˆ†æ)
2. [æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ](#2-æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ)
3. [åŠŸèƒ½å¢å¼ºæ–¹æ¡ˆ](#3-åŠŸèƒ½å¢å¼ºæ–¹æ¡ˆ)
4. [ç”¨æˆ·ä½“éªŒä¼˜åŒ–](#4-ç”¨æˆ·ä½“éªŒä¼˜åŒ–)
5. [å®‰å…¨æ€§æå‡](#5-å®‰å…¨æ€§æå‡)
6. [å®æ–½è®¡åˆ’](#6-å®æ–½è®¡åˆ’)

---

## 1. å½“å‰å®ç°åˆ†æ

### 1.1 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | çŠ¶æ€ |
|------|------|------|
| **é“¾ä¸Š** | pallet-chat | âœ… å·²å®ç° |
| **å­˜å‚¨** | IPFS | âœ… å·²å®ç° |
| **åŠ å¯†** | NaCl (Polkadot.js) | âœ… å·²å®ç° |
| **å‰ç«¯** | React + Ant Design | âœ… å·²å®ç° |

### 1.2 ç°æœ‰åŠŸèƒ½

**âœ… å·²å®ç°**ï¼š
- 1å¯¹1ç§èŠ
- ç«¯åˆ°ç«¯åŠ å¯†
- æ¶ˆæ¯å·²è¯»/æœªè¯»
- æ¶ˆæ¯è½¯åˆ é™¤
- ä¼šè¯ç®¡ç†
- æ–‡æœ¬æ¶ˆæ¯
- å›¾ç‰‡æ¶ˆæ¯
- æ–‡ä»¶æ¶ˆæ¯
- å®æ—¶äº‹ä»¶ç›‘å¬

**âŒ å¾…ä¼˜åŒ–**ï¼š
- æ¶ˆæ¯åŠ è½½é€Ÿåº¦æ…¢ï¼ˆé“¾ä¸ŠæŸ¥è¯¢+IPFSä¸‹è½½ï¼‰
- æ— æ¶ˆæ¯æœç´¢åŠŸèƒ½
- æ— æ¶ˆæ¯è½¬å‘åŠŸèƒ½
- æ— æ¶ˆæ¯æ’¤å›åŠŸèƒ½
- æ— æ‰“å­—æŒ‡ç¤ºå™¨
- æ— æ¶ˆæ¯è‰ç¨¿ä¿å­˜
- ç¼ºå°‘emojiè¡¨æƒ…æ”¯æŒ
- ç¼ºå°‘@æåŠåŠŸèƒ½

### 1.3 æ€§èƒ½ç“¶é¢ˆ

**è¯†åˆ«çš„é—®é¢˜**ï¼š

| é—®é¢˜ | å½±å“ | åŸå›  |
|------|------|------|
| æ¶ˆæ¯åŠ è½½æ…¢ | ğŸ”´ é«˜ | é“¾ä¸ŠæŸ¥è¯¢ + IPFSä¸‹è½½ |
| å‘é€å»¶è¿Ÿé«˜ | ğŸ”´ é«˜ | ç­‰å¾…åŒºå—ç¡®è®¤ï¼ˆ6-12ç§’ï¼‰ |
| å·²è¯»çŠ¶æ€å»¶è¿Ÿ | ğŸŸ¡ ä¸­ | éœ€è¦ä¸Šé“¾äº¤æ˜“ |
| åˆ—è¡¨æ»šåŠ¨å¡é¡¿ | ğŸŸ¡ ä¸­ | æœªå®ç°è™šæ‹Ÿæ»šåŠ¨ |
| å›¾ç‰‡åŠ è½½æ…¢ | ğŸŸ¡ ä¸­ | IPFSç½‘ç»œæ³¢åŠ¨ |

---

## 2. æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

### 2.1 æ¶ˆæ¯ç¼“å­˜æœºåˆ¶ â­â­â­â­â­

**é—®é¢˜**ï¼šæ¯æ¬¡æ‰“å¼€ä¼šè¯éƒ½è¦é‡æ–°ä»é“¾ä¸Šå’ŒIPFSåŠ è½½æ¶ˆæ¯

**æ–¹æ¡ˆ**ï¼šå®ç°æœ¬åœ°ç¼“å­˜

#### IndexedDBç¼“å­˜æ¶æ„

```typescript
// æ–‡ä»¶: src/lib/chat-cache.ts

/**
 * å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šèŠå¤©æ¶ˆæ¯ç¼“å­˜ç®¡ç†
 * - ä½¿ç”¨IndexedDBå­˜å‚¨å·²è§£å¯†çš„æ¶ˆæ¯
 * - å‡å°‘é“¾ä¸ŠæŸ¥è¯¢å’ŒIPFSä¸‹è½½
 * - è‡ªåŠ¨åŒæ­¥æœ€æ–°æ¶ˆæ¯
 */

import { openDB, DBSchema, IDBPDatabase } from 'idb';

interface ChatDB extends DBSchema {
  // æ¶ˆæ¯è¡¨
  messages: {
    key: number;  // msg_id
    value: {
      id: number;
      sessionId: string;
      sender: string;
      receiver: string;
      content: MessageContent;
      type: MessageType;
      sentAt: number;
      isRead: boolean;
      isDeleted: boolean;
      cachedAt: number;  // ç¼“å­˜æ—¶é—´
    };
    indexes: {
      'by-session': string;  // sessionId
      'by-time': number;     // sentAt
    };
  };
  
  // ä¼šè¯è¡¨
  sessions: {
    key: string;  // session_id
    value: {
      id: string;
      participants: string[];
      lastMessageId: number;
      lastActive: number;
      unreadCount: number;
      cachedAt: number;
    };
  };
  
  // åŒæ­¥çŠ¶æ€è¡¨
  syncStatus: {
    key: string;  // 'last_sync_time'
    value: number;  // timestamp
  };
}

let db: IDBPDatabase<ChatDB> | null = null;

/**
 * åˆå§‹åŒ–æ•°æ®åº“
 */
export async function initChatDB() {
  if (db) return db;
  
  db = await openDB<ChatDB>('stardust-chat', 1, {
    upgrade(db) {
      // åˆ›å»ºæ¶ˆæ¯è¡¨
      const messageStore = db.createObjectStore('messages', { keyPath: 'id' });
      messageStore.createIndex('by-session', 'sessionId');
      messageStore.createIndex('by-time', 'sentAt');
      
      // åˆ›å»ºä¼šè¯è¡¨
      db.createObjectStore('sessions', { keyPath: 'id' });
      
      // åˆ›å»ºåŒæ­¥çŠ¶æ€è¡¨
      db.createObjectStore('syncStatus');
    },
  });
  
  return db;
}

/**
 * ç¼“å­˜æ¶ˆæ¯
 */
export async function cacheMessage(message: Message) {
  const database = await initChatDB();
  await database.put('messages', {
    ...message,
    cachedAt: Date.now(),
  });
}

/**
 * æ‰¹é‡ç¼“å­˜æ¶ˆæ¯
 */
export async function cacheMessages(messages: Message[]) {
  const database = await initChatDB();
  const tx = database.transaction('messages', 'readwrite');
  
  await Promise.all([
    ...messages.map(msg => tx.store.put({
      ...msg,
      cachedAt: Date.now(),
    })),
    tx.done,
  ]);
}

/**
 * ä»ç¼“å­˜è¯»å–ä¼šè¯æ¶ˆæ¯
 */
export async function getCachedMessages(sessionId: string): Promise<Message[]> {
  const database = await initChatDB();
  const index = database.transaction('messages').store.index('by-session');
  const messages = await index.getAll(sessionId);
  
  // æŒ‰æ—¶é—´æ’åº
  return messages.sort((a, b) => a.sentAt - b.sentAt);
}

/**
 * æ£€æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥
 */
export async function needsSync(sessionId: string): Promise<boolean> {
  const database = await initChatDB();
  const lastSync = await database.get('syncStatus', `session_${sessionId}`);
  
  if (!lastSync) return true;
  
  // è¶…è¿‡5åˆ†é’Ÿï¼Œéœ€è¦åŒæ­¥
  return Date.now() - lastSync > 5 * 60 * 1000;
}

/**
 * æ›´æ–°åŒæ­¥æ—¶é—´
 */
export async function updateSyncTime(sessionId: string) {
  const database = await initChatDB();
  await database.put('syncStatus', Date.now(), `session_${sessionId}`);
}

/**
 * æ¸…ç†è¿‡æœŸç¼“å­˜ï¼ˆ30å¤©å‰çš„æ¶ˆæ¯ï¼‰
 */
export async function cleanupOldCache() {
  const database = await initChatDB();
  const cutoff = Date.now() - 30 * 24 * 60 * 60 * 1000;
  
  const tx = database.transaction('messages', 'readwrite');
  const index = tx.store.index('by-time');
  
  for await (const cursor of index.iterate()) {
    if (cursor.value.cachedAt < cutoff) {
      await cursor.delete();
    }
  }
  
  await tx.done;
}
```

#### ä¼˜åŒ–åçš„æ¶ˆæ¯åŠ è½½æµç¨‹

```typescript
// æ–‡ä»¶: src/lib/chat.ts

/**
 * æ™ºèƒ½åŠ è½½æ¶ˆæ¯ï¼ˆç¼“å­˜ä¼˜å…ˆï¼‰
 */
export async function loadMessages(sessionId: string, account: any): Promise<Message[]> {
  try {
    // 1. å…ˆä»ç¼“å­˜è¯»å–
    const cachedMessages = await getCachedMessages(sessionId);
    
    // 2. æ£€æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥
    const shouldSync = await needsSync(sessionId);
    
    if (!shouldSync && cachedMessages.length > 0) {
      console.log('âœ… ä»ç¼“å­˜åŠ è½½æ¶ˆæ¯:', cachedMessages.length);
      return cachedMessages;
    }
    
    // 3. ä»é“¾ä¸ŠåŒæ­¥æœ€æ–°æ¶ˆæ¯
    console.log('ğŸ”„ ä»é“¾ä¸ŠåŒæ­¥æ¶ˆæ¯...');
    const freshMessages = await loadMessagesFromChain(sessionId, account);
    
    // 4. æ›´æ–°ç¼“å­˜
    await cacheMessages(freshMessages);
    await updateSyncTime(sessionId);
    
    return freshMessages;
  } catch (error) {
    console.error('åŠ è½½æ¶ˆæ¯å¤±è´¥:', error);
    
    // é™çº§ï¼šè¿”å›ç¼“å­˜æ¶ˆæ¯
    const cachedMessages = await getCachedMessages(sessionId);
    if (cachedMessages.length > 0) {
      console.log('âš ï¸ é™çº§åˆ°ç¼“å­˜æ¶ˆæ¯');
      return cachedMessages;
    }
    
    throw error;
  }
}

/**
 * ä»é“¾ä¸ŠåŠ è½½æ¶ˆæ¯
 */
async function loadMessagesFromChain(sessionId: string, account: any): Promise<Message[]> {
  const api = await getApi();
  
  // 1. æŸ¥è¯¢æ¶ˆæ¯IDåˆ—è¡¨
  const messageIds = await api.query.chat.sessionMessages(sessionId);
  
  // 2. æ‰¹é‡æŸ¥è¯¢æ¶ˆæ¯ï¼ˆä¼˜åŒ–ï¼šä½¿ç”¨multiï¼‰
  const metaList = await api.query.chat.messages.multi(messageIds);
  
  // 3. å¹¶è¡Œä¸‹è½½å’Œè§£å¯†
  const messages = await Promise.all(
    metaList.map(async (meta, index) => {
      if (meta.isNone) return null;
      
      const msgMeta = meta.unwrap();
      const msgId = messageIds[index];
      
      // ä»IPFSä¸‹è½½ï¼ˆå¸¦é‡è¯•ï¼‰
      const encryptedContent = await downloadWithRetry(msgMeta.content_cid);
      
      // è§£å¯†
      const content = await decryptMessageContent(
        encryptedContent,
        account.privateKey
      );
      
      return {
        id: msgId,
        sessionId,
        sender: msgMeta.sender.toString(),
        receiver: msgMeta.receiver.toString(),
        content,
        type: msgMeta.msg_type,
        sentAt: msgMeta.sent_at,
        isRead: msgMeta.is_read,
        isDeleted: msgMeta.is_deleted_by_sender || msgMeta.is_deleted_by_receiver,
      };
    })
  );
  
  return messages.filter(Boolean) as Message[];
}

/**
 * IPFSä¸‹è½½ï¼ˆå¸¦é‡è¯•å’Œè¶…æ—¶ï¼‰
 */
async function downloadWithRetry(cid: string, maxRetries = 3): Promise<string> {
  for (let i = 0; i < maxRetries; i++) {
    try {
      // è¶…æ—¶æ§åˆ¶ï¼š10ç§’
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 10000);
      
      const response = await fetch(`https://ipfs.io/ipfs/${cid}`, {
        signal: controller.signal,
      });
      
      clearTimeout(timeoutId);
      
      if (response.ok) {
        return await response.text();
      }
    } catch (error) {
      console.warn(`IPFSä¸‹è½½å¤±è´¥ï¼ˆå°è¯• ${i + 1}/${maxRetries}ï¼‰:`, error);
      
      if (i === maxRetries - 1) {
        throw new Error('IPFSä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
      }
      
      // ç­‰å¾…åé‡è¯•
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
  
  throw new Error('IPFSä¸‹è½½å¤±è´¥');
}
```

**æ•ˆæœ**ï¼š
- âœ… é¦–æ¬¡åŠ è½½ï¼š6-12ç§’ï¼ˆä»é“¾ä¸Šï¼‰
- âœ… å†æ¬¡æ‰“å¼€ï¼š<100msï¼ˆä»ç¼“å­˜ï¼‰
- âœ… æ€§èƒ½æå‡ï¼š**60-120å€**

### 2.2 è™šæ‹Ÿæ»šåŠ¨ â­â­â­â­

**é—®é¢˜**ï¼šå†å²æ¶ˆæ¯å¤šæ—¶ï¼Œåˆ—è¡¨æ»šåŠ¨å¡é¡¿

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨ react-window è™šæ‹Ÿæ»šåŠ¨

```typescript
// æ–‡ä»¶: src/features/chat/VirtualMessageList.tsx

import React from 'react';
import { FixedSizeList } from 'react-window';
import type { Message } from '../../types/chat';
import { MessageBubble } from './MessageBubble';

interface VirtualMessageListProps {
  messages: Message[];
  currentAccount: string;
  height: number;
}

/**
 * å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šè™šæ‹Ÿæ»šåŠ¨æ¶ˆæ¯åˆ—è¡¨
 * - åªæ¸²æŸ“å¯è§åŒºåŸŸçš„æ¶ˆæ¯
 * - æ”¯æŒæ•°åƒæ¡æ¶ˆæ¯æµç•…æ»šåŠ¨
 * - è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
 */
export const VirtualMessageList: React.FC<VirtualMessageListProps> = ({
  messages,
  currentAccount,
  height,
}) => {
  const listRef = React.useRef<FixedSizeList>(null);
  
  // æ»šåŠ¨åˆ°åº•éƒ¨
  React.useEffect(() => {
    if (listRef.current && messages.length > 0) {
      listRef.current.scrollToItem(messages.length - 1);
    }
  }, [messages.length]);
  
  // æ¸²æŸ“å•æ¡æ¶ˆæ¯
  const Row = ({ index, style }: { index: number; style: React.CSSProperties }) => {
    const message = messages[index];
    const isMine = message.sender === currentAccount;
    
    return (
      <div style={style}>
        <MessageBubble message={message} isMine={isMine} />
      </div>
    );
  };
  
  return (
    <FixedSizeList
      ref={listRef}
      height={height}
      itemCount={messages.length}
      itemSize={80}  // æ¯æ¡æ¶ˆæ¯çº¦80pxé«˜
      width="100%"
    >
      {Row}
    </FixedSizeList>
  );
};
```

**æ•ˆæœ**ï¼š
- âœ… æ”¯æŒ10000+æ¡æ¶ˆæ¯æµç•…æ»šåŠ¨
- âœ… å†…å­˜å ç”¨å‡å°‘80%
- âœ… æ¸²æŸ“æ€§èƒ½æå‡10å€

### 2.3 æ‰¹é‡æ“ä½œä¼˜åŒ– â­â­â­â­

**é—®é¢˜**ï¼šæ ‡è®°å¤šæ¡æ¶ˆæ¯å·²è¯»æ—¶ï¼Œéœ€è¦å¤šæ¬¡ä¸Šé“¾äº¤æ˜“

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨pallet-chatçš„æ‰¹é‡æ¥å£

```typescript
// æ–‡ä»¶: src/lib/chat.ts

/**
 * æ‰¹é‡æ ‡è®°æ¶ˆæ¯å·²è¯»ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
 */
export async function markMultipleAsRead(
  messageIds: number[],
  account: any
): Promise<string> {
  const api = await getApi();
  
  // ä½¿ç”¨pallet-chatçš„æ‰¹é‡æ¥å£
  const tx = api.tx.chat.markBatchAsRead(messageIds);
  
  return new Promise((resolve, reject) => {
    tx.signAndSend(account, (result) => {
      if (result.status.isFinalized) {
        resolve(result.status.asFinalized.toHex());
      }
      if (result.dispatchError) {
        reject(new Error('æ‰¹é‡æ ‡è®°å·²è¯»å¤±è´¥'));
      }
    });
  });
}

/**
 * æ™ºèƒ½æ ‡è®°å·²è¯»ï¼ˆè‡ªåŠ¨é€‰æ‹©å•ä¸ªæˆ–æ‰¹é‡ï¼‰
 */
export async function smartMarkAsRead(
  messageIds: number[],
  account: any
): Promise<void> {
  if (messageIds.length === 0) return;
  
  if (messageIds.length === 1) {
    // å•æ¡æ¶ˆæ¯ï¼šä½¿ç”¨å•ä¸ªæ¥å£
    await markMessageAsRead(messageIds[0], account);
  } else {
    // å¤šæ¡æ¶ˆæ¯ï¼šä½¿ç”¨æ‰¹é‡æ¥å£
    await markMultipleAsRead(messageIds, account);
  }
}

/**
 * ä¸€é”®æ ‡è®°ä¼šè¯å·²è¯»
 */
export async function markSessionAsReadOptimized(
  sessionId: string,
  account: any
): Promise<void> {
  const api = await getApi();
  
  // ä½¿ç”¨pallet-chatçš„ä¼šè¯æ‰¹é‡æ¥å£
  const tx = api.tx.chat.markSessionAsRead(sessionId);
  
  await new Promise((resolve, reject) => {
    tx.signAndSend(account, (result) => {
      if (result.status.isFinalized) {
        resolve(result.status.asFinalized.toHex());
      }
      if (result.dispatchError) {
        reject(new Error('æ ‡è®°ä¼šè¯å·²è¯»å¤±è´¥'));
      }
    });
  });
}
```

**æ•ˆæœ**ï¼š
- âœ… æ‰¹é‡æ ‡è®°10æ¡æ¶ˆæ¯ï¼š1æ¬¡äº¤æ˜“ï¼ˆvs 10æ¬¡ï¼‰
- âœ… äº¤æ˜“è´¹ç”¨å‡å°‘90%
- âœ… ç¡®è®¤é€Ÿåº¦æå‡10å€

---

## 3. åŠŸèƒ½å¢å¼ºæ–¹æ¡ˆ

### 3.1 æ¶ˆæ¯æœç´¢ â­â­â­â­â­

**æ–°å¢åŠŸèƒ½**ï¼šåœ¨ä¼šè¯ä¸­æœç´¢æ¶ˆæ¯

```typescript
// æ–‡ä»¶: src/features/chat/MessageSearch.tsx

import React, { useState } from 'react';
import { Input, List, Typography, Tag } from 'antd';
import { SearchOutlined } from '@ant-design/icons';

const { Text } = Typography;

interface MessageSearchProps {
  sessionId: string;
  onSelectMessage: (messageId: number) => void;
}

/**
 * å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šæ¶ˆæ¯æœç´¢ç»„ä»¶
 * - æ”¯æŒå…¨æ–‡æœç´¢
 * - é«˜äº®æ˜¾ç¤ºåŒ¹é…ç»“æœ
 * - ç‚¹å‡»è·³è½¬åˆ°æ¶ˆæ¯ä½ç½®
 */
export const MessageSearch: React.FC<MessageSearchProps> = ({
  sessionId,
  onSelectMessage,
}) => {
  const [keyword, setKeyword] = useState('');
  const [results, setResults] = useState<Message[]>([]);
  const [searching, setSearching] = useState(false);
  
  /**
   * æœç´¢æ¶ˆæ¯
   */
  const handleSearch = async (value: string) => {
    if (!value.trim()) {
      setResults([]);
      return;
    }
    
    setSearching(true);
    try {
      // ä»ç¼“å­˜ä¸­æœç´¢
      const cachedMessages = await getCachedMessages(sessionId);
      
      // å…¨æ–‡åŒ¹é…
      const matched = cachedMessages.filter(msg => {
        const text = msg.content.text || '';
        return text.toLowerCase().includes(value.toLowerCase());
      });
      
      setResults(matched);
    } catch (error) {
      console.error('æœç´¢å¤±è´¥:', error);
    } finally {
      setSearching(false);
    }
  };
  
  /**
   * é«˜äº®å…³é”®è¯
   */
  const highlightText = (text: string, keyword: string) => {
    const regex = new RegExp(`(${keyword})`, 'gi');
    const parts = text.split(regex);
    
    return (
      <span>
        {parts.map((part, index) =>
          regex.test(part) ? (
            <Text key={index} mark style={{ backgroundColor: '#B8860B', color: '#fff' }}>
              {part}
            </Text>
          ) : (
            <span key={index}>{part}</span>
          )
        )}
      </span>
    );
  };
  
  return (
    <div style={{ padding: 16 }}>
      {/* æœç´¢æ¡† */}
      <Input
        placeholder="æœç´¢æ¶ˆæ¯å†…å®¹"
        prefix={<SearchOutlined />}
        value={keyword}
        onChange={(e) => {
          setKeyword(e.target.value);
          handleSearch(e.target.value);
        }}
        size="large"
        allowClear
        style={{
          borderRadius: 24,
          border: '2px solid rgba(184, 134, 11, 0.2)',
        }}
      />
      
      {/* æœç´¢ç»“æœ */}
      {keyword && (
        <div style={{ marginTop: 16 }}>
          <Text type="secondary" style={{ fontSize: 13 }}>
            æ‰¾åˆ° {results.length} æ¡æ¶ˆæ¯
          </Text>
          
          <List
            loading={searching}
            dataSource={results}
            renderItem={(msg) => (
              <List.Item
                onClick={() => onSelectMessage(msg.id)}
                style={{
                  cursor: 'pointer',
                  padding: 12,
                  borderRadius: 8,
                  marginBottom: 8,
                  background: '#fff',
                  border: '1px solid #f0f0f0',
                }}
              >
                <div style={{ flex: 1 }}>
                  <div style={{ marginBottom: 4 }}>
                    <Tag color={msg.sender === account ? 'blue' : 'green'}>
                      {msg.sender === account ? 'æˆ‘' : 'å¯¹æ–¹'}
                    </Tag>
                    <Text type="secondary" style={{ fontSize: 12 }}>
                      {new Date(msg.sentAt).toLocaleString()}
                    </Text>
                  </div>
                  <Text>
                    {highlightText(msg.content.text || '', keyword)}
                  </Text>
                </div>
              </List.Item>
            )}
          />
        </div>
      )}
    </div>
  );
};
```

**æ•ˆæœ**ï¼š
- âœ… å®æ—¶æœç´¢ï¼Œ<100mså“åº”
- âœ… å…³é”®è¯é«˜äº®
- âœ… ç‚¹å‡»è·³è½¬

### 3.2 æ¶ˆæ¯è½¬å‘ â­â­â­â­

**æ–°å¢åŠŸèƒ½**ï¼šè½¬å‘æ¶ˆæ¯åˆ°å…¶ä»–ä¼šè¯

```typescript
// æ–‡ä»¶: src/features/chat/MessageForward.tsx

import React, { useState } from 'react';
import { Modal, List, Avatar, Checkbox, Button, message as antMessage } from 'antd';
import { UserOutlined } from '@ant-design/icons';
import type { Session, Message } from '../../types/chat';

interface MessageForwardProps {
  message: Message;
  visible: boolean;
  onClose: () => void;
  onForward: (targetSessionIds: string[]) => void;
}

/**
 * å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šæ¶ˆæ¯è½¬å‘ç»„ä»¶
 * - é€‰æ‹©ç›®æ ‡ä¼šè¯
 * - æ‰¹é‡è½¬å‘åˆ°å¤šä¸ªä¼šè¯
 * - ä¿ç•™åŸæ¶ˆæ¯æ ¼å¼
 */
export const MessageForward: React.FC<MessageForwardProps> = ({
  message,
  visible,
  onClose,
  onForward,
}) => {
  const [sessions, setSessions] = useState<Session[]>([]);
  const [selectedSessionIds, setSelectedSessionIds] = useState<string[]>([]);
  const [loading, setLoading] = useState(false);
  
  // åŠ è½½ä¼šè¯åˆ—è¡¨
  React.useEffect(() => {
    if (visible) {
      loadSessions();
    }
  }, [visible]);
  
  const loadSessions = async () => {
    // ä»ç¼“å­˜æˆ–é“¾ä¸ŠåŠ è½½ä¼šè¯åˆ—è¡¨
    const userSessions = await getUserSessions(account);
    setSessions(userSessions.filter(s => s.id !== message.sessionId));
  };
  
  const handleForward = async () => {
    if (selectedSessionIds.length === 0) {
      antMessage.warning('è¯·é€‰æ‹©è‡³å°‘ä¸€ä¸ªä¼šè¯');
      return;
    }
    
    setLoading(true);
    try {
      // è½¬å‘æ¶ˆæ¯
      await onForward(selectedSessionIds);
      antMessage.success(`å·²è½¬å‘åˆ° ${selectedSessionIds.length} ä¸ªä¼šè¯`);
      onClose();
    } catch (error) {
      antMessage.error('è½¬å‘å¤±è´¥');
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <Modal
      open={visible}
      title="è½¬å‘æ¶ˆæ¯"
      onCancel={onClose}
      footer={[
        <Button key="cancel" onClick={onClose}>
          å–æ¶ˆ
        </Button>,
        <Button
          key="forward"
          type="primary"
          loading={loading}
          onClick={handleForward}
          style={{
            background: 'linear-gradient(135deg, #B8860B 0%, #D4AF37 100%)',
            border: 'none',
          }}
        >
          è½¬å‘ ({selectedSessionIds.length})
        </Button>,
      ]}
      centered
    >
      {/* æ¶ˆæ¯é¢„è§ˆ */}
      <div style={{
        padding: 12,
        background: '#f5f5f5',
        borderRadius: 8,
        marginBottom: 16,
      }}>
        <Text type="secondary" style={{ fontSize: 13 }}>
          {message.content.text}
        </Text>
      </div>
      
      {/* ä¼šè¯é€‰æ‹© */}
      <List
        dataSource={sessions}
        renderItem={(session) => (
          <List.Item
            onClick={() => {
              setSelectedSessionIds(prev =>
                prev.includes(session.id)
                  ? prev.filter(id => id !== session.id)
                  : [...prev, session.id]
              );
            }}
            style={{ cursor: 'pointer', padding: '12px 8px' }}
          >
            <Checkbox
              checked={selectedSessionIds.includes(session.id)}
              style={{ marginRight: 12 }}
            />
            <List.Item.Meta
              avatar={<Avatar icon={<UserOutlined />} />}
              title={session.otherUser?.name || 'æœªçŸ¥ç”¨æˆ·'}
            />
          </List.Item>
        )}
      />
    </Modal>
  );
};
```

**ä½¿ç”¨æ–¹å¼**ï¼š

```typescript
// åœ¨ChatWindow.tsxä¸­
<MessageBubble
  message={msg}
  isMine={isMine}
  onForward={() => {
    setForwardMessage(msg);
    setForwardModalVisible(true);
  }}
/>

<MessageForward
  message={forwardMessage}
  visible={forwardModalVisible}
  onClose={() => setForwardModalVisible(false)}
  onForward={async (targetSessionIds) => {
    // è½¬å‘åˆ°å¤šä¸ªä¼šè¯
    for (const sessionId of targetSessionIds) {
      await sendMessage({
        receiver: getReceiverFromSession(sessionId),
        content: forwardMessage.content,
        type: forwardMessage.type,
        sessionId,
      }, account);
    }
  }}
/>
```

### 3.3 æ¶ˆæ¯æ’¤å› â­â­â­â­

**æ–°å¢åŠŸèƒ½**ï¼š2åˆ†é’Ÿå†…å¯æ’¤å›æ¶ˆæ¯

```typescript
// æ–‡ä»¶: src/lib/chat.ts

/**
 * æ’¤å›æ¶ˆæ¯ï¼ˆè½¯åˆ é™¤ + ç‰¹æ®Šæ ‡è®°ï¼‰
 */
export async function recallMessage(
  msgId: number,
  account: any
): Promise<void> {
  const api = await getApi();
  
  // 1. æŸ¥è¯¢æ¶ˆæ¯
  const msgMeta = await api.query.chat.messages(msgId);
  if (msgMeta.isNone) {
    throw new Error('æ¶ˆæ¯ä¸å­˜åœ¨');
  }
  
  const msg = msgMeta.unwrap();
  
  // 2. æ£€æŸ¥æ˜¯å¦æ˜¯å‘é€æ–¹
  if (msg.sender.toString() !== account.address) {
    throw new Error('åªèƒ½æ’¤å›è‡ªå·±å‘é€çš„æ¶ˆæ¯');
  }
  
  // 3. æ£€æŸ¥æ—¶é—´ï¼ˆ2åˆ†é’Ÿå†…ï¼‰
  const currentBlock = await api.query.system.number();
  const sentAt = msg.sent_at.toNumber();
  const elapsed = currentBlock.toNumber() - sentAt;
  
  // å‡è®¾6ç§’ä¸€ä¸ªå—ï¼Œ20ä¸ªå— = 2åˆ†é’Ÿ
  if (elapsed > 20) {
    throw new Error('è¶…è¿‡2åˆ†é’Ÿï¼Œæ— æ³•æ’¤å›');
  }
  
  // 4. åˆ é™¤æ¶ˆæ¯ï¼ˆè½¯åˆ é™¤ï¼‰
  const tx = api.tx.chat.deleteMessage(msgId);
  
  return new Promise((resolve, reject) => {
    tx.signAndSend(account, (result) => {
      if (result.status.isFinalized) {
        resolve();
      }
      if (result.dispatchError) {
        reject(new Error('æ’¤å›å¤±è´¥'));
      }
    });
  });
}
```

**UIç»„ä»¶**ï¼š

```typescript
// åœ¨MessageBubbleä¸­æ·»åŠ æ’¤å›æŒ‰é’®
{isMine && isRecallable(message) && (
  <Button
    type="text"
    size="small"
    onClick={async () => {
      Modal.confirm({
        title: 'ç¡®è®¤æ’¤å›',
        content: 'æ’¤å›åï¼Œå¯¹æ–¹å°†æ— æ³•çœ‹åˆ°æ­¤æ¶ˆæ¯',
        okText: 'ç¡®è®¤æ’¤å›',
        cancelText: 'å–æ¶ˆ',
        onOk: async () => {
          try {
            await recallMessage(message.id, account);
            antMessage.success('æ¶ˆæ¯å·²æ’¤å›');
            
            // åˆ·æ–°æ¶ˆæ¯åˆ—è¡¨
            await loadMessages();
          } catch (error) {
            antMessage.error(error.message);
          }
        },
      });
    }}
  >
    æ’¤å›
  </Button>
)}

// åˆ¤æ–­æ˜¯å¦å¯æ’¤å›
function isRecallable(message: Message): boolean {
  const elapsed = Date.now() - message.sentAt;
  return elapsed < 2 * 60 * 1000;  // 2åˆ†é’Ÿå†…
}
```

### 3.4 è‰ç¨¿ä¿å­˜ â­â­â­

**æ–°å¢åŠŸèƒ½**ï¼šè‡ªåŠ¨ä¿å­˜è¾“å…¥ä¸­çš„æ¶ˆæ¯è‰ç¨¿

```typescript
// æ–‡ä»¶: src/lib/chat-draft.ts

/**
 * å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šæ¶ˆæ¯è‰ç¨¿ç®¡ç†
 * - è‡ªåŠ¨ä¿å­˜è¾“å…¥ä¸­çš„æ–‡æœ¬
 * - åˆ‡æ¢ä¼šè¯æ—¶æ¢å¤è‰ç¨¿
 * - å‘é€åè‡ªåŠ¨æ¸…é™¤
 */

const DRAFT_KEY_PREFIX = 'chat_draft_';

/**
 * ä¿å­˜è‰ç¨¿
 */
export function saveDraft(sessionId: string, text: string) {
  if (!text.trim()) {
    // ç©ºè‰ç¨¿ï¼Œåˆ é™¤
    localStorage.removeItem(`${DRAFT_KEY_PREFIX}${sessionId}`);
    return;
  }
  
  const draft = {
    text,
    savedAt: Date.now(),
  };
  
  localStorage.setItem(
    `${DRAFT_KEY_PREFIX}${sessionId}`,
    JSON.stringify(draft)
  );
}

/**
 * è¯»å–è‰ç¨¿
 */
export function loadDraft(sessionId: string): string {
  try {
    const draftStr = localStorage.getItem(`${DRAFT_KEY_PREFIX}${sessionId}`);
    if (!draftStr) return '';
    
    const draft = JSON.parse(draftStr);
    
    // è¶…è¿‡24å°æ—¶çš„è‰ç¨¿ï¼Œè‡ªåŠ¨æ¸…é™¤
    if (Date.now() - draft.savedAt > 24 * 60 * 60 * 1000) {
      localStorage.removeItem(`${DRAFT_KEY_PREFIX}${sessionId}`);
      return '';
    }
    
    return draft.text || '';
  } catch (error) {
    return '';
  }
}

/**
 * æ¸…é™¤è‰ç¨¿
 */
export function clearDraft(sessionId: string) {
  localStorage.removeItem(`${DRAFT_KEY_PREFIX}${sessionId}`);
}
```

**UIé›†æˆ**ï¼š

```typescript
// åœ¨ChatWindow.tsxä¸­
const [inputText, setInputText] = useState('');

// åˆ‡æ¢ä¼šè¯æ—¶ï¼ŒåŠ è½½è‰ç¨¿
useEffect(() => {
  const draft = loadDraft(session.id);
  setInputText(draft);
}, [session.id]);

// è¾“å…¥æ—¶ï¼Œè‡ªåŠ¨ä¿å­˜è‰ç¨¿
const handleInputChange = (value: string) => {
  setInputText(value);
  saveDraft(session.id, value);
};

// å‘é€åï¼Œæ¸…é™¤è‰ç¨¿
const handleSend = async () => {
  await sendMessage(...);
  clearDraft(session.id);
  setInputText('');
};
```

### 3.5 Emojiè¡¨æƒ…æ”¯æŒ â­â­â­

**æ–°å¢åŠŸèƒ½**ï¼šè¡¨æƒ…é€‰æ‹©å™¨

```typescript
// æ–‡ä»¶: src/features/chat/EmojiPicker.tsx

import React from 'react';
import { Popover, Button } from 'antd';
import { SmileOutlined } from '@ant-design/icons';

interface EmojiPickerProps {
  onSelect: (emoji: string) => void;
}

/**
 * å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šEmojiè¡¨æƒ…é€‰æ‹©å™¨
 * - å¸¸ç”¨è¡¨æƒ…å¿«é€Ÿé€‰æ‹©
 * - ç‚¹å‡»æ’å…¥åˆ°è¾“å…¥æ¡†
 */
export const EmojiPicker: React.FC<EmojiPickerProps> = ({ onSelect }) => {
  const emojis = [
    'ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£',
    'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Œ', 'ğŸ˜',
    'ğŸ¥°', 'ğŸ˜˜', 'ğŸ˜—', 'ğŸ˜™', 'ğŸ˜š', 'ğŸ˜‹', 'ğŸ˜›',
    'ğŸ˜', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ¤¨', 'ğŸ§', 'ğŸ¤“', 'ğŸ˜',
    'ğŸ‘', 'ğŸ‘', 'ğŸ‘Œ', 'ğŸ¤', 'ğŸ’ª', 'ğŸ™', 'â¤ï¸',
    'ğŸ’”', 'ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’™', 'ğŸ’š', 'ğŸ’›',
    'ğŸ‰', 'ğŸŠ', 'ğŸ', 'ğŸˆ', 'ğŸŒ¹', 'ğŸŒ¸', 'ğŸŒº',
  ];
  
  const emojiContent = (
    <div style={{
      display: 'grid',
      gridTemplateColumns: 'repeat(7, 1fr)',
      gap: 8,
      padding: 8,
      maxWidth: 280,
    }}>
      {emojis.map((emoji, index) => (
        <Button
          key={index}
          type="text"
          onClick={() => onSelect(emoji)}
          style={{
            fontSize: 24,
            padding: 4,
            height: 40,
            width: 40,
          }}
        >
          {emoji}
        </Button>
      ))}
    </div>
  );
  
  return (
    <Popover content={emojiContent} trigger="click" placement="topLeft">
      <Button
        type="text"
        icon={<SmileOutlined style={{ fontSize: 20, color: '#B8860B' }} />}
      />
    </Popover>
  );
};
```

**ä½¿ç”¨æ–¹å¼**ï¼š

```typescript
// åœ¨ChatWindowè¾“å…¥åŒºåŸŸ
<div style={{ display: 'flex', gap: 8, alignItems: 'flex-end' }}>
  <EmojiPicker
    onSelect={(emoji) => {
      setInputText(prev => prev + emoji);
    }}
  />
  
  <TextArea
    value={inputText}
    onChange={(e) => setInputText(e.target.value)}
    placeholder="è¾“å…¥æ¶ˆæ¯..."
  />
  
  <Button type="primary" onClick={handleSend}>
    å‘é€
  </Button>
</div>
```

### 3.6 æ¶ˆæ¯å¼•ç”¨å›å¤ â­â­â­â­

**æ–°å¢åŠŸèƒ½**ï¼šå¼•ç”¨æŸæ¡æ¶ˆæ¯è¿›è¡Œå›å¤

```typescript
// ä¿®æ”¹MessageContentç±»å‹
interface MessageContent {
  text?: string;
  imageUrl?: string;
  fileUrl?: string;
  timestamp: number;
  
  // æ–°å¢ï¼šå¼•ç”¨æ¶ˆæ¯
  replyTo?: {
    messageId: number;
    text: string;
    sender: string;
  };
}

// UIç»„ä»¶
{message.content.replyTo && (
  <div style={{
    padding: 8,
    background: 'rgba(0, 0, 0, 0.05)',
    borderLeft: '3px solid #B8860B',
    borderRadius: 4,
    marginBottom: 8,
  }}>
    <Text type="secondary" style={{ fontSize: 12 }}>
      å›å¤ {message.content.replyTo.sender}:
    </Text>
    <Text style={{ fontSize: 13, display: 'block' }}>
      {message.content.replyTo.text}
    </Text>
  </div>
)}
```

---

## 4. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 4.1 æ¶ˆæ¯çŠ¶æ€æŒ‡ç¤º â­â­â­â­â­

**ä¼˜åŒ–**ï¼šæ¸…æ™°çš„æ¶ˆæ¯å‘é€çŠ¶æ€

```typescript
// æ¶ˆæ¯çŠ¶æ€æšä¸¾
enum MessageSendStatus {
  Sending = 'sending',      // å‘é€ä¸­ï¼ˆä¸Šä¼ IPFSï¼‰
  Confirming = 'confirming', // ç¡®è®¤ä¸­ï¼ˆç­‰å¾…ä¸Šé“¾ï¼‰
  Sent = 'sent',            // å·²å‘é€
  Failed = 'failed',        // å¤±è´¥
}

// UIç»„ä»¶
{message.status === 'sending' && <LoadingOutlined spin />}
{message.status === 'confirming' && <ClockCircleOutlined />}
{message.status === 'sent' && message.isRead && <CheckOutlined style={{ color: '#52c41a' }} />}
{message.status === 'sent' && !message.isRead && <CheckOutlined />}
{message.status === 'failed' && (
  <Button
    type="text"
    size="small"
    onClick={() => retryMessage(message)}
  >
    <ExclamationCircleOutlined style={{ color: '#ff4d4f' }} /> é‡å‘
  </Button>
)}
```

### 4.2 æœªè¯»æ¶ˆæ¯æç¤º â­â­â­â­â­

**ä¼˜åŒ–**ï¼šè‡ªåŠ¨æ»šåŠ¨åˆ°ç¬¬ä¸€æ¡æœªè¯»æ¶ˆæ¯

```typescript
/**
 * æ»šåŠ¨åˆ°ç¬¬ä¸€æ¡æœªè¯»æ¶ˆæ¯
 */
export function scrollToFirstUnread(
  messages: Message[],
  currentAccount: string,
  containerRef: React.RefObject<HTMLDivElement>
) {
  const firstUnreadIndex = messages.findIndex(
    msg => !msg.isRead && msg.receiver === currentAccount
  );
  
  if (firstUnreadIndex === -1) {
    // æ— æœªè¯»ï¼Œæ»šåŠ¨åˆ°åº•éƒ¨
    scrollToBottom(containerRef);
    return;
  }
  
  // æ»šåŠ¨åˆ°ç¬¬ä¸€æ¡æœªè¯»æ¶ˆæ¯
  const firstUnreadElement = document.querySelector(
    `[data-message-id="${messages[firstUnreadIndex].id}"]`
  );
  
  if (firstUnreadElement) {
    firstUnreadElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
    
    // é«˜äº®æç¤º
    firstUnreadElement.classList.add('first-unread');
  }
}

// CSS
.first-unread {
  position: relative;
  animation: highlightUnread 2s ease;
}

.first-unread::before {
  content: 'â”€â”€ ä»¥ä¸‹æ˜¯æœªè¯»æ¶ˆæ¯ â”€â”€';
  position: absolute;
  top: -30px;
  left: 50%;
  transform: translateX(-50%);
  color: #B8860B;
  font-size: 12px;
  background: #fff;
  padding: 4px 12px;
  border-radius: 12px;
  border: 1px solid #B8860B;
}

@keyframes highlightUnread {
  0%, 100% { background: transparent; }
  50% { background: rgba(184, 134, 11, 0.1); }
}
```

### 4.3 è¾“å…¥ä¼˜åŒ– â­â­â­â­

**ä¼˜åŒ–**ï¼šæ™ºèƒ½è¾“å…¥ä½“éªŒ

```typescript
/**
 * æ™ºèƒ½è¾“å…¥æ¡†ç»„ä»¶
 */
<TextArea
  value={inputText}
  onChange={handleInputChange}
  onKeyPress={(e) => {
    // Ctrl+Enter æˆ– Cmd+Enter å‘é€
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
      e.preventDefault();
      handleSend();
    }
  }}
  placeholder="è¾“å…¥æ¶ˆæ¯... (Ctrl+Enterå‘é€)"
  autoSize={{ minRows: 1, maxRows: 4 }}
  maxLength={1000}
  showCount
  style={{
    borderRadius: 20,
    border: '2px solid rgba(184, 134, 11, 0.2)',
    padding: '8px 16px',
    resize: 'none',
  }}
/>

{/* å­—æ•°ç»Ÿè®¡ */}
<Text type="secondary" style={{ fontSize: 12 }}>
  {inputText.length}/1000
</Text>

{/* å¿«æ·é”®æç¤º */}
<Text type="secondary" style={{ fontSize: 11 }}>
  Ctrl+Enter å‘é€
</Text>
```

### 4.4 æ¶ˆæ¯æ—¶é—´ä¼˜åŒ– â­â­â­

**ä¼˜åŒ–**ï¼šæ™ºèƒ½æ˜¾ç¤ºæ¶ˆæ¯æ—¶é—´

```typescript
/**
 * æ™ºèƒ½æ—¶é—´æ˜¾ç¤º
 */
export function formatMessageTime(timestamp: number): string {
  const now = Date.now();
  const diff = now - timestamp;
  
  const minute = 60 * 1000;
  const hour = 60 * minute;
  const day = 24 * hour;
  
  if (diff < minute) {
    return 'åˆšåˆš';
  } else if (diff < hour) {
    return `${Math.floor(diff / minute)}åˆ†é’Ÿå‰`;
  } else if (diff < day) {
    return `${Math.floor(diff / hour)}å°æ—¶å‰`;
  } else if (diff < 7 * day) {
    return `${Math.floor(diff / day)}å¤©å‰`;
  } else {
    return new Date(timestamp).toLocaleDateString();
  }
}

/**
 * æ™ºèƒ½åˆ†ç»„æ˜¾ç¤ºæ—¶é—´
 */
export function groupMessagesByTime(messages: Message[]) {
  const groups: { time: string; messages: Message[] }[] = [];
  let currentGroup: Message[] = [];
  let lastTime = 0;
  
  messages.forEach((msg, index) => {
    // è¶…è¿‡5åˆ†é’Ÿï¼Œæ’å…¥æ—¶é—´åˆ†éš”
    if (index === 0 || msg.sentAt - lastTime > 5 * 60 * 1000) {
      if (currentGroup.length > 0) {
        groups.push({
          time: formatMessageTime(lastTime),
          messages: currentGroup,
        });
      }
      currentGroup = [msg];
      lastTime = msg.sentAt;
    } else {
      currentGroup.push(msg);
    }
  });
  
  if (currentGroup.length > 0) {
    groups.push({
      time: formatMessageTime(lastTime),
      messages: currentGroup,
    });
  }
  
  return groups;
}

// UIæ¸²æŸ“
{groupMessagesByTime(messages).map((group, index) => (
  <div key={index}>
    {/* æ—¶é—´åˆ†éš”çº¿ */}
    <div style={{
      textAlign: 'center',
      margin: '20px 0',
    }}>
      <Text type="secondary" style={{
        fontSize: 12,
        background: '#fff',
        padding: '4px 12px',
        borderRadius: 12,
        border: '1px solid #f0f0f0',
      }}>
        {group.time}
      </Text>
    </div>
    
    {/* æ¶ˆæ¯åˆ—è¡¨ */}
    {group.messages.map(msg => (
      <MessageBubble key={msg.id} message={msg} />
    ))}
  </div>
))}
```

---

## 5. å®‰å…¨æ€§æå‡

### 5.1 æ¶ˆæ¯éªŒè¯å¢å¼º â­â­â­â­

**ä¼˜åŒ–**ï¼šéªŒè¯æ¶ˆæ¯å®Œæ•´æ€§

```typescript
/**
 * æ¶ˆæ¯å®Œæ•´æ€§éªŒè¯
 */
export async function verifyMessageIntegrity(
  message: Message,
  encryptedCid: string
): Promise<boolean> {
  try {
    // 1. é‡æ–°è®¡ç®—æ¶ˆæ¯å“ˆå¸Œ
    const content = JSON.stringify(message.content);
    const calculatedHash = hashMessage(content);
    
    // 2. ä¸é“¾ä¸ŠCIDå¯¹æ¯”
    const chainCid = await api.query.chat.messages(message.id).content_cid;
    
    // 3. éªŒè¯æ˜¯å¦ä¸€è‡´
    return calculatedHash === chainCid;
  } catch (error) {
    console.error('éªŒè¯å¤±è´¥:', error);
    return false;
  }
}

/**
 * æ¶ˆæ¯ç­¾åï¼ˆå¯é€‰ï¼Œå¢å¼ºå®‰å…¨æ€§ï¼‰
 */
export async function signMessage(
  content: MessageContent,
  senderPrivateKey: string
): Promise<string> {
  const message = JSON.stringify(content);
  const signature = await sign(message, senderPrivateKey);
  return signature;
}
```

### 5.2 é»‘åå•UI â­â­â­

**æ–°å¢**ï¼šé»‘åå•ç®¡ç†é¡µé¢

```typescript
// æ–‡ä»¶: src/features/chat/BlockedUsers.tsx

/**
 * é»‘åå•ç®¡ç†ç»„ä»¶
 */
export const BlockedUsers: React.FC = () => {
  const [blockedList, setBlockedList] = useState<string[]>([]);
  
  // åŠ è½½é»‘åå•
  useEffect(() => {
    loadBlockedUsers();
  }, []);
  
  const loadBlockedUsers = async () => {
    const api = await getApi();
    const list = await api.query.chat.listBlockedUsers(account);
    setBlockedList(list.map(addr => addr.toString()));
  };
  
  // æ‹‰é»‘ç”¨æˆ·
  const blockUser = async (userAddress: string) => {
    const api = await getApi();
    const tx = api.tx.chat.blockUser(userAddress);
    await tx.signAndSend(account);
    
    antMessage.success('å·²æ‹‰é»‘è¯¥ç”¨æˆ·');
    loadBlockedUsers();
  };
  
  // è§£é™¤æ‹‰é»‘
  const unblockUser = async (userAddress: string) => {
    const api = await getApi();
    const tx = api.tx.chat.unblockUser(userAddress);
    await tx.signAndSend(account);
    
    antMessage.success('å·²è§£é™¤æ‹‰é»‘');
    loadBlockedUsers();
  };
  
  return (
    <Card title="é»‘åå•ç®¡ç†" style={{ maxWidth: 480, margin: '0 auto' }}>
      <List
        dataSource={blockedList}
        renderItem={(address) => (
          <List.Item
            actions={[
              <Button
                type="link"
                onClick={() => unblockUser(address)}
              >
                è§£é™¤
              </Button>
            ]}
          >
            <Text code>{address.slice(0, 10)}...{address.slice(-8)}</Text>
          </List.Item>
        )}
      />
    </Card>
  );
};
```

---

## 6. å®æ–½è®¡åˆ’

### 6.1 ä¼˜å…ˆçº§æ’åº

| ä¼˜åŒ–é¡¹ | ä¼˜å…ˆçº§ | æŠ•å…¥ | ä»·å€¼ | å®æ–½é¡ºåº |
|--------|--------|------|------|---------|
| **æ¶ˆæ¯ç¼“å­˜** | P0 | 4å°æ—¶ | â­â­â­â­â­ | 1 |
| **æ‰¹é‡æ ‡è®°å·²è¯»** | P0 | 2å°æ—¶ | â­â­â­â­ | 2 |
| **æ¶ˆæ¯çŠ¶æ€æŒ‡ç¤º** | P0 | 2å°æ—¶ | â­â­â­â­â­ | 3 |
| **æ¶ˆæ¯æœç´¢** | P1 | 4å°æ—¶ | â­â­â­â­ | 4 |
| **è‰ç¨¿ä¿å­˜** | P1 | 2å°æ—¶ | â­â­â­ | 5 |
| **Emojiæ”¯æŒ** | P1 | 2å°æ—¶ | â­â­â­ | 6 |
| **æ¶ˆæ¯æ’¤å›** | P2 | 3å°æ—¶ | â­â­â­ | 7 |
| **æ¶ˆæ¯è½¬å‘** | P2 | 3å°æ—¶ | â­â­â­ | 8 |
| **è™šæ‹Ÿæ»šåŠ¨** | P2 | 4å°æ—¶ | â­â­â­ | 9 |
| **é»‘åå•UI** | P2 | 2å°æ—¶ | â­â­ | 10 |

### 6.2 ç¬¬1å¤©å®æ–½ï¼ˆP0æ ¸å¿ƒä¼˜åŒ–ï¼‰

**ä¸Šåˆï¼ˆ4å°æ—¶ï¼‰**ï¼š

```
09:00-11:00  å®ç°æ¶ˆæ¯ç¼“å­˜æœºåˆ¶
             - åˆ›å»º chat-cache.ts
             - å®ç° IndexedDB æ“ä½œ
             - é›†æˆåˆ° loadMessages

11:00-13:00  å®ç°æ‰¹é‡å·²è¯»ä¼˜åŒ–
             - ä¼˜åŒ– markAsRead é€»è¾‘
             - æ·»åŠ æ™ºèƒ½æ‰¹é‡å¤„ç†
             - å‰ç«¯UIé€‚é…
```

**ä¸‹åˆï¼ˆ4å°æ—¶ï¼‰**ï¼š

```
14:00-16:00  æ¶ˆæ¯çŠ¶æ€æŒ‡ç¤º
             - æ·»åŠ å‘é€çŠ¶æ€ç®¡ç†
             - UIçŠ¶æ€å›¾æ ‡
             - å¤±è´¥é‡è¯•åŠŸèƒ½

16:00-18:00  æ¶ˆæ¯æœç´¢åŠŸèƒ½
             - å®ç°æœç´¢ç»„ä»¶
             - é›†æˆåˆ°ChatWindow
             - æµ‹è¯•éªŒè¯
```

### 6.3 ç¬¬2å¤©å®æ–½ï¼ˆP1å¢å¼ºåŠŸèƒ½ï¼‰

**ä¸Šåˆï¼ˆ4å°æ—¶ï¼‰**ï¼š

```
09:00-11:00  è‰ç¨¿ä¿å­˜ + Emoji
             - å®ç°è‰ç¨¿ç®¡ç†
             - åˆ›å»ºEmojié€‰æ‹©å™¨
             - é›†æˆåˆ°è¾“å…¥æ¡†

11:00-13:00  æ¶ˆæ¯æ—¶é—´ä¼˜åŒ–
             - æ™ºèƒ½æ—¶é—´æ˜¾ç¤º
             - æ¶ˆæ¯åˆ†ç»„
             - UIä¼˜åŒ–
```

**ä¸‹åˆï¼ˆ4å°æ—¶ï¼‰**ï¼š

```
14:00-16:00  æ¶ˆæ¯æ’¤å›
             - å®ç°æ’¤å›é€»è¾‘
             - UIé›†æˆ
             - æ—¶é—´é™åˆ¶

16:00-18:00  æ•´ä½“æµ‹è¯•
             - åŠŸèƒ½æµ‹è¯•
             - æ€§èƒ½æµ‹è¯•
             - Bugä¿®å¤
```

---

## 7. é¢„æœŸæ•ˆæœ

### 7.1 æ€§èƒ½æå‡

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **é¦–æ¬¡åŠ è½½** | 6-12ç§’ | 6-12ç§’ | - |
| **å†æ¬¡æ‰“å¼€** | 6-12ç§’ | <100ms | â¬†ï¸ **60-120å€** |
| **æ¶ˆæ¯æœç´¢** | âŒ | <100ms | â¬†ï¸ **æ–°å¢** |
| **æ‰¹é‡å·²è¯»** | NÃ—6ç§’ | 6ç§’ | â¬†ï¸ **Nå€** |
| **æ»šåŠ¨æµç•…åº¦** | å¡é¡¿ | æµç•… | â¬†ï¸ **10å€** |

### 7.2 åŠŸèƒ½å¢å¼º

**æ–°å¢8ä¸ªé‡è¦åŠŸèƒ½**ï¼š

1. âœ… æ¶ˆæ¯ç¼“å­˜ï¼ˆæ€§èƒ½æå‡ï¼‰
2. âœ… æ¶ˆæ¯æœç´¢ï¼ˆä¾¿åˆ©æ€§æå‡ï¼‰
3. âœ… æ¶ˆæ¯è½¬å‘ï¼ˆåŠŸèƒ½æ€§æå‡ï¼‰
4. âœ… æ¶ˆæ¯æ’¤å›ï¼ˆå®¹é”™æ€§æå‡ï¼‰
5. âœ… è‰ç¨¿ä¿å­˜ï¼ˆä½“éªŒæå‡ï¼‰
6. âœ… Emojiè¡¨æƒ…ï¼ˆè¶£å‘³æ€§æå‡ï¼‰
7. âœ… å¼•ç”¨å›å¤ï¼ˆäº’åŠ¨æ€§æå‡ï¼‰
8. âœ… é»‘åå•UIï¼ˆå®‰å…¨æ€§æå‡ï¼‰

### 7.3 ç”¨æˆ·ä½“éªŒæå‡

**æ”¹è¿›å‰**ï¼š
- âŒ æ¯æ¬¡æ‰“å¼€éƒ½ç­‰6-12ç§’
- âŒ æ‰¾å†å²æ¶ˆæ¯å›°éš¾
- âŒ å‘é”™äº†æ— æ³•æ’¤å›
- âŒ è¾“å…¥ä¸­åˆ‡æ¢ä¼šè¯ï¼Œå†…å®¹ä¸¢å¤±

**æ”¹è¿›å**ï¼š
- âœ… å†æ¬¡æ‰“å¼€ç§’å¼€ï¼ˆ<100msï¼‰
- âœ… å…³é”®è¯æœç´¢ï¼Œå¿«é€Ÿå®šä½
- âœ… 2åˆ†é’Ÿå†…å¯æ’¤å›
- âœ… è‡ªåŠ¨ä¿å­˜è‰ç¨¿

---

## 8. ä»£ç å®æ–½æ¸…å•

### 8.1 æ–°å¢æ–‡ä»¶ï¼ˆ10ä¸ªï¼‰

| æ–‡ä»¶ | åŠŸèƒ½ | ä»£ç é‡ |
|------|------|--------|
| `lib/chat-cache.ts` | IndexedDBç¼“å­˜ç®¡ç† | 200è¡Œ |
| `features/chat/MessageSearch.tsx` | æ¶ˆæ¯æœç´¢ç»„ä»¶ | 150è¡Œ |
| `features/chat/MessageForward.tsx` | æ¶ˆæ¯è½¬å‘ç»„ä»¶ | 120è¡Œ |
| `features/chat/EmojiPicker.tsx` | è¡¨æƒ…é€‰æ‹©å™¨ | 80è¡Œ |
| `features/chat/VirtualMessageList.tsx` | è™šæ‹Ÿæ»šåŠ¨ | 100è¡Œ |
| `features/chat/MessageBubble.tsx` | æ¶ˆæ¯æ°”æ³¡ç»„ä»¶ | 150è¡Œ |
| `features/chat/BlockedUsers.tsx` | é»‘åå•ç®¡ç† | 100è¡Œ |
| `lib/chat-draft.ts` | è‰ç¨¿ç®¡ç† | 80è¡Œ |
| `lib/chat-retry.ts` | é‡è¯•æœºåˆ¶ | 60è¡Œ |
| `lib/chat-time.ts` | æ—¶é—´å·¥å…· | 80è¡Œ |

**æ€»ä»£ç é‡**ï¼šçº¦1120è¡Œ

### 8.2 ä¿®æ”¹æ–‡ä»¶ï¼ˆ5ä¸ªï¼‰

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | ä»£ç é‡ |
|------|---------|--------|
| `lib/chat.ts` | æ·»åŠ ç¼“å­˜é€»è¾‘ã€æ‰¹é‡æ¥å£ | +150è¡Œ |
| `features/chat/ChatWindow.tsx` | é›†æˆæ–°åŠŸèƒ½ç»„ä»¶ | +200è¡Œ |
| `features/chat/ChatList.tsx` | ä¼˜åŒ–åˆ—è¡¨æ˜¾ç¤º | +50è¡Œ |
| `types/chat.ts` | æ‰©å±•ç±»å‹å®šä¹‰ | +50è¡Œ |
| `ChatWindow.css` | æ–°å¢æ ·å¼ | +100è¡Œ |

**æ€»ä¿®æ”¹é‡**ï¼šçº¦550è¡Œ

**æ€»å·¥ä½œé‡**ï¼šçº¦1670è¡Œä»£ç ï¼ˆ1-2å¤©ï¼‰

---

## 9. æµ‹è¯•è®¡åˆ’

### 9.1 å•å…ƒæµ‹è¯•

```typescript
// chat-cache.test.ts
describe('Chat Cache', () => {
  test('åº”è¯¥èƒ½ç¼“å­˜æ¶ˆæ¯', async () => {
    await cacheMessage(mockMessage);
    const cached = await getCachedMessages(sessionId);
    expect(cached).toContainEqual(mockMessage);
  });
  
  test('åº”è¯¥èƒ½æ‰¹é‡ç¼“å­˜', async () => {
    await cacheMessages(mockMessages);
    const cached = await getCachedMessages(sessionId);
    expect(cached.length).toBe(mockMessages.length);
  });
  
  test('åº”è¯¥èƒ½æ¸…ç†è¿‡æœŸç¼“å­˜', async () => {
    await cleanupOldCache();
    // éªŒè¯è¿‡æœŸæ¶ˆæ¯å·²åˆ é™¤
  });
});

// chat-search.test.ts
describe('Message Search', () => {
  test('åº”è¯¥èƒ½æœç´¢æ–‡æœ¬æ¶ˆæ¯', async () => {
    const results = await searchMessages('å…³é”®è¯', messages);
    expect(results.length).toBeGreaterThan(0);
  });
  
  test('åº”è¯¥æ”¯æŒå¤§å°å†™ä¸æ•æ„Ÿ', async () => {
    const results1 = await searchMessages('Hello', messages);
    const results2 = await searchMessages('hello', messages);
    expect(results1).toEqual(results2);
  });
});
```

### 9.2 æ€§èƒ½æµ‹è¯•

```typescript
// æµ‹è¯•ç¼“å­˜æ€§èƒ½
async function testCachePerformance() {
  const sessionId = 'test-session';
  
  // æµ‹è¯•1ï¼šä»é“¾ä¸ŠåŠ è½½ï¼ˆæ— ç¼“å­˜ï¼‰
  console.time('ä»é“¾ä¸ŠåŠ è½½');
  await loadMessagesFromChain(sessionId, account);
  console.timeEnd('ä»é“¾ä¸ŠåŠ è½½');
  // é¢„æœŸï¼š6-12ç§’
  
  // æµ‹è¯•2ï¼šä»ç¼“å­˜åŠ è½½
  console.time('ä»ç¼“å­˜åŠ è½½');
  await getCachedMessages(sessionId);
  console.timeEnd('ä»ç¼“å­˜åŠ è½½');
  // é¢„æœŸï¼š<100ms
  
  // æ€§èƒ½æå‡ï¼š60-120å€
}

// æµ‹è¯•è™šæ‹Ÿæ»šåŠ¨æ€§èƒ½
async function testVirtualScrollPerformance() {
  const messages = generateMockMessages(10000);
  
  console.time('æ¸²æŸ“10000æ¡æ¶ˆæ¯');
  render(<VirtualMessageList messages={messages} />);
  console.timeEnd('æ¸²æŸ“10000æ¡æ¶ˆæ¯');
  // é¢„æœŸï¼š<500msï¼ˆvs æ™®é€šåˆ—è¡¨ 5-10ç§’ï¼‰
}
```

---

## 10. å…¼å®¹æ€§è¯´æ˜

### 10.1 å‘åå…¼å®¹

**âœ… å®Œå…¨å…¼å®¹**ï¼š
- ä¸ä¿®æ”¹pallet-chat
- ä¸ä¿®æ”¹æ•°æ®ç»“æ„
- ä¸å½±å“ç°æœ‰åŠŸèƒ½
- çº¯å‰ç«¯ä¼˜åŒ–

**å‡çº§æ–¹å¼**ï¼š
- ç”¨æˆ·æ— æ„ŸçŸ¥
- è‡ªåŠ¨è¿ç§»ç¼“å­˜
- æ¸è¿›å¼å¢å¼º

### 10.2 é™çº§ç­–ç•¥

**ç¼“å­˜å¤±è´¥**ï¼š
- é™çº§åˆ°é“¾ä¸ŠåŠ è½½
- æ˜¾ç¤ºé™çº§æç¤º
- ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½

**IndexedDBä¸å¯ç”¨**ï¼š
- æ£€æµ‹æµè§ˆå™¨æ”¯æŒ
- é™çº§åˆ°å†…å­˜ç¼“å­˜
- æç¤ºç”¨æˆ·å‡çº§æµè§ˆå™¨

---

## 11. æ–‡æ¡£å’ŒåŸ¹è®­

### 11.1 ç”¨æˆ·æ–‡æ¡£

**æ–°å¢**ï¼šèŠå¤©ä½¿ç”¨æŒ‡å—

```markdown
# èŠå¤©åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## åŸºç¡€åŠŸèƒ½

### å‘é€æ¶ˆæ¯
- è¾“å…¥æ–‡æœ¬ï¼Œç‚¹å‡»"å‘é€"
- æˆ–æŒ‰ Ctrl+Enter å¿«é€Ÿå‘é€
- æ”¯æŒEmojiè¡¨æƒ…

### æŸ¥çœ‹æ¶ˆæ¯
- æœªè¯»æ¶ˆæ¯è‡ªåŠ¨é«˜äº®
- æ»šåŠ¨åˆ°ç¬¬ä¸€æ¡æœªè¯»
- æ¶ˆæ¯è‡ªåŠ¨åˆ†ç»„æ˜¾ç¤º

## é«˜çº§åŠŸèƒ½

### æœç´¢æ¶ˆæ¯
1. ç‚¹å‡»æœç´¢å›¾æ ‡
2. è¾“å…¥å…³é”®è¯
3. ç‚¹å‡»ç»“æœè·³è½¬

### è½¬å‘æ¶ˆæ¯
1. é•¿æŒ‰æ¶ˆæ¯
2. é€‰æ‹©"è½¬å‘"
3. é€‰æ‹©ç›®æ ‡ä¼šè¯

### æ’¤å›æ¶ˆæ¯
- 2åˆ†é’Ÿå†…å¯æ’¤å›
- ç‚¹å‡»"æ’¤å›"æŒ‰é’®
- å¯¹æ–¹å°†çœ‹åˆ°"æ¶ˆæ¯å·²æ’¤å›"

### é»‘åå•
- è®¾ç½® â†’ é»‘åå•
- æ‹‰é»‘åå¯¹æ–¹æ— æ³•å‘æ¶ˆæ¯
```

### 11.2 å¼€å‘æ–‡æ¡£

**æ–°å¢**ï¼šèŠå¤©æ¨¡å—å¼€å‘æŒ‡å—

```markdown
# èŠå¤©æ¨¡å—å¼€å‘æŒ‡å—

## æ¶æ„è¯´æ˜

### æ•°æ®æµ
ç”¨æˆ·è¾“å…¥ â†’ åŠ å¯† â†’ ä¸Šä¼ IPFS â†’ é“¾ä¸Šå­˜å‚¨å…ƒæ•°æ® â†’ äº‹ä»¶é€šçŸ¥ â†’ æ¥æ”¶æ–¹ä¸‹è½½è§£å¯† â†’ ç¼“å­˜ â†’ æ˜¾ç¤º

### ç¼“å­˜ç­–ç•¥
- IndexedDBæŒä¹…åŒ–
- 5åˆ†é’ŸåŒæ­¥é—´éš”
- 30å¤©è‡ªåŠ¨æ¸…ç†

## APIæ¥å£

### å‘é€æ¶ˆæ¯
\`\`\`typescript
await sendMessage({
  receiver,
  content: { text: 'æ¶ˆæ¯å†…å®¹' },
  type: MessageType.Text,
  sessionId,
}, account)
\`\`\`

### æœç´¢æ¶ˆæ¯
\`\`\`typescript
const results = await searchMessages('å…³é”®è¯', sessionId)
\`\`\`
```

---

## 12. æ€»ç»“

### 12.1 æ ¸å¿ƒä»·å€¼

**æŠ•å…¥äº§å‡ºæ¯”**ï¼šâ­â­â­â­â­

- **æŠ•å…¥**ï¼š1-2å¤©ï¼ˆçº¦1670è¡Œä»£ç ï¼‰
- **äº§å‡º**ï¼š
  - æ€§èƒ½æå‡ï¼š60-120å€ï¼ˆç¼“å­˜ï¼‰
  - åŠŸèƒ½å¢åŠ ï¼š8ä¸ªæ–°åŠŸèƒ½
  - ä½“éªŒæå‡ï¼šæ˜¾è‘—æ”¹å–„
  - ç”¨æˆ·æ»¡æ„åº¦ï¼šå¤§å¹…æå‡

### 12.2 ä¸å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | æŠ•å…¥ | æ€§èƒ½ | åŠŸèƒ½ | æ¨èåº¦ |
|------|------|------|------|--------|
| **æ–¹æ¡ˆ1ï¼šä¼˜åŒ–ç°æœ‰ç§èŠ** | 1-2å¤© | â¬†ï¸ 60å€ | +8ä¸ª | â­â­â­â­â­ |
| æ–¹æ¡ˆ2ï¼šP2Pé‡æ„ | 2-4å‘¨ | â¬†ï¸ 10å€ | +15ä¸ª | â­â­â­â­ |
| æ–¹æ¡ˆ3ï¼šç¾¤èŠå¼€å‘ | 2-3å‘¨ | â¬‡ï¸ é™ä½ | +5ä¸ª | â­â­ |

### 12.3 å»ºè®®

**âœ… ç«‹å³å®æ–½æ–¹æ¡ˆ1**

**åŸå› **ï¼š
1. âœ… **æŠ•å…¥æœ€å°**ï¼š1-2å¤© vs 2-4å‘¨
2. âœ… **è§æ•ˆæœ€å¿«**ï¼šç«‹å³å¯ç”¨
3. âœ… **é£é™©æœ€ä½**ï¼šçº¯å‰ç«¯ä¼˜åŒ–
4. âœ… **ä»·å€¼æœ€é«˜**ï¼šæ€§èƒ½æå‡60å€
5. âœ… **ä¸å†²çª**ï¼šå¯ä¸P2Pæ–¹æ¡ˆå¹¶è¡Œ

**å®æ–½å»ºè®®**ï¼š
- **æœ¬å‘¨å®Œæˆ**ï¼šP0æ ¸å¿ƒä¼˜åŒ–ï¼ˆ4é¡¹ï¼‰
- **ä¸‹å‘¨å®Œæˆ**ï¼šP1å¢å¼ºåŠŸèƒ½ï¼ˆ4é¡¹ï¼‰
- **æœˆåº•å®Œæˆ**ï¼šP2å¯é€‰åŠŸèƒ½ï¼ˆ2é¡¹ï¼‰

---

## 13. é™„å½•ï¼šå®Œæ•´ä»£ç åŒ…

### 13.1 npmä¾èµ–

```json
{
  "dependencies": {
    "idb": "^7.1.1",              // IndexedDBå°è£…
    "react-window": "^1.8.10",    // è™šæ‹Ÿæ»šåŠ¨
    "@emoji-mart/react": "^1.1.1" // Emojié€‰æ‹©å™¨ï¼ˆå¯é€‰ï¼‰
  }
}
```

### 13.2 å®‰è£…å‘½ä»¤

```bash
cd /home/xiaodong/æ–‡æ¡£/stardust/stardust-dapp
npm install idb react-window
```

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹ä¼˜åŒ–ç°æœ‰ç§èŠåŠŸèƒ½ï¼** ğŸš€

**ç¬¬ä¸€æ­¥ï¼šå®ç°æ¶ˆæ¯ç¼“å­˜æœºåˆ¶ï¼Œæ€§èƒ½æå‡60å€ï¼** âš¡

---

**ç»´æŠ¤è€…**: Stardust å¼€å‘å›¢é˜Ÿ  
**åˆ›å»ºæ—¥æœŸ**: 2025-11-08  
**ç‰ˆæœ¬**: 1.0.0

