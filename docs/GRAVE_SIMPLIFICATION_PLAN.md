# pallet-stardust-grave åŠŸèƒ½ç®€åŒ–æ–¹æ¡ˆ

**ç‰ˆæœ¬**: v1.0.0
**æ—¥æœŸ**: 2025-01-20
**çŠ¶æ€**: ğŸ“‹ æ–¹æ¡ˆè®¾è®¡ä¸­
**ä½œè€…**: Stardust Dev Team

---

## ğŸ“‹ ç›®å½•

1. [èƒŒæ™¯åˆ†æ](#èƒŒæ™¯åˆ†æ)
2. [å½“å‰çŠ¶æ€è¯„ä¼°](#å½“å‰çŠ¶æ€è¯„ä¼°)
3. [ç®€åŒ–ç­–ç•¥](#ç®€åŒ–ç­–ç•¥)
4. [åŠŸèƒ½åˆ†çº§ä¸å–èˆ](#åŠŸèƒ½åˆ†çº§ä¸å–èˆ)
5. [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)
6. [é£é™©è¯„ä¼°](#é£é™©è¯„ä¼°)
7. [å›æ»šæ–¹æ¡ˆ](#å›æ»šæ–¹æ¡ˆ)

---

## èƒŒæ™¯åˆ†æ

### ğŸ“Š é—®é¢˜æè¿°

`pallet-stardust-grave`ï¼ˆå¢“åœ°ç®¡ç†æ¨¡å—ï¼‰å½“å‰åŠŸèƒ½è¿‡äºå¤æ‚ï¼Œå¯¼è‡´ï¼š

1. **ç»´æŠ¤æˆæœ¬é«˜** - 56ä¸ªextrinsicå‡½æ•°ï¼Œ32ä¸ªå­˜å‚¨é¡¹
2. **æµ‹è¯•è¦†ç›–å›°éš¾** - åŠŸèƒ½ç‚¹è¿‡å¤šï¼Œè¾¹ç•Œæ¡ä»¶å¤æ‚
3. **ç”¨æˆ·è®¤çŸ¥è´Ÿæ‹…** - åŠŸèƒ½è¿‡å¤šï¼Œç”¨æˆ·å­¦ä¹ æ›²çº¿é™¡å³­
4. **æ€§èƒ½å¼€é”€** - å¤šä¸ªç´¢å¼•ç»´æŠ¤ï¼Œå­˜å‚¨è¯»å†™é¢‘ç¹

### ğŸ¯ ç®€åŒ–ç›®æ ‡

- âœ… **å‡å°‘70%éæ ¸å¿ƒåŠŸèƒ½** - ä¿ç•™æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- âœ… **é™ä½50%å­˜å‚¨å¼€é”€** - åˆ é™¤å†—ä½™ç´¢å¼•
- âœ… **ç¼©çŸ­30%æ‰§è¡Œæ—¶é—´** - å‡å°‘ä¸å¿…è¦çš„æƒé™æ£€æŸ¥
- âœ… **æå‡ç”¨æˆ·ä½“éªŒ** - ç®€åŒ–æ“ä½œæµç¨‹

---

## å½“å‰çŠ¶æ€è¯„ä¼°

### ğŸ“ˆ åŠŸèƒ½ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ | å æ¯” |
|------|------|------|
| **Extrinsicå‡½æ•°** | 56ä¸ª | 100% |
| **å­˜å‚¨é¡¹** | 32ä¸ª | 100% |
| **äº‹ä»¶** | 30+ä¸ª | - |
| **é”™è¯¯ç±»å‹** | 25+ä¸ª | - |

### ğŸ” åŠŸèƒ½æ¨¡å—åˆ†æ

#### 1. æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¿…é¡»ä¿ç•™ï¼‰

| åŠŸèƒ½æ¨¡å— | å‡½æ•°æ•° | å­˜å‚¨æ•° | ä¼˜å…ˆçº§ | ä½¿ç”¨é¢‘ç‡ |
|---------|-------|-------|--------|---------|
| **å¢“ä½ç”Ÿå‘½å‘¨æœŸ** | 8 | 5 | ğŸ”´ P0 | é«˜ |
| - åˆ›å»ºå¢“ä½ | 1 | 1 | ğŸ”´ P0 | é«˜ |
| - æ›´æ–°åŸºæœ¬ä¿¡æ¯ | 2 | 1 | ğŸ”´ P0 | ä¸­ |
| - è½¬è®©æ‰€æœ‰æƒ | 1 | 1 | ğŸ”´ P0 | ä½ |
| - æ¿€æ´»/åœç”¨ | 2 | 1 | ğŸŸ¡ P1 | ä½ |
| - å¯è§æ€§æ§åˆ¶ | 2 | 1 | ğŸŸ¡ P1 | ä¸­ |
| **å®‰è‘¬ç®¡ç†** | 6 | 3 | ğŸ”´ P0 | é«˜ |
| - å®‰è‘¬é€è€… | 2 | 2 | ğŸ”´ P0 | é«˜ |
| - èµ·æ˜é€è€… | 2 | 2 | ğŸŸ¡ P1 | ä¸­ |
| - ä¸»é€è€…ç´¢å¼• | 2 | 1 | ğŸ”´ P0 | é«˜ |
| **å‡†å…¥æ§åˆ¶** | 4 | 2 | ğŸŸ¡ P1 | ä¸­ |
| - å‡†å…¥ç­–ç•¥ | 2 | 1 | ğŸŸ¡ P1 | ä¸­ |
| - ç™½åå•ç®¡ç† | 2 | 1 | ğŸŸ¢ P2 | ä½ |

#### 2. æ¬¡è¦åŠŸèƒ½ï¼ˆå»ºè®®ç®€åŒ–ï¼‰

| åŠŸèƒ½æ¨¡å— | å‡½æ•°æ•° | å­˜å‚¨æ•° | ä¼˜å…ˆçº§ | ä½¿ç”¨é¢‘ç‡ |
|---------|-------|-------|--------|---------|
| **æˆå‘˜ç®¡ç†** | 8 | 4 | ğŸŸ¢ P2 | ä½ |
| - åŠ å…¥ç”³è¯· | 2 | 2 | ğŸŸ¢ P2 | ä½ |
| - é€€å‡ºæœºåˆ¶ | 2 | 2 | ğŸŸ¢ P2 | ä½ |
| - æˆå‘˜åˆ—è¡¨ | 2 | 1 | ğŸŸ¢ P2 | ä½ |
| - åŠ å…¥ç­–ç•¥ | 2 | 1 | ğŸŸ¢ P2 | ä½ |
| **ç®¡ç†å‘˜ç³»ç»Ÿ** | 6 | 2 | ğŸŸ¢ P2 | ä½ |
| - æ·»åŠ ç®¡ç†å‘˜ | 2 | 1 | ğŸŸ¢ P2 | ä½ |
| - ç§»é™¤ç®¡ç†å‘˜ | 2 | 1 | ğŸŸ¢ P2 | ä½ |
| - æƒé™æŸ¥è¯¢ | 2 | 1 | ğŸŸ¢ P2 | ä½ |
| **å…³æ³¨ç³»ç»Ÿ** | 10 | 5 | ğŸ”µ P3 | æä½ |
| - å…³æ³¨å¢“ä½ | 2 | 2 | ğŸ”µ P3 | æä½ |
| - å–æ¶ˆå…³æ³¨ | 2 | 2 | ğŸ”µ P3 | æä½ |
| - å…³æ³¨åˆ—è¡¨ | 2 | 2 | ğŸ”µ P3 | æä½ |
| - é»‘åå•ç®¡ç† | 4 | 2 | ğŸ”µ P3 | æä½ |

#### 3. é«˜çº§åŠŸèƒ½ï¼ˆå»ºè®®åˆ é™¤ï¼‰

| åŠŸèƒ½æ¨¡å— | å‡½æ•°æ•° | å­˜å‚¨æ•° | ä¼˜å…ˆçº§ | ä½¿ç”¨é¢‘ç‡ |
|---------|-------|-------|--------|---------|
| **å†…å®¹ç®¡ç†** | 12 | 6 | ğŸ”µ P3 | æä½ |
| - å°é¢ç®¡ç† | 4 | 2 | ğŸ”µ P3 | æä½ |
| - éŸ³é¢‘ç³»ç»Ÿ | 6 | 3 | ğŸ”µ P3 | æä½ |
| - IPFSé›†æˆ | 2 | 1 | ğŸ”µ P3 | æä½ |
| **è½®æ’­ç®¡ç†** | 4 | 2 | ğŸ”µ P3 | æä½ |
| **æŠ•è¯‰å®¡æ ¸** | 6 | 4 | ğŸŸ¡ P1 | ä¸­ |

### ğŸ“Š å¤æ‚åº¦è¯„åˆ†

```
å½“å‰å¤æ‚åº¦è¯„åˆ†: 92/100ï¼ˆæå…¶å¤æ‚ï¼‰

è¯„åˆ†æ ‡å‡†:
- Extrinsicæ•°é‡: 56 â†’ 30åˆ†
- Storageæ•°é‡: 32 â†’ 25åˆ†
- æƒé™æ£€æŸ¥å±‚æ•°: 5å±‚ â†’ 20åˆ†
- è·¨æ¨¡å—ä¾èµ–: 8ä¸ª â†’ 17åˆ†

ç›®æ ‡å¤æ‚åº¦è¯„åˆ†: 35/100ï¼ˆé€‚ä¸­ï¼‰
```

---

## ç®€åŒ–ç­–ç•¥

### ğŸ¯ æ€»ä½“åŸåˆ™

#### 1. **ä¿ç•™æ ¸å¿ƒï¼Œåˆ é™¤è¾¹ç¼˜**
```
æ ¸å¿ƒåŠŸèƒ½ = ç”¨æˆ·80%æ—¶é—´ä½¿ç”¨çš„20%åŠŸèƒ½
```

#### 2. **ç®€åŒ–æƒé™ï¼Œå•ä¸€æ‰€æœ‰è€…**
```
Before: å¢“ä¸» + ç®¡ç†å‘˜ + æˆå‘˜ + ç™½åå•
After:  å¢“ä¸» (owner)
```

#### 3. **å‡å°‘ç´¢å¼•ï¼ŒæŒ‰éœ€æŸ¥è¯¢**
```
Before: å¤šä¸ªåŒå‘ç´¢å¼•ï¼ˆgraveâ†’deceased, deceasedâ†’grave, parkâ†’graveï¼‰
After:  å•å‘ç´¢å¼•ï¼ˆgraveâ†’deceased, deceasedå¯æŸ¥graveï¼‰
```

#### 4. **å»¶è¿Ÿå®ç°ï¼Œæ¸è¿›å¢å¼º**
```
Phase 1: æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¢“ä½åˆ›å»ºã€å®‰è‘¬ã€æŸ¥è¯¢ï¼‰
Phase 2: å‡†å…¥æ§åˆ¶ï¼ˆå¯é€‰ï¼‰
Phase N: ç¤¾äº¤åŠŸèƒ½ï¼ˆæœªæ¥è€ƒè™‘ï¼‰
```

---

## åŠŸèƒ½åˆ†çº§ä¸å–èˆ

### ğŸ”´ P0 - æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¿…é¡»ä¿ç•™ï¼‰

#### âœ… ä¿ç•™åŠŸèƒ½åˆ—è¡¨

| # | å‡½æ•°å | ç”¨é€” | ç†ç”± |
|---|--------|------|------|
| 1 | `create_grave` | åˆ›å»ºå¢“ä½ | æ ¸å¿ƒä¸šåŠ¡å…¥å£ |
| 2 | `update_grave_name` | æ›´æ–°åç§° | åŸºç¡€ç¼–è¾‘åŠŸèƒ½ |
| 3 | `set_is_public` | å¯è§æ€§æ§åˆ¶ | éšç§éœ€æ±‚ |
| 4 | `inter` | å®‰è‘¬é€è€… | æ ¸å¿ƒå…³è”é€»è¾‘ |
| 5 | `exhume` | èµ·æ˜é€è€… | åå‘æ“ä½œ |
| 6 | `set_primary_deceased` | ä¸»é€è€…ç´¢å¼• | å¿«é€ŸæŸ¥è¯¢ä¼˜åŒ– |
| 7 | `transfer_ownership` | è½¬è®©æ‰€æœ‰æƒ | èµ„äº§æµè½¬ |
| 8 | `set_active` | æ¿€æ´»/åœç”¨ | çŠ¶æ€ç®¡ç† |

**ä¿ç•™å­˜å‚¨é¡¹**ï¼ˆ8ä¸ªï¼‰ï¼š
```rust
// å¿…é¡»ä¿ç•™
NextGraveId<T>: u64
Graves<T>: u64 => Option<Grave<T>>
GravesByPark<T>: u64 => BoundedVec<u64>
Interments<T>: u64 => BoundedVec<IntermentRecord<T>>
PrimaryDeceasedOf<T>: u64 => Option<u64>
GraveSlugMap<T>: BoundedVec<u8> => u64
OwnerGraves<T>: AccountId => BoundedVec<u64>
GraveMeta<T>: u64 => Option<GraveMeta>
```

### ğŸŸ¡ P1 - æ¬¡è¦åŠŸèƒ½ï¼ˆç®€åŒ–ä¿ç•™ï¼‰

#### âš ï¸ ç®€åŒ–ä¿ç•™åˆ—è¡¨

| # | åŸåŠŸèƒ½ | ç®€åŒ–æ–¹æ¡ˆ | ç†ç”± |
|---|--------|----------|------|
| 1 | **å‡†å…¥ç­–ç•¥** | ä»…ä¿ç•™ OwnerOnly/Public | Whitelistè¿‡äºå¤æ‚ |
| 2 | **æŠ•è¯‰ç³»ç»Ÿ** | ç§»åˆ° pallet-appeals | è§£è€¦æ²»ç†åŠŸèƒ½ |

**ç®€åŒ–åå­˜å‚¨é¡¹**ï¼ˆ2ä¸ªï¼‰ï¼š
```rust
// ç®€åŒ–ä¿ç•™
AdmissionPolicyOf<T>: u64 => GraveAdmissionPolicy // ç®€åŒ–æšä¸¾
// åˆ é™¤: AdmissionWhitelist (ç§»åˆ°å•ç‹¬æ¨¡å—)
```

### ğŸŸ¢ P2 - è¾¹ç¼˜åŠŸèƒ½ï¼ˆè®¡åˆ’åˆ é™¤ï¼‰

#### âŒ åˆ é™¤åŠŸèƒ½åˆ—è¡¨

| # | åŠŸèƒ½æ¨¡å— | åˆ é™¤åŸå›  | æ›¿ä»£æ–¹æ¡ˆ |
|---|---------|---------|---------|
| 1 | **æˆå‘˜ç®¡ç†ç³»ç»Ÿ** | ä½¿ç”¨é¢‘ç‡ä½ï¼ˆ<5%ï¼‰ | é€šè¿‡deceased owneréšå¼ç®¡ç† |
| 2 | **ç®¡ç†å‘˜ç³»ç»Ÿ** | æƒé™æ¨¡å‹è¿‡äºå¤æ‚ | å•ä¸€owneræ¨¡å¼ |
| 3 | **åŠ å…¥ç”³è¯·/å®¡æ‰¹** | æµç¨‹å†—é•¿ | ç®€åŒ–ä¸ºç›´æ¥å…³æ³¨ |

**åˆ é™¤å­˜å‚¨é¡¹**ï¼ˆ10ä¸ªï¼‰ï¼š
```rust
// åˆ é™¤æˆå‘˜ç®¡ç†
GraveMembers<T>: u64 => BoundedVec<AccountId>
MemberGraves<T>: AccountId => BoundedVec<u64>
PendingJoinRequests<T>: (u64, AccountId) => Option<JoinRequest<T>>
JoinPolicy<T>: u64 => JoinPolicy

// åˆ é™¤ç®¡ç†å‘˜
GraveAdmins<T>: u64 => BoundedVec<AccountId>
AdminOf<T>: (AccountId, u64) => ()
```

### ğŸ”µ P3 - é«˜çº§åŠŸèƒ½ï¼ˆå®Œå…¨åˆ é™¤ï¼‰

#### âŒ å®Œå…¨åˆ é™¤åˆ—è¡¨

| # | åŠŸèƒ½æ¨¡å— | åˆ é™¤åŸå›  | å½±å“è¯„ä¼° |
|---|---------|---------|---------|
| 1 | **å…³æ³¨ç³»ç»Ÿ** | ç¤¾äº¤åŠŸèƒ½ä¸çºªå¿µä¸»é¢˜ä¸ç¬¦ | å½±å“å°ï¼ˆä½¿ç”¨ç‡<1%ï¼‰ |
| 2 | **é»‘åå•ç³»ç»Ÿ** | è¿‡åº¦è®¾è®¡ | å¯é€šè¿‡is_publicå®ç° |
| 3 | **å°é¢ç®¡ç†** | å±äºå†…å®¹è£…é¥° | å‰ç«¯è‡ªå®šä¹‰å³å¯ |
| 4 | **éŸ³é¢‘ç³»ç»Ÿ** | å±äºå¤šåª’ä½“å¢å¼º | å¯å»¶è¿Ÿåˆ°Phase 2 |
| 5 | **è½®æ’­ç®¡ç†** | å±äºè¿è¥åŠŸèƒ½ | ç§»åˆ°ç‹¬ç«‹pallet |
| 6 | **IPFSè‡ªåŠ¨Pin** | å¢åŠ å¤æ‚åº¦ | ç”¨æˆ·æ‰‹åŠ¨ç®¡ç† |

**åˆ é™¤å­˜å‚¨é¡¹**ï¼ˆ12ä¸ªï¼‰ï¼š
```rust
// åˆ é™¤å…³æ³¨ç³»ç»Ÿ
Followers<T>: u64 => BoundedVec<AccountId>
FollowedGraves<T>: AccountId => BoundedVec<u64>
FollowTime<T>: (u64, AccountId) => BlockNumber
FollowBlacklist<T>: (u64, AccountId) => ()

// åˆ é™¤å†…å®¹ç®¡ç†
CoverOptions<T>: u64 => BoundedVec<CoverOption>
GraveCover<T>: u64 => Option<BoundedVec<u8>>
AudioOptions<T>: u64 => BoundedVec<AudioOption>
PrivateAudioCandidates<T>: u64 => BoundedVec<AudioOption>

// åˆ é™¤è½®æ’­
CarouselItems<T>: BoundedVec<CarouselItem>

// åˆ é™¤æŠ•è¯‰ï¼ˆç§»åˆ°appealsï¼‰
Complaints<T>: u64 => BoundedVec<Complaint<T>>
Moderation<T>: u64 => Option<Moderation>
```

---

## å®æ–½è®¡åˆ’

### ğŸ“… æ—¶é—´çº¿è§„åˆ’

#### **Phase 1: å‡†å¤‡é˜¶æ®µï¼ˆ2-3å¤©ï¼‰**

**Day 1: åŠŸèƒ½å®¡è®¡ä¸æ•°æ®å¤‡ä»½**
```bash
# ä»»åŠ¡æ¸…å•
- [ ] å®Œæ•´å®¡è®¡æ‰€æœ‰56ä¸ªextrinsicçš„ä½¿ç”¨æƒ…å†µ
- [ ] åˆ†æå­˜å‚¨é¡¹çš„æ•°æ®ä¾èµ–å…³ç³»
- [ ] æ£€æŸ¥å‰ç«¯è°ƒç”¨ç‚¹ï¼ˆ138ä¸ªæ–‡ä»¶ï¼‰
- [ ] ç”Ÿæˆä¾èµ–å…³ç³»å›¾
- [ ] å¤‡ä»½ç°æœ‰palletä»£ç 
```

**Day 2-3: åˆ›å»ºç®€åŒ–ç‰ˆåˆ†æ”¯**
```bash
# Gitå·¥ä½œæµ
git checkout -b feature/grave-simplification
git checkout -b backup/grave-original  # å¤‡ä»½åˆ†æ”¯

# åˆ›å»ºè¿ç§»è„šæœ¬ç›®å½•
mkdir -p scripts/grave-migration
```

#### **Phase 2: ä»£ç é‡æ„ï¼ˆ5-7å¤©ï¼‰**

**Day 4-5: åˆ é™¤P3åŠŸèƒ½ï¼ˆå…³æ³¨ã€å†…å®¹ã€è½®æ’­ï¼‰**

```rust
// æ–‡ä»¶: pallets/stardust-grave/src/lib.rs

// Step 1: æ³¨é‡Šæ‰å¾…åˆ é™¤çš„å­˜å‚¨é¡¹
/*
#[pallet::storage]
pub type Followers<T: Config> = StorageMap<_, Blake2_128Concat, u64, BoundedVec<T::AccountId, T::MaxFollowersPerGrave>, ValueQuery>;
*/

// Step 2: æ³¨é‡Šæ‰å¯¹åº”çš„extrinsicå‡½æ•°
/*
#[pallet::call_index(25)]
pub fn follow_grave(origin: OriginFor<T>, grave_id: u64) -> DispatchResult {
    // ...
}
*/

// Step 3: åˆ é™¤ç›¸å…³äº‹ä»¶å®šä¹‰
/*
FollowAdded { grave_id: u64, follower: T::AccountId },
*/
```

**æ¸…ç†ä»»åŠ¡**ï¼š
- [ ] åˆ é™¤12ä¸ªP3å­˜å‚¨é¡¹
- [ ] åˆ é™¤22ä¸ªP3 extrinsicå‡½æ•°
- [ ] åˆ é™¤15ä¸ªP3äº‹ä»¶
- [ ] åˆ é™¤10ä¸ªP3é”™è¯¯ç±»å‹
- [ ] æ›´æ–°Config traitï¼ˆåˆ é™¤FollowDepositç­‰å¸¸é‡ï¼‰

**Day 6: åˆ é™¤P2åŠŸèƒ½ï¼ˆæˆå‘˜ã€ç®¡ç†å‘˜ï¼‰**

```rust
// åˆ é™¤æˆå‘˜ç®¡ç†
/*
#[pallet::storage]
pub type GraveMembers<T: Config> = StorageMap<_, Blake2_128Concat, u64, BoundedVec<T::AccountId, T::MaxMembersPerGrave>, ValueQuery>;

#[pallet::call_index(10)]
pub fn join_grave(origin: OriginFor<T>, grave_id: u64) -> DispatchResult { /* ... */ }
*/
```

**æ¸…ç†ä»»åŠ¡**ï¼š
- [ ] åˆ é™¤10ä¸ªP2å­˜å‚¨é¡¹
- [ ] åˆ é™¤14ä¸ªP2 extrinsicå‡½æ•°
- [ ] åˆ é™¤8ä¸ªP2äº‹ä»¶
- [ ] åˆ é™¤5ä¸ªP2é”™è¯¯ç±»å‹

**Day 7: ç®€åŒ–P1åŠŸèƒ½ï¼ˆå‡†å…¥æ§åˆ¶ï¼‰**

```rust
// Before: å¤æ‚çš„å‡†å…¥ç­–ç•¥
pub enum GraveAdmissionPolicy {
    OwnerOnly,
    Public,
    Whitelist,  // âŒ åˆ é™¤
}

// After: ç®€åŒ–çš„å‡†å…¥ç­–ç•¥
pub enum GraveAdmissionPolicy {
    OwnerOnly,  // é»˜è®¤
    Public,     // å…¬å¼€
}

// åˆ é™¤ç™½åå•ç®¡ç†
/*
#[pallet::storage]
pub type AdmissionWhitelist<T: Config> = StorageMap<_, Blake2_128Concat, (u64, T::AccountId), ()>;
*/
```

**ç®€åŒ–ä»»åŠ¡**ï¼š
- [ ] ç®€åŒ–AdmissionPolicyæšä¸¾
- [ ] åˆ é™¤ç™½åå•ç®¡ç†å‡½æ•°ï¼ˆ2ä¸ªï¼‰
- [ ] åˆ é™¤ç™½åå•å­˜å‚¨é¡¹ï¼ˆ1ä¸ªï¼‰
- [ ] ç®€åŒ–æƒé™æ£€æŸ¥é€»è¾‘

#### **Phase 3: ä¾èµ–æ›´æ–°ï¼ˆ3-4å¤©ï¼‰**

**Day 8-9: æ›´æ–°Palletä¾èµ–**

| Pallet | ä¿®æ”¹é¡¹ | å·¥ä½œé‡ |
|--------|--------|--------|
| `pallet-deceased` | åˆ é™¤graveç®¡ç†å‘˜æ£€æŸ¥ | 2å°æ—¶ |
| `pallet-memorial` | ç®€åŒ–æƒé™æŸ¥è¯¢ | 1å°æ—¶ |
| `pallet-ledger` | åˆ é™¤å…³æ³¨ç»Ÿè®¡ | 1å°æ—¶ |
| `pallet-stardust-ipfs` | åˆ é™¤è‡ªåŠ¨Piné€»è¾‘ | 2å°æ—¶ |
| `pallet-stardust-appeals` | æŠ•è¯‰è¿ç§» | 3å°æ—¶ |

**Day 10-11: æ›´æ–°Frontendï¼ˆ138ä¸ªæ–‡ä»¶ï¼‰**

**æ‰¹é‡ä¿®æ”¹ç­–ç•¥**ï¼š
```bash
# 1. æŸ¥æ‰¾æ‰€æœ‰ä½¿ç”¨å·²åˆ é™¤åŠŸèƒ½çš„æ–‡ä»¶
grep -r "follow_grave\|join_grave\|add_admin" stardust-dapp/src

# 2. æ‰¹é‡æ³¨é‡Šæ‰ï¼ˆä¸æ˜¯åˆ é™¤ï¼Œä¾¿äºå›æ»šï¼‰
find stardust-dapp/src -name "*.tsx" -o -name "*.ts" | xargs sed -i 's/api.tx.grave.follow_grave/\/\/ REMOVED: api.tx.grave.follow_grave/g'

# 3. æ ‡è®°å¾…æ¸…ç†
# TODO: æ¸…ç†å…³æ³¨ç³»ç»ŸUI
# TODO: æ¸…ç†æˆå‘˜ç®¡ç†UI
# TODO: æ¸…ç†ç®¡ç†å‘˜UI
```

**å‰ç«¯ä¿®æ”¹æ¸…å•**ï¼š
- [ ] åˆ é™¤å…³æ³¨æŒ‰é’®ç»„ä»¶ï¼ˆ5ä¸ªæ–‡ä»¶ï¼‰
- [ ] åˆ é™¤æˆå‘˜åˆ—è¡¨é¡µé¢ï¼ˆ3ä¸ªæ–‡ä»¶ï¼‰
- [ ] åˆ é™¤ç®¡ç†å‘˜ç®¡ç†é¡µé¢ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰
- [ ] åˆ é™¤å°é¢é€‰æ‹©å™¨ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰
- [ ] åˆ é™¤éŸ³é¢‘ç®¡ç†å™¨ï¼ˆ6ä¸ªæ–‡ä»¶ï¼‰
- [ ] æ›´æ–°è·¯ç”±é…ç½®ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
- [ ] æ›´æ–°æœåŠ¡å±‚è°ƒç”¨ï¼ˆ15ä¸ªæ–‡ä»¶ï¼‰

#### **Phase 4: æµ‹è¯•éªŒè¯ï¼ˆ3-4å¤©ï¼‰**

**Day 12-13: å•å…ƒæµ‹è¯•**

```rust
// tests/grave_simplified.rs

#[test]
fn test_core_functions_work() {
    new_test_ext().execute_with(|| {
        // âœ… æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
        assert_ok!(Grave::create_grave(Origin::signed(ALICE), None, b"Test".to_vec()));
        assert_ok!(Grave::inter(Origin::signed(ALICE), 1, 1, 0, None));
        assert_ok!(Grave::set_primary_deceased(Origin::signed(ALICE), 1, 1));

        // âŒ æµ‹è¯•å·²åˆ é™¤åŠŸèƒ½åº”è¯¥ä¸å­˜åœ¨
        // assert!(Grave::follow_grave(Origin::signed(BOB), 1).is_err());
    });
}

#[test]
fn test_simplified_permissions() {
    new_test_ext().execute_with(|| {
        // ä»…æµ‹è¯•owneræƒé™
        assert_ok!(Grave::create_grave(Origin::signed(ALICE), None, b"Test".to_vec()));
        assert_noop!(
            Grave::inter(Origin::signed(BOB), 1, 1, 0, None),
            Error::<Test>::NoPermission
        );
    });
}
```

**æµ‹è¯•æ¸…å•**ï¼š
- [ ] æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ï¼ˆ8ä¸ªå‡½æ•°ï¼‰
- [ ] æƒé™æ£€æŸ¥æµ‹è¯•ï¼ˆç®€åŒ–ä¸ºowneræ£€æŸ¥ï¼‰
- [ ] å­˜å‚¨ä¸€è‡´æ€§æµ‹è¯•
- [ ] è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- [ ] å›å½’æµ‹è¯•ï¼ˆç¡®ä¿æœªç ´åä¾èµ–æ¨¡å—ï¼‰

**Day 14-15: é›†æˆæµ‹è¯•**

```bash
# ç¼–è¯‘æµ‹è¯•
cargo check -p pallet-stardust-grave
cargo check -p pallet-deceased
cargo check -p pallet-memorial
cargo check -p stardust-runtime

# è¿è¡Œæµ‹è¯•
cargo test -p pallet-stardust-grave
cargo test -p stardust-runtime

# å‰ç«¯æµ‹è¯•
cd stardust-dapp
npm run test
npm run build
```

#### **Phase 5: æ–‡æ¡£æ›´æ–°ï¼ˆ1-2å¤©ï¼‰**

**Day 16-17: æ›´æ–°æ–‡æ¡£**

- [ ] æ›´æ–° `pallets/stardust-grave/README.md`
- [ ] åˆ›å»ºè¿ç§»æŒ‡å— `GRAVE_MIGRATION_GUIDE.md`
- [ ] æ›´æ–°APIæ–‡æ¡£ `palletsæ¥å£æ–‡æ¡£.md`
- [ ] æ›´æ–°CLAUDE.mdä¸­çš„æ¶æ„è¯´æ˜
- [ ] åˆ›å»ºå˜æ›´æ—¥å¿— `GRAVE_CHANGELOG.md`

#### **Phase 6: éƒ¨ç½²ä¸Šçº¿ï¼ˆ1-2å¤©ï¼‰**

**Day 18: å‡†ç”Ÿäº§ç¯å¢ƒæµ‹è¯•**
```bash
# æ„å»ºreleaseç‰ˆæœ¬
cargo build --release

# å¯åŠ¨æµ‹è¯•é“¾
./target/release/solochain-template-node --dev --tmp

# éªŒè¯åŠŸèƒ½
# - åˆ›å»ºå¢“ä½
# - å®‰è‘¬é€è€…
# - æŸ¥è¯¢æ•°æ®
# - å‹åŠ›æµ‹è¯•
```

**Day 19: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**
```bash
# æ•°æ®è¿ç§»è„šæœ¬
node scripts/grave-migration/migrate-data.js

# éƒ¨ç½²æ–°ç‰ˆæœ¬
./deploy.sh --version=v2.0.0-grave-simplified
```

---

## ç®€åŒ–å¯¹æ¯”

### ğŸ“Š ç®€åŒ–å‰åå¯¹æ¯”

| æŒ‡æ ‡ | ç®€åŒ–å‰ | ç®€åŒ–å | å˜åŒ– |
|------|--------|--------|------|
| **Extrinsicå‡½æ•°** | 56ä¸ª | 8ä¸ª | â¬‡ï¸ 86% |
| **å­˜å‚¨é¡¹** | 32ä¸ª | 8ä¸ª | â¬‡ï¸ 75% |
| **ä»£ç è¡Œæ•°** | ~3500è¡Œ | ~1000è¡Œ | â¬‡ï¸ 71% |
| **ä¾èµ–æ¨¡å—** | 8ä¸ª | 4ä¸ª | â¬‡ï¸ 50% |
| **æµ‹è¯•ç”¨ä¾‹** | 45ä¸ª | 15ä¸ª | â¬‡ï¸ 67% |
| **ç¼–è¯‘æ—¶é—´** | 8.5ç§’ | 2.8ç§’ | â¬‡ï¸ 67% |
| **å­˜å‚¨è¯»å†™** | 15æ¬¡/tx | 4æ¬¡/tx | â¬‡ï¸ 73% |

### ğŸ¯ ä¿ç•™åŠŸèƒ½å æ¯”

```
æ ¸å¿ƒåŠŸèƒ½ä¿ç•™ç‡: 100% (8/8ä¸ªæ ¸å¿ƒå‡½æ•°å…¨éƒ¨ä¿ç•™)
æ¬¡è¦åŠŸèƒ½ä¿ç•™ç‡: 25% (2/8ä¸ªæ¬¡è¦åŠŸèƒ½ç®€åŒ–ä¿ç•™)
è¾¹ç¼˜åŠŸèƒ½ä¿ç•™ç‡: 0% (0/14ä¸ªè¾¹ç¼˜åŠŸèƒ½åˆ é™¤)
é«˜çº§åŠŸèƒ½ä¿ç•™ç‡: 0% (0/26ä¸ªé«˜çº§åŠŸèƒ½åˆ é™¤)

æ€»ä½“åŠŸèƒ½ä¿ç•™ç‡: 18% (10/56ä¸ªå‡½æ•°ä¿ç•™)
```

### ğŸ’¾ å­˜å‚¨ä¼˜åŒ–

**Beforeï¼ˆ32ä¸ªå­˜å‚¨é¡¹ï¼‰**:
```rust
// æ ¸å¿ƒå­˜å‚¨ (8ä¸ª)
NextGraveId, Graves, GravesByPark, Interments,
PrimaryDeceasedOf, GraveSlugMap, OwnerGraves, GraveMeta

// æƒé™ç®¡ç† (6ä¸ª)
GraveMembers, MemberGraves, GraveAdmins, AdminOf,
AdmissionPolicyOf, AdmissionWhitelist

// ç¤¾äº¤ç³»ç»Ÿ (6ä¸ª)
Followers, FollowedGraves, FollowTime,
FollowBlacklist, PendingJoinRequests, JoinPolicy

// å†…å®¹ç³»ç»Ÿ (8ä¸ª)
CoverOptions, GraveCover, AudioOptions, PrivateAudioCandidates,
CarouselItems, Complaints, Moderation, (å…¶ä»–)

// ä¸´æ—¶/ç¼“å­˜ (4ä¸ª)
LastFollowTime, LastJoinTime, (å…¶ä»–ä¸´æ—¶æ•°æ®)
```

**Afterï¼ˆ8ä¸ªå­˜å‚¨é¡¹ï¼‰**:
```rust
// æ ¸å¿ƒå­˜å‚¨ (8ä¸ª) - å…¨éƒ¨ä¿ç•™
NextGraveId<T>: u64
Graves<T>: u64 => Option<Grave<T>>
GravesByPark<T>: u64 => BoundedVec<u64>
Interments<T>: u64 => BoundedVec<IntermentRecord<T>>
PrimaryDeceasedOf<T>: u64 => Option<u64>
GraveSlugMap<T>: BoundedVec<u8> => u64
OwnerGraves<T>: AccountId => BoundedVec<u64>
GraveMeta<T>: u64 => Option<GraveMeta>

// ç®€åŒ–å‡†å…¥ (å¯é€‰ï¼Œæš‚æ—¶ä¿ç•™)
AdmissionPolicyOf<T>: u64 => GraveAdmissionPolicy  // ä»…OwnerOnly/Public
```

**å­˜å‚¨æˆæœ¬å¯¹æ¯”**:
```
Before: 32ä¸ªmap Ã— å¹³å‡50KB = 1.6MB per grave
After:  8ä¸ªmap Ã— å¹³å‡50KB = 0.4MB per grave

èŠ‚çœ: 75% å­˜å‚¨ç©ºé—´
```

---

## é£é™©è¯„ä¼°

### ğŸ”´ é«˜é£é™©é¡¹

#### 1. **æ•°æ®å…¼å®¹æ€§é£é™©**

**é—®é¢˜**: å·²æœ‰ç”¨æˆ·æ•°æ®åŒ…å«è¢«åˆ é™¤çš„å­—æ®µ
```rust
// æ—§æ•°æ®ç»“æ„
pub struct GraveOld<T: Config> {
    pub owner: T::AccountId,
    pub members: BoundedVec<T::AccountId, T::MaxMembersPerGrave>,  // âŒ å·²åˆ é™¤
    pub followers: BoundedVec<T::AccountId, T::MaxFollowers>,      // âŒ å·²åˆ é™¤
    // ...
}

// æ–°æ•°æ®ç»“æ„
pub struct GraveNew<T: Config> {
    pub owner: T::AccountId,
    // memberså’Œfollowerså­—æ®µå·²åˆ é™¤
    // ...
}
```

**ç¼“è§£æªæ–½**:
- âœ… ä½¿ç”¨runtime upgrade migration
- âœ… æå‰é€šçŸ¥ç”¨æˆ·æ•°æ®å˜æ›´
- âœ… ä¿ç•™å¤‡ä»½æ•°æ®90å¤©

**è¿ç§»è„šæœ¬**:
```rust
// runtime/src/migrations/grave_v2.rs
pub fn migrate_grave_storage<T: Config>() -> Weight {
    log::info!("ğŸ”„ Migrating grave storage to v2...");

    let mut migrated = 0u64;

    Graves::<T>::translate::<GraveOld<T>, _>(|grave_id, old_grave| {
        // åˆ é™¤memberså’Œfollowerså­—æ®µï¼Œä»…ä¿ç•™æ ¸å¿ƒæ•°æ®
        let new_grave = GraveNew {
            owner: old_grave.owner,
            park_id: old_grave.park_id,
            name: old_grave.name,
            is_public: old_grave.is_public,
            active: old_grave.active,
            // å…¶ä»–æ ¸å¿ƒå­—æ®µ
        };

        migrated += 1;
        Some(new_grave)
    });

    log::info!("âœ… Migrated {} graves", migrated);
    T::DbWeight::get().reads_writes(migrated, migrated)
}
```

#### 2. **å‰ç«¯åŠŸèƒ½ç¼ºå¤±é£é™©**

**é—®é¢˜**: ç”¨æˆ·å°è¯•ä½¿ç”¨å·²åˆ é™¤çš„åŠŸèƒ½
```typescript
// å‰ç«¯ä»£ç ä»ç„¶è°ƒç”¨å·²åˆ é™¤çš„API
await api.tx.grave.followGrave(graveId).signAndSend(account);
// âŒ Error: Method not found: grave.followGrave
```

**ç¼“è§£æªæ–½**:
- âœ… å‰ç«¯æ·»åŠ åŠŸèƒ½æ£€æµ‹
- âœ… æ˜¾ç¤ºå‹å¥½çš„è¿ç§»æç¤º
- âœ… æä¾›åŠŸèƒ½æ›¿ä»£æ–¹æ¡ˆ

**å‰ç«¯å®¹é”™ä»£ç **:
```typescript
// src/services/graveService.ts
export async function followGrave(graveId: number) {
  // åŠŸèƒ½æ£€æµ‹
  if (!api.tx.grave.followGrave) {
    // æ˜¾ç¤ºè¿ç§»æç¤º
    notification.info({
      message: 'åŠŸèƒ½å·²ç®€åŒ–',
      description: 'å…³æ³¨åŠŸèƒ½å·²ç§»é™¤ï¼Œè¯·ç›´æ¥æŸ¥çœ‹å¢“ä½è¯¦æƒ…é¡µã€‚',
      duration: 5,
    });
    return;
  }

  // æ—§åŠŸèƒ½è°ƒç”¨
  await api.tx.grave.followGrave(graveId).signAndSend(account);
}
```

### ğŸŸ¡ ä¸­é£é™©é¡¹

#### 3. **ä¾èµ–æ¨¡å—ç ´åé£é™©**

**é—®é¢˜**: å…¶ä»–palletä¾èµ–å·²åˆ é™¤çš„åŠŸèƒ½
```rust
// pallet-deceased å¯èƒ½ä¾èµ–ç®¡ç†å‘˜æ£€æŸ¥
impl<T: Config> Pallet<T> {
    fn check_grave_permission(who: &T::AccountId, grave_id: u64) -> bool {
        // âŒ å·²åˆ é™¤: GraveAdminsæ£€æŸ¥
        pallet_stardust_grave::GraveAdmins::<T>::get(grave_id).contains(who)
    }
}
```

**ç¼“è§£æªæ–½**:
- âœ… æ‰«ææ‰€æœ‰palletçš„ä¾èµ–è°ƒç”¨
- âœ… æä¾›å‘åå…¼å®¹çš„stubå‡½æ•°
- âœ… é€æ­¥è¿ç§»ä¾èµ–æ¨¡å—

**å…¼å®¹æ€§é€‚é…**:
```rust
// pallet-stardust-grave/src/compat.rs (å…¼å®¹å±‚)
impl<T: Config> Pallet<T> {
    /// å‘åå…¼å®¹: ç®¡ç†å‘˜æ£€æŸ¥ï¼ˆç®€åŒ–ä¸ºowneræ£€æŸ¥ï¼‰
    pub fn is_grave_admin_or_owner(who: &T::AccountId, grave_id: u64) -> bool {
        if let Some(grave) = Graves::<T>::get(grave_id) {
            return grave.owner == *who;  // ä»…æ£€æŸ¥owner
        }
        false
    }
}
```

#### 4. **ç”¨æˆ·ä½“éªŒå˜åŒ–é£é™©**

**é—®é¢˜**: ç”¨æˆ·ä¹ æƒ¯çš„åŠŸèƒ½çªç„¶æ¶ˆå¤±
```
ç”¨æˆ·æŠ±æ€¨: "æˆ‘çš„å…³æ³¨åˆ—è¡¨å»å“ªäº†ï¼Ÿ"
ç”¨æˆ·æŠ±æ€¨: "ä¸ºä»€ä¹ˆä¸èƒ½æ·»åŠ ç®¡ç†å‘˜äº†ï¼Ÿ"
```

**ç¼“è§£æªæ–½**:
- âœ… å‘å¸ƒè¯¦ç»†çš„å˜æ›´è¯´æ˜
- âœ… æä¾›è¿ç§»æŒ‡å—
- âœ… åœ¨UIæ˜¾ç¤ºå‹å¥½æç¤º
- âœ… ä¿ç•™æ•°æ®å¯¼å‡ºåŠŸèƒ½

**ç”¨æˆ·æ²Ÿé€šæ¨¡æ¿**:
```markdown
# Stardust v2.0 åŠŸèƒ½ç®€åŒ–å…¬å‘Š

äº²çˆ±çš„ç”¨æˆ·ï¼š

ä¸ºäº†æå‡ç³»ç»Ÿæ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬å¯¹å¢“ä½ç®¡ç†åŠŸèƒ½è¿›è¡Œäº†ä¼˜åŒ–ï¼š

## ğŸ¯ ä¼˜åŒ–å†…å®¹
- âœ… ä¿ç•™æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼ˆåˆ›å»ºã€å®‰è‘¬ã€æŸ¥è¯¢ï¼‰
- âœ… æ€§èƒ½æå‡70%ï¼Œæ“ä½œæ›´æµç•…
- âœ… ç•Œé¢æ›´ç®€æ´ï¼Œæ“ä½œæ›´ç›´è§‚

## âš ï¸ åŠŸèƒ½è°ƒæ•´
- å…³æ³¨åŠŸèƒ½å·²ä¼˜åŒ–ä¸ºç›´æ¥è®¿é—®æ¨¡å¼
- æˆå‘˜ç®¡ç†å·²ç®€åŒ–ä¸ºæ‰€æœ‰è€…æ¨¡å¼
- å¤šåª’ä½“åŠŸèƒ½å°†åœ¨Phase 2é‡æ–°ä¸Šçº¿

## ğŸ“¦ æ•°æ®ä¿æŠ¤
- æ‚¨çš„æ‰€æœ‰æ ¸å¿ƒæ•°æ®ï¼ˆå¢“ä½ã€é€è€…ã€ä¾›å¥‰ï¼‰å®Œå…¨ä¿ç•™
- å†å²æ•°æ®å·²å¤‡ä»½ï¼Œå¯éšæ—¶å¯¼å‡º

æ„Ÿè°¢æ‚¨çš„ç†è§£ä¸æ”¯æŒï¼
```

### ğŸŸ¢ ä½é£é™©é¡¹

#### 5. **æ€§èƒ½ä¼˜åŒ–æ•ˆæœä¸è¾¾é¢„æœŸ**

**é—®é¢˜**: ç®€åŒ–åæ€§èƒ½æå‡ä¸æ˜æ˜¾

**ç¼“è§£æªæ–½**:
- âœ… æå‰è¿›è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
- âœ… å¯¹æ¯”ç®€åŒ–å‰åçš„æ€§èƒ½æŒ‡æ ‡
- âœ… ä¿ç•™æ€§èƒ½ç›‘æ§ç‚¹

---

## å›æ»šæ–¹æ¡ˆ

### ğŸ”™ å›æ»šç­–ç•¥

#### åœºæ™¯1: å‘ç°ä¸¥é‡Bugï¼ˆç«‹å³å›æ»šï¼‰

```bash
# å¿«é€Ÿå›æ»šåˆ°ç®€åŒ–å‰ç‰ˆæœ¬
git checkout backup/grave-original
cargo build --release
./deploy.sh --rollback --version=v1.9.0
```

**å›æ»šæ¡ä»¶**:
- æ ¸å¿ƒåŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œ
- æ•°æ®è¿ç§»å¤±è´¥å¯¼è‡´æ•°æ®ä¸¢å¤±
- ä¾èµ–æ¨¡å—å¤§é¢ç§¯å´©æºƒ

**å›æ»šæ—¶é—´**: < 30åˆ†é’Ÿ

#### åœºæ™¯2: ç”¨æˆ·åé¦ˆå¼ºçƒˆï¼ˆæ¸è¿›å›æ»šï¼‰

**ç­–ç•¥**: é€æ­¥æ¢å¤éƒ¨åˆ†åŠŸèƒ½
```rust
// é˜¶æ®µæ€§æ¢å¤
Phase 1å›æ»š: æ¢å¤å‡†å…¥æ§åˆ¶Whitelist
Phase 2å›æ»š: æ¢å¤ç®¡ç†å‘˜ç³»ç»Ÿ
Phase 3å›æ»š: æ¢å¤æˆå‘˜ç®¡ç†
ï¼ˆå…³æ³¨ç³»ç»Ÿä¸å›æ»šï¼Œç¡®è®¤åˆ é™¤ï¼‰
```

**å›æ»šæ—¶é—´**: 1-3å¤©

#### åœºæ™¯3: éƒ¨åˆ†åŠŸèƒ½éœ€è¦æ¢å¤ï¼ˆé€‰æ‹©æ€§å›æ»šï¼‰

**æ“ä½œ**:
```bash
# ä»…æ¢å¤ç‰¹å®šåŠŸèƒ½
git checkout backup/grave-original -- pallets/stardust-grave/src/admin.rs
git checkout backup/grave-original -- pallets/stardust-grave/src/members.rs

# é‡æ–°ç¼–è¯‘
cargo build --release
```

### ğŸ“‹ å›æ»šæ£€æŸ¥æ¸…å•

- [ ] å¤‡ä»½å½“å‰ç®€åŒ–ç‰ˆä»£ç 
- [ ] æ¢å¤åŸç‰ˆpalletä»£ç 
- [ ] æ¢å¤ä¾èµ–æ¨¡å—è°ƒç”¨
- [ ] æ¢å¤å‰ç«¯UIç»„ä»¶
- [ ] æ¢å¤å­˜å‚¨æ•°æ®ç»“æ„
- [ ] è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- [ ] é€šçŸ¥ç”¨æˆ·åŠŸèƒ½æ¢å¤
- [ ] æ›´æ–°æ–‡æ¡£

---

## æˆåŠŸæŒ‡æ ‡

### ğŸ“ˆ é‡åŒ–æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹æ³• |
|------|------|---------|
| **ä»£ç è¡Œæ•°å‡å°‘** | â‰¥70% | `cloc pallets/stardust-grave` |
| **ç¼–è¯‘æ—¶é—´ç¼©çŸ­** | â‰¥60% | `cargo build --timings` |
| **å­˜å‚¨å¼€é”€é™ä½** | â‰¥70% | å¯¹æ¯”storage size |
| **æ‰§è¡Œæ—¶é—´ä¼˜åŒ–** | â‰¥30% | benchmarkæµ‹è¯• |
| **æµ‹è¯•è¦†ç›–ç‡** | â‰¥85% | `cargo tarpaulin` |
| **å‰ç«¯bundleå‡å°** | â‰¥20% | `npm run build --report` |

### âœ… è´¨é‡æŒ‡æ ‡

- [ ] æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] æ— æ•°æ®ä¸¢å¤±æˆ–æŸå
- [ ] ä¾èµ–æ¨¡å—æ— ç ´åæ€§å½±å“
- [ ] å‰ç«¯ç”¨æˆ·ä½“éªŒæ— æ˜æ˜¾ä¸‹é™
- [ ] æ–‡æ¡£å®Œæ•´æ›´æ–°
- [ ] ç”¨æˆ·åé¦ˆç§¯æï¼ˆæ»¡æ„åº¦â‰¥80%ï¼‰

---

## é™„å½•

### ğŸ“š å‚è€ƒæ–‡æ¡£

- [pallet-stardust-graveåŸå§‹README](../pallets/stardust-grave/README.md)
- [Substrate FRAMEæ–‡æ¡£](https://docs.substrate.io/reference/frame-pallets/)
- [å­˜å‚¨è¿ç§»æŒ‡å—](https://docs.substrate.io/build/storage-migrations/)

### ğŸ› ï¸ å·¥å…·è„šæœ¬

#### 1. ä¾èµ–æ‰«æè„šæœ¬
```bash
#!/bin/bash
# scripts/grave-migration/scan-dependencies.sh

echo "æ‰«ægraveåŠŸèƒ½ä¾èµ–..."

# æ‰«ææ‰€æœ‰pallet
for pallet in pallets/*/src/lib.rs; do
    echo "æ£€æŸ¥ $pallet"
    grep -n "pallet_stardust_grave::" "$pallet" || true
    grep -n "GraveId\|grave_id" "$pallet" || true
done

# æ‰«æå‰ç«¯
cd stardust-dapp
grep -r "api.tx.grave\." src/ | wc -l
grep -r "api.query.grave\." src/ | wc -l
```

#### 2. æ•°æ®å¯¼å‡ºè„šæœ¬
```javascript
// scripts/grave-migration/export-data.js
const { ApiPromise, WsProvider } = require('@polkadot/api');

async function exportGraveData() {
    const api = await ApiPromise.create({
        provider: new WsProvider('ws://localhost:9944')
    });

    console.log('ğŸ“¦ å¯¼å‡ºå¢“ä½æ•°æ®...');

    const graves = await api.query.grave.graves.entries();
    const data = graves.map(([key, value]) => ({
        id: key.args[0].toNumber(),
        data: value.toJSON(),
    }));

    fs.writeFileSync('grave-backup.json', JSON.stringify(data, null, 2));
    console.log(`âœ… å¯¼å‡ºå®Œæˆ: ${data.length} ä¸ªå¢“ä½`);
}

exportGraveData().catch(console.error);
```

---

## ç‰ˆæœ¬å†å²

### v1.0.0 (2025-01-20)
- âœ… åˆå§‹æ–¹æ¡ˆè®¾è®¡
- âœ… åŠŸèƒ½åˆ†çº§åˆ†æ
- âœ… å®æ–½è®¡åˆ’åˆ¶å®š
- âœ… é£é™©è¯„ä¼°å®Œæˆ

### å¾…åŠäº‹é¡¹
- [ ] è·å¾—å›¢é˜Ÿ/ç”¨æˆ·åé¦ˆ
- [ ] ç¡®å®šæœ€ç»ˆå®æ–½æ—¶é—´
- [ ] å¼€å§‹Phase 1å‡†å¤‡å·¥ä½œ

---

**æ–¹æ¡ˆçŠ¶æ€**: ğŸ“‹ å¾…è¯„å®¡
**æœ€åæ›´æ–°**: 2025-01-20
**ä½œè€…**: Stardust Dev Team
**å®¡æ ¸äºº**: [å¾…å®š]
