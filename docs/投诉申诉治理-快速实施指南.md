# æŠ•è¯‰ç”³è¯‰æ²»ç† - å¿«é€Ÿå®æ–½æŒ‡å—

> **ç‰ˆæœ¬**: v1.0 | **æ—¥æœŸ**: 2025-10-27  
> **ç”¨é€”**: ä¸ºå¼€å‘å›¢é˜Ÿæä¾›å¿«é€Ÿå®æ–½è·¯çº¿

---

## ğŸ¯ ä¸€å¥è¯æ€»ç»“

**å»ºç«‹ç»Ÿä¸€çš„æŠ•è¯‰/ç”³è¯‰æ²»ç†æ¡†æ¶ï¼Œæ•´åˆ6ä¸ªpalletçš„åˆ†æ•£æœºåˆ¶ï¼Œæå‡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚**

---

## ğŸ“Š å½“å‰é—®é¢˜

| é—®é¢˜ | å½±å“ | ä¸¥é‡åº¦ |
|-----|------|-------|
| 6ä¸ªpalletå„è‡ªå®ç°æŠ•è¯‰æœºåˆ¶ | ä»£ç å†—ä½™ã€ç»´æŠ¤å›°éš¾ | ğŸ”´ é«˜ |
| æ²¡æœ‰ç»Ÿä¸€çš„æƒé™ç®¡ç† | å®‰å…¨é£é™© | ğŸ”´ é«˜ |
| ç”¨æˆ·ä½“éªŒä¸ä¸€è‡´ | ç”¨æˆ·å›°æƒ‘ | ğŸŸ¡ ä¸­ |
| ç¼ºä¹è‡ªåŠ¨æ‰§è¡Œæœºåˆ¶ | æ²»ç†æ•ˆç‡ä½ | ğŸŸ¡ ä¸­ |
| æ²¡æœ‰åŠ¨æ€æŠ¼é‡‘ç­–ç•¥ | æ¶æ„åˆ·å± | ğŸŸ¡ ä¸­ |

---

## ğŸ¯ è§£å†³æ–¹æ¡ˆæ¶æ„

```text
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ç”¨æˆ·å‰ç«¯    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      æ²»ç†ä¸­æ¢ (Governance Hub)    â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚stardust-appealsâ”‚  â”‚arbitration  â”‚ â”‚
        â”‚  â”‚(å†…å®¹æŠ•è¯‰)  â”‚  â”‚(äº¤æ˜“äº‰è®®)   â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      æ”¯æ’‘æœåŠ¡ (Services)          â”‚
        â”‚  deposits â”‚ evidence â”‚ escrow    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    ä¸šåŠ¡åŸŸ (Business Pallets)      â”‚
        â”‚  textâ”‚mediaâ”‚graveâ”‚otcâ”‚bridge     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ä¸‰æ­¥å¿«é€Ÿå®æ–½

### Step 1: ä»£ç å‡†å¤‡ï¼ˆ1å‘¨ï¼‰

```bash
# 1. åˆ›å»ºfeatureåˆ†æ”¯
git checkout -b feature/unified-governance

# 2. æ›´æ–°ä¾èµ–
cd pallets/stardust-appeals
cargo update

# 3. æ·»åŠ åŠ¨æ€æŠ¼é‡‘trait
# ç¼–è¾‘ lib.rsï¼Œæ·»åŠ  AppealDepositPolicy trait

# 4. é›†æˆpallet-deposits
# æ›´æ–° Cargo.toml
pallet-deposits = { path = "../deposits", default-features = false }
```

**å…³é”®ä»£ç ï¼šåŠ¨æ€æŠ¼é‡‘ç­–ç•¥**

```rust
// pallets/stardust-appeals/src/lib.rs
pub trait AppealDepositPolicy {
    type AccountId;
    type Balance;
    
    fn calc_deposit(
        who: &Self::AccountId,
        domain: u8,
        target: u64,
        action: u8,
    ) -> Option<Self::Balance>;
}

// runtime/src/lib.rs å®ç°
pub struct RuntimeAppealDepositPolicy;
impl AppealDepositPolicy for RuntimeAppealDepositPolicy {
    type AccountId = AccountId;
    type Balance = Balance;
    
    fn calc_deposit(
        who: &AccountId,
        domain: u8,
        target: u64,
        action: u8,
    ) -> Option<Balance> {
        // åŸºç¡€æŠ¼é‡‘
        let base = 100 * DUST;
        
        // æ ¹æ®å†å²æˆåŠŸç‡åŠ¨æ€è°ƒæ•´
        let history = MemoAppeals::list_by_account(who, None, 0, 100);
        let multiplier = calculate_multiplier(&history);
        
        Some((base as f64 * multiplier) as Balance)
    }
}
```

### Step 2: å‰ç«¯é›†æˆï¼ˆ2å‘¨ï¼‰

```typescript
// src/services/unified-complaint.ts
export class UnifiedComplaintService {
  // ç»Ÿä¸€æäº¤æ¥å£
  async submitComplaint(params: {
    type: 'text' | 'media' | 'grave' | 'otc' | 'bridge';
    targetId: string;
    evidence: File[];
    reason?: string;
  }): Promise<ComplaintResult> {
    // 1. ä¸Šä¼ è¯æ®åˆ°IPFS
    const evidenceCid = await this.uploadEvidence(params.evidence);
    
    // 2. æäº¤åˆ°pallet-evidence
    const evidenceId = await this.commitEvidence(evidenceCid);
    
    // 3. æ ¹æ®ç±»å‹è·¯ç”±åˆ°æ­£ç¡®çš„pallet
    const { domain, action } = this.mapTypeToParams(params.type);
    
    // 4. æäº¤æŠ•è¯‰
    const tx = this.api.tx.memoAppeals.submitAppeal(
      domain,
      params.targetId,
      action,
      params.reason || '',
      evidenceCid,
    );
    
    const result = await tx.signAndSend(this.signer);
    return { appealId: result.toString(), evidenceId };
  }
  
  // ç»Ÿä¸€æŸ¥è¯¢æ¥å£
  async getComplaintStatus(appealId: string): Promise<Status> {
    const appeal = await this.api.query.memoAppeals.appeals(appealId);
    return this.parseStatus(appeal);
  }
}
```

**å‰ç«¯ç»„ä»¶ç¤ºä¾‹**

```tsx
// components/ComplaintButton.tsx
export const ComplaintButton: React.FC<{
  type: ComplaintType;
  targetId: string;
}> = ({ type, targetId }) => {
  const [open, setOpen] = useState(false);
  const service = useUnifiedComplaint();
  
  const handleSubmit = async (data: FormData) => {
    try {
      const result = await service.submitComplaint({
        type,
        targetId,
        evidence: data.evidence,
        reason: data.reason,
      });
      
      notification.success({
        message: 'æŠ•è¯‰å·²æäº¤',
        description: `ç”³è¯‰ID: ${result.appealId}`,
      });
      
      // è·³è½¬åˆ°è¿½è¸ªé¡µé¢
      navigate(`/complaints/${result.appealId}`);
    } catch (error) {
      notification.error({
        message: 'æäº¤å¤±è´¥',
        description: error.message,
      });
    }
  };
  
  return (
    <>
      <Button onClick={() => setOpen(true)}>
        æŠ•è¯‰ä¸å½“å†…å®¹
      </Button>
      <ComplaintModal
        open={open}
        onClose={() => setOpen(false)}
        onSubmit={handleSubmit}
      />
    </>
  );
};
```

### Step 3: æµ‹è¯•ä¸Šçº¿ï¼ˆ1å‘¨ï¼‰

```bash
# 1. å•å…ƒæµ‹è¯•
cd pallets/stardust-appeals
cargo test

# 2. é›†æˆæµ‹è¯•
cd tests/integration
npm test

# 3. æœ¬åœ°æµ‹è¯•ç½‘
./start-local-testnet.sh

# 4. å‰ç«¯E2Eæµ‹è¯•
cd stardust-dapp
npm run test:e2e

# 5. éƒ¨ç½²åˆ°æµ‹è¯•ç½‘
./scripts/deploy-testnet.sh

# 6. ä¸»ç½‘éƒ¨ç½²ï¼ˆéœ€æ²»ç†æ‰¹å‡†ï¼‰
./scripts/deploy-mainnet.sh
```

---

## ğŸ“‹ è¯¦ç»†ä»»åŠ¡æ¸…å•

### åç«¯ä»»åŠ¡ï¼ˆPalletå¼€å‘ï¼‰

- [ ] **Task 1.1**: stardust-appealsæ·»åŠ åŠ¨æ€æŠ¼é‡‘traitï¼ˆ2å¤©ï¼‰
  - å®šä¹‰`AppealDepositPolicy` trait
  - Runtimeå®ç°ç­–ç•¥é€»è¾‘
  - å•å…ƒæµ‹è¯•è¦†ç›–

- [ ] **Task 1.2**: arbitrationå®Œå–„Routerï¼ˆ2å¤©ï¼‰
  - ä¼˜åŒ–`can_dispute()`é€»è¾‘
  - æ·»åŠ æ›´å¤šä¸šåŠ¡åŸŸæ”¯æŒ
  - é”™è¯¯å¤„ç†ä¼˜åŒ–

- [ ] **Task 1.3**: é›†æˆpallet-depositsï¼ˆ3å¤©ï¼‰
  - æ›¿æ¢Currencyä¸ºDepositManager
  - è¿ç§»æŠ¼é‡‘ç®¡ç†é€»è¾‘
  - å…¼å®¹æ€§æµ‹è¯•

- [ ] **Task 1.4**: åº”ç­”å¦å†³æœºåˆ¶ï¼ˆ2å¤©ï¼‰
  - å®ç°`LastActiveProvider` trait
  - åœ¨deceased/graveä¸­è®°å½•æœ€åæ´»è·ƒæ—¶é—´
  - è‡ªåŠ¨å¦å†³é€»è¾‘æµ‹è¯•

### å‰ç«¯ä»»åŠ¡ï¼ˆUI/UXå¼€å‘ï¼‰

- [ ] **Task 2.1**: ç»Ÿä¸€æŠ•è¯‰å…¥å£ç»„ä»¶ï¼ˆ3å¤©ï¼‰
  - ComplaintButtonç»„ä»¶
  - ComplaintModalç»„ä»¶
  - è¯æ®ä¸Šä¼ ç»„ä»¶
  - è¡¨å•éªŒè¯

- [ ] **Task 2.2**: è¿›åº¦è¿½è¸ªé¢æ¿ï¼ˆ2å¤©ï¼‰
  - çŠ¶æ€å±•ç¤ºç»„ä»¶
  - æ—¶é—´çº¿ç»„ä»¶
  - å€’è®¡æ—¶ç»„ä»¶

- [ ] **Task 2.3**: æ²»ç†å®¡æŸ¥é¢æ¿ï¼ˆ3å¤©ï¼‰
  - ä»»åŠ¡åˆ—è¡¨ç»„ä»¶
  - è¯æ®æŸ¥çœ‹å™¨
  - æŠ•ç¥¨æŒ‰é’®
  - æ‰¹é‡æ“ä½œ

- [ ] **Task 2.4**: æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿï¼ˆ2å¤©ï¼‰
  - äº‹ä»¶ç›‘å¬
  - æ¨é€é€šçŸ¥
  - æ¶ˆæ¯ä¸­å¿ƒ
  - é‚®ä»¶é€šçŸ¥ï¼ˆå¯é€‰ï¼‰

### æµ‹è¯•ä»»åŠ¡

- [ ] **Task 3.1**: å•å…ƒæµ‹è¯•ï¼ˆ5å¤©ï¼‰
  - stardust-appealsæµ‹è¯•ç”¨ä¾‹
  - arbitrationæµ‹è¯•ç”¨ä¾‹
  - è¾¹ç•Œæ¡ä»¶æµ‹è¯•
  - è¦†ç›–ç‡>80%

- [ ] **Task 3.2**: é›†æˆæµ‹è¯•ï¼ˆ3å¤©ï¼‰
  - ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
  - å¤šç”¨æˆ·å¹¶å‘æµ‹è¯•
  - å¼‚å¸¸åœºæ™¯æµ‹è¯•

- [ ] **Task 3.3**: å‹åŠ›æµ‹è¯•ï¼ˆ2å¤©ï¼‰
  - é™é¢‘æµ‹è¯•
  - å¤§é‡æŠ•è¯‰æµ‹è¯•
  - æ€§èƒ½åŸºå‡†æµ‹è¯•

### æ–‡æ¡£ä»»åŠ¡

- [ ] **Task 4.1**: æŠ€æœ¯æ–‡æ¡£ï¼ˆ2å¤©ï¼‰
  - APIæ–‡æ¡£
  - æ¶æ„æ–‡æ¡£
  - éƒ¨ç½²æ–‡æ¡£

- [ ] **Task 4.2**: ç”¨æˆ·æ–‡æ¡£ï¼ˆ2å¤©ï¼‰
  - ç”¨æˆ·æ‰‹å†Œ
  - FAQ
  - è§†é¢‘æ•™ç¨‹

---

## âš ï¸ é£é™©ä¸åº”å¯¹

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|-----|------|------|---------|
| æ•°æ®è¿ç§»å¤±è´¥ | ä¸­ | é«˜ | â€¢ å……åˆ†æµ‹è¯•<br>â€¢ å¤‡ä»½æ—§æ•°æ®<br>â€¢ æ”¯æŒå›æ»š |
| æ€§èƒ½ä¸‹é™ | ä½ | ä¸­ | â€¢ å‹åŠ›æµ‹è¯•<br>â€¢ æ€§èƒ½ç›‘æ§<br>â€¢ ä¼˜åŒ–ç´¢å¼• |
| ç”¨æˆ·é€‚åº”å›°éš¾ | ä¸­ | ä¸­ | â€¢ è¯¦ç»†æ–‡æ¡£<br>â€¢ è§†é¢‘æ•™ç¨‹<br>â€¢ å®¢æœæ”¯æŒ |
| å®‰å…¨æ¼æ´ | ä½ | é«˜ | â€¢ ä»£ç å®¡è®¡<br>â€¢ Bugèµé‡‘<br>â€¢ åº”æ€¥é¢„æ¡ˆ |

---

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

### Week 1-2: åç«¯å¼€å‘
- [ ] Day 1-2: åŠ¨æ€æŠ¼é‡‘trait
- [ ] Day 3-4: Routerå®Œå–„
- [ ] Day 5-7: pallet-depositsé›†æˆ
- [ ] Day 8-10: åº”ç­”å¦å†³æœºåˆ¶

### Week 3-4: å‰ç«¯å¼€å‘
- [ ] Day 11-13: ç»Ÿä¸€æŠ•è¯‰å…¥å£
- [ ] Day 14-15: è¿›åº¦è¿½è¸ª
- [ ] Day 16-18: æ²»ç†å®¡æŸ¥é¢æ¿
- [ ] Day 19-20: æ¶ˆæ¯é€šçŸ¥

### Week 5: æµ‹è¯•
- [ ] Day 21-25: å•å…ƒæµ‹è¯•
- [ ] Day 26-28: é›†æˆæµ‹è¯•
- [ ] Day 29-30: å‹åŠ›æµ‹è¯•

### Week 6: ä¸Šçº¿
- [ ] Day 31-33: æ–‡æ¡£ç¼–å†™
- [ ] Day 34: æµ‹è¯•ç½‘éƒ¨ç½²
- [ ] Day 35: ä¸»ç½‘éƒ¨ç½²

---

## ğŸ¯ éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- [x] ç”¨æˆ·å¯ä»¥é€šè¿‡ç»Ÿä¸€å…¥å£æäº¤æŠ•è¯‰
- [x] ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—åŠ¨æ€æŠ¼é‡‘
- [x] æ²»ç†å§”å‘˜ä¼šå¯ä»¥å®¡æŸ¥å’Œè£å†³
- [x] å…¬ç¤ºæœŸåˆ°æœŸè‡ªåŠ¨æ‰§è¡Œ
- [x] æ”¯æŒåº”ç­”è‡ªåŠ¨å¦å†³
- [x] æ”¯æŒæ’¤å›ï¼ˆç½šæ²¡10%ï¼‰

### æ€§èƒ½æ ‡å‡†
- [x] æäº¤æŠ•è¯‰å“åº”æ—¶é—´<3ç§’
- [x] æŸ¥è¯¢çŠ¶æ€å“åº”æ—¶é—´<1ç§’
- [x] æ”¯æŒå¹¶å‘>100ç”¨æˆ·
- [x] é™é¢‘ä¿æŠ¤æœ‰æ•ˆ

### è´¨é‡æ ‡å‡†
- [x] å•å…ƒæµ‹è¯•è¦†ç›–ç‡>80%
- [x] é›†æˆæµ‹è¯•é€šè¿‡ç‡100%
- [x] é›¶å®‰å…¨æ¼æ´
- [x] æ–‡æ¡£å®Œæ•´

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å¼€å‘è§„èŒƒ
```rust
// âœ… å¥½çš„åšæ³•
pub fn submit_appeal(...) -> DispatchResult {
    // 1. å‚æ•°æ ¡éªŒ
    ensure!(!evidence_cid.is_empty(), Error::EvidenceRequired);
    
    // 2. æƒé™æ£€æŸ¥
    ensure_signed(origin)?;
    
    // 3. ä¸šåŠ¡é€»è¾‘
    let deposit = Self::calculate_deposit(&who)?;
    
    // 4. çŠ¶æ€æ›´æ–°
    Appeals::insert(id, appeal);
    
    // 5. äº‹ä»¶è§¦å‘
    Self::deposit_event(Event::AppealSubmitted(id));
    
    Ok(())
}

// âŒ ä¸å¥½çš„åšæ³•
pub fn submit_appeal(...) -> DispatchResult {
    // ç›´æ¥æ“ä½œï¼Œæ²¡æœ‰æ ¡éªŒ
    Appeals::insert(id, appeal);
    Ok(())
}
```

### 2. é”™è¯¯å¤„ç†
```rust
// âœ… è¯¦ç»†é”™è¯¯ä¿¡æ¯
#[pallet::error]
pub enum Error<T> {
    /// è¯æ®CIDä¸èƒ½ä¸ºç©º
    EvidenceRequired,
    /// è¯æ®CIDé•¿åº¦ä¸è¶³ï¼ˆæœ€å°46å­—èŠ‚ï¼‰
    EvidenceTooShort,
    /// é™é¢‘ï¼šæ—¶é—´çª—å£å†…æäº¤æ¬¡æ•°è¿‡å¤š
    RateLimited,
    /// å·²å­˜åœ¨å¾…å¤„ç†çš„ç”³è¯‰
    AlreadyPending,
}

// âŒ æ¨¡ç³Šé”™è¯¯
pub enum Error<T> {
    BadInput,
    Failed,
}
```

### 3. æµ‹è¯•è§„èŒƒ
```rust
#[test]
fn test_submit_appeal_rate_limited() {
    new_test_ext().execute_with(|| {
        let who = account(1);
        
        // æäº¤5æ¬¡æˆåŠŸ
        for i in 0..5 {
            assert_ok!(submit_appeal(who, i));
        }
        
        // ç¬¬6æ¬¡å¤±è´¥ï¼ˆé™é¢‘ï¼‰
        assert_noop!(
            submit_appeal(who, 6),
            Error::<Test>::RateLimited
        );
    });
}
```

---

## ğŸ“ è”ç³»æ–¹å¼

| è§’è‰² | å§“å | è”ç³»æ–¹å¼ |
|-----|------|---------|
| æŠ€æœ¯è´Ÿè´£äºº | - | tech-lead@stardust.io |
| æ¶æ„å¸ˆ | - | architect@stardust.io |
| å‰ç«¯è´Ÿè´£äºº | - | frontend@stardust.io |
| æµ‹è¯•è´Ÿè´£äºº | - | qa@stardust.io |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´æ–¹æ¡ˆè®¾è®¡](./æŠ•è¯‰ç”³è¯‰æ²»ç†-æ•´ä½“æ–¹æ¡ˆè®¾è®¡.md)
- [æƒé™åˆ†ææŠ¥å‘Š](./è‡ªç ”palletæŠ•è¯‰ç”³è¯‰å­—æ®µæƒé™åˆ†ææŠ¥å‘Š.md)
- [å¿«é€Ÿå‚è€ƒæ‰‹å†Œ](./æŠ•è¯‰ç”³è¯‰å­—æ®µæƒé™-å¿«é€Ÿå‚è€ƒ.md)

---

**æœ€åæ›´æ–°**: 2025-10-27  
**æ–‡æ¡£çŠ¶æ€**: âœ… å¯æ‰§è¡Œ  
**ä¸‹ä¸€æ­¥**: å¼€å§‹Task 1.1 - æ·»åŠ åŠ¨æ€æŠ¼é‡‘trait

