# å§”å‘˜ä¼šåŠ¨æ€æˆå‘˜ - è§£å¯†æƒé™æ–¹æ¡ˆ

## ä¸€ã€é—®é¢˜å®šä¹‰

### å½“å‰æ–¹æ¡ˆçš„å±€é™

**é™æ€æˆæƒæ–¹æ¡ˆï¼š**
```rust
// åšå¸‚å•†æäº¤ç”³è¯·æ—¶
let committee_members = [å§”å‘˜A, å§”å‘˜B, å§”å‘˜C];  // å½“æ—¶çš„å§”å‘˜ä¼šæˆå‘˜

// ä¸ºæ¯ä¸ªå§”å‘˜ä¼šæˆå‘˜åŠ å¯†AESå¯†é’¥
encrypted_keys = {
  "åšå¸‚å•†è‡ªå·±": encrypt(aes_key, åšå¸‚å•†å…¬é’¥),
  "å§”å‘˜A": encrypt(aes_key, å§”å‘˜Aå…¬é’¥),
  "å§”å‘˜B": encrypt(aes_key, å§”å‘˜Bå…¬é’¥),
  "å§”å‘˜C": encrypt(aes_key, å§”å‘˜Cå…¬é’¥),
}
```

**é—®é¢˜åœºæ™¯ï¼š**

#### âŒ é—®é¢˜1ï¼šæ–°å§”å‘˜æ— æ³•æŸ¥çœ‹å†å²æ•°æ®
```
æ—¶é—´è½´ï¼š
2024-01-01: åšå¸‚å•†æäº¤ç”³è¯·ï¼ŒåŠ å¯†ç»™å§”å‘˜Aã€Bã€C
2024-06-01: æ–°å¢å§”å‘˜D
           â†“
é—®é¢˜ï¼šå§”å‘˜Dæ— æ³•è§£å¯†2024-01-01ä¹‹å‰çš„æ‰€æœ‰å†å²ç”³è¯·
```

#### âŒ é—®é¢˜2ï¼šç¦»èŒå§”å‘˜ä»å¯æŸ¥çœ‹
```
æ—¶é—´è½´ï¼š
2024-01-01: åšå¸‚å•†æäº¤ç”³è¯·ï¼ŒåŠ å¯†ç»™å§”å‘˜Aã€Bã€C
2024-06-01: å§”å‘˜Cç¦»èŒ
           â†“
é—®é¢˜ï¼šå§”å‘˜Cä»ç„¶å¯ä»¥è§£å¯†å¹¶æŸ¥çœ‹æ‰€æœ‰å†å²æ•°æ®
```

#### âŒ é—®é¢˜3ï¼šé‡æ–°åŠ å¯†æˆæœ¬é«˜
```
å¦‚æœæ¯æ¬¡å§”å‘˜ä¼šå˜æ›´éƒ½é‡æ–°åŠ å¯†æ‰€æœ‰å†å²æ•°æ®ï¼š
- 10,000ä¸ªåšå¸‚å•†ç”³è¯·
- æ¯ä¸ªç”³è¯·éœ€è¦é‡æ–°åŠ å¯†
- éœ€è¦è§£å¯† â†’ é‡æ–°åŠ å¯† â†’ ä¸Šä¼ IPFS â†’ æ›´æ–°é“¾ä¸ŠCID
- è€—æ—¶ã€è€—èµ„æºã€é«˜Gasè´¹
```

---

## äºŒã€ç†æƒ³éœ€æ±‚

### æœŸæœ›æ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å§”å‘˜ä¼šæˆå‘˜åŠ¨æ€å˜åŒ–                 â”‚
â”‚                                              â”‚
â”‚  2024-01-01: [å§”å‘˜A, å§”å‘˜B, å§”å‘˜C]          â”‚
â”‚  2024-03-01: [å§”å‘˜A, å§”å‘˜B, å§”å‘˜C, å§”å‘˜D]   â”‚
â”‚  2024-06-01: [å§”å‘˜A, å§”å‘˜B, å§”å‘˜D, å§”å‘˜E]   â”‚
â”‚             ï¼ˆå§”å‘˜Cç¦»èŒï¼Œæ–°å¢å§”å‘˜Eï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æœŸæœ›ï¼šåŸºäº"å½“å‰è§’è‰²"çš„åŠ¨æ€æƒé™        â”‚
â”‚                                              â”‚
â”‚  âœ… å§”å‘˜Dåœ¨2024-03-01åŠ å…¥åï¼š                â”‚
â”‚     - å¯ä»¥æŸ¥çœ‹2024-01-01çš„å†å²æ•°æ®           â”‚
â”‚     - å¯ä»¥æŸ¥çœ‹ä¹‹åçš„æ‰€æœ‰æ•°æ®                 â”‚
â”‚                                              â”‚
â”‚  âœ… å§”å‘˜Cåœ¨2024-06-01ç¦»èŒåï¼š                â”‚
â”‚     - ä¸èƒ½æŸ¥çœ‹2024-06-01ä¹‹åçš„æ•°æ®           â”‚
â”‚     - å†å²è®¿é—®è®°å½•ä»ç„¶ä¿ç•™ï¼ˆå®¡è®¡ï¼‰            â”‚
â”‚                                              â”‚
â”‚  âœ… å§”å‘˜Eåœ¨2024-06-01åŠ å…¥åï¼š                â”‚
â”‚     - å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å†å²æ•°æ®ï¼ˆåŒ…æ‹¬2024-01-01ï¼‰ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆAï¼šå§”å‘˜ä¼šå…±äº«å¯†é’¥ï¼ˆæ¨è â­â­â­â­â­ï¼‰

#### åŸç†

```rust
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å§”å‘˜ä¼šç»´æŠ¤ä¸€ä¸ªå…±äº«åŠ å¯†å¯†é’¥             â”‚
â”‚                                               â”‚
â”‚  Committee Shared Keyï¼ˆ32å­—èŠ‚ï¼‰               â”‚
â”‚  - å­˜å‚¨ä½ç½®ï¼šé“¾ä¸Šï¼ˆåŠ å¯†çŠ¶æ€ï¼‰                  â”‚
â”‚  - è°å¯ä»¥è®¿é—®ï¼šå½“å‰å§”å‘˜ä¼šæˆå‘˜                  â”‚
â”‚  - å¦‚ä½•è®¿é—®ï¼šé€šè¿‡å§”å‘˜ä¼šå¤šç­¾æˆ–æ²»ç†è°ƒç”¨          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        åšå¸‚å•†åŠ å¯†æ•æ„Ÿä¿¡æ¯                      â”‚
â”‚                                               â”‚
â”‚  1. ç”ŸæˆéšæœºAESå¯†é’¥ï¼ˆ32å­—èŠ‚ï¼‰                 â”‚
â”‚  2. ç”¨AESå¯†é’¥åŠ å¯†æ•æ„Ÿæ•°æ®                     â”‚
â”‚  3. ç”¨"å§”å‘˜ä¼šå…±äº«å¯†é’¥"åŠ å¯†AESå¯†é’¥              â”‚
â”‚  4. ä¸Šä¼ åˆ°IPFS                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IPFSå­˜å‚¨ï¼š
{
  "encrypted_content": "...",  // AESåŠ å¯†çš„æ•æ„Ÿæ•°æ®
  "encrypted_aes_key": {
    "owner": "ç”¨æˆ·å…¬é’¥åŠ å¯†çš„AESå¯†é’¥",  // åšå¸‚å•†è‡ªå·±å¯è§£å¯†
    "committee": "å§”å‘˜ä¼šå…±äº«å¯†é’¥åŠ å¯†çš„AESå¯†é’¥"  // ä»»ä½•å§”å‘˜ä¼šæˆå‘˜å¯è§£å¯†
  }
}
```

#### å®ç°æ–¹æ¡ˆ

##### â‘  é“¾ä¸Šå­˜å‚¨å§”å‘˜ä¼šå…±äº«å¯†é’¥

```rust
/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šå§”å‘˜ä¼šå…±äº«åŠ å¯†å¯†é’¥
/// 
/// å­˜å‚¨å§”å‘˜ä¼šç”¨äºè§£å¯†æ•æ„Ÿä¿¡æ¯çš„å…±äº«å¯†é’¥
/// - å¯†é’¥æœ¬èº«ä¹Ÿæ˜¯åŠ å¯†çš„ï¼ˆä½¿ç”¨å§”å‘˜ä¼šé›†ä½“æ§åˆ¶ï¼‰
/// - åªæœ‰å½“å‰å§”å‘˜ä¼šæˆå‘˜å¯ä»¥è®¿é—®
#[pallet::storage]
pub type CommitteeSharedKey<T: Config> = StorageValue<
    _,
    BoundedVec<u8, ConstU32<256>>,  // åŠ å¯†åçš„å…±äº«å¯†é’¥
    OptionQuery,
>;

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šå§”å‘˜ä¼šæˆå‘˜çš„ä¸ªäººå¯†é’¥åˆ†ç‰‡
/// 
/// ä½¿ç”¨é—¨é™åŠ å¯†ï¼ˆThreshold Encryptionï¼‰åˆ†å‰²å…±äº«å¯†é’¥
/// - 5ä¸ªå§”å‘˜ä¼šæˆå‘˜ï¼Œä»»æ„3ä¸ªå¯ä»¥æ¢å¤å…±äº«å¯†é’¥
/// - é˜²æ­¢å•ä¸ªå§”å‘˜ä¼šæˆå‘˜æ»¥ç”¨æƒé™
#[pallet::storage]
pub type CommitteeKeyShares<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::AccountId,  // å§”å‘˜ä¼šæˆå‘˜
    BoundedVec<u8, ConstU32<256>>,  // è¯¥æˆå‘˜çš„å¯†é’¥åˆ†ç‰‡ï¼ˆåŠ å¯†ï¼‰
    OptionQuery,
>;
```

##### â‘¡ åˆå§‹åŒ–å§”å‘˜ä¼šå…±äº«å¯†é’¥

```rust
/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šåˆå§‹åŒ–å§”å‘˜ä¼šå…±äº«å¯†é’¥
/// 
/// Rootæˆ–è¶…çº§å¤šæ•°å§”å‘˜ä¼šæˆå‘˜åŒæ„åï¼Œç”Ÿæˆå¹¶åˆ†å‘å…±äº«å¯†é’¥
/// 
/// # å‚æ•°
/// - encrypted_shares: ä¸ºæ¯ä¸ªå§”å‘˜ä¼šæˆå‘˜åŠ å¯†çš„å¯†é’¥åˆ†ç‰‡
#[pallet::call_index(XX)]
#[pallet::weight(10_000)]
pub fn init_committee_shared_key(
    origin: OriginFor<T>,
    encrypted_shares: Vec<(T::AccountId, Vec<u8>)>,  // æ¯ä¸ªæˆå‘˜çš„åŠ å¯†åˆ†ç‰‡
) -> DispatchResult {
    // éªŒè¯æƒé™ï¼šRoot æˆ– è¶…çº§å¤šæ•°å§”å‘˜ä¼š
    ensure_root(origin.clone()).or_else(|_| {
        T::CommitteeOrigin::ensure_origin(origin)?;
        Ok(())
    })?;
    
    // éªŒè¯æ‰€æœ‰å½“å‰å§”å‘˜ä¼šæˆå‘˜éƒ½æœ‰åˆ†ç‰‡
    let current_members = Self::get_committee_members();
    ensure!(
        encrypted_shares.len() == current_members.len(),
        Error::<T>::InvalidKeyShareCount
    );
    
    for (member, share) in encrypted_shares {
        ensure!(
            current_members.contains(&member),
            Error::<T>::NotCommitteeMember
        );
        
        CommitteeKeyShares::<T>::insert(&member, share);
    }
    
    Self::deposit_event(Event::CommitteeSharedKeyInitialized {
        member_count: current_members.len() as u32,
    });
    
    Ok(())
}
```

##### â‘¢ å§”å‘˜ä¼šæˆå‘˜å˜æ›´æ—¶æ›´æ–°å¯†é’¥åˆ†ç‰‡

```rust
/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šæ›´æ–°å§”å‘˜ä¼šæˆå‘˜çš„å¯†é’¥åˆ†ç‰‡
/// 
/// å½“å§”å‘˜ä¼šæˆå‘˜å˜æ›´æ—¶ï¼Œé‡æ–°åˆ†é…å¯†é’¥åˆ†ç‰‡
/// - æ–°æˆå‘˜ï¼šè·å¾—æ–°çš„å¯†é’¥åˆ†ç‰‡
/// - ç¦»èŒæˆå‘˜ï¼šåˆ é™¤å¯†é’¥åˆ†ç‰‡
#[pallet::call_index(XX)]
#[pallet::weight(10_000)]
pub fn update_committee_key_shares(
    origin: OriginFor<T>,
    new_shares: Vec<(T::AccountId, Vec<u8>)>,  // æ–°çš„å¯†é’¥åˆ†ç‰‡åˆ†é…
) -> DispatchResult {
    T::CommitteeOrigin::ensure_origin(origin)?;
    
    // æ¸…ç©ºæ—§çš„åˆ†ç‰‡
    let _ = CommitteeKeyShares::<T>::clear(u32::MAX, None);
    
    // è®¾ç½®æ–°çš„åˆ†ç‰‡
    for (member, share) in new_shares {
        CommitteeKeyShares::<T>::insert(&member, share);
    }
    
    Self::deposit_event(Event::CommitteeKeySharesUpdated);
    
    Ok(())
}
```

#### å‰ç«¯å®ç°

##### â‘  åšå¸‚å•†åŠ å¯†æ•°æ®

```typescript
// src/utils/committeeEncryption.ts

/**
 * ä½¿ç”¨å§”å‘˜ä¼šå…±äº«å¯†é’¥åŠ å¯†æ•æ„Ÿä¿¡æ¯
 */
async function encryptForCommittee(
  sensitiveData: any,
  userAccount: string,
  userPublicKey: Uint8Array
): Promise<{ cid: string }> {
  // 1. ç”ŸæˆéšæœºAESå¯†é’¥
  const aesKey = crypto.randomBytes(32);
  
  // 2. ç”¨AESå¯†é’¥åŠ å¯†æ•°æ®
  const encryptedData = aesEncrypt(JSON.stringify(sensitiveData), aesKey);
  
  // 3. è·å–å§”å‘˜ä¼šå…±äº«å…¬é’¥ï¼ˆé“¾ä¸ŠæŸ¥è¯¢ï¼‰
  const committeePublicKey = await api.query.marketMaker.committeePublicKey();
  
  // 4. åŠ å¯†AESå¯†é’¥
  const encryptedKeys = {
    // ç”¨æˆ·è‡ªå·±å¯ä»¥è§£å¯†
    owner: rsaEncrypt(aesKey, userPublicKey),
    
    // å§”å‘˜ä¼šå¯ä»¥è§£å¯†ï¼ˆä½¿ç”¨å§”å‘˜ä¼šå…±äº«å…¬é’¥ï¼‰
    committee: rsaEncrypt(aesKey, committeePublicKey),
  };
  
  // 5. ä¸Šä¼ åˆ°IPFS
  const ipfsData = {
    version: '2.0',  // æ–°ç‰ˆæœ¬ï¼Œæ”¯æŒå§”å‘˜ä¼šå…±äº«å¯†é’¥
    encrypted_content: encryptedData,
    encrypted_keys: encryptedKeys,
    metadata: {
      encrypted_at: Date.now(),
      encryptor: userAccount,
    },
  };
  
  const result = await ipfs.add(JSON.stringify(ipfsData));
  
  console.log('âœ… å·²åŠ å¯†ç»™ï¼šç”¨æˆ·è‡ªå·± + å§”å‘˜ä¼šï¼ˆåŠ¨æ€æˆå‘˜ï¼‰');
  
  return { cid: result.path };
}
```

##### â‘¡ å§”å‘˜ä¼šæˆå‘˜è§£å¯†æ•°æ®

```typescript
/**
 * å§”å‘˜ä¼šæˆå‘˜è§£å¯†æ•æ„Ÿä¿¡æ¯
 */
async function decryptByCommitteeMember(
  privateCid: string,
  myAccount: string
): Promise<any> {
  // 1. æ£€æŸ¥æ˜¯å¦ä¸ºå§”å‘˜ä¼šæˆå‘˜
  const members = await api.query.collective.members(3);
  const isCommitteeMember = members.some(m => m.toString() === myAccount);
  
  if (!isCommitteeMember) {
    throw new Error('æ‚¨ä¸æ˜¯å§”å‘˜ä¼šæˆå‘˜ï¼Œæ— æƒè§£å¯†');
  }
  
  // 2. ä»IPFSä¸‹è½½åŠ å¯†æ•°æ®
  const ipfsData = await downloadFromIPFS(privateCid);
  
  // 3. è·å–æˆ‘çš„å¯†é’¥åˆ†ç‰‡ï¼ˆé“¾ä¸Šï¼‰
  const myKeyShare = await api.query.marketMaker.committeeKeyShares(myAccount);
  
  if (myKeyShare.isNone) {
    throw new Error('æœªæ‰¾åˆ°æ‚¨çš„å¯†é’¥åˆ†ç‰‡ï¼Œè¯·è”ç³»ç®¡ç†å‘˜');
  }
  
  // 4. ç”¨æˆ‘çš„ç§é’¥è§£å¯†å¯†é’¥åˆ†ç‰‡
  const myPrivateKey = await getPrivateKeyFromWallet();
  const decryptedKeyShare = rsaDecrypt(
    myKeyShare.unwrap(),
    myPrivateKey
  );
  
  // 5. è·å–å…¶ä»–2ä¸ªå§”å‘˜ä¼šæˆå‘˜çš„å¯†é’¥åˆ†ç‰‡ï¼ˆéœ€è¦å¤šç­¾æˆ–é“¾ä¸‹åè°ƒï¼‰
  // é—¨é™åŠ å¯†ï¼š3/5 ä»»æ„3ä¸ªæˆå‘˜å¯ä»¥æ¢å¤å…±äº«å¯†é’¥
  const otherShares = await requestKeySharesFromOtherMembers(2);
  
  // 6. ç»„åˆåˆ†ç‰‡æ¢å¤å§”å‘˜ä¼šå…±äº«å¯†é’¥
  const committeeSharedKey = combineKeyShares([
    decryptedKeyShare,
    ...otherShares,
  ]);
  
  // 7. ç”¨å§”å‘˜ä¼šå…±äº«å¯†é’¥è§£å¯†AESå¯†é’¥
  const encryptedAesKey = ipfsData.encrypted_keys.committee;
  const aesKey = rsaDecrypt(encryptedAesKey, committeeSharedKey);
  
  // 8. ç”¨AESå¯†é’¥è§£å¯†æ•°æ®
  const decryptedData = aesDecrypt(ipfsData.encrypted_content, aesKey);
  
  return JSON.parse(decryptedData);
}
```

#### ä¼˜ç¼ºç‚¹åˆ†æ

| é¡¹ç›® | è¯„ä¼° | è¯´æ˜ |
|------|------|------|
| âœ… åŠ¨æ€æˆå‘˜æ”¯æŒ | ğŸŸ¢ ä¼˜ç§€ | æ–°æˆå‘˜è‡ªåŠ¨è·å¾—æƒé™ |
| âœ… è‡ªåŠ¨æ’¤é”€ | ğŸŸ¢ ä¼˜ç§€ | ç¦»èŒæˆå‘˜è‡ªåŠ¨å¤±å»æƒé™ |
| âœ… æ— éœ€é‡æ–°åŠ å¯† | ğŸŸ¢ ä¼˜ç§€ | å†å²æ•°æ®ä¸éœ€è¦é‡æ–°åŠ å¯† |
| âœ… å®ç°å¤æ‚åº¦ | ğŸŸ¡ ä¸­ç­‰ | éœ€è¦é—¨é™åŠ å¯†åº“ |
| âš ï¸ å¯†é’¥ç®¡ç† | ğŸŸ¡ éœ€è°¨æ… | å§”å‘˜ä¼šå…±äº«å¯†é’¥éœ€è¦å®‰å…¨ç®¡ç† |
| âš ï¸ åä½œæˆæœ¬ | ğŸŸ¡ ä¸­ç­‰ | éœ€è¦è‡³å°‘3ä¸ªæˆå‘˜åœ¨çº¿åä½œ |

---

### æ–¹æ¡ˆBï¼šåŸºäºè§’è‰²çš„é“¾ä¸Šä»£ç†ï¼ˆç®€åŒ–ç‰ˆ â­â­â­â­ï¼‰

#### åŸç†

```rust
ä¸å­˜å‚¨åŠ å¯†å¯†é’¥ï¼Œè€Œæ˜¯å­˜å‚¨"è§’è‰²â†’æ•°æ®"çš„æ˜ å°„å…³ç³»

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é“¾ä¸Šè®°å½•è®¿é—®æƒé™ï¼ˆä¸å­˜å‚¨å¯†é’¥ï¼‰          â”‚
â”‚                                               â”‚
â”‚  DataAccessControl {                          â”‚
â”‚    data_id: "mm_123_private",                â”‚
â”‚    allowed_roles: ["Committee"],             â”‚
â”‚    owner: "åšå¸‚å•†è´¦æˆ·",                       â”‚
â”‚  }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‰ç«¯è®¿é—®æ§åˆ¶                          â”‚
â”‚                                               â”‚
â”‚  1. ç”¨æˆ·è¯·æ±‚è§£å¯†                              â”‚
â”‚  2. é“¾ä¸ŠæŸ¥è¯¢ï¼šå½“å‰ç”¨æˆ·æ˜¯å¦æœ‰"Committee"è§’è‰²    â”‚
â”‚  3. å¦‚æœæ˜¯ï¼šä»é“¾ä¸‹å¯†é’¥æœåŠ¡å™¨è·å–è§£å¯†å¯†é’¥       â”‚
â”‚  4. è§£å¯†æ•°æ®                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ³¨æ„ï¼š** æ­¤æ–¹æ¡ˆéœ€è¦é“¾ä¸‹å¯ä¿¡å¯†é’¥æœåŠ¡å™¨ï¼Œä¸æ˜¯çº¯é“¾ä¸Šæ–¹æ¡ˆã€‚

#### ä¼˜ç¼ºç‚¹

| é¡¹ç›® | è¯„ä¼° |
|------|------|
| âœ… å®ç°ç®€å• | ğŸŸ¢ ç®€å• |
| âœ… åŠ¨æ€æƒé™ | ğŸŸ¢ å®Œç¾ |
| âŒ ä¸­å¿ƒåŒ–é£é™© | ğŸ”´ ä¾èµ–é“¾ä¸‹æœåŠ¡å™¨ |
| âŒ ä¸æ¨è | ğŸ”´ ä¸ç¬¦åˆå»ä¸­å¿ƒåŒ–åŸåˆ™ |

---

### æ–¹æ¡ˆCï¼šå®šæœŸé‡æ–°åŠ å¯†ï¼ˆå®ç”¨æŠ˜è¡· â­â­â­ï¼‰

#### åŸç†

```rust
æ¯æ¬¡å§”å‘˜ä¼šæˆå‘˜å˜æ›´æ—¶ï¼Œå¼‚æ­¥é‡æ–°åŠ å¯†å†å²æ•°æ®

æ—¶é—´è½´ï¼š
2024-01-01: åšå¸‚å•†Aæäº¤ç”³è¯·ï¼ŒåŠ å¯†ç»™[å§”å‘˜A, B, C]
2024-01-15: åšå¸‚å•†Bæäº¤ç”³è¯·ï¼ŒåŠ å¯†ç»™[å§”å‘˜A, B, C]
2024-03-01: æ–°å¢å§”å‘˜D
           â†“
           è§¦å‘åå°ä»»åŠ¡ï¼š
           - é‡æ–°åŠ å¯†2024-01-01çš„ç”³è¯·ï¼ˆåŠ å¯†ç»™[å§”å‘˜A, B, C, D]ï¼‰
           - é‡æ–°åŠ å¯†2024-01-15çš„ç”³è¯·ï¼ˆåŠ å¯†ç»™[å§”å‘˜A, B, C, D]ï¼‰
           - ...
           
2024-06-01: å§”å‘˜Cç¦»èŒ
           â†“
           è§¦å‘åå°ä»»åŠ¡ï¼š
           - é‡æ–°åŠ å¯†æ‰€æœ‰å†å²æ•°æ®ï¼ˆä¸åŒ…å«å§”å‘˜Cï¼‰
```

#### å®ç°æ–¹æ¡ˆ

##### â‘  é“¾ä¸Šè§¦å‘é‡æ–°åŠ å¯†ä»»åŠ¡

```rust
/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šå§”å‘˜ä¼šæˆå‘˜å˜æ›´åçš„é’©å­
/// 
/// å½“å§”å‘˜ä¼šæˆå‘˜å˜æ›´æ—¶ï¼Œæ ‡è®°éœ€è¦é‡æ–°åŠ å¯†
#[pallet::hooks]
impl<T: Config> Hooks<BlockNumberFor<T>> for Pallet<T> {
    fn on_initialize(n: BlockNumberFor<T>) -> Weight {
        // æ£€æŸ¥å§”å‘˜ä¼šæˆå‘˜æ˜¯å¦å˜æ›´
        let current_members = Self::get_committee_members();
        let last_members = LastCommitteeMembers::<T>::get();
        
        if current_members != last_members {
            // å§”å‘˜ä¼šæˆå‘˜å·²å˜æ›´
            LastCommitteeMembers::<T>::put(&current_members);
            
            // æ ‡è®°éœ€è¦é‡æ–°åŠ å¯†
            ReencryptionRequired::<T>::put(true);
            
            Self::deposit_event(Event::CommitteeChanged {
                new_member_count: current_members.len() as u32,
            });
        }
        
        Weight::from_parts(10_000, 0)
    }
}

#[pallet::storage]
pub type ReencryptionRequired<T: Config> = StorageValue<_, bool, ValueQuery>;

#[pallet::storage]
pub type LastCommitteeMembers<T: Config> = StorageValue<
    _,
    BoundedVec<T::AccountId, ConstU32<50>>,
    ValueQuery,
>;
```

##### â‘¡ é“¾ä¸‹å·¥ä½œè€…ï¼ˆOff-chain Workerï¼‰æ‰§è¡Œé‡æ–°åŠ å¯†

```rust
/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šé“¾ä¸‹å·¥ä½œè€…é‡æ–°åŠ å¯†å†å²æ•°æ®
fn offchain_worker(block_number: BlockNumberFor<T>) {
    if ReencryptionRequired::<T>::get() {
        log::info!("å¼€å§‹é‡æ–°åŠ å¯†å†å²æ•°æ®...");
        
        // è·å–å½“å‰å§”å‘˜ä¼šæˆå‘˜
        let current_members = Self::get_committee_members();
        
        // è·å–æ‰€æœ‰éœ€è¦é‡æ–°åŠ å¯†çš„ç”³è¯·
        let applications = Applications::<T>::iter();
        
        for (mm_id, app) in applications {
            // 1. ä»IPFSä¸‹è½½æ—§çš„åŠ å¯†æ•°æ®
            let old_cid = app.private_cid;
            let encrypted_data = download_from_ipfs(old_cid);
            
            // 2. ç”¨ä»»æ„ä¸€ä¸ªæ—§å§”å‘˜ä¼šæˆå‘˜çš„æƒé™è§£å¯†AESå¯†é’¥
            //    ï¼ˆå‡è®¾æœ‰ä¸€ä¸ªå¯ä¿¡çš„è§£å¯†æœåŠ¡ï¼‰
            let aes_key = trusted_decrypt_service(encrypted_data);
            
            // 3. ä¸ºæ–°çš„å§”å‘˜ä¼šæˆå‘˜åˆ—è¡¨é‡æ–°åŠ å¯†
            let new_encrypted_keys = encrypt_for_members(aes_key, &current_members);
            
            // 4. ä¸Šä¼ æ–°çš„åŠ å¯†æ•°æ®åˆ°IPFS
            let new_cid = upload_to_ipfs(new_encrypted_keys);
            
            // 5. æ›´æ–°é“¾ä¸ŠCIDï¼ˆéœ€è¦é€šè¿‡Rootæˆ–å§”å‘˜ä¼šå¤šç­¾ï¼‰
            let _ = Self::update_private_cid(mm_id, new_cid);
        }
        
        // æ ‡è®°é‡æ–°åŠ å¯†å®Œæˆ
        ReencryptionRequired::<T>::put(false);
        
        log::info!("âœ… å†å²æ•°æ®é‡æ–°åŠ å¯†å®Œæˆ");
    }
}
```

#### ä¼˜ç¼ºç‚¹

| é¡¹ç›® | è¯„ä¼° |
|------|------|
| âœ… æœ€ç»ˆä¸€è‡´æ€§ | ğŸŸ¢ æœ€ç»ˆæ‰€æœ‰æ•°æ®éƒ½ä¼šæ›´æ–° |
| âœ… å®‰å…¨æ€§ | ğŸŸ¢ ç¦»èŒæˆå‘˜æœ€ç»ˆæ— æ³•è®¿é—® |
| âš ï¸ æ—¶é—´å»¶è¿Ÿ | ğŸŸ¡ é‡æ–°åŠ å¯†éœ€è¦æ—¶é—´ |
| âš ï¸ è®¡ç®—æˆæœ¬ | ğŸŸ¡ å¤§é‡å†å²æ•°æ®æˆæœ¬é«˜ |
| âš ï¸ å®ç°å¤æ‚ | ğŸŸ¡ éœ€è¦Off-chain Worker |

---

## å››ã€æ¨èæ–¹æ¡ˆ

### ğŸ† æ–¹æ¡ˆAï¼šå§”å‘˜ä¼šå…±äº«å¯†é’¥ï¼ˆé—¨é™åŠ å¯†ï¼‰

**åŸå› ï¼š**
1. âœ… å®Œå…¨å»ä¸­å¿ƒåŒ–
2. âœ… åŠ¨æ€æˆå‘˜æ”¯æŒå®Œç¾
3. âœ… æ— éœ€é‡æ–°åŠ å¯†å†å²æ•°æ®
4. âœ… å®‰å…¨æ€§é«˜ï¼ˆé—¨é™åŠ å¯†ï¼Œéœ€è¦3/5æˆå‘˜åä½œï¼‰
5. âš ï¸ å®ç°å¤æ‚åº¦å¯æ¥å—

**æ ¸å¿ƒæ€æƒ³ï¼š**
```
ä¸ä¸ºæ¯ä¸ªå§”å‘˜ä¼šæˆå‘˜å•ç‹¬åŠ å¯†ï¼Œè€Œæ˜¯åŠ å¯†ç»™"å§”å‘˜ä¼š"è¿™ä¸ªè§’è‰²
- å§”å‘˜ä¼šç»´æŠ¤ä¸€ä¸ªå…±äº«å¯†é’¥
- å…±äº«å¯†é’¥é€šè¿‡é—¨é™åŠ å¯†åˆ†å‰²ç»™æ‰€æœ‰æˆå‘˜
- ä»»æ„3ä¸ªæˆå‘˜å¯ä»¥æ¢å¤å…±äº«å¯†é’¥
- æˆå‘˜å˜æ›´æ—¶åªéœ€æ›´æ–°å¯†é’¥åˆ†ç‰‡ï¼Œä¸éœ€è¦é‡æ–°åŠ å¯†æ•°æ®
```

---

## äº”ã€æ–¹æ¡ˆAè¯¦ç»†å®æ–½

### 5.1 æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰æ‹© | è¯´æ˜ |
|------|---------|------|
| é—¨é™åŠ å¯† | Shamir's Secret Sharing | å°†å¯†é’¥åˆ†å‰²ä¸ºNä»½ï¼Œä»»æ„Kä»½å¯æ¢å¤ |
| å¯¹ç§°åŠ å¯† | AES-256-GCM | åŠ å¯†å®é™…æ•°æ® |
| éå¯¹ç§°åŠ å¯† | X25519 | ä¿æŠ¤å¯†é’¥åˆ†ç‰‡ |
| å‰ç«¯åº“ | `secrets.js-grempe` | Shamirç§˜å¯†å…±äº«JSå®ç° |

---

### 5.2 å®Œæ•´å·¥ä½œæµç¨‹

#### æµç¨‹1ï¼šåˆå§‹åŒ–å§”å‘˜ä¼šå…±äº«å¯†é’¥ï¼ˆä¸€æ¬¡æ€§ï¼‰

```typescript
// æ²»ç†è„šæœ¬ï¼šåˆå§‹åŒ–å§”å‘˜ä¼šå…±äº«å¯†é’¥

import secrets from 'secrets.js-grempe';

async function initCommitteeSharedKey() {
  // 1. ç”Ÿæˆå§”å‘˜ä¼šå…±äº«å¯†é’¥ï¼ˆ32å­—èŠ‚ = 256ä½ï¼‰
  const sharedKey = crypto.randomBytes(32);
  const sharedKeyHex = sharedKey.toString('hex');
  
  console.log('âœ… å·²ç”Ÿæˆå§”å‘˜ä¼šå…±äº«å¯†é’¥ï¼ˆè¯·å¦¥å–„ä¿ç®¡æ­¤å¯†é’¥ï¼‰');
  
  // 2. ä½¿ç”¨Shamirç§˜å¯†å…±äº«åˆ†å‰²å¯†é’¥
  //    - 5ä»½åˆ†ç‰‡ï¼ˆå¯¹åº”5ä¸ªå§”å‘˜ä¼šæˆå‘˜ï¼‰
  //    - ä»»æ„3ä»½å¯ä»¥æ¢å¤ï¼ˆé—¨é™å€¼ = 3ï¼‰
  const shares = secrets.share(sharedKeyHex, 5, 3);
  
  console.log('âœ… å…±äº«å¯†é’¥å·²åˆ†å‰²ä¸º5ä¸ªåˆ†ç‰‡ï¼Œä»»æ„3ä»½å¯æ¢å¤');
  
  // 3. è·å–å½“å‰å§”å‘˜ä¼šæˆå‘˜
  const committeeMembers = await api.query.collective.members(3);
  
  if (committeeMembers.length !== 5) {
    throw new Error('å§”å‘˜ä¼šæˆå‘˜æ•°é‡ä¸æ˜¯5äººï¼Œè¯·è°ƒæ•´');
  }
  
  // 4. ä¸ºæ¯ä¸ªå§”å‘˜ä¼šæˆå‘˜åŠ å¯†å…¶åˆ†ç‰‡
  const encryptedShares: [string, string][] = [];
  
  for (let i = 0; i < committeeMembers.length; i++) {
    const member = committeeMembers[i].toString();
    const share = shares[i];
    
    // è·å–å§”å‘˜ä¼šæˆå‘˜çš„å…¬é’¥
    const pubKey = await api.query.evidence.userPublicKeys(member);
    
    if (pubKey.isNone) {
      throw new Error(`å§”å‘˜ä¼šæˆå‘˜ ${member} æœªæ³¨å†Œå…¬é’¥`);
    }
    
    // ç”¨å§”å‘˜ä¼šæˆå‘˜çš„å…¬é’¥åŠ å¯†åˆ†ç‰‡
    const encryptedShare = rsaEncrypt(
      Buffer.from(share, 'hex'),
      pubKey.unwrap().keyData
    );
    
    encryptedShares.push([member, encryptedShare.toString('hex')]);
    
    console.log(`âœ… å·²ä¸ºå§”å‘˜ä¼šæˆå‘˜ ${member.slice(0, 10)}... åŠ å¯†åˆ†ç‰‡`);
  }
  
  // 5. å°†åŠ å¯†çš„åˆ†ç‰‡æäº¤åˆ°é“¾ä¸Š
  await api.tx.sudo.sudo(
    api.tx.marketMaker.initCommitteeSharedKey(encryptedShares)
  ).signAndSend(sudoAccount);
  
  console.log('âœ… å§”å‘˜ä¼šå…±äº«å¯†é’¥åˆå§‹åŒ–å®Œæˆï¼');
  console.log('âš ï¸ è¯·å°†å…±äº«å¯†é’¥å¤‡ä»½åˆ°å®‰å…¨ä½ç½®ï¼ˆç¦»çº¿å­˜å‚¨ï¼‰');
  
  return sharedKey;
}
```

---

#### æµç¨‹2ï¼šå§”å‘˜ä¼šæˆå‘˜å˜æ›´æ—¶æ›´æ–°åˆ†ç‰‡

```typescript
/**
 * å§”å‘˜ä¼šæˆå‘˜å˜æ›´æ—¶ï¼Œé‡æ–°åˆ†é…å¯†é’¥åˆ†ç‰‡
 */
async function updateCommitteeKeyShares(
  sharedKey: Buffer,  // å§”å‘˜ä¼šå…±äº«å¯†é’¥ï¼ˆä»å®‰å…¨å¤‡ä»½æ¢å¤ï¼‰
  newMembers: string[]  // æ–°çš„å§”å‘˜ä¼šæˆå‘˜åˆ—è¡¨
) {
  // 1. é‡æ–°åˆ†å‰²å…±äº«å¯†é’¥
  const shares = secrets.share(
    sharedKey.toString('hex'),
    newMembers.length,
    Math.ceil(newMembers.length * 2 / 3)  // 2/3é—¨é™
  );
  
  console.log(`âœ… å…±äº«å¯†é’¥å·²é‡æ–°åˆ†å‰²ä¸º ${newMembers.length} ä¸ªåˆ†ç‰‡`);
  
  // 2. ä¸ºæ¯ä¸ªæ–°æˆå‘˜åŠ å¯†åˆ†ç‰‡
  const encryptedShares: [string, string][] = [];
  
  for (let i = 0; i < newMembers.length; i++) {
    const member = newMembers[i];
    const share = shares[i];
    
    const pubKey = await api.query.evidence.userPublicKeys(member);
    const encryptedShare = rsaEncrypt(
      Buffer.from(share, 'hex'),
      pubKey.unwrap().keyData
    );
    
    encryptedShares.push([member, encryptedShare.toString('hex')]);
  }
  
  // 3. æäº¤åˆ°é“¾ä¸Šï¼ˆéœ€è¦å§”å‘˜ä¼šå¤šç­¾ï¼‰
  await api.tx.marketMaker.updateCommitteeKeyShares(
    encryptedShares
  ).signAndSend(committeeAccount);
  
  console.log('âœ… å§”å‘˜ä¼šæˆå‘˜å¯†é’¥åˆ†ç‰‡å·²æ›´æ–°ï¼');
  console.log('âœ… æ–°æˆå‘˜è‡ªåŠ¨è·å¾—å†å²æ•°æ®è®¿é—®æƒé™');
  console.log('âœ… ç¦»èŒæˆå‘˜è‡ªåŠ¨å¤±å»è®¿é—®æƒé™');
}
```

---

#### æµç¨‹3ï¼šåšå¸‚å•†åŠ å¯†æ•æ„Ÿä¿¡æ¯

```typescript
/**
 * åšå¸‚å•†æäº¤ç”³è¯·æ—¶åŠ å¯†æ•æ„Ÿä¿¡æ¯
 */
async function encryptSensitiveData(
  sensitiveData: any,
  makerAccount: string
) {
  // 1. ç”ŸæˆéšæœºAESå¯†é’¥
  const aesKey = crypto.randomBytes(32);
  
  // 2. ç”¨AESåŠ å¯†æ•°æ®
  const encryptedContent = aesEncrypt(
    JSON.stringify(sensitiveData),
    aesKey
  );
  
  // 3. æ¢å¤å§”å‘˜ä¼šå…±äº«å…¬é’¥
  //    æ–¹æ³•ï¼šä»é“¾ä¸Šè·å–ä»»æ„3ä¸ªå§”å‘˜ä¼šæˆå‘˜çš„åˆ†ç‰‡ï¼Œç»„åˆæ¢å¤
  //    æ³¨æ„ï¼šè¿™é‡Œéœ€è¦é“¾ä¸‹åè°ƒæˆ–é¢„å…ˆè·å–
  const committeePublicKey = await getCommitteePublicKey();
  
  // 4. åŠ å¯†AESå¯†é’¥
  const encryptedKeys = {
    // åšå¸‚å•†è‡ªå·±
    owner: rsaEncrypt(aesKey, myPublicKey),
    
    // å§”å‘˜ä¼šï¼ˆä½¿ç”¨å§”å‘˜ä¼šå…±äº«å…¬é’¥ï¼‰
    committee: rsaEncrypt(aesKey, committeePublicKey),
  };
  
  // 5. ä¸Šä¼ åˆ°IPFS
  const ipfsData = {
    version: '2.0',
    encrypted_content: encryptedContent.toString('hex'),
    encrypted_keys: {
      owner: encryptedKeys.owner.toString('hex'),
      committee: encryptedKeys.committee.toString('hex'),
    },
    metadata: {
      encrypted_at: Date.now(),
      encryptor: makerAccount,
    },
  };
  
  const result = await ipfs.add(JSON.stringify(ipfsData));
  
  console.log('âœ… æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†');
  console.log('âœ… ä»»ä½•å½“å‰æˆ–æœªæ¥çš„å§”å‘˜ä¼šæˆå‘˜éƒ½å¯ä»¥è§£å¯†');
  
  return result.path;  // CID
}
```

---

#### æµç¨‹4ï¼šå§”å‘˜ä¼šæˆå‘˜è§£å¯†

```typescript
/**
 * å§”å‘˜ä¼šæˆå‘˜è§£å¯†æ•æ„Ÿä¿¡æ¯
 */
async function decryptByCommitteeMember(
  privateCid: string,
  myAccount: string
) {
  // 1. éªŒè¯æ˜¯å§”å‘˜ä¼šæˆå‘˜
  const members = await api.query.collective.members(3);
  const isMember = members.some(m => m.toString() === myAccount);
  
  if (!isMember) {
    throw new Error('æ‚¨ä¸æ˜¯å§”å‘˜ä¼šæˆå‘˜');
  }
  
  // 2. ä»IPFSä¸‹è½½åŠ å¯†æ•°æ®
  const ipfsData = await downloadFromIPFS(privateCid);
  
  // 3. è·å–æˆ‘çš„å¯†é’¥åˆ†ç‰‡
  const myShareEncrypted = await api.query.marketMaker.committeeKeyShares(myAccount);
  
  // 4. ç”¨æˆ‘çš„ç§é’¥è§£å¯†åˆ†ç‰‡
  const myPrivateKey = await getPrivateKeyFromWallet();
  const myShare = rsaDecrypt(
    Buffer.from(myShareEncrypted.unwrap(), 'hex'),
    myPrivateKey
  );
  
  console.log('âœ… å·²è§£å¯†æˆ‘çš„å¯†é’¥åˆ†ç‰‡');
  
  // 5. è¯·æ±‚å…¶ä»–2ä¸ªå§”å‘˜ä¼šæˆå‘˜çš„åˆ†ç‰‡ï¼ˆé“¾ä¸‹åè°ƒï¼‰
  const otherShares = await requestSharesFromOtherMembers(2);
  
  console.log('âœ… å·²è·å–å…¶ä»–2ä¸ªæˆå‘˜çš„åˆ†ç‰‡');
  
  // 6. ç»„åˆ3ä¸ªåˆ†ç‰‡æ¢å¤å§”å‘˜ä¼šå…±äº«å¯†é’¥
  const allShares = [myShare, ...otherShares];
  const committeeSharedKey = secrets.combine(allShares);
  
  console.log('âœ… å·²æ¢å¤å§”å‘˜ä¼šå…±äº«å¯†é’¥');
  
  // 7. ç”¨å§”å‘˜ä¼šå…±äº«å¯†é’¥è§£å¯†AESå¯†é’¥
  const encryptedAesKey = Buffer.from(ipfsData.encrypted_keys.committee, 'hex');
  const aesKey = rsaDecrypt(encryptedAesKey, Buffer.from(committeeSharedKey, 'hex'));
  
  // 8. ç”¨AESå¯†é’¥è§£å¯†æ•°æ®
  const decryptedData = aesDecrypt(
    Buffer.from(ipfsData.encrypted_content, 'hex'),
    aesKey
  );
  
  return JSON.parse(decryptedData);
}
```

---

### 5.3 å®‰å…¨æ€§åˆ†æ

#### âœ… ä¼˜åŠ¿

1. **åŠ¨æ€æˆå‘˜æ”¯æŒ**
   - âœ… æ–°å§”å‘˜ä¼šæˆå‘˜è‡ªåŠ¨è·å¾—å†å²æ•°æ®è®¿é—®æƒé™
   - âœ… ä¸éœ€è¦é‡æ–°åŠ å¯†ä»»ä½•å†å²æ•°æ®

2. **è‡ªåŠ¨æƒé™æ’¤é”€**
   - âœ… ç¦»èŒå§”å‘˜ä¼šæˆå‘˜ç«‹å³å¤±å»å¯†é’¥åˆ†ç‰‡
   - âœ… æ— æ³•ç‹¬è‡ªæ¢å¤å§”å‘˜ä¼šå…±äº«å¯†é’¥
   - âœ… æ— æ³•è§£å¯†æ–°æ•°æ®

3. **é˜²æ­¢å•ç‚¹å¤±è´¥**
   - âœ… ä»»æ„3/5æˆå‘˜å¯ä»¥æ¢å¤å¯†é’¥
   - âœ… å³ä½¿2ä¸ªæˆå‘˜ç¦»çº¿ä¹Ÿä¸å½±å“è§£å¯†
   - âœ… é˜²æ­¢å•ä¸ªæˆå‘˜æ»¥ç”¨æƒé™

4. **å®Œå…¨å»ä¸­å¿ƒåŒ–**
   - âœ… ä¸ä¾èµ–é“¾ä¸‹æœåŠ¡å™¨
   - âœ… æ‰€æœ‰æ•°æ®é“¾ä¸Šå¯éªŒè¯
   - âœ… ç¬¦åˆåŒºå—é“¾ç²¾ç¥

---

#### âš ï¸ é£é™©ä¸å¯¹ç­–

##### é£é™©1ï¼šå§”å‘˜ä¼šå…±äº«å¯†é’¥æ³„éœ²

**åœºæ™¯ï¼š** å¦‚æœå§”å‘˜ä¼šå…±äº«å¯†é’¥æœ¬èº«è¢«æ³„éœ²

**å¯¹ç­–ï¼š**
```rust
// 1. å®šæœŸè½®æ¢å§”å‘˜ä¼šå…±äº«å¯†é’¥ï¼ˆå¦‚æ¯å¹´ä¸€æ¬¡ï¼‰
pub fn rotate_committee_shared_key(
    new_key: [u8; 32],
    new_shares: Vec<(AccountId, Vec<u8>)>,
) -> DispatchResult {
    // éœ€è¦é‡æ–°åŠ å¯†æ‰€æœ‰å†å²æ•°æ®ï¼ˆæˆ–ä½¿ç”¨åŒå±‚åŠ å¯†ï¼‰
}

// 2. åŒå±‚åŠ å¯†ï¼šå…±äº«å¯†é’¥ + æ—¶é—´æˆ³å¯†é’¥
//    å³ä½¿å…±äº«å¯†é’¥æ³„éœ²ï¼Œä¹Ÿéœ€è¦æ—¶é—´æˆ³å¯†é’¥æ‰èƒ½è§£å¯†
```

---

##### é£é™©2ï¼šåè°ƒæˆæœ¬é«˜

**åœºæ™¯ï¼š** æ¯æ¬¡è§£å¯†éƒ½éœ€è¦è‡³å°‘3ä¸ªå§”å‘˜ä¼šæˆå‘˜åœ¨çº¿åä½œ

**å¯¹ç­–ï¼š**
```typescript
// æ–¹æ¡ˆAï¼šé¢„å…ˆç”Ÿæˆè§£å¯†ä¼šè¯ï¼ˆ24å°æ—¶æœ‰æ•ˆï¼‰
async function createDecryptionSession() {
  // 3ä¸ªå§”å‘˜ä¼šæˆå‘˜æå‰åä½œç”Ÿæˆä¸´æ—¶è§£å¯†å¯†é’¥
  // 24å°æ—¶å†…ä»»ä½•å§”å‘˜ä¼šæˆå‘˜å¯ä»¥ä½¿ç”¨
  const sessionKey = combineShares([share1, share2, share3]);
  
  // å­˜å‚¨åœ¨å®‰å…¨çš„é“¾ä¸‹å­˜å‚¨ï¼ˆå¦‚SGXï¼‰
  storeSessionKey(sessionKey, expiresAt: now + 24h);
}

// æ–¹æ¡ˆBï¼šå§”æ‰˜è§£å¯†ï¼ˆå§”å‘˜ä¼šæˆå‘˜æˆæƒå…¶ä»–æˆå‘˜ä»£ç†ï¼‰
async function delegateDecryption(from: Member, to: Member) {
  // å§”å‘˜Aæˆæƒå§”å‘˜Bä¸´æ—¶ä½¿ç”¨è‡ªå·±çš„åˆ†ç‰‡
  const encryptedShare = encryptForMember(myShare, toPublicKey);
  await submitDelegation(from, to, encryptedShare, expiresAt);
}
```

---

##### é£é™©3ï¼šåˆå§‹åŒ–å¤æ‚

**åœºæ™¯ï¼š** ç¬¬ä¸€æ¬¡è®¾ç½®å§”å‘˜ä¼šå…±äº«å¯†é’¥æµç¨‹å¤æ‚

**å¯¹ç­–ï¼š**
```typescript
// æä¾›è‡ªåŠ¨åŒ–è„šæœ¬
import { initCommitteeSharedKey } from '@stardust/governance-scripts';

// ä¸€é”®åˆå§‹åŒ–
await initCommitteeSharedKey({
  threshold: 3,
  totalShares: 5,
  members: committeeMembers,
});

console.log('âœ… åˆå§‹åŒ–å®Œæˆï¼');
```

---

## å…­ã€åˆç†æ€§åˆ†æ

### âœ… ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆåˆç†ï¼Ÿ

#### 1. ä¸šåŠ¡éœ€æ±‚åŒ¹é…

| éœ€æ±‚ | æ–¹æ¡ˆAï¼ˆå§”å‘˜ä¼šå…±äº«å¯†é’¥ï¼‰ | é™æ€æˆæƒæ–¹æ¡ˆ |
|------|----------------------|------------|
| æ–°å§”å‘˜å¯æŸ¥çœ‹å†å²æ•°æ® | âœ… è‡ªåŠ¨æ”¯æŒ | âŒ æ— æ³•æŸ¥çœ‹ |
| ç¦»èŒå§”å‘˜è‡ªåŠ¨æ’¤é”€ | âœ… ç«‹å³ç”Ÿæ•ˆ | âŒ ä»å¯æŸ¥çœ‹ |
| æ— éœ€é‡æ–°åŠ å¯† | âœ… ä¸éœ€è¦ | âŒ éœ€è¦é‡æ–°åŠ å¯†æ‰€æœ‰æ•°æ® |
| å®ç°å¤æ‚åº¦ | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¢ ç®€å• |

---

#### 2. çœŸå®åœºæ™¯é€‚ç”¨

**åœºæ™¯1ï¼šå§”å‘˜ä¼šæ¢å±Š**
```
2024å¹´å§”å‘˜ä¼šï¼š[A, B, C, D, E]
2025å¹´å§”å‘˜ä¼šï¼š[B, C, F, G, H]  // Aã€Dã€Eç¦»èŒï¼ŒFã€Gã€Hæ–°åŠ å…¥

âœ… æ–¹æ¡ˆAï¼šåªéœ€æ›´æ–°å¯†é’¥åˆ†ç‰‡ï¼ˆ10åˆ†é’Ÿï¼‰
âŒ é™æ€æ–¹æ¡ˆï¼šéœ€è¦é‡æ–°åŠ å¯†10,000ä¸ªå†å²ç”³è¯·ï¼ˆæ•°å°æ—¶ï¼‰
```

---

**åœºæ™¯2ï¼šç´§æ€¥ä»²è£**
```
å‡Œæ™¨2ç‚¹å‘ç”ŸOTCäº‰è®®ï¼Œéœ€è¦æŸ¥çœ‹2023å¹´çš„å†å²æ•°æ®

âœ… æ–¹æ¡ˆAï¼šå½“å‰å§”å‘˜ä¼šæˆå‘˜ï¼ˆFã€Gã€Hï¼‰å¯ä»¥ç«‹å³æŸ¥çœ‹
âŒ é™æ€æ–¹æ¡ˆï¼šåªæœ‰2023å¹´çš„å§”å‘˜ä¼šæˆå‘˜ï¼ˆAã€Dã€Eï¼‰å¯ä»¥æŸ¥çœ‹
            ä½†ä»–ä»¬å¯èƒ½å·²ç»ç¦»èŒï¼Œæ— æ³•è”ç³»
```

---

**åœºæ™¯3ï¼šåˆè§„å®¡è®¡**
```
ç›‘ç®¡æœºæ„è¦æ±‚å®¡è®¡æ‰€æœ‰å†å²åšå¸‚å•†KYCè®°å½•

âœ… æ–¹æ¡ˆAï¼šå½“å‰å§”å‘˜ä¼šå¯ä»¥æŸ¥çœ‹æ‰€æœ‰å†å²è®°å½•
âŒ é™æ€æ–¹æ¡ˆï¼šéœ€è¦è”ç³»æ‰€æœ‰å†å²å§”å‘˜ä¼šæˆå‘˜ï¼ˆå¯èƒ½å·²ç»ç¦»èŒï¼‰
```

---

#### 3. å®‰å…¨æ€§å¹³è¡¡

| å®‰å…¨è€ƒè™‘ | æ–¹æ¡ˆA | è¯„ä¼° |
|---------|------|------|
| **éšç§ä¿æŠ¤** | å§”å‘˜ä¼šå…±äº«å¯†é’¥ | ğŸŸ¢ åªæœ‰å§”å‘˜ä¼šå¯ä»¥è§£å¯† |
| **é˜²æ­¢æ»¥ç”¨** | é—¨é™åŠ å¯†ï¼ˆ3/5ï¼‰ | ğŸŸ¢ éœ€è¦å¤šäººåä½œ |
| **è®¿é—®å®¡è®¡** | é“¾ä¸Šè®°å½•æ—¥å¿— | ğŸŸ¢ æ‰€æœ‰è®¿é—®å¯è¿½æº¯ |
| **æƒé™æ’¤é”€** | è‡ªåŠ¨å¤±æ•ˆ | ğŸŸ¢ ç¦»èŒç«‹å³å¤±å»åˆ†ç‰‡ |

---

## ä¸ƒã€æ€»ç»“

### âœ… å¯è¡Œæ€§ç»“è®º

**å®Œå…¨å¯è¡Œï¼æ¨èæ–¹æ¡ˆAï¼šå§”å‘˜ä¼šå…±äº«å¯†é’¥ï¼ˆé—¨é™åŠ å¯†ï¼‰**

**æŠ€æœ¯æ ˆï¼š**
- âœ… Shamirç§˜å¯†å…±äº«ï¼ˆæˆç†Ÿç®—æ³•ï¼‰
- âœ… AES-256-GCMï¼ˆæ ‡å‡†åŠ å¯†ï¼‰
- âœ… X25519ï¼ˆSubstrateæ ‡å‡†ï¼‰
- âœ… JSåº“å¯ç”¨ï¼ˆsecrets.js-grempeï¼‰

**å®æ–½éš¾åº¦ï¼š**
- ğŸŸ¡ ä¸­ç­‰ï¼ˆéœ€è¦2-3å¤©å¼€å‘ï¼‰
- ğŸŸ¢ æ— éœ€ä¿®æ”¹ç°æœ‰æ•°æ®ç»“æ„
- ğŸŸ¢ å¯ä»¥é€æ­¥è¿ç§»

---

### âœ… åˆç†æ€§ç»“è®º

**ä¸šåŠ¡ä¸Šå®Œå…¨åˆç†ï¼**

#### ä¼˜åŠ¿ï¼š
1. âœ… **åŠ¨æ€æˆå‘˜æ”¯æŒ** - æ–°å§”å‘˜è‡ªåŠ¨è·å¾—å†å²æ•°æ®è®¿é—®æƒé™
2. âœ… **è‡ªåŠ¨æƒé™æ’¤é”€** - ç¦»èŒå§”å‘˜ç«‹å³å¤±å»è®¿é—®æƒé™
3. âœ… **æ— éœ€é‡æ–°åŠ å¯†** - èŠ‚çœå¤§é‡æ—¶é—´å’ŒGasè´¹
4. âœ… **é˜²æ­¢å•ç‚¹å¤±è´¥** - é—¨é™åŠ å¯†ï¼ˆ3/5ï¼‰ä¿è¯å¯ç”¨æ€§
5. âœ… **å®Œå…¨å»ä¸­å¿ƒåŒ–** - ä¸ä¾èµ–é“¾ä¸‹æœåŠ¡å™¨

#### æˆæœ¬ï¼š
- ğŸŸ¡ åˆå§‹åŒ–ç¨å¤æ‚ï¼ˆä¸€æ¬¡æ€§ï¼‰
- ğŸŸ¡ è§£å¯†éœ€è¦åä½œï¼ˆå¯é€šè¿‡ä¼šè¯å¯†é’¥ç¼“è§£ï¼‰
- ğŸŸ¡ éœ€è¦å¯†é’¥å¤‡ä»½ç®¡ç†

---

### ğŸ¯ æ¨èå®æ–½è®¡åˆ’

#### Phase 1ï¼šåŸºç¡€è®¾æ–½ï¼ˆ1å‘¨ï¼‰
1. âœ… æ·»åŠ é“¾ä¸Šå­˜å‚¨ï¼ˆCommitteeKeySharesï¼‰
2. âœ… å®ç°åˆå§‹åŒ–æ¥å£ï¼ˆinit_committee_shared_keyï¼‰
3. âœ… å®ç°æ›´æ–°æ¥å£ï¼ˆupdate_committee_key_sharesï¼‰

#### Phase 2ï¼šå‰ç«¯é›†æˆï¼ˆ1å‘¨ï¼‰
1. âœ… åšå¸‚å•†åŠ å¯†å·¥å…·ï¼ˆencryptForCommitteeï¼‰
2. âœ… å§”å‘˜ä¼šè§£å¯†å·¥å…·ï¼ˆdecryptByCommitteeMemberï¼‰
3. âœ… æ²»ç†è„šæœ¬ï¼ˆå¯†é’¥åˆ†ç‰‡ç®¡ç†ï¼‰

#### Phase 3ï¼šæµ‹è¯•ä¸éƒ¨ç½²ï¼ˆ1å‘¨ï¼‰
1. âœ… å•å…ƒæµ‹è¯•
2. âœ… é›†æˆæµ‹è¯•ï¼ˆå§”å‘˜ä¼šæˆå‘˜å˜æ›´ï¼‰
3. âœ… æµ‹è¯•ç½‘éƒ¨ç½²
4. âœ… ä¸»ç½‘è¿ç§»

**æ€»å·¥ä½œé‡ï¼šçº¦3å‘¨**

---

**ç¼–å†™æ—¥æœŸ**ï¼š2025-10-23  
**ç‰ˆæœ¬**ï¼šv1.0  
**çŠ¶æ€**ï¼šå®æ–½æ–¹æ¡ˆ  
**ç»“è®º**ï¼šâœ… æŠ€æœ¯å¯è¡Œ + âœ… ä¸šåŠ¡åˆç† + â­ å¼ºçƒˆæ¨è

