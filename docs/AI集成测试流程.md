# AI 推理服务 - 完整测试流程

## 📋 测试检查清单

### ✅ 第一阶段：后端服务测试

#### 1.1 服务启动检查
```bash
# 检查服务进程
ps aux | grep uvicorn | grep -v grep

# 预期输出：
# xiaodong  113211  1.3  0.1 ... python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

- [ ] 服务进程存在
- [ ] 进程 ID 正常
- [ ] 端口 8000 已监听

#### 1.2 健康检查
```bash
# 执行健康检查
curl -s http://localhost:8000/health | python3 -m json.tool

# 预期输出：
# {
#     "status": "degraded" or "healthy",
#     "components": {
#         "redis": "...",
#         "deepseek": "healthy",
#         "local_model": "healthy"
#     },
#     "timestamp": ...
# }
```

- [ ] 健康检查接口响应
- [ ] DeepSeek 组件正常
- [ ] 本地模型组件正常
- [ ] 返回时间戳

#### 1.3 推理 API 测试
```bash
# 运行测试脚本
cd /home/xiaodong/文档/stardust/ai-inference-service
source venv/bin/activate
python test-inference.py

# 预期输出：
# ✅ 服务健康检查: 通过
# ✅ 推理成功!
# 🎯 交易信号: BUY/SELL/HOLD
# 💰 置信度: 60-90%
# ⏱️ 推理耗时: <100ms
```

- [ ] 测试脚本执行成功
- [ ] 返回交易信号
- [ ] 置信度在合理范围
- [ ] 响应时间 < 100ms
- [ ] 包含完整的推理结果

---

### ✅ 第二阶段：前端集成测试

#### 2.1 查看路由配置
```bash
# 检查路由文件
grep "ai-strategy" /home/xiaodong/文档/stardust/stardust-dapp/src/routes.tsx

# 预期输出：
# { match: h => h === '#/ai-strategy', component: lazy(() => import('./features/ai-strategy/AIStrategyDemo')) },
```

- [ ] AI 策略路由已添加
- [ ] 路由路径正确：`#/ai-strategy`
- [ ] 组件导入路径正确

#### 2.2 启动前端服务
```bash
cd /home/xiaodong/文档/stardust/stardust-dapp
npm run dev

# 或者如果已经在运行，检查是否有编译错误
```

- [ ] 前端服务启动无错误
- [ ] 没有 TypeScript 编译错误
- [ ] 没有 linter 错误
- [ ] Hot reload 正常工作

#### 2.3 访问 AI 策略页面

**浏览器操作**:
1. 打开浏览器
2. 访问前端地址（如 `http://localhost:5173`）
3. 在地址栏添加 hash: `#/ai-strategy`
4. 完整URL: `http://localhost:5173/#/ai-strategy`

**检查清单**:
- [ ] 页面成功加载
- [ ] AI 交易面板显示
- [ ] 没有控制台错误
- [ ] UI 渲染正常

#### 2.4 测试 AI 交易面板功能

**输入测试**:
- [ ] 可以输入交易对名称
- [ ] 可以输入价格数值
- [ ] 可以选择 AI 模型类型
- [ ] 可以输入策略 ID

**按钮测试**:
- [ ] "获取 AI 交易信号" 按钮可点击
- [ ] 点击后显示加载状态
- [ ] 检查服务按钮可用

**结果展示**:
- [ ] 显示交易信号（BUY/SELL/HOLD）
- [ ] 显示置信度百分比
- [ ] 显示置信度进度条
- [ ] 显示建议仓位
- [ ] 显示入场/止损/止盈价格
- [ ] 显示市场状况标签
- [ ] 显示风险评分
- [ ] 显示推理依据文本
- [ ] 显示特征重要性图表
- [ ] 显示推理耗时

**执行交易测试**:
- [ ] "执行买入/卖出" 按钮显示
- [ ] 按钮状态根据信号类型变化
- [ ] HOLD 信号时按钮禁用

---

### ✅ 第三阶段：交易仪表板集成测试

#### 3.1 访问交易仪表板

**浏览器操作**:
1. 确保已连接钱包
2. 访问交易页面（根据你的路由配置）
3. 或直接访问: `http://localhost:5173/#/otc/order` 或类似路径

**检查清单**:
- [ ] 交易仪表板页面加载
- [ ] 看到多个 Tab 标签
- [ ] 包含"AI 助手" Tab
- [ ] Tab 图标显示闪电图标

#### 3.2 切换到 AI 助手 Tab

**操作步骤**:
1. 点击 "AI 助手" Tab
2. 等待内容加载

**检查清单**:
- [ ] Tab 切换成功
- [ ] AI 交易面板嵌入显示
- [ ] 顶部显示说明卡片
- [ ] 说明文本正确显示

#### 3.3 在交易仪表板中测试 AI 功能

**获取信号**:
1. 在 AI 面板中输入参数
2. 点击"获取 AI 交易信号"
3. 等待结果

**检查清单**:
- [ ] 信号成功获取
- [ ] 所有结果字段正常显示
- [ ] 没有控制台错误

**执行交易流程**:
1. 当 AI 给出 BUY 信号且置信度 ≥ 70% 时
2. 点击"执行买入"按钮
3. 观察页面反应

**预期行为**:
- [ ] 显示提示消息："AI 建议买入，置信度 XX%"
- [ ] 自动打开"创建订单"弹窗
- [ ] 弹窗预填充相关数据（如果实现）

---

### ✅ 第四阶段：完整交易流程测试

#### 4.1 准备测试环境

**前置条件**:
- [ ] 钱包已连接
- [ ] 账户有足够余额
- [ ] AI 服务正常运行
- [ ] 前端服务正常运行
- [ ] 区块链节点正常运行

#### 4.2 完整流程测试

**步骤 1: 访问交易仪表板**
```
URL: http://localhost:5173/#/[你的交易路由]
```
- [ ] 页面加载成功
- [ ] 钱包连接状态正常

**步骤 2: 切换到 AI 助手**
- [ ] 点击 "AI 助手" Tab
- [ ] AI 面板显示

**步骤 3: 配置参数**
- [ ] 交易对: DUST-USDT
- [ ] 当前价格: 0.1
- [ ] AI 模型: LSTM
- [ ] 策略 ID: 1

**步骤 4: 获取 AI 信号**
- [ ] 点击"获取 AI 交易信号"
- [ ] 等待 1-3 秒
- [ ] 查看返回结果

**步骤 5: 分析 AI 建议**
记录以下信息：
- 信号类型: _______ (BUY/SELL/HOLD)
- 置信度: _______ %
- 建议仓位: $ _______
- 入场价: $ _______
- 止损价: $ _______
- 止盈价: $ _______
- 风险评分: _______ /100
- 市场状况: _______ (Bullish/Bearish/Sideways/Volatile)

**步骤 6: 执行交易（如果信号是 BUY 且置信度 ≥ 70%）**
- [ ] 点击"执行买入"按钮
- [ ] 看到提示消息
- [ ] 创建订单弹窗打开
- [ ] 填写订单详情
- [ ] 提交订单
- [ ] 等待区块确认
- [ ] 订单创建成功

**步骤 7: 验证结果**
- [ ] 切换到"我的订单" Tab
- [ ] 看到新创建的订单
- [ ] 订单状态正确
- [ ] 订单金额正确

---

### ✅ 第五阶段：错误处理测试

#### 5.1 AI 服务不可用测试

**操作**:
1. 停止 AI 服务: `pkill -f "uvicorn app.main:app"`
2. 在前端尝试获取交易信号

**预期行为**:
- [ ] 显示错误提示
- [ ] 错误信息清晰（如"AI服务连接失败"）
- [ ] 不会导致页面崩溃
- [ ] 提供重试选项

**恢复**:
```bash
cd ~/文档/stardust/ai-inference-service
source venv/bin/activate
nohup python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload > service.log 2>&1 &
```

#### 5.2 网络超时测试

**操作**:
1. 修改 AI 服务配置使其响应缓慢（可选）
2. 或设置前端超时时间很短

**预期行为**:
- [ ] 显示超时错误
- [ ] 不会无限等待
- [ ] 可以取消请求

#### 5.3 无效数据测试

**操作**:
1. 输入无效的价格（如负数或0）
2. 输入无效的交易对名称

**预期行为**:
- [ ] 输入验证生效
- [ ] 显示验证错误提示
- [ ] 防止无效请求发送

---

### ✅ 第六阶段：性能测试

#### 6.1 响应时间测试

**测试 10 次请求，记录响应时间**:

| 次数 | 响应时间 (ms) | 状态 |
|------|--------------|------|
| 1    |              |      |
| 2    |              |      |
| 3    |              |      |
| 4    |              |      |
| 5    |              |      |
| 6    |              |      |
| 7    |              |      |
| 8    |              |      |
| 9    |              |      |
| 10   |              |      |

**评估标准**:
- [ ] 平均响应时间 < 100ms: ⭐⭐⭐⭐⭐
- [ ] 平均响应时间 < 500ms: ⭐⭐⭐⭐
- [ ] 平均响应时间 < 1000ms: ⭐⭐⭐

#### 6.2 并发测试

**操作**:
1. 打开多个浏览器标签页
2. 同时在不同标签页请求 AI 信号

**预期行为**:
- [ ] 所有请求都能成功
- [ ] 没有请求失败
- [ ] 响应时间基本一致

#### 6.3 缓存测试（如果启用 Redis）

**操作**:
1. 使用相同参数请求两次
2. 对比两次响应时间

**预期行为**:
- [ ] 第二次请求更快
- [ ] 结果一致
- [ ] 缓存命中显示在日志中

---

### ✅ 第七阶段：UI/UX 测试

#### 7.1 桌面端测试

**浏览器**: Chrome / Firefox / Edge

**检查项**:
- [ ] 布局正常
- [ ] 所有元素可见
- [ ] 按钮可点击
- [ ] 表单可交互
- [ ] 图表清晰
- [ ] 文字可读

#### 7.2 移动端测试

**操作**: 使用浏览器开发者工具切换到移动设备视图

**检查项**:
- [ ] 响应式布局生效
- [ ] 所有内容自适应屏幕
- [ ] 触摸操作友好
- [ ] 滚动流畅
- [ ] 字体大小适中
- [ ] 按钮大小合适

#### 7.3 主题测试

**操作**: 如果支持主题切换

**检查项**:
- [ ] 亮色主题正常
- [ ] 暗色主题正常
- [ ] 主题切换平滑
- [ ] 颜色对比度合适

---

### ✅ 第八阶段：集成测试

#### 8.1 与钱包集成

**检查项**:
- [ ] 钱包连接状态正确显示
- [ ] 账户地址正确获取
- [ ] 钱包切换时组件更新
- [ ] 签名交易流程正常

#### 8.2 与区块链集成

**检查项**:
- [ ] 可以读取链上数据
- [ ] 可以提交交易到链上
- [ ] 交易状态正确追踪
- [ ] 事件监听正常工作

#### 8.3 与其他模块集成

**检查项**:
- [ ] 从做市商列表跳转到 AI 助手
- [ ] AI 建议可以直接创建订单
- [ ] 订单创建后可以在列表中看到
- [ ] 数据在各个模块间一致

---

## 📊 测试结果汇总

### 测试统计

- **总测试项**: _____ 项
- **通过项**: _____ 项
- **失败项**: _____ 项
- **通过率**: _____ %

### 关键指标

| 指标 | 目标值 | 实际值 | 状态 |
|------|--------|--------|------|
| 服务可用性 | 99% | _____ | ⬜ |
| 平均响应时间 | < 100ms | _____ ms | ⬜ |
| 成功率 | > 95% | _____ % | ⬜ |
| 错误处理 | 100% | _____ % | ⬜ |

### 问题记录

| # | 问题描述 | 严重程度 | 状态 | 解决方案 |
|---|----------|----------|------|----------|
| 1 |          |          |      |          |
| 2 |          |          |      |          |
| 3 |          |          |      |          |

---

## 🐛 常见问题解决

### 问题 1: AI 服务连接失败

**症状**: 前端显示"AI服务连接失败"

**解决方案**:
```bash
# 1. 检查服务是否运行
ps aux | grep uvicorn | grep -v grep

# 2. 如果没有运行，重启服务
cd ~/文档/stardust/ai-inference-service
source venv/bin/activate
nohup python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload > service.log 2>&1 &

# 3. 检查服务健康
curl http://localhost:8000/health
```

### 问题 2: 组件不显示

**症状**: AI 面板或按钮不显示

**解决方案**:
```bash
# 1. 检查浏览器控制台错误
# 2. 检查 TypeScript 编译错误
cd ~/文档/stardust/stardust-dapp
npm run build

# 3. 清除缓存重新加载
# Ctrl+Shift+R 或 Cmd+Shift+R
```

### 问题 3: 推理结果不合理

**症状**: 置信度总是很低或信号不准确

**解决方案**:
```bash
# 1. 检查市场数据是否合理
# 2. 尝试不同的模型类型
# 3. 调整置信度阈值
# 4. 查看 AI 服务日志
tail -f ~/文档/stardust/ai-inference-service/service.log
```

### 问题 4: 执行交易失败

**症状**: 点击执行按钮后交易未创建

**解决方案**:
1. 检查钱包连接状态
2. 确认账户有足够余额
3. 检查区块链节点状态
4. 查看浏览器控制台错误

---

## ✅ 最终验收标准

### 必须通过 (P0)
- [ ] AI 服务正常运行
- [ ] 前端可以访问 AI 策略页面
- [ ] 可以获取交易信号
- [ ] 信号结果正常显示
- [ ] 交易仪表板集成成功

### 应该通过 (P1)
- [ ] 响应时间 < 100ms
- [ ] 错误处理完善
- [ ] 移动端适配
- [ ] 与钱包集成正常
- [ ] 可以执行完整交易流程

### 可以通过 (P2)
- [ ] 缓存功能正常（如果启用）
- [ ] 并发请求支持
- [ ] 主题切换支持
- [ ] 性能优化

---

## 📝 测试签字

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| 测试执行人 |  |  |  |
| 开发负责人 |  |  |  |
| 项目经理 |  |  |  |

---

**测试版本**: v1.0.0  
**测试日期**: 2025-11-04  
**文档版本**: 1.0

---

## 🎯 快速测试命令

```bash
# 一键测试脚本
cd ~/文档/stardust

# 1. 测试后端服务
cd ai-inference-service
source venv/bin/activate
python test-inference.py

# 2. 访问前端测试
# 浏览器打开: http://localhost:5173/#/ai-strategy

# 3. 查看服务日志
tail -f ai-inference-service/service.log

# 4. 测试健康检查
curl http://localhost:8000/health | python3 -m json.tool
```

---

祝测试顺利！🎉

