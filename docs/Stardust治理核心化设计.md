# Stardust 治理核心化设计

> **核心理念**：治理是 Stardust 项目的核心，所有功能模块都应围绕治理机制构建，确保内容质量、用户权益和生态健康发展。

## 📋 目录

1. [治理核心地位](#1-治理核心地位)
2. [治理体系架构](#2-治理体系架构)
3. [核心治理模块](#3-核心治理模块)
4. [治理流程设计](#4-治理流程设计)
5. [治理机制整合](#5-治理机制整合)
6. [治理优化建议](#6-治理优化建议)
7. [实施路线图](#7-实施路线图)

---

## 1. 治理核心地位

### 1.1 为什么治理是核心？

**Stardust 作为数字纪念平台，治理机制决定了：**

1. **内容质量保障**：确保逝者信息的真实性、准确性和尊重性
2. **用户权益保护**：防止恶意操作、虚假信息、隐私侵犯
3. **生态健康发展**：平衡各方利益，促进社区共建
4. **平台公信力**：透明、公正的治理机制是平台信任的基础
5. **长期可持续性**：完善的治理机制确保平台长期稳定运行

### 1.2 治理核心化原则

```
┌─────────────────────────────────────────────────┐
│            Stardust 治理核心化原则              │
├─────────────────────────────────────────────────┤
│                                                 │
│  1. 所有内容操作必须经过治理审核                │
│  2. 所有争议必须通过治理机制解决                │
│  3. 所有参数调整必须通过治理投票                │
│  4. 所有资金分配必须通过治理审批                │
│  5. 所有权限变更必须通过治理验证                │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 1.3 治理覆盖范围

| 治理领域 | 治理内容 | 治理机制 |
|---------|---------|---------|
| **内容治理** | 逝者信息、文本、媒体、作品 | `pallet-stardust-appeals` + `pallet-deceased/governance` |
| **用户治理** | 用户权限、信誉、身份验证 | `pallet-identity` + `pallet-credit` |
| **资金治理** | 国库管理、资金分配、收益分成 | `pallet-treasury` + `pallet-affiliate` |
| **参数治理** | 押金、费率、阈值、期限 | `pallet-democracy` + `pallet-referenda` |
| **争议治理** | 投诉、申诉、仲裁 | `pallet-stardust-appeals` + `pallet-arbitration` |
| **生态治理** | 提案、投票、执行 | `pallet-collective` + `pallet-referenda` |

---

## 2. 治理体系架构

### 2.1 三层治理架构

```
┌─────────────────────────────────────────────────────────────┐
│                    Stardust 治理体系                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  第一层：内容治理层（Content Governance）            │   │
│  │  - 逝者信息审核                                      │   │
│  │  - 内容质量保障                                      │   │
│  │  - 投诉申诉处理                                      │   │
│  │  核心模块：pallet-stardust-appeals                   │   │
│  └─────────────────────────────────────────────────────┘   │
│                           ↓                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  第二层：用户治理层（User Governance）               │   │
│  │  - 用户权限管理                                      │   │
│  │  - 信誉体系维护                                      │   │
│  │  - 身份验证审核                                      │   │
│  │  核心模块：pallet-identity + pallet-credit          │   │
│  └─────────────────────────────────────────────────────┘   │
│                           ↓                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  第三层：生态治理层（Ecosystem Governance）          │   │
│  │  - 提案创建与投票                                    │   │
│  │  - 参数调整与优化                                    │   │
│  │  - 资金分配与审计                                    │   │
│  │  核心模块：pallet-democracy + pallet-referenda      │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 治理模块关系图

```
                    ┌─────────────────────┐
                    │  pallet-democracy   │  ← 民主投票
                    │  (生态治理)         │
                    └──────────┬──────────┘
                               │
                    ┌──────────▼──────────┐
                    │  pallet-referenda   │  ← 公投系统
                    │  (提案执行)         │
                    └──────────┬──────────┘
                               │
        ┌──────────────────────┼──────────────────────┐
        │                      │                      │
┌───────▼────────┐   ┌─────────▼─────────┐  ┌────────▼────────┐
│ pallet-stardust│   │ pallet-arbitration│  │ pallet-treasury │
│ -appeals       │   │ (仲裁)            │  │ (国库)          │
│ (申诉治理)     │   └───────────────────┘  └─────────────────┘
└───────┬────────┘
        │
┌───────▼────────────────────────────────────────────┐
│  pallet-deceased/governance                        │
│  (逝者拥有者操作治理)                              │
│  - OwnerOperation                                  │
│  - OwnerDeposit                                    │
│  - Complaint                                       │
└────────────────────────────────────────────────────┘
```

---

## 3. 核心治理模块

### 3.1 pallet-stardust-appeals（申诉治理核心）

**功能定位**：通用申诉治理框架，支持多域申诉流程

**核心特性**：
- ✅ 支持 7 个域（Grave、Deceased、Text、Media、Offerings、Park、Works）
- ✅ 动态押金机制（根据用户信誉、内容重要性调整）
- ✅ 公示期保护机制（给对象所有者应答机会）
- ✅ 自动执行机制（公示期到期后自动执行）
- ✅ 押金管理（使用 Holds API）
- ✅ 限频控制（防止恶意申诉刷屏）
- ✅ 应答自动否决（对象所有者及时应答可自动否决申诉）

**治理流程**：
```
提交申诉 → 委员会审批 → 公示期 → 自动执行/自动否决
   ↓           ↓            ↓
 押金锁定    批准/驳回    执行/撤销
```

**关键接口**：
- `submit_appeal()`: 提交申诉
- `approve_appeal()`: 批准申诉
- `reject_appeal()`: 驳回申诉
- `withdraw_appeal()`: 撤回申诉
- `submit_work_complaint()`: 提交作品投诉（Domain 7）

### 3.2 pallet-deceased/governance（逝者拥有者治理）

**功能定位**：逝者拥有者操作投诉治理机制

**核心特性**：
- ✅ 永久质押押金模式（创建逝者时锁定押金）
- ✅ USDT 计价系统（避免 DUST 价格波动）
- ✅ 无操作押金（拥有者日常增删改无需额外押金）
- ✅ 押金池扣款（投诉成功从质押押金扣除）
- ✅ 自动权限控制（押金不足时限制操作）

**治理流程**：
```
创建逝者 → 锁定押金 → 拥有者操作 → 可被投诉 → 投诉审核 → 押金扣除/退还
```

**关键接口**：
- `owner_execute_operation()`: 拥有者执行操作
- `complain_owner_operation()`: 投诉拥有者操作
- `review_owner_complaint()`: 审核投诉
- `non_owner_execute_operation()`: 非拥有者执行操作（需押金）
- `auto_finalize_operation()`: 自动确认操作（30天后无投诉）

### 3.3 pallet-democracy（民主投票）

**功能定位**：生态级民主投票系统

**核心特性**：
- ✅ 提案创建与投票
- ✅ 多数投票机制
- ✅ 投票权重计算
- ✅ 提案执行管理

**治理场景**：
- 参数调整提案（押金、费率、阈值等）
- 资金分配提案（国库资金使用）
- 功能升级提案（新功能上线）
- 紧急治理提案（安全漏洞修复）

### 3.4 pallet-referenda（公投系统）

**功能定位**：高级公投机制，支持复杂投票策略

**核心特性**：
- ✅ 多种投票类型（单选、多选、排序等）
- ✅ 投票权重聚合（代币、锁仓、NFT、信誉）
- ✅ 提案生命周期管理
- ✅ 自动执行机制

**治理场景**：
- 重大决策公投（协议升级、资金分配）
- 参数调整公投（押金倍数、费率等）
- 社区提案公投（新功能、新规则）

### 3.5 pallet-arbitration（仲裁）

**功能定位**：争议仲裁机制

**核心特性**：
- ✅ 争议提交与处理
- ✅ 仲裁员选择机制
- ✅ 仲裁结果执行
- ✅ 仲裁费用管理

**治理场景**：
- 复杂争议仲裁（申诉机制无法解决的争议）
- 跨域争议仲裁（涉及多个域的争议）
- 高价值争议仲裁（涉及大额资金的争议）

### 3.6 pallet-treasury（国库管理）

**功能定位**：资金管理与分配

**核心特性**：
- ✅ 资金存储与管理
- ✅ 支出审批机制
- ✅ 资金审计追踪
- ✅ 多签保护机制

**治理场景**：
- 国库资金支出（开发、运营、奖励等）
- 收益分配（平台收益、治理奖励等）
- 紧急资金使用（安全漏洞修复等）

---

## 4. 治理流程设计

### 4.1 内容治理流程

```
┌─────────────────────────────────────────────────────────┐
│              内容治理完整流程                            │
└─────────────────────────────────────────────────────────┘

1. 内容创建/修改
   │
   ├─→ 拥有者操作 → 无需押金（已有永久质押）
   │                │
   │                └─→ 可被投诉（无限期）
   │
   └─→ 非拥有者操作 → 需押金（2 USDT）
                      │
                      └─→ 可被投诉（30天内）

2. 投诉提交
   │
   ├─→ 最小押金：5 USDT
   │
   └─→ 投诉理由 + 证据（IPFS CID）

3. 投诉审核
   │
   ├─→ 委员会审核
   │   │
   │   ├─→ 投诉成立 → 撤销操作 + 押金分配
   │   │              │
   │   │              ├─→ 80% 投诉人
   │   │              └─→ 20% 委员会
   │   │
   │   └─→ 投诉不成立 → 退还投诉押金
   │                    │
   │                    ├─→ 80% 拥有者
   │                    └─→ 20% 委员会

4. 自动确认
   │
   └─→ 30天无投诉 → 自动确认操作 + 退还押金
```

### 4.2 生态治理流程

```
┌─────────────────────────────────────────────────────────┐
│              生态治理完整流程                            │
└─────────────────────────────────────────────────────────┘

1. 提案创建
   │
   ├─→ 满足门槛条件（代币持有量、信誉等）
   │
   └─→ 提交提案（描述 + 执行动作 + IPFS 文档）

2. 提案审核
   │
   ├─→ 委员会预审核（可选）
   │
   └─→ 进入投票期

3. 投票阶段
   │
   ├─→ 投票延迟期（防止闪电操控）
   │
   ├─→ 投票期（6天）
   │   │
   │   ├─→ 支持/反对/弃权
   │   │
   │   └─→ 投票权重计算（代币 + 锁仓 + NFT + 信誉）
   │
   └─→ 投票结束

4. 提案执行
   │
   ├─→ 投票通过 → 进入 Timelock 队列
   │   │
   │   ├─→ 延迟执行期（2天审查期）
   │   │
   │   └─→ 自动执行
   │
   └─→ 投票未通过 → 提案失效
```

### 4.3 争议解决流程

```
┌─────────────────────────────────────────────────────────┐
│              争议解决完整流程                            │
└─────────────────────────────────────────────────────────┘

1. 争议产生
   │
   ├─→ 申诉机制无法解决
   │
   └─→ 涉及大额资金或复杂情况

2. 仲裁申请
   │
   ├─→ 提交仲裁申请（争议描述 + 证据）
   │
   └─→ 支付仲裁费用

3. 仲裁员选择
   │
   ├─→ 随机选择仲裁员（3-5名）
   │
   └─→ 仲裁员审查争议

4. 仲裁裁决
   │
   ├─→ 多数仲裁员投票
   │
   └─→ 执行仲裁结果

5. 结果执行
   │
   └─→ 自动执行仲裁结果（资金分配、操作撤销等）
```

---

## 5. 治理机制整合

### 5.1 统一治理接口

**目标**：为前端提供统一的治理接口，简化调用逻辑

```rust
/// 统一治理接口 Trait
pub trait UnifiedGovernance<T: Config> {
    /// 提交治理请求（自动路由到对应模块）
    fn submit_governance_request(
        request_type: GovernanceRequestType,
        params: GovernanceParams,
    ) -> DispatchResult;
    
    /// 查询治理状态
    fn get_governance_status(
        request_id: u64,
    ) -> Option<GovernanceStatus>;
    
    /// 执行治理操作
    fn execute_governance_action(
        request_id: u64,
    ) -> DispatchResult;
}

/// 治理请求类型
pub enum GovernanceRequestType {
    /// 内容申诉
    ContentAppeal { domain: u8, target: u64, action: u8 },
    /// 拥有者操作投诉
    OwnerOperationComplaint { operation_id: u64 },
    /// 生态提案
    EcosystemProposal { proposal_id: u64 },
    /// 争议仲裁
    DisputeArbitration { dispute_id: u64 },
}
```

### 5.2 治理状态统一管理

**目标**：统一管理所有治理请求的状态，便于前端展示

```rust
/// 统一治理状态
#[derive(Encode, Decode, Clone, PartialEq, Eq, RuntimeDebug, TypeInfo)]
pub enum UnifiedGovernanceStatus {
    /// 已提交
    Submitted,
    /// 审核中
    UnderReview,
    /// 已批准
    Approved,
    /// 已驳回
    Rejected,
    /// 公示中
    InNoticePeriod,
    /// 已执行
    Executed,
    /// 已撤销
    Revoked,
    /// 已过期
    Expired,
}
```

### 5.3 治理事件统一发布

**目标**：统一发布治理事件，便于前端监听和索引

```rust
/// 统一治理事件
#[pallet::event]
pub enum UnifiedGovernanceEvent<T: Config> {
    /// 治理请求已提交
    GovernanceRequestSubmitted {
        request_id: u64,
        request_type: GovernanceRequestType,
        submitter: T::AccountId,
    },
    /// 治理请求状态变更
    GovernanceRequestStatusChanged {
        request_id: u64,
        old_status: UnifiedGovernanceStatus,
        new_status: UnifiedGovernanceStatus,
    },
    /// 治理请求已执行
    GovernanceRequestExecuted {
        request_id: u64,
        executor: T::AccountId,
    },
}
```

---

## 6. 治理优化建议

### 6.1 当前治理机制分析

#### ✅ 优势

1. **模块化设计**：各治理模块职责清晰，低耦合
2. **功能完整**：覆盖内容、用户、生态、争议等各个层面
3. **机制成熟**：基于 Substrate 官方模块扩展，稳定可靠
4. **押金机制**：有效防止恶意操作和滥用

#### ⚠️ 待优化点

1. **缺乏统一接口**：各治理模块接口不统一，前端调用复杂
2. **状态管理分散**：治理状态分散在各模块，难以统一查询
3. **事件格式不统一**：各模块事件格式不一致，前端处理复杂
4. **治理流程不清晰**：缺乏统一的治理流程文档和指引
5. **治理参数分散**：押金、费率等参数分散在各模块，难以统一管理

### 6.2 优化方案

#### 方案1：创建统一治理协调模块

**目标**：创建 `pallet-unified-governance` 作为治理协调中心

**功能**：
- 统一治理接口封装
- 治理请求路由分发
- 治理状态统一管理
- 治理事件统一发布
- 治理参数统一配置

**优势**：
- 前端调用简化
- 治理流程清晰
- 状态管理统一
- 便于扩展和维护

**实施难度**：⭐⭐⭐（中等）

#### 方案2：治理参数集中管理

**目标**：创建 `pallet-governance-params` 集中管理所有治理参数

**功能**：
- 押金参数管理（基础押金、最小押金、最大押金等）
- 费率参数管理（投诉费率、仲裁费率等）
- 期限参数管理（公示期、投票期、执行延迟等）
- 阈值参数管理（提案门槛、投票门槛等）

**优势**：
- 参数调整统一
- 便于治理投票
- 参数审计清晰

**实施难度**：⭐⭐（较低）

#### 方案3：治理仪表盘

**目标**：创建治理仪表盘，统一展示所有治理活动

**功能**：
- 治理请求列表（按类型、状态筛选）
- 治理统计信息（成功率、平均处理时间等）
- 治理参数展示（当前押金、费率等）
- 治理历史记录（所有治理活动）

**优势**：
- 治理透明度提升
- 用户体验改善
- 便于审计和分析

**实施难度**：⭐⭐（较低，主要是前端工作）

### 6.3 优先级建议

| 优化方案 | 优先级 | 实施难度 | 预期收益 |
|---------|--------|---------|---------|
| **治理参数集中管理** | 🔥 高 | ⭐⭐ | ⭐⭐⭐⭐⭐ |
| **治理仪表盘** | 🔥 高 | ⭐⭐ | ⭐⭐⭐⭐ |
| **统一治理协调模块** | ⚡ 中 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## 7. 实施路线图

### 阶段1：治理核心化基础（1-2周）

**目标**：明确治理核心地位，完善治理文档

**任务**：
- ✅ 创建治理核心化设计文档（本文档）
- ✅ 梳理现有治理模块和功能
- ✅ 分析治理机制优缺点
- ✅ 制定治理优化方案

**交付物**：
- 治理核心化设计文档
- 治理模块功能清单
- 治理优化建议报告

### 阶段2：治理参数集中管理（2-3周）

**目标**：创建治理参数管理模块，集中管理所有治理参数

**任务**：
- 创建 `pallet-governance-params` 模块
- 迁移现有参数到新模块
- 实现参数查询和更新接口
- 添加参数变更治理投票机制

**交付物**：
- `pallet-governance-params` 模块
- 参数迁移脚本
- 参数管理接口文档

### 阶段3：治理仪表盘开发（2-3周）

**目标**：开发治理仪表盘，统一展示治理活动

**任务**：
- 设计治理仪表盘 UI/UX
- 实现治理请求列表组件
- 实现治理统计信息组件
- 实现治理参数展示组件
- 实现治理历史记录组件

**交付物**：
- 治理仪表盘前端页面
- 治理数据查询 API
- 治理仪表盘使用文档

### 阶段4：统一治理协调模块（3-4周）

**目标**：创建统一治理协调模块，简化前端调用

**任务**：
- 创建 `pallet-unified-governance` 模块
- 实现统一治理接口
- 实现治理请求路由分发
- 实现治理状态统一管理
- 实现治理事件统一发布

**交付物**：
- `pallet-unified-governance` 模块
- 统一治理接口文档
- 前端集成指南

### 阶段5：治理机制优化（持续）

**目标**：持续优化治理机制，提升治理效率和用户体验

**任务**：
- 优化押金计算算法
- 优化投票权重计算
- 优化治理流程
- 收集用户反馈并改进

**交付物**：
- 治理机制优化报告
- 用户反馈分析报告
- 持续改进计划

---

## 8. 总结

### 8.1 核心要点

1. **治理是 Stardust 的核心**：所有功能模块都应围绕治理机制构建
2. **三层治理架构**：内容治理 → 用户治理 → 生态治理
3. **统一治理接口**：简化前端调用，提升用户体验
4. **治理参数集中管理**：便于调整和审计
5. **治理仪表盘**：提升治理透明度和可观测性

### 8.2 下一步行动

1. **立即行动**：
   - 完善治理文档和流程说明
   - 创建治理参数管理模块
   - 开发治理仪表盘

2. **短期目标**（1-2个月）：
   - 完成治理参数集中管理
   - 完成治理仪表盘开发
   - 优化现有治理流程

3. **长期目标**（3-6个月）：
   - 完成统一治理协调模块
   - 持续优化治理机制
   - 建立治理社区和反馈机制

---

## 9. 附录

### 9.1 治理模块清单

| 模块名称 | 功能定位 | 状态 | 优先级 |
|---------|---------|------|--------|
| `pallet-stardust-appeals` | 申诉治理核心 | ✅ 已实现 | 🔥 高 |
| `pallet-deceased/governance` | 逝者拥有者治理 | ✅ 已实现 | 🔥 高 |
| `pallet-democracy` | 民主投票 | ✅ 已实现 | ⚡ 中 |
| `pallet-referenda` | 公投系统 | ✅ 已实现 | ⚡ 中 |
| `pallet-arbitration` | 仲裁 | ✅ 已实现 | ⚡ 中 |
| `pallet-treasury` | 国库管理 | ✅ 已实现 | 🔥 高 |
| `pallet-governance-params` | 参数管理 | ❌ 待开发 | 🔥 高 |
| `pallet-unified-governance` | 统一协调 | ❌ 待开发 | ⚡ 中 |

### 9.2 治理相关文档

- [逝者信息公众治理最优方案设计](./逝者信息公众治理最优方案设计.md)
- [逝者内容公众治理机制设计方案](./逝者内容公众治理机制设计方案.md)
- [pallet-stardust-appeals README](../pallets/stardust-appeals/README.md)
- [pallet-deceased README](../pallets/deceased/README.md)

### 9.3 治理参数参考

| 参数名称 | 当前值 | 建议值 | 说明 |
|---------|--------|--------|------|
| 基础申诉押金 | 20 DUST | 动态计算 | 根据用户信誉和内容重要性 |
| 最小投诉押金 | 5 USDT | 5 USDT | 投诉最小押金 |
| 公示期 | 7天 | 7天 | 申诉批准后的公示期 |
| 投票期 | 6天 | 6天 | 提案投票期 |
| 执行延迟 | 2天 | 2天 | 提案执行延迟期 |
| 投诉分配比例 | 80%/20% | 80%/20% | 投诉成功时投诉人/委员会分配 |

---

**文档版本**：v1.0.0  
**最后更新**：2025-01-XX  
**维护者**：Stardust 开发团队

