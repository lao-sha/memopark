# Stardust节点服务器存储配置需求

## 🎯 核心问题

**发起PIN（运营者节点）和不发起PIN（普通节点）的服务器，对存储有什么要求？**

---

## 📊 存储需求对比总览

| 节点类型 | 链上数据 | IPFS数据 | 总存储需求 | 增长速度 |
|---------|---------|---------|-----------|---------|
| **普通全节点** | ~100GB | 0 | **~100GB** | 慢 |
| **验证者节点** | ~100GB | 0 | **~100GB** | 慢 |
| **运营者节点** | ~100GB | **10TB+** | **~10TB+** ⚠️ | 快 |
| **归档节点** | ~500GB | 0 | **~500GB** | 中等 |

**关键差异**：运营者节点需要100倍以上的存储容量！

---

## 🔍 详细存储需求分析

### 1. 普通全节点（不发起PIN）

#### 链上数据存储

```
Substrate数据库结构：
~/.local/share/stardust-node/chains/dev/
├── db/                        # RocksDB数据库
│   ├── full/                  # 区块和状态
│   │   ├── parachains/       # 约50GB（1年后）
│   │   └── ...
│   └── ...
├── network/                   # 网络配置
│   └── secret_ed25519        # 节点密钥
└── keystore/                  # 本地密钥存储

总计：约100GB（运行1年后）
```

**存储需求明细**：

| 数据类型 | 大小（初始） | 大小（1年后） | 增长速度 |
|---------|-------------|--------------|---------|
| **区块数据** | 1GB | 50GB | ~140MB/天 |
| **状态数据** | 5GB | 40GB | ~100MB/天 |
| **索引数据** | 100MB | 5GB | ~15MB/天 |
| **网络数据** | 10MB | 100MB | ~250KB/天 |
| **日志数据** | 100MB | 5GB | ~15MB/天 |
| **总计** | **~6GB** | **~100GB** | **~270MB/天** |

**硬件推荐**：

```yaml
CPU: 2核心（Intel/AMD）
RAM: 8GB
存储: 200GB SSD（预留1年增长空间）
  - 类型：SSD（推荐NVMe）
  - IOPS：至少5000
  - 读写速度：至少500MB/s
网络: 100Mbps上下行
操作系统: Ubuntu 22.04 LTS
```

**成本估算**：
- 云服务器：$20-40/月（如阿里云ECS t5）
- 自建服务器：$300-500（一次性）

---

### 2. 验证者节点（不发起PIN）

#### 与普通全节点相同

**存储需求**：~100GB（1年后）

**额外要求**：
- ✅ 更高的CPU性能（共识计算）
- ✅ 更高的网络稳定性（99.9%在线率）
- ✅ 更大的RAM（16GB推荐）

**硬件推荐**：

```yaml
CPU: 4核心（推荐8核心）
RAM: 16GB（推荐32GB）
存储: 200GB NVMe SSD
  - 类型：NVMe SSD（必须）
  - IOPS：至少10000
  - 读写速度：至少1000MB/s
网络: 1Gbps上下行（稳定）
操作系统: Ubuntu 22.04 LTS
备用电源: UPS（推荐）
```

**成本估算**：
- 云服务器：$100-200/月（如AWS c5.2xlarge）
- 自建服务器：$1000-2000（一次性）

---

### 3. 运营者节点（发起PIN）⭐

#### A. 链上数据存储（同普通节点）

```
~/.local/share/stardust-node/chains/dev/
└── db/                        # ~100GB（1年后）
```

#### B. IPFS数据存储（核心差异）⭐

```
IPFS数据结构：
~/.ipfs/
├── blocks/                    # 实际文件块存储 ⭐
│   ├── 00/
│   │   ├── 0000...            # CID文件块
│   │   ├── 0001...
│   │   └── ...
│   ├── 01/
│   └── ...FF/                 # 256个子目录
│
├── datastore/                 # 元数据存储
│   └── SHARDING              # 约1GB
│
└── config                     # 配置文件

IPFS Cluster数据：
~/.ipfs-cluster/
├── state/                     # 集群状态
│   └── state.json            # 约100MB
└── raft/                      # Raft共识
    └── ...                   # 约1GB

总计：10TB+（取决于pin的内容数量）
```

**存储需求计算**：

假设运营者承诺10TB容量：

| 项目 | 大小 | 说明 |
|-----|------|------|
| **链上数据** | 100GB | Substrate数据库 |
| **IPFS blocks** | 9.8TB | 实际文件内容 ⭐ |
| **IPFS metadata** | 50GB | 索引和元数据 |
| **IPFS Cluster** | 10GB | 集群状态 |
| **操作系统** | 20GB | Ubuntu系统 |
| **日志备份** | 20GB | 日志和监控数据 |
| **预留空间** | 100GB | 缓冲区 |
| **总计** | **~10.1TB** | 实际需求 |

**建议配置**：12TB（20%冗余）

---

#### C. 运营者节点硬件推荐

```yaml
CPU: 8核心（推荐16核心）
  - 用途：IPFS数据处理、加密解密
RAM: 32GB（推荐64GB）
  - 用途：IPFS缓存、区块链状态
  
存储（分层配置）⭐:
  1. 系统盘：200GB NVMe SSD
     - Substrate数据库
     - IPFS metadata
     - 操作系统
     
  2. 数据盘：12TB HDD/SSD（根据预算）
     - IPFS blocks存储
     - 选项A：HDD RAID10（推荐）⭐
     - 选项B：SSD（高性能）
     - 选项C：混合存储（NVMe缓存 + HDD）

存储性能要求:
  - 系统盘IOPS: 10000+
  - 数据盘IOPS: 1000+ (HDD) / 5000+ (SSD)
  - 顺序读写: 200MB/s+ (HDD) / 500MB/s+ (SSD)
  
网络: 1Gbps上下行（必须）
  - 用途：IPFS内容分发
  - 月度流量：约5-10TB
  
操作系统: Ubuntu 22.04 LTS
备用电源: UPS（必须）
```

**成本估算**：

| 方案 | 配置 | 一次性成本 | 月度成本 | 适用场景 |
|-----|------|-----------|---------|---------|
| **云服务器** | 8C32G + 12TB HDD | - | $200-400 | 测试/小规模 |
| **自建服务器（HDD）** | 8C32G + 4×4TB RAID10 | $2000-3000 | $50（电费） | 生产环境 ⭐ |
| **自建服务器（SSD）** | 8C32G + 2×8TB SSD | $5000-8000 | $50（电费） | 高性能场景 |

---

### 4. 归档节点（不发起PIN）

#### 存储所有历史状态

```
~/.local/share/stardust-node/chains/dev/
├── db/
│   └── full/                  # 完整历史状态
│       ├── parachains/       # ~300GB（1年后）
│       └── state/            # ~200GB（1年后）
└── ...

总计：约500GB（1年后）
```

**硬件推荐**：

```yaml
CPU: 4核心
RAM: 16GB
存储: 1TB NVMe SSD（预留增长空间）
网络: 500Mbps上下行
```

**成本估算**：
- 云服务器：$80-150/月
- 自建服务器：$800-1500（一次性）

---

## 📈 存储增长预测

### 链上数据增长曲线

```
假设区块时间：6秒
每日区块数：14,400
平均区块大小：10KB

每日增长：14,400 × 10KB ≈ 140MB
每月增长：140MB × 30 ≈ 4.2GB
每年增长：4.2GB × 12 ≈ 50GB
```

| 时间 | 普通节点 | 验证者节点 | 归档节点 |
|-----|---------|-----------|---------|
| **1个月** | 10GB | 10GB | 15GB |
| **6个月** | 35GB | 35GB | 100GB |
| **1年** | 60GB | 60GB | 300GB |
| **2年** | 110GB | 110GB | 600GB |

---

### IPFS数据增长曲线（运营者节点）

```
假设：
- 每日新增CID：100个
- 平均文件大小：100MB
- 运营者承担3副本中的1个

每日增长：100 × 100MB × (1/3) ≈ 3.3GB
每月增长：3.3GB × 30 ≈ 100GB
每年增长：100GB × 12 ≈ 1.2TB
```

| 时间 | IPFS存储增长 | 累计存储 |
|-----|-------------|---------|
| **1个月** | 100GB | 100GB |
| **6个月** | 600GB | 700GB |
| **1年** | 1.2TB | 1.9TB |
| **2年** | 2.4TB | 4.3TB |
| **5年** | 6TB | 10.3TB ⭐ |

**结论**：运营者节点5年后需要约10TB存储

---

## 💾 存储方案选择

### 方案A：纯HDD（经济型）⭐

**配置**：
```yaml
系统盘: 200GB NVMe SSD
数据盘: 4×4TB HDD RAID10 = 8TB可用

成本: $300（HDD） + $200（SSD） = $500
性能: 
  - 顺序读写：200MB/s
  - IOPS：150-200
  - 适合大文件存储
```

**优点**：
- ✅ 成本最低（$0.06/GB）
- ✅ 容量大
- ✅ RAID10提供冗余

**缺点**：
- ⚠️ IOPS较低
- ⚠️ 小文件性能一般

**适用场景**：
- 预算有限
- 主要存储大文件（视频、高清图片）
- 对延迟要求不高

---

### 方案B：纯SSD（高性能）

**配置**：
```yaml
系统盘: 200GB NVMe SSD
数据盘: 2×8TB SATA SSD RAID1 = 8TB可用

成本: $2000（SSD×2） + $200（系统盘） = $2200
性能: 
  - 顺序读写：500MB/s
  - IOPS：5000+
  - 适合所有场景
```

**优点**：
- ✅ 性能最强
- ✅ 低延迟
- ✅ 适合高并发

**缺点**：
- ❌ 成本高（$0.27/GB）
- ⚠️ 容量受限

**适用场景**：
- 预算充足
- 高性能要求
- 大量小文件

---

### 方案C：混合存储（平衡型）⭐

**配置**：
```yaml
系统盘: 200GB NVMe SSD
热数据缓存: 1TB NVMe SSD（IPFS缓存）
冷数据存储: 4×4TB HDD RAID10 = 8TB可用

成本: $300（HDD） + $400（SSD） = $700
性能: 
  - 热数据：1000MB/s（NVMe）
  - 冷数据：200MB/s（HDD）
  - 智能分层
```

**IPFS缓存配置**：
```json
// ~/.ipfs/config
{
  "Datastore": {
    "StorageMax": "1TB",        // NVMe缓存
    "BloomFilterSize": 1048576,
    "GCPeriod": "1h",
    "Spec": {
      "mounts": [
        {
          "mountpoint": "/blocks",
          "path": "blocks",
          "shardFunc": "/repo/flatfs/shard/v1/next-to-last/2",
          "type": "flatfs"
        },
        {
          "mountpoint": "/cold",
          "path": "/mnt/cold-storage/ipfs",  // HDD
          "type": "flatfs"
        }
      ],
      "type": "mount"
    }
  }
}
```

**优点**：
- ✅ 性能好（热数据快速访问）
- ✅ 成本适中（$0.09/GB）
- ✅ 容量大

**缺点**：
- ⚠️ 配置复杂
- ⚠️ 需要手动分层管理

**适用场景**：
- 平衡性能和成本 ⭐
- 大部分运营者的最佳选择

---

## 🔧 存储配置最佳实践

### 1. 文件系统选择

| 文件系统 | 适用场景 | 优点 | 缺点 |
|---------|---------|------|------|
| **ext4** | 通用 | 稳定、成熟 | 性能一般 |
| **XFS** | 大文件 | 大文件性能好 ⭐ | 小文件一般 |
| **Btrfs** | 高级功能 | 快照、压缩 | 稳定性待提升 |
| **ZFS** | 企业级 | 数据完整性强 | 内存占用大 |

**推荐**：
- 系统盘：ext4
- IPFS数据盘：XFS ⭐

---

### 2. RAID配置

| RAID级别 | 冗余性 | 可用容量 | 适用场景 |
|---------|-------|---------|---------|
| **RAID0** | ❌ 无 | 100% | 测试环境 |
| **RAID1** | ✅ 高 | 50% | 系统盘 |
| **RAID5** | ✅ 中 | (n-1)/n | 3+盘HDD |
| **RAID10** | ✅✅ 高 | 50% | 生产环境 ⭐ |

**推荐**：
- 4×4TB HDD RAID10 = 8TB可用 ⭐
- 或 3×6TB HDD RAID5 = 12TB可用

---

### 3. 监控和告警

```bash
# 磁盘空间监控
df -h | grep -E 'ipfs|substrate'

# 推荐配置告警
监控项：
- 链上数据：>80%时告警
- IPFS数据：>85%时告警
- IOPS使用率：>70%时告警
- 磁盘健康：SMART检查
```

---

## 📊 成本效益对比

### 10TB存储5年TCO（Total Cost of Ownership）

| 方案 | 初始成本 | 年度成本 | 5年总成本 | 单位成本 |
|-----|---------|---------|-----------|---------|
| **云服务（HDD）** | $0 | $2400 | $12,000 | $1.20/GB |
| **云服务（SSD）** | $0 | $4800 | $24,000 | $2.40/GB |
| **自建（HDD RAID10）** | $2500 | $300 | $4,000 | $0.40/GB ⭐ |
| **自建（SSD RAID1）** | $5000 | $300 | $6,500 | $0.65/GB |
| **自建（混合）** | $3500 | $300 | $5,000 | $0.50/GB |

**结论**：自建服务器5年TCO仅为云服务的1/3 ⭐

---

## ✅ 推荐配置总结

### 普通全节点（不发起PIN）

```yaml
最低配置:
  CPU: 2核心
  RAM: 4GB
  存储: 100GB SSD
  网络: 100Mbps
  成本: $15-30/月（云） / $200（自建）

推荐配置:
  CPU: 4核心
  RAM: 8GB
  存储: 200GB NVMe SSD
  网络: 500Mbps
  成本: $30-60/月（云） / $400（自建）
```

---

### 验证者节点（不发起PIN）

```yaml
推荐配置:
  CPU: 8核心
  RAM: 32GB
  存储: 500GB NVMe SSD
  网络: 1Gbps
  UPS: 必须
  成本: $150-300/月（云） / $1500（自建）
```

---

### 运营者节点（发起PIN）⭐

```yaml
推荐配置（混合存储）:
  CPU: 16核心
  RAM: 64GB
  
  存储:
    系统盘: 200GB NVMe SSD
    缓存盘: 1TB NVMe SSD
    数据盘: 4×4TB HDD RAID10 (8TB可用)
  
  网络: 1Gbps（必须）
  UPS: 必须
  
  成本: 
    云服务: $300-500/月
    自建: $3500（一次性） + $50/月（电费）
    
  5年TCO: 
    云服务: $18,000-30,000
    自建: $6,500 ⭐ 节省70%
```

---

### 归档节点（不发起PIN）

```yaml
推荐配置:
  CPU: 8核心
  RAM: 32GB
  存储: 2TB NVMe SSD
  网络: 1Gbps
  成本: $150-300/月（云） / $1500（自建）
```

---

## 🎯 关键要点

### 1. 存储需求差异巨大

```
普通节点:     ~100GB（1年）
运营者节点:   ~10TB（5年）

差异: 100倍 ⭐
```

### 2. 成本差异显著

```
普通节点云成本:   $30/月
运营者节点云成本: $400/月

差异: 13倍 ⚠️
```

### 3. 自建服务器优势明显

```
5年TCO:
云服务: $24,000
自建:   $6,500

节省: 73% ⭐
```

### 4. 运营者节点建议自建

**理由**：
- ✅ 长期成本低70%+
- ✅ 完全控制硬件
- ✅ 灵活扩容
- ✅ 无带宽限制

---

**总结：普通节点仅需100GB存储，运营者节点需要10TB+存储，建议自建服务器以降低长期成本！** 🚀

