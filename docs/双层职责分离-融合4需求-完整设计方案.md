# åŒå±‚èŒè´£åˆ†ç¦»ï¼šèåˆ4éœ€æ±‚å®Œæ•´è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

**æ ¸å¿ƒç†å¿µ**: ä¿ç•™åŒå±‚ownerï¼Œæ˜ç¡®èŒè´£åˆ†å·¥ï¼Œå¼ºåŒ–é€è€…owneræƒåˆ©ä¿æŠ¤ï¼Œå»ºç«‹å¢“ä½æ°‘ä¸»æ²»ç†

**è®¾è®¡æ—¶é—´**: 2025-10-24  
**ä¼˜å…ˆçº§**: P0ï¼ˆæ ¸å¿ƒæ¶æ„é‡æ„ï¼‰  
**ç‰ˆæœ¬**: v2.0 - èåˆç‰ˆ

### è®¾è®¡åŸåˆ™

```
1. åŒå±‚Ownerä¿ç•™åŸåˆ™
   â†’ å¢“ä½ownerï¼ˆå¢“ä¸»ï¼‰ï¼šç®¡ç†å¢“ä½åŸºç¡€è®¾æ–½
   â†’ é€è€…ownerï¼šç®¡ç†é€è€…å†…å®¹ï¼Œæƒåˆ©å—ä¿æŠ¤

2. èŒè´£æ˜ç¡®åŸåˆ™
   â†’ å¢“ä½å±‚ï¼šåŸºç¡€è®¾æ–½ã€å‡†å…¥ã€æ²»ç†
   â†’ é€è€…å±‚ï¼šå†…å®¹ç®¡ç†ã€å…³ç³»ã€è¿ç§»

3. é€è€…Ownerä¼˜å…ˆåŸåˆ™
   â†’ æ¶‰åŠé€è€…çš„äº‹åŠ¡ï¼Œé€è€…owneræ‹¥æœ‰æœ€ç»ˆå†³ç­–æƒ
   â†’ å¢“ä¸»ä¸å¯å¼ºåˆ¶å¹²é¢„é€è€…owneræƒåˆ©

4. æ°‘ä¸»æ²»ç†åŸåˆ™
   â†’ é€è€…ownerå¯å‚ä¸å¢“ä½é‡å¤§äº‹åŠ¡å†³ç­–
   â†’ é€šè¿‡æŠ•ç¥¨åˆ¶è¡¡å¢“ä¸»æƒåŠ›

5. è‡ªæ„¿åä½œåŸåˆ™
   â†’ å¢“ä¸»ä¸é€è€…owneråŸºäºåå•†åˆä½œ
   â†’ åŒæ–¹æƒåˆ©å¹³ç­‰ï¼Œç›¸äº’å°Šé‡
```

---

## ğŸ—ï¸ å®Œæ•´æƒé™æ¶æ„

### 1. ä¸‰å±‚æƒé™æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å›­åŒºå±‚ (Park)                            â”‚
â”‚  - å›­åŒºç®¡ç†å‘˜ï¼šç®¡ç†å›­åŒºä¸‹æ‰€æœ‰å¢“ä½                             â”‚
â”‚  - æƒåŠ›å—é™ï¼šä¸æ¶‰åŠé€è€…å†…å®¹ç®¡ç†                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¢“ä½å±‚ (Grave)                           â”‚
â”‚                                                              â”‚
â”‚  å¢“ä½Ownerï¼ˆå¢“ä¸»ï¼‰ï¼š                                          â”‚
â”‚    èŒè´£ï¼š                                                     â”‚
â”‚    â”œâ”€ ç®¡ç†å¢“ä½åŸºç¡€è®¾æ–½ï¼ˆå°é¢ã€éŸ³ä¹ã€è£…é¥°ï¼‰                     â”‚
â”‚    â”œâ”€ è®¾ç½®å‡†å…¥ç­–ç•¥ï¼ˆè°å¯ä»¥è¿å…¥ï¼‰                              â”‚
â”‚    â”œâ”€ æ·»åŠ /ç§»é™¤å¢“ä½ç®¡ç†å‘˜                                     â”‚
â”‚    â”œâ”€ å‘èµ·å¢“ä½è½¬è®©ï¼ˆéœ€æ±‚1ï¼šå¿…é¡»å…ˆæ¸…ç©ºï¼‰                       â”‚
â”‚    â””â”€ å‘èµ·æ²»ç†ææ¡ˆï¼ˆéœ€æ±‚4ï¼šé‡å¤§äº‹é¡¹éœ€æŠ•ç¥¨ï¼‰                   â”‚
â”‚                                                              â”‚
â”‚    é™åˆ¶ï¼š                                                     â”‚
â”‚    â”œâ”€ âŒ ä¸èƒ½å¼ºåˆ¶æ›¿æ¢é€è€…ownerï¼ˆéœ€æ±‚2ï¼‰                       â”‚
â”‚    â”œâ”€ âŒ ä¸èƒ½å¼ºåˆ¶è¿ç§»é€è€…ï¼ˆéœ€æ±‚3ï¼‰                            â”‚
â”‚    â””â”€ âš ï¸ é‡å¤§äº‹é¡¹éœ€é€è€…owneræŠ•ç¥¨é€šè¿‡ï¼ˆéœ€æ±‚4ï¼‰                 â”‚
â”‚                                                              â”‚
â”‚  å¢“ä½Adminsï¼ˆå¢“ä½ç®¡ç†å‘˜ï¼‰ï¼š                                   â”‚
â”‚    èŒè´£ï¼š                                                     â”‚
â”‚    â”œâ”€ è¾…åŠ©ç®¡ç†å¢“ä½åŸºç¡€è®¾æ–½                                    â”‚
â”‚    â””â”€ å‚ä¸å¢“ä½æ²»ç†æŠ•ç¥¨ï¼ˆå¦‚æœå¯ç”¨ï¼‰                            â”‚
â”‚                                                              â”‚
â”‚  å¢“ä½æ²»ç†ï¼ˆGovernanceï¼Œéœ€æ±‚4ï¼‰ï¼š                              â”‚
â”‚    æŠ•ç¥¨äººï¼š                                                   â”‚
â”‚    â”œâ”€ å¢“ä¸»ï¼ˆ1ç¥¨ï¼‰                                            â”‚
â”‚    â”œâ”€ å¢“ä½ç®¡ç†å‘˜ï¼ˆæ¯äºº1ç¥¨ï¼‰                                   â”‚
â”‚    â””â”€ å¢“ä½å†…æ‰€æœ‰é€è€…ownerï¼ˆæ¯äºº1ç¥¨ï¼Œä¸€äººä¸€ç¥¨ï¼‰                â”‚
â”‚                                                              â”‚
â”‚    æ²»ç†äº‹é¡¹ï¼š                                                 â”‚
â”‚    â”œâ”€ æ™®é€šäº‹é¡¹ï¼ˆç®€å•å¤šæ•°>50%ï¼‰ï¼šå°é¢ã€éŸ³ä¹ã€ç®¡ç†å‘˜             â”‚
â”‚    â””â”€ é‡å¤§äº‹é¡¹ï¼ˆè¶…çº§å¤šæ•°â‰¥67%ï¼‰ï¼šå¢“ä½è½¬è®©ã€å‡†å…¥ç­–ç•¥            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é€è€…å±‚ (Deceased)                        â”‚
â”‚                                                              â”‚
â”‚  é€è€…Ownerï¼ˆé€è€…èµ„æ–™ç®¡ç†è€…ï¼‰ï¼š                                â”‚
â”‚    æƒåŠ›ï¼š                                                     â”‚
â”‚    â”œâ”€ ä¿®æ”¹é€è€…èµ„æ–™ï¼ˆå§“åã€æ—¥æœŸã€æ€§åˆ«ç­‰ï¼‰                       â”‚
â”‚    â”œâ”€ è®¾ç½®é€è€…ä¸»å›¾                                            â”‚
â”‚    â”œâ”€ ç®¡ç†é€è€…å…³ç³»ï¼ˆäº²å±ã€é…å¶ç­‰ï¼‰                            â”‚
â”‚    â”œâ”€ ç®¡ç†äº²å‹å›¢ï¼ˆæ·»åŠ /ç§»é™¤ã€è®¾ç½®è§’è‰²ï¼‰                       â”‚
â”‚    â”œâ”€ è½¬è®©é€è€…ownerç»™ä»–äººï¼ˆéœ€æ±‚2ï¼šä»…æœ¬äººå¯è½¬è®©ï¼‰              â”‚
â”‚    â”œâ”€ è¿ç§»é€è€…åˆ°å…¶ä»–å¢“ä½ï¼ˆéœ€æ±‚3ï¼šä»…æœ¬äººå¯è¿ç§»ï¼‰               â”‚
â”‚    â””â”€ æŠ•ç¥¨ç®¡ç†å¢“ä½äº‹åŠ¡ï¼ˆéœ€æ±‚4ï¼šå‚ä¸æ²»ç†ï¼‰                     â”‚
â”‚                                                              â”‚
â”‚    é™åˆ¶ï¼š                                                     â”‚
â”‚    â””â”€ âŒ ä¸èƒ½ä¿®æ”¹å¢“ä½åŸºç¡€è®¾æ–½ï¼ˆå°é¢ã€éŸ³ä¹ç­‰ï¼‰                 â”‚
â”‚                                                              â”‚
â”‚  é€è€…Creatorï¼ˆåˆ›å»ºè€…ï¼‰ï¼š                                      â”‚
â”‚    â””â”€ å®¡è®¡ç”¨ï¼Œä¸å¯å˜ï¼Œæ— æƒé™                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç¤¾äº¤å±‚ (Friends)                         â”‚
â”‚  - çº¯ç¤¾äº¤åŠŸèƒ½ï¼Œæ— ç®¡ç†æƒé™                                     â”‚
â”‚  - Member/Core ä»…ç”¨äºåŒºåˆ†å…³ç³»äº²ç–                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æƒé™æ£€æŸ¥çŸ©é˜µ

| æ“ä½œ | å¢“ä¸» | å¢“ä½ç®¡ç†å‘˜ | é€è€…Owner | å›­åŒºç®¡ç†å‘˜ |
|------|------|-----------|----------|-----------|
| **å¢“ä½å±‚æ“ä½œ** ||||| 
| è®¾ç½®å¢“ä½å°é¢/éŸ³ä¹ | âœ… æˆ–éœ€æŠ•ç¥¨ | âœ… æˆ–éœ€æŠ•ç¥¨ | æŠ•ç¥¨æƒ | âœ… |
| æ·»åŠ å¢“ä½ç®¡ç†å‘˜ | âœ… æˆ–éœ€æŠ•ç¥¨ | âŒ | æŠ•ç¥¨æƒ | âœ… |
| ç§»é™¤å¢“ä½ç®¡ç†å‘˜ | âœ… æˆ–éœ€æŠ•ç¥¨ | âŒ | æŠ•ç¥¨æƒ | âœ… |
| è®¾ç½®å‡†å…¥ç­–ç•¥ | âœ… æˆ–éœ€æŠ•ç¥¨ | âŒ | æŠ•ç¥¨æƒ | âœ… |
| è½¬è®©å¢“ä½ | âœ… éœ€æŠ•ç¥¨+æ¸…ç©º | âŒ | æŠ•ç¥¨æƒ | âŒ |
| **é€è€…å±‚æ“ä½œ** |||||
| åˆ›å»ºé€è€… | âœ… | âœ… | N/A | âœ… |
| ä¿®æ”¹é€è€…èµ„æ–™ | âŒ | âŒ | âœ… | âŒ |
| è®¾ç½®é€è€…ä¸»å›¾ | âŒ | âŒ | âœ… | âŒ |
| ç®¡ç†é€è€…å…³ç³» | âŒ | âŒ | âœ… | âŒ |
| è½¬è®©é€è€…owner | âŒ | âŒ | âœ… | âŒ |
| è¿ç§»é€è€…åˆ°å…¶ä»–å¢“ä½ | âŒ | âŒ | âœ… | âŒ |
| **æ²»ç†æ“ä½œ** |||||
| å‘èµ·æ²»ç†ææ¡ˆ | âœ… | âœ… | âœ… | âŒ |
| æŠ•ç¥¨æ²»ç†ææ¡ˆ | âœ… | âœ… | âœ… | âŒ |

**å…³é”®è¯´æ˜**ï¼š
- "æˆ–éœ€æŠ•ç¥¨"ï¼šå–å†³äºå¢“ä½æ˜¯å¦å¯ç”¨æ²»ç†
- "æŠ•ç¥¨æƒ"ï¼šå¦‚æœæ²»ç†å¯ç”¨ï¼Œé€è€…ownerå¯å‚ä¸æŠ•ç¥¨
- "âœ… éœ€æŠ•ç¥¨+æ¸…ç©º"ï¼šè½¬è®©å¢“ä½éœ€è¦ä¸¤ä¸ªå‰ç½®æ¡ä»¶

---

## ğŸ’¾ æ•°æ®ç»“æ„è®¾è®¡

### 1. å¢“ä½ç»“æ„ï¼ˆGraveï¼‰- å¢å¼º

```rust
// pallets/stardust-grave/src/lib.rs

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šå¢“ä½è®°å½•ï¼ˆèåˆç‰ˆï¼‰
/// 
/// èŒè´£ï¼š
/// - ç‰©ç†è½½ä½“ç®¡ç†ï¼ˆä½ç½®ã€å°é¢ã€éŸ³ä¹ï¼‰
/// - åŸºç¡€æƒé™ç®¡ç†ï¼ˆownerã€adminsï¼‰
/// - å‡†å…¥ç­–ç•¥ç®¡ç†ï¼ˆè°å¯ä»¥è¿å…¥ï¼‰
/// - æ²»ç†ç­–ç•¥ç®¡ç†ï¼ˆæ˜¯å¦å¯ç”¨æŠ•ç¥¨ï¼‰
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen)]
#[scale_info(skip_type_params(T))]
pub struct Grave<T: Config> {
    /// å¢“ä¸»ï¼šå¢“ä½æ‰€æœ‰è€…
    pub owner: T::AccountId,
    
    /// æ‰€å±å›­åŒºï¼ˆå¯é€‰ï¼‰
    pub park_id: Option<T::ParkId>,
    
    /// ç®¡ç†å‘˜ç»„IDï¼ˆå¯é€‰ï¼Œæš‚æœªä½¿ç”¨ï¼‰
    pub admin_group: Option<u64>,
    
    /// å°é¢CID
    pub cover: BoundedVec<u8, T::CidLimit>,
    
    /// éŸ³ä¹CID
    pub audio: BoundedVec<u8, T::CidLimit>,
    
    /// åˆ›å»ºæ—¶é—´
    pub created_at: BlockNumberFor<T>,
    
    /// å¯è§æ€§
    pub visibility: GraveVisibility,
    
    /// â­ æ–°å¢ï¼šå‡†å…¥ç­–ç•¥ï¼ˆéœ€æ±‚3ï¼‰
    pub admission_policy: AdmissionPolicy,
    
    /// â­ æ–°å¢ï¼šæ²»ç†çŠ¶æ€ï¼ˆéœ€æ±‚4ï¼‰
    pub governance_enabled: bool,
}

/// â­ æ–°å¢ï¼šå¢“ä½å‡†å…¥ç­–ç•¥ï¼ˆéœ€æ±‚3ï¼‰
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen)]
pub enum AdmissionPolicy {
    /// ä»…å¢“ä¸»å¯æ·»åŠ é€è€…ï¼ˆé»˜è®¤ï¼‰
    GraveOwnerOnly,
    
    /// å…¬å¼€æ¥æ”¶ï¼Œä»»ä½•é€è€…owneréƒ½å¯ä»¥è¿å…¥
    Public,
    
    /// ç™½åå•åˆ¶ï¼Œä»…å…è®¸ç‰¹å®šè´¦æˆ·è¿å…¥
    Whitelist,
    
    /// éœ€è¦ç”³è¯·ï¼Œå¢“ä¸»å®¡æ‰¹
    RequireApproval,
}

/// å¢“ä½ç®¡ç†å‘˜åˆ—è¡¨ï¼ˆä¸å˜ï¼‰
#[pallet::storage]
pub type GraveAdmins<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::GraveId,
    BoundedVec<T::AccountId, T::MaxAdminsPerGrave>,
    ValueQuery,
>;

/// â­ æ–°å¢ï¼šå¢“ä½å‡†å…¥ç™½åå•ï¼ˆéœ€æ±‚3ï¼‰
#[pallet::storage]
pub type GraveAdmissionWhitelist<T: Config> = StorageDoubleMap<
    _,
    Blake2_128Concat,
    T::GraveId,
    Blake2_128Concat,
    T::AccountId,
    (),
    OptionQuery,
>;

/// â­ æ–°å¢ï¼šå¢“ä½å‡†å…¥ç”³è¯·ï¼ˆéœ€æ±‚3 - RequireApprovalç­–ç•¥ï¼‰
#[pallet::storage]
pub type GraveAdmissionRequests<T: Config> = StorageDoubleMap<
    _,
    Blake2_128Concat,
    T::GraveId,
    Blake2_128Concat,
    T::AccountId,  // ç”³è¯·äºº
    AdmissionRequest<T>,
    OptionQuery,
>;

#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen)]
#[scale_info(skip_type_params(T))]
pub struct AdmissionRequest<T: Config> {
    pub applicant: T::AccountId,
    pub deceased_id: T::DeceasedId,
    pub requested_at: BlockNumberFor<T>,
    pub reason: BoundedVec<u8, T::CidLimit>,
}
```

---

### 2. é€è€…ç»“æ„ï¼ˆDeceasedï¼‰- ä¿æŒ

```rust
// pallets/deceased/src/lib.rs

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šé€è€…è®°å½•ï¼ˆèåˆç‰ˆï¼‰
/// 
/// èŒè´£ï¼š
/// - é€è€…èµ„æ–™æ•°æ®
/// - å†…å®¹ç®¡ç†æƒé™ï¼ˆé€šè¿‡ owner å­—æ®µï¼‰
/// - å…³ç³»å’Œç¤¾äº¤åŠŸèƒ½
/// 
/// æƒé™è¯´æ˜ï¼š
/// - owner: é€è€…èµ„æ–™ç®¡ç†è€…ï¼ˆå—ä¿æŠ¤ï¼Œéœ€æ±‚2ï¼‰
/// - creator: æœ€åˆåˆ›å»ºè€…ï¼ˆå®¡è®¡ç”¨ï¼Œä¸å¯å˜ï¼‰
/// - å¢“ä½æƒé™: ä»…åœ¨åˆ›å»ºæ—¶æ£€æŸ¥ï¼Œåç»­ä¸å¯è¶Šæƒ
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen)]
#[scale_info(skip_type_params(T))]
pub struct Deceased<T: Config> {
    /// æ‰€å±å¢“ä½ï¼ˆå¿…é¡»ï¼Œå¯è¿ç§» - éœ€æ±‚3ï¼‰
    pub grave_id: T::GraveId,
    
    /// é€è€…èµ„æ–™ç®¡ç†è€…ï¼ˆä¼˜å…ˆæƒé™ï¼Œå—ä¿æŠ¤ - éœ€æ±‚2ï¼‰
    pub owner: T::AccountId,
    
    /// æœ€åˆåˆ›å»ºè€…ï¼ˆå®¡è®¡ç”¨ï¼Œä¸å¯å˜ï¼‰
    pub creator: T::AccountId,
    
    /// å§“åå…¨ç§°ï¼ˆåŠ å¯†CIDï¼‰
    pub full_name: BoundedVec<u8, T::CidLimit>,
    
    /// æ€§åˆ«
    pub gender: Gender,
    
    /// å‡ºç”Ÿæ—¥æœŸï¼ˆåŠ å¯†CIDï¼‰
    pub birth_date: BoundedVec<u8, T::CidLimit>,
    
    /// é€ä¸–æ—¥æœŸï¼ˆåŠ å¯†CIDï¼‰
    pub death_date: BoundedVec<u8, T::CidLimit>,
    
    /// ä¸»å›¾CID
    pub main_image: BoundedVec<u8, T::CidLimit>,
    
    /// åˆ›å»ºæ—¶é—´
    pub created_at: BlockNumberFor<T>,
    
    /// æœ€åæ›´æ–°æ—¶é—´
    pub last_updated: BlockNumberFor<T>,
    
    /// å”¯ä¸€æ ‡è¯†tokenï¼ˆ49å­—èŠ‚ï¼‰
    pub deceased_token: [u8; 49],
}
```

---

### 3. å¢“ä½æ²»ç†ç»“æ„ï¼ˆæ–°å¢ï¼Œéœ€æ±‚4ï¼‰

```rust
// pallets/stardust-grave/src/lib.rs

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šå¢“ä½æ²»ç†ç­–ç•¥ï¼ˆéœ€æ±‚4ï¼‰
/// 
/// ç”¨é€”ï¼š
/// - å®šä¹‰å¢“ä½æ²»ç†è§„åˆ™
/// - å†³å®šå“ªäº›äº‹é¡¹éœ€è¦æŠ•ç¥¨
/// - è®¾å®šæŠ•ç¥¨é˜ˆå€¼
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen)]
pub struct GraveGovernance {
    /// æ˜¯å¦å¯ç”¨æ²»ç†ï¼ˆé»˜è®¤falseï¼‰
    pub enabled: bool,
    
    /// æŠ•ç¥¨äººèŒƒå›´
    pub voter_scope: VoterScope,
    
    /// æ™®é€šäº‹é¡¹é˜ˆå€¼ï¼ˆç™¾åˆ†æ¯”ï¼Œå¦‚51è¡¨ç¤º>50%ï¼‰
    pub normal_threshold: u8,
    
    /// é‡å¤§äº‹é¡¹é˜ˆå€¼ï¼ˆå¦‚67è¡¨ç¤ºâ‰¥67%ï¼‰
    pub critical_threshold: u8,
    
    /// æŠ•ç¥¨æœŸï¼ˆåŒºå—æ•°ï¼‰
    pub voting_period: u32,
    
    /// æœ€çŸ­æŠ•ç¥¨æœŸï¼ˆé˜²æ­¢é€Ÿæˆ˜é€Ÿå†³ï¼‰
    pub min_voting_period: u32,
}

impl Default for GraveGovernance {
    fn default() -> Self {
        Self {
            enabled: false,  // é»˜è®¤å…³é—­æ²»ç†
            voter_scope: VoterScope::IncludeDeceasedOwners,
            normal_threshold: 51,
            critical_threshold: 67,
            voting_period: 7 * 24 * 3600 / 6,  // 7å¤©ï¼ˆå‡è®¾6ç§’ä¸€ä¸ªåŒºå—ï¼‰
            min_voting_period: 1 * 24 * 3600 / 6,  // 1å¤©
        }
    }
}

/// æŠ•ç¥¨äººèŒƒå›´
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen)]
pub enum VoterScope {
    /// ä»…å¢“ä¸»å’Œç®¡ç†å‘˜
    AdminsOnly,
    
    /// å¢“ä¸» + ç®¡ç†å‘˜ + æ‰€æœ‰é€è€…ownerï¼ˆæ¨èï¼‰
    IncludeDeceasedOwners,
    
    /// ä»…é€è€…ownerï¼ˆä¸€äººä¸€ç¥¨ï¼‰
    DeceasedOwnersOnly,
}

/// å¢“ä½æ²»ç†ææ¡ˆç±»å‹
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen)]
#[scale_info(skip_type_params(T))]
pub enum GraveProposalType<T: Config> {
    /// æ™®é€šäº‹é¡¹ï¼šè®¾ç½®å¢“ä½å°é¢
    SetCover {
        cover_cid: BoundedVec<u8, T::CidLimit>,
    },
    
    /// æ™®é€šäº‹é¡¹ï¼šè®¾ç½®å¢“ä½éŸ³ä¹
    SetAudio {
        audio_cid: BoundedVec<u8, T::CidLimit>,
    },
    
    /// æ™®é€šäº‹é¡¹ï¼šæ·»åŠ å¢“ä½ç®¡ç†å‘˜
    AddAdmin {
        admin: T::AccountId,
    },
    
    /// æ™®é€šäº‹é¡¹ï¼šç§»é™¤å¢“ä½ç®¡ç†å‘˜
    RemoveAdmin {
        admin: T::AccountId,
    },
    
    /// é‡å¤§äº‹é¡¹ï¼šè½¬è®©å¢“ä½ï¼ˆéœ€æ±‚1ï¼šå¿…é¡»å…ˆæ¸…ç©ºï¼‰
    TransferGrave {
        new_owner: T::AccountId,
    },
    
    /// é‡å¤§äº‹é¡¹ï¼šè®¾ç½®å‡†å…¥ç­–ç•¥
    SetAdmissionPolicy {
        policy: AdmissionPolicy,
    },
    
    /// é‡å¤§äº‹é¡¹ï¼šä¿®æ”¹æ²»ç†ç­–ç•¥
    UpdateGovernance {
        new_governance: GraveGovernance,
    },
}

/// å¢“ä½æ²»ç†ææ¡ˆ
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen)]
#[scale_info(skip_type_params(T))]
pub struct GraveProposal<T: Config> {
    pub proposal_id: u64,
    pub grave_id: T::GraveId,
    pub proposal_type: GraveProposalType<T>,
    pub proposer: T::AccountId,
    pub created_at: BlockNumberFor<T>,
    pub voting_deadline: BlockNumberFor<T>,
    pub status: ProposalStatus,
    pub votes: VoteResult<T>,
    pub is_critical: bool,
}

/// ææ¡ˆçŠ¶æ€
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen)]
pub enum ProposalStatus {
    Voting,
    Approved,
    Rejected,
    Executed,
    Cancelled,
    Expired,
}

/// æŠ•ç¥¨ç»“æœ
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen)]
#[scale_info(skip_type_params(T))]
pub struct VoteResult<T: Config> {
    pub ayes: BoundedVec<T::AccountId, ConstU32<256>>,
    pub nays: BoundedVec<T::AccountId, ConstU32<256>>,
    pub abstains: BoundedVec<T::AccountId, ConstU32<256>>,
    pub total_voters: u32,
}

impl<T: Config> Default for VoteResult<T> {
    fn default() -> Self {
        Self {
            ayes: BoundedVec::default(),
            nays: BoundedVec::default(),
            abstains: BoundedVec::default(),
            total_voters: 0,
        }
    }
}

/// æŠ•ç¥¨ç±»å‹
#[derive(Encode, Decode, Clone, PartialEq, Eq, TypeInfo, MaxEncodedLen)]
pub enum VoteType {
    Aye,
    Nay,
    Abstain,
}

/// å­˜å‚¨

/// å¢“ä½æ²»ç†ç­–ç•¥
#[pallet::storage]
pub type GraveGovernanceOf<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::GraveId,
    GraveGovernance,
    ValueQuery,
>;

/// å¢“ä½æ²»ç†ææ¡ˆ
#[pallet::storage]
pub type GraveProposals<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    u64,
    GraveProposal<T>,
    OptionQuery,
>;

/// æ´»è·ƒææ¡ˆåˆ—è¡¨
#[pallet::storage]
pub type ActiveGraveProposals<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::GraveId,
    BoundedVec<u64, ConstU32<10>>,
    ValueQuery,
>;

/// ä¸‹ä¸€ä¸ªææ¡ˆID
#[pallet::storage]
pub type NextGraveProposalId<T: Config> = StorageValue<_, u64, ValueQuery>;
```

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### éœ€æ±‚1ï¼šå¢“ä½è½¬è®©å‰å¿…é¡»æ¸…ç©º

```rust
// pallets/stardust-grave/src/lib.rs

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šè½¬è®©å¢“ä½ï¼ˆéœ€æ±‚1èåˆï¼‰
/// 
/// å‰ç½®æ¡ä»¶ï¼š
/// 1. å¢“ä½å¿…é¡»ä¸ºç©ºï¼ˆæ— ä»»ä½•é€è€…ï¼‰
/// 2. å¦‚æœæ²»ç†å¯ç”¨ï¼Œéœ€è¦æŠ•ç¥¨é€šè¿‡ï¼ˆé‡å¤§äº‹é¡¹ï¼‰
/// 
/// æƒé™ï¼šå¢“ä¸»
#[pallet::call_index(20)]
#[pallet::weight(T::WeightInfo::transfer_grave())]
pub fn transfer_grave(
    origin: OriginFor<T>,
    grave_id: T::GraveId,
    new_owner: T::AccountId,
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    let grave = Graves::<T>::get(grave_id)
        .ok_or(Error::<T>::GraveNotFound)?;
    
    // æƒé™æ£€æŸ¥ï¼šä»…å¢“ä¸»
    ensure!(grave.owner == who, Error::<T>::NotAuthorized);
    
    // â­ éœ€æ±‚1ï¼šæ£€æŸ¥å¢“ä½æ˜¯å¦ä¸ºç©º
    let deceased_count = pallet_deceased::DeceasedByGrave::<T>::get(grave_id).len();
    ensure!(
        deceased_count == 0,
        Error::<T>::GraveNotEmpty
    );
    
    // â­ éœ€æ±‚4ï¼šå¦‚æœæ²»ç†å¯ç”¨ï¼Œæ£€æŸ¥æ˜¯å¦é€šè¿‡æŠ•ç¥¨
    let governance = GraveGovernanceOf::<T>::get(grave_id);
    if governance.enabled {
        return Err(Error::<T>::RequiresGovernanceApproval.into());
        // å¢“ä¸»åº”è¯¥å…ˆè°ƒç”¨ propose_grave_action å‘èµ·ææ¡ˆ
    }
    
    // æ‰§è¡Œè½¬è®©
    Graves::<T>::try_mutate(grave_id, |maybe_grave| {
        let g = maybe_grave.as_mut().ok_or(Error::<T>::GraveNotFound)?;
        let old_owner = g.owner.clone();
        g.owner = new_owner.clone();
        
        Self::deposit_event(Event::GraveTransferred {
            grave_id,
            old_owner,
            new_owner,
        });
        
        Ok(())
    })
}

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šé€šè¿‡æ²»ç†è½¬è®©å¢“ä½ï¼ˆéœ€æ±‚1+éœ€æ±‚4ï¼‰
/// 
/// æµç¨‹ï¼š
/// 1. å¢“ä¸»å‘èµ·ææ¡ˆ
/// 2. é€è€…ownerä»¬æŠ•ç¥¨
/// 3. æŠ•ç¥¨é€šè¿‡åè‡ªåŠ¨æ‰§è¡Œè½¬è®©
fn execute_grave_transfer_proposal(
    grave_id: T::GraveId,
    new_owner: T::AccountId,
) -> DispatchResult {
    // æ£€æŸ¥å¢“ä½æ˜¯å¦ä¸ºç©º
    let deceased_count = pallet_deceased::DeceasedByGrave::<T>::get(grave_id).len();
    ensure!(
        deceased_count == 0,
        Error::<T>::GraveNotEmpty
    );
    
    // æ‰§è¡Œè½¬è®©
    Graves::<T>::try_mutate(grave_id, |maybe_grave| {
        let g = maybe_grave.as_mut().ok_or(Error::<T>::GraveNotFound)?;
        let old_owner = g.owner.clone();
        g.owner = new_owner.clone();
        
        Self::deposit_event(Event::GraveTransferredByGovernance {
            grave_id,
            old_owner,
            new_owner,
        });
        
        Ok(())
    })
}
```

---

### éœ€æ±‚2ï¼šç¦æ­¢å¢“ä¸»å¼ºåˆ¶æ›¿æ¢é€è€…owner

```rust
// pallets/deceased/src/lib.rs

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šè½¬è®©é€è€…ownerï¼ˆéœ€æ±‚2å®ç°ï¼‰
/// 
/// æƒé™ï¼šä»…é€è€…å½“å‰ownerï¼ˆå¢“ä¸»æ— æƒï¼‰
/// 
/// é‡è¦ï¼šæ­¤å‡½æ•°åˆ é™¤äº†å¢“ä½æƒé™æ£€æŸ¥ï¼Œå¢“ä¸»ä¸èƒ½å¼ºåˆ¶è½¬è®©
#[pallet::call_index(30)]
#[pallet::weight(T::WeightInfo::transfer_deceased_owner())]
pub fn transfer_deceased_owner(
    origin: OriginFor<T>,
    deceased_id: T::DeceasedId,
    new_owner: T::AccountId,
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    let deceased = DeceasedOf::<T>::get(deceased_id)
        .ok_or(Error::<T>::DeceasedNotFound)?;
    
    // â­ éœ€æ±‚2ï¼šä»…é€è€…ownerå¯è½¬è®©ï¼Œåˆ é™¤å¢“ä½æƒé™æ£€æŸ¥
    ensure!(
        deceased.owner == who,
        Error::<T>::NotDeceasedOwner
    );
    
    // ä¸å…è®¸è½¬ç»™è‡ªå·±
    ensure!(deceased.owner != new_owner, Error::<T>::BadInput);
    
    // æ‰§è¡Œè½¬è®©
    DeceasedOf::<T>::try_mutate(deceased_id, |maybe_d| {
        let d = maybe_d.as_mut().ok_or(Error::<T>::DeceasedNotFound)?;
        
        let old_owner = d.owner.clone();
        d.owner = new_owner.clone();
        d.last_updated = <frame_system::Pallet<T>>::block_number();
        
        // è®°å½•å˜æ›´å†å²
        DeceasedOwnerHistory::<T>::try_mutate(deceased_id, |history| {
            let record = OwnerChangeRecord {
                from_owner: old_owner.clone(),
                to_owner: new_owner.clone(),
                changed_at: <frame_system::Pallet<T>>::block_number(),
                changed_by: who.clone(),
            };
            history.try_push(record)
                .map_err(|_| Error::<T>::Overflow)
        })?;
        
        Self::deposit_event(Event::DeceasedOwnerTransferred {
            deceased_id,
            grave_id: d.grave_id,
            old_owner,
            new_owner,
            transferred_by: who,
        });
        
        Ok(())
    })
}

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šåˆ›å»ºé€è€…ï¼ˆéœ€æ±‚2å½±å“ï¼‰
/// 
/// æƒé™ï¼šå¢“ä½æƒé™ï¼ˆå¢“ä¸»/ç®¡ç†å‘˜/å›­åŒºç®¡ç†å‘˜ï¼‰
/// 
/// é‡è¦ï¼šåˆ›å»ºè€…è‡ªåŠ¨æˆä¸ºownerï¼Œåç»­å¢“ä¸»æ— æ³•å¼ºåˆ¶æ”¶å›
#[pallet::call_index(0)]
#[pallet::weight(T::WeightInfo::create_deceased())]
pub fn create_deceased(
    origin: OriginFor<T>,
    grave_id: T::GraveId,
    full_name: Vec<u8>,
    gender_code: u8,
    birth_date: Vec<u8>,
    death_date: Vec<u8>,
    main_image: Vec<u8>,
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    // æ£€æŸ¥å¢“ä½æƒé™
    ensure!(
        T::GraveProvider::can_attach(&who, grave_id),
        Error::<T>::NotAuthorized
    );
    
    // æ„å»ºé€è€…
    let deceased = Deceased {
        grave_id,
        owner: who.clone(),      // åˆ›å»ºè€…æˆä¸ºowner
        creator: who.clone(),     // è®°å½•åˆ›å»ºè€…
        // ... å…¶ä»–å­—æ®µ
    };
    
    // âš ï¸ é‡è¦è¯´æ˜ï¼š
    // è™½ç„¶å¢“ä¸»å¯ä»¥åˆ›å»ºé€è€…å¹¶è‡ªåŠ¨æˆä¸ºownerï¼Œ
    // ä½†åç»­å¢“ä¸»è‹¥å°†ownerè½¬è®©ç»™ä»–äººï¼Œåˆ™æ— æ³•å¼ºåˆ¶æ”¶å›ï¼ˆéœ€æ±‚2ï¼‰
    
    // å­˜å‚¨é€è€…...
    
    Ok(())
}
```

---

### éœ€æ±‚3ï¼šé€è€…è¿å¢“ä»…é™é€è€…owner

```rust
// pallets/deceased/src/lib.rs

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šè½¬ç§»é€è€…åˆ°å…¶ä»–å¢“ä½ï¼ˆéœ€æ±‚3å®ç°ï¼‰
/// 
/// æƒé™ï¼šä»…é€è€…ownerï¼ˆå¢“ä¸»æ— æƒï¼‰
/// 
/// æµç¨‹ï¼š
/// 1. æ£€æŸ¥é€è€…owneræƒé™
/// 2. æ£€æŸ¥ç›®æ ‡å¢“ä½å‡†å…¥ç­–ç•¥
/// 3. æ£€æŸ¥ç›®æ ‡å¢“ä½å®¹é‡
/// 4. æ‰§è¡Œè¿ç§»
#[pallet::call_index(10)]
#[pallet::weight(T::WeightInfo::transfer_deceased())]
pub fn transfer_deceased(
    origin: OriginFor<T>,
    deceased_id: T::DeceasedId,
    new_grave_id: T::GraveId,
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    DeceasedOf::<T>::try_mutate(deceased_id, |maybe_d| {
        let d = maybe_d.as_mut().ok_or(Error::<T>::DeceasedNotFound)?;
        
        let old_grave_id = d.grave_id;
        
        // ä¸å…è®¸è½¬ç§»åˆ°åŒä¸€ä¸ªå¢“ä½
        ensure!(old_grave_id != new_grave_id, Error::<T>::BadInput);
        
        // â­ éœ€æ±‚3ï¼šä»…é€è€…ownerå¯è¿ç§»ï¼Œåˆ é™¤å¢“ä½æƒé™æ£€æŸ¥
        ensure!(d.owner == who, Error::<T>::NotDeceasedOwner);
        
        // æ£€æŸ¥ç›®æ ‡å¢“ä½å­˜åœ¨
        ensure!(
            T::GraveProvider::grave_exists(new_grave_id),
            Error::<T>::GraveNotFound
        );
        
        // â­ éœ€æ±‚3ï¼šæ£€æŸ¥ç›®æ ‡å¢“ä½å‡†å…¥ç­–ç•¥
        let admission_policy = T::GraveProvider::get_admission_policy(new_grave_id);
        Self::check_admission(&who, new_grave_id, &admission_policy)?;
        
        // æ£€æŸ¥ç›®æ ‡å¢“ä½å®¹é‡
        let deceased_count = DeceasedByGrave::<T>::get(new_grave_id).len();
        ensure!(
            deceased_count < T::MaxDeceasedPerGrave::get() as usize,
            Error::<T>::TooManyDeceasedInGrave
        );
        
        // ä»æ—§å¢“ä½ç§»é™¤
        DeceasedByGrave::<T>::try_mutate(old_grave_id, |list| {
            if let Some(pos) = list.iter().position(|t| t == &d.deceased_token) {
                list.remove(pos);
            }
            Ok::<(), DispatchError>(())
        })?;
        
        // æ·»åŠ åˆ°æ–°å¢“ä½
        DeceasedByGrave::<T>::try_mutate(new_grave_id, |list| {
            list.try_push(d.deceased_token)
                .map_err(|_| Error::<T>::TooManyDeceasedInGrave)
        })?;
        
        // æ›´æ–°é€è€…çš„å¢“ä½
        d.grave_id = new_grave_id;
        d.last_updated = <frame_system::Pallet<T>>::block_number();
        
        Self::deposit_event(Event::DeceasedTransferred {
            deceased_id,
            old_grave_id,
            new_grave_id,
            transferred_by: who,
        });
        
        Ok(())
    })
}

/// æ£€æŸ¥å‡†å…¥ç­–ç•¥
fn check_admission(
    who: &T::AccountId,
    grave_id: T::GraveId,
    policy: &AdmissionPolicy,
) -> DispatchResult {
    match policy {
        AdmissionPolicy::GraveOwnerOnly => {
            // ä»…å¢“ä¸»å¯æ·»åŠ ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯å¢“ä¸»
            ensure!(
                T::GraveProvider::is_grave_owner(who, grave_id),
                Error::<T>::AdmissionDenied
            );
        },
        AdmissionPolicy::Public => {
            // å…¬å¼€æ¥æ”¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥
        },
        AdmissionPolicy::Whitelist => {
            // ç™½åå•åˆ¶ï¼Œæ£€æŸ¥æ˜¯å¦åœ¨ç™½åå•
            ensure!(
                T::GraveProvider::is_in_whitelist(who, grave_id),
                Error::<T>::AdmissionDenied
            );
        },
        AdmissionPolicy::RequireApproval => {
            // éœ€è¦ç”³è¯·ï¼Œæ£€æŸ¥æ˜¯å¦å·²æ‰¹å‡†
            ensure!(
                T::GraveProvider::is_admission_approved(who, grave_id),
                Error::<T>::AdmissionNotApproved
            );
        },
    }
    
    Ok(())
}
```

**å¢“ä½å‡†å…¥ç­–ç•¥ç®¡ç†**ï¼š

```rust
// pallets/stardust-grave/src/lib.rs

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šè®¾ç½®å¢“ä½å‡†å…¥ç­–ç•¥ï¼ˆéœ€æ±‚3ï¼‰
/// 
/// æƒé™ï¼šå¢“ä¸»ï¼Œæˆ–éœ€è¦æ²»ç†æŠ•ç¥¨ï¼ˆå¦‚æœå¯ç”¨ï¼‰
#[pallet::call_index(25)]
#[pallet::weight(T::WeightInfo::set_admission_policy())]
pub fn set_admission_policy(
    origin: OriginFor<T>,
    grave_id: T::GraveId,
    policy: AdmissionPolicy,
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    let grave = Graves::<T>::get(grave_id)
        .ok_or(Error::<T>::GraveNotFound)?;
    
    // æƒé™æ£€æŸ¥ï¼šä»…å¢“ä¸»
    ensure!(grave.owner == who, Error::<T>::NotAuthorized);
    
    // å¦‚æœæ²»ç†å¯ç”¨ï¼Œéœ€è¦æŠ•ç¥¨
    let governance = GraveGovernanceOf::<T>::get(grave_id);
    if governance.enabled {
        return Err(Error::<T>::RequiresGovernanceApproval.into());
        // å¢“ä¸»åº”è¯¥å…ˆè°ƒç”¨ propose_grave_action å‘èµ·ææ¡ˆ
    }
    
    // æ›´æ–°å‡†å…¥ç­–ç•¥
    Graves::<T>::try_mutate(grave_id, |maybe_grave| {
        let g = maybe_grave.as_mut().ok_or(Error::<T>::GraveNotFound)?;
        g.admission_policy = policy.clone();
        
        Self::deposit_event(Event::AdmissionPolicySet {
            grave_id,
            policy,
        });
        
        Ok(())
    })
}

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šæ·»åŠ åˆ°å‡†å…¥ç™½åå•ï¼ˆéœ€æ±‚3ï¼‰
#[pallet::call_index(26)]
pub fn add_to_admission_whitelist(
    origin: OriginFor<T>,
    grave_id: T::GraveId,
    account: T::AccountId,
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    // æƒé™æ£€æŸ¥ï¼šä»…å¢“ä¸»
    ensure!(
        Self::is_grave_owner(&who, grave_id),
        Error::<T>::NotAuthorized
    );
    
    GraveAdmissionWhitelist::<T>::insert(grave_id, account.clone(), ());
    
    Self::deposit_event(Event::WhitelistAdded {
        grave_id,
        account,
    });
    
    Ok(())
}

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šç”³è¯·è¿å…¥å¢“ä½ï¼ˆéœ€æ±‚3 - RequireApprovalç­–ç•¥ï¼‰
#[pallet::call_index(27)]
pub fn request_admission(
    origin: OriginFor<T>,
    grave_id: T::GraveId,
    deceased_id: T::DeceasedId,
    reason_cid: Vec<u8>,
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    // æ£€æŸ¥é€è€…owner
    let deceased = pallet_deceased::DeceasedOf::<T>::get(deceased_id)
        .ok_or(Error::<T>::DeceasedNotFound)?;
    ensure!(deceased.owner == who, Error::<T>::NotAuthorized);
    
    // æ£€æŸ¥å‡†å…¥ç­–ç•¥
    let grave = Graves::<T>::get(grave_id)
        .ok_or(Error::<T>::GraveNotFound)?;
    ensure!(
        grave.admission_policy == AdmissionPolicy::RequireApproval,
        Error::<T>::InvalidAdmissionPolicy
    );
    
    // åˆ›å»ºç”³è¯·
    let request = AdmissionRequest {
        applicant: who.clone(),
        deceased_id,
        requested_at: <frame_system::Pallet<T>>::block_number(),
        reason: BoundedVec::try_from(reason_cid)
            .map_err(|_| Error::<T>::BadInput)?,
    };
    
    GraveAdmissionRequests::<T>::insert(grave_id, who.clone(), request);
    
    Self::deposit_event(Event::AdmissionRequested {
        grave_id,
        applicant: who,
        deceased_id,
    });
    
    Ok(())
}

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šæ‰¹å‡†è¿å…¥ç”³è¯·ï¼ˆéœ€æ±‚3ï¼‰
#[pallet::call_index(28)]
pub fn approve_admission(
    origin: OriginFor<T>,
    grave_id: T::GraveId,
    applicant: T::AccountId,
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    // æƒé™æ£€æŸ¥ï¼šä»…å¢“ä¸»
    ensure!(
        Self::is_grave_owner(&who, grave_id),
        Error::<T>::NotAuthorized
    );
    
    // æ£€æŸ¥ç”³è¯·æ˜¯å¦å­˜åœ¨
    ensure!(
        GraveAdmissionRequests::<T>::contains_key(grave_id, &applicant),
        Error::<T>::RequestNotFound
    );
    
    // æ·»åŠ åˆ°ç™½åå•ï¼ˆä¸´æ—¶ï¼‰
    GraveAdmissionWhitelist::<T>::insert(grave_id, applicant.clone(), ());
    
    // ç§»é™¤ç”³è¯·
    GraveAdmissionRequests::<T>::remove(grave_id, &applicant);
    
    Self::deposit_event(Event::AdmissionApproved {
        grave_id,
        applicant,
    });
    
    Ok(())
}
```

---

### éœ€æ±‚4ï¼šé€è€…owneræŠ•ç¥¨æ²»ç†å¢“ä½

```rust
// pallets/stardust-grave/src/lib.rs

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šè®¾ç½®å¢“ä½æ²»ç†ç­–ç•¥ï¼ˆéœ€æ±‚4ï¼‰
/// 
/// æƒé™ï¼šä»…å¢“ä¸»
#[pallet::call_index(30)]
#[pallet::weight(T::WeightInfo::set_grave_governance())]
pub fn set_grave_governance(
    origin: OriginFor<T>,
    grave_id: T::GraveId,
    governance: GraveGovernance,
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    // æƒé™æ£€æŸ¥ï¼šä»…å¢“ä¸»
    ensure!(
        Self::is_grave_owner(&who, grave_id),
        Error::<T>::NotAuthorized
    );
    
    GraveGovernanceOf::<T>::insert(grave_id, governance.clone());
    
    Self::deposit_event(Event::GraveGovernanceSet {
        grave_id,
        governance,
    });
    
    Ok(())
}

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šå‘èµ·å¢“ä½æ²»ç†ææ¡ˆï¼ˆéœ€æ±‚4ï¼‰
/// 
/// æƒé™ï¼šå¢“ä¸»ã€ç®¡ç†å‘˜ã€æˆ–é€è€…owner
#[pallet::call_index(31)]
#[pallet::weight(T::WeightInfo::propose_grave_action())]
pub fn propose_grave_action(
    origin: OriginFor<T>,
    grave_id: T::GraveId,
    proposal_type: GraveProposalType<T>,
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    // æ£€æŸ¥å¢“ä½æ²»ç†æ˜¯å¦å¯ç”¨
    let governance = GraveGovernanceOf::<T>::get(grave_id);
    ensure!(governance.enabled, Error::<T>::GovernanceNotEnabled);
    
    // æƒé™æ£€æŸ¥ï¼šæ˜¯å¦æœ‰ææ¡ˆæƒ
    ensure!(
        Self::can_propose_grave(&who, grave_id, &governance),
        Error::<T>::NotAuthorized
    );
    
    // åˆ¤æ–­æ˜¯å¦é‡å¤§äº‹é¡¹
    let is_critical = matches!(
        proposal_type,
        GraveProposalType::TransferGrave { .. }
            | GraveProposalType::SetAdmissionPolicy { .. }
            | GraveProposalType::UpdateGovernance { .. }
    );
    
    // åˆ›å»ºææ¡ˆ
    let proposal_id = NextGraveProposalId::<T>::get();
    NextGraveProposalId::<T>::put(proposal_id + 1);
    
    let current_block = <frame_system::Pallet<T>>::block_number();
    
    let proposal = GraveProposal {
        proposal_id,
        grave_id,
        proposal_type: proposal_type.clone(),
        proposer: who.clone(),
        created_at: current_block,
        voting_deadline: current_block + governance.voting_period.into(),
        status: ProposalStatus::Voting,
        votes: VoteResult::default(),
        is_critical,
    };
    
    GraveProposals::<T>::insert(proposal_id, proposal);
    
    // æ·»åŠ åˆ°æ´»è·ƒææ¡ˆ
    ActiveGraveProposals::<T>::try_mutate(grave_id, |proposals| {
        proposals.try_push(proposal_id)
            .map_err(|_| Error::<T>::TooManyProposals)
    })?;
    
    Self::deposit_event(Event::GraveProposalCreated {
        proposal_id,
        grave_id,
        proposal_type,
        proposer: who,
    });
    
    Ok(())
}

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šæŠ•ç¥¨å¢“ä½æ²»ç†ææ¡ˆï¼ˆéœ€æ±‚4ï¼‰
/// 
/// æƒé™ï¼šæ ¹æ®æ²»ç†ç­–ç•¥çš„VoterScope
#[pallet::call_index(32)]
#[pallet::weight(T::WeightInfo::vote_grave_proposal())]
pub fn vote_grave_proposal(
    origin: OriginFor<T>,
    proposal_id: u64,
    vote: VoteType,
) -> DispatchResult {
    let who = ensure_signed(origin)?;
    
    GraveProposals::<T>::try_mutate(proposal_id, |maybe_proposal| {
        let proposal = maybe_proposal.as_mut().ok_or(Error::<T>::ProposalNotFound)?;
        
        // æ£€æŸ¥ææ¡ˆçŠ¶æ€
        ensure!(
            proposal.status == ProposalStatus::Voting,
            Error::<T>::ProposalNotVoting
        );
        
        // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
        let current_block = <frame_system::Pallet<T>>::block_number();
        ensure!(
            current_block <= proposal.voting_deadline,
            Error::<T>::ProposalExpired
        );
        
        // æ£€æŸ¥æŠ•ç¥¨æƒé™
        let governance = GraveGovernanceOf::<T>::get(proposal.grave_id);
        ensure!(
            Self::can_vote_grave(&who, proposal.grave_id, &governance),
            Error::<T>::NotAuthorized
        );
        
        // æ£€æŸ¥æ˜¯å¦å·²æŠ•ç¥¨
        ensure!(
            !proposal.votes.ayes.contains(&who)
                && !proposal.votes.nays.contains(&who)
                && !proposal.votes.abstains.contains(&who),
            Error::<T>::AlreadyVoted
        );
        
        // è®°å½•æŠ•ç¥¨
        match vote {
            VoteType::Aye => {
                proposal.votes.ayes.try_push(who.clone())
                    .map_err(|_| Error::<T>::TooManyVotes)?;
            },
            VoteType::Nay => {
                proposal.votes.nays.try_push(who.clone())
                    .map_err(|_| Error::<T>::TooManyVotes)?;
            },
            VoteType::Abstain => {
                proposal.votes.abstains.try_push(who.clone())
                    .map_err(|_| Error::<T>::TooManyVotes)?;
            },
        }
        
        proposal.votes.total_voters = proposal.votes.total_voters.saturating_add(1);
        
        Self::deposit_event(Event::GraveProposalVoted {
            proposal_id,
            voter: who,
            vote,
        });
        
        Ok(())
    })
}

/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šç»“æŸæŠ•ç¥¨å¹¶æ‰§è¡Œææ¡ˆï¼ˆéœ€æ±‚4ï¼‰
#[pallet::call_index(33)]
#[pallet::weight(T::WeightInfo::finalize_grave_proposal())]
pub fn finalize_grave_proposal(
    origin: OriginFor<T>,
    proposal_id: u64,
) -> DispatchResult {
    let _who = ensure_signed(origin)?;
    
    GraveProposals::<T>::try_mutate(proposal_id, |maybe_proposal| {
        let proposal = maybe_proposal.as_mut().ok_or(Error::<T>::ProposalNotFound)?;
        
        // æ£€æŸ¥ææ¡ˆçŠ¶æ€
        ensure!(
            proposal.status == ProposalStatus::Voting,
            Error::<T>::ProposalNotVoting
        );
        
        // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾æœ€çŸ­æŠ•ç¥¨æœŸ
        let current_block = <frame_system::Pallet<T>>::block_number();
        let governance = GraveGovernanceOf::<T>::get(proposal.grave_id);
        ensure!(
            current_block >= proposal.created_at + governance.min_voting_period.into(),
            Error::<T>::VotingPeriodNotEnded
        );
        
        // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
        let is_expired = current_block > proposal.voting_deadline;
        
        // è®¡ç®—æŠ•ç¥¨ç»“æœ
        let threshold = if proposal.is_critical {
            governance.critical_threshold
        } else {
            governance.normal_threshold
        };
        
        let passed = Self::check_grave_vote_passed(proposal, threshold)?;
        
        if passed && !is_expired {
            // æ‰§è¡Œææ¡ˆ
            Self::execute_grave_proposal(proposal)?;
            proposal.status = ProposalStatus::Executed;
            
            Self::deposit_event(Event::GraveProposalExecuted {
                proposal_id,
                grave_id: proposal.grave_id,
            });
        } else {
            proposal.status = if is_expired {
                ProposalStatus::Expired
            } else {
                ProposalStatus::Rejected
            };
            
            Self::deposit_event(Event::GraveProposalRejected {
                proposal_id,
                grave_id: proposal.grave_id,
            });
        }
        
        // æ¸…ç†æ´»è·ƒææ¡ˆ
        ActiveGraveProposals::<T>::mutate(proposal.grave_id, |proposals| {
            if let Some(pos) = proposals.iter().position(|&id| id == proposal_id) {
                proposals.remove(pos);
            }
        });
        
        Ok(())
    })
}

/// è¾…åŠ©å‡½æ•°

impl<T: Config> Pallet<T> {
    /// æ£€æŸ¥æ˜¯å¦å¯ä»¥å‘èµ·ææ¡ˆ
    fn can_propose_grave(
        who: &T::AccountId,
        grave_id: T::GraveId,
        governance: &GraveGovernance,
    ) -> bool {
        // å¢“ä¸»æˆ–ç®¡ç†å‘˜æ€»æ˜¯å¯ä»¥ææ¡ˆ
        if Self::is_grave_owner(who, grave_id) || Self::is_grave_admin(who, grave_id) {
            return true;
        }
        
        // æ ¹æ®æŠ•ç¥¨èŒƒå›´å†³å®š
        match governance.voter_scope {
            VoterScope::AdminsOnly => false,
            VoterScope::IncludeDeceasedOwners | VoterScope::DeceasedOwnersOnly => {
                Self::is_deceased_owner_in_grave(who, grave_id)
            },
        }
    }
    
    /// æ£€æŸ¥æ˜¯å¦å¯ä»¥æŠ•ç¥¨
    fn can_vote_grave(
        who: &T::AccountId,
        grave_id: T::GraveId,
        governance: &GraveGovernance,
    ) -> bool {
        match governance.voter_scope {
            VoterScope::AdminsOnly => {
                Self::is_grave_owner(who, grave_id) || Self::is_grave_admin(who, grave_id)
            },
            VoterScope::IncludeDeceasedOwners => {
                Self::is_grave_owner(who, grave_id)
                    || Self::is_grave_admin(who, grave_id)
                    || Self::is_deceased_owner_in_grave(who, grave_id)
            },
            VoterScope::DeceasedOwnersOnly => {
                Self::is_deceased_owner_in_grave(who, grave_id)
            },
        }
    }
    
    /// æ£€æŸ¥æ˜¯å¦æ˜¯å¢“ä½å†…é€è€…çš„owner
    fn is_deceased_owner_in_grave(
        who: &T::AccountId,
        grave_id: T::GraveId,
    ) -> bool {
        let deceased_tokens = pallet_deceased::DeceasedByGrave::<T>::get(grave_id);
        
        for token in deceased_tokens.iter() {
            if let Some(deceased_id) = pallet_deceased::DeceasedIdByToken::<T>::get(token) {
                if let Some(deceased) = pallet_deceased::DeceasedOf::<T>::get(deceased_id) {
                    if deceased.owner == *who {
                        return true;
                    }
                }
            }
        }
        
        false
    }
    
    /// æ£€æŸ¥æŠ•ç¥¨æ˜¯å¦é€šè¿‡
    fn check_grave_vote_passed(
        proposal: &GraveProposal<T>,
        threshold: u8,
    ) -> Result<bool, DispatchError> {
        let ayes = proposal.votes.ayes.len() as u32;
        let total = proposal.votes.total_voters;
        
        if total == 0 {
            return Ok(false);
        }
        
        let required = (total as u64)
            .saturating_mul(threshold as u64)
            .saturating_div(100) as u32;
        
        Ok(ayes >= required)
    }
    
    /// æ‰§è¡Œææ¡ˆ
    fn execute_grave_proposal(
        proposal: &GraveProposal<T>,
    ) -> DispatchResult {
        match &proposal.proposal_type {
            GraveProposalType::SetCover { cover_cid } => {
                Graves::<T>::try_mutate(proposal.grave_id, |maybe_grave| {
                    let grave = maybe_grave.as_mut().ok_or(Error::<T>::GraveNotFound)?;
                    grave.cover = cover_cid.clone();
                    Ok(())
                })?;
            },
            
            GraveProposalType::SetAudio { audio_cid } => {
                Graves::<T>::try_mutate(proposal.grave_id, |maybe_grave| {
                    let grave = maybe_grave.as_mut().ok_or(Error::<T>::GraveNotFound)?;
                    grave.audio = audio_cid.clone();
                    Ok(())
                })?;
            },
            
            GraveProposalType::AddAdmin { admin } => {
                GraveAdmins::<T>::try_mutate(proposal.grave_id, |admins| {
                    admins.try_push(admin.clone())
                        .map_err(|_| Error::<T>::TooManyAdmins)
                })?;
            },
            
            GraveProposalType::RemoveAdmin { admin } => {
                GraveAdmins::<T>::mutate(proposal.grave_id, |admins| {
                    if let Some(pos) = admins.iter().position(|a| a == admin) {
                        admins.remove(pos);
                    }
                });
            },
            
            GraveProposalType::TransferGrave { new_owner } => {
                // è°ƒç”¨éœ€æ±‚1çš„è½¬è®©å‡½æ•°
                Self::execute_grave_transfer_proposal(proposal.grave_id, new_owner.clone())?;
            },
            
            GraveProposalType::SetAdmissionPolicy { policy } => {
                Graves::<T>::try_mutate(proposal.grave_id, |maybe_grave| {
                    let grave = maybe_grave.as_mut().ok_or(Error::<T>::GraveNotFound)?;
                    grave.admission_policy = policy.clone();
                    Ok(())
                })?;
            },
            
            GraveProposalType::UpdateGovernance { new_governance } => {
                GraveGovernanceOf::<T>::insert(proposal.grave_id, new_governance.clone());
            },
        }
        
        Ok(())
    }
}
```

---

## ğŸ“Š å…¸å‹åœºæ™¯æµç¨‹

### åœºæ™¯1ï¼šå¢“ä½è½¬è®©ï¼ˆèåˆéœ€æ±‚1+éœ€æ±‚4ï¼‰

```
å‰æï¼š
- Aliceæ˜¯å¢“ä¸»
- å¢“ä½Aå†…æœ‰é€è€…D1ï¼ˆowner: Bobï¼‰ã€D2ï¼ˆowner: Carolï¼‰
- å¢“ä½å¯ç”¨äº†æ²»ç†

æµç¨‹ï¼š

Step 1: Aliceæƒ³å–å¢“ä½ç»™Dave
  â†’ å‘ç°å¢“ä½éç©ºï¼Œæ— æ³•ç›´æ¥è½¬è®©

Step 2: Aliceè”ç³»Bobå’ŒCarol
  â†’ "æˆ‘è¦å–å¢“ä½ï¼Œè¯·ä½ ä»¬è¿ç§»é€è€…"

Step 3: Bobè¿ç§»D1ï¼ˆéœ€æ±‚3ï¼‰
  â†’ Bob: transfer_deceased(D1, bob_new_grave)
  â†’ æˆåŠŸï¼Bobè‡ªä¸»å†³å®šè¿åˆ°å“ªé‡Œ

Step 4: Carolè¿ç§»D2ï¼ˆéœ€æ±‚3ï¼‰
  â†’ Carol: transfer_deceased(D2, carol_new_grave)
  â†’ æˆåŠŸï¼

Step 5: å¢“ä½Aç°åœ¨ä¸ºç©ºï¼ŒAliceå‘èµ·æ²»ç†ææ¡ˆï¼ˆéœ€æ±‚4ï¼‰
  â†’ Alice: propose_grave_action(A, TransferGrave { Dave })
  â†’ ææ¡ˆåˆ›å»ºï¼ŒæŠ•ç¥¨æœŸå¼€å§‹ï¼ˆ7å¤©ï¼‰

Step 6: å¢“ä½AåŸæœ‰çš„é€è€…ownerä»¬æ”¶åˆ°é€šçŸ¥
  â†’ Bobå’ŒCarolè™½ç„¶é€è€…å·²è¿å‡ºï¼Œä½†ä»åœ¨æŠ•ç¥¨äººåå•
  â†’ é—®é¢˜ï¼šä»–ä»¬å·²ç»æ²¡æœ‰åˆ©ç›Šå…³ç³»äº†ï¼Ÿ

  âš ï¸ æ”¹è¿›ï¼šå¢“ä½ä¸ºç©ºæ—¶ï¼Œå–æ¶ˆæ²»ç†è¦æ±‚
  â†’ å¦‚æœå¢“ä½ä¸ºç©ºï¼Œå¢“ä¸»å¯ç›´æ¥è½¬è®©

Step 6ï¼ˆæ”¹è¿›ï¼‰: å¢“ä½ä¸ºç©ºï¼ŒAliceç›´æ¥è½¬è®©
  â†’ Alice: transfer_grave(A, Dave)
  â†’ æ£€æŸ¥ï¼šå¢“ä½ä¸ºç©º âœ…
  â†’ æ£€æŸ¥ï¼šæ²»ç†å¯ç”¨ï¼Œä½†å¢“ä½ä¸ºç©ºï¼Œè·³è¿‡æŠ•ç¥¨
  â†’ æˆåŠŸè½¬è®©ï¼

ç»“æœï¼š
âœ… Bobå’ŒCarolè‡ªä¸»è¿ç§»ï¼Œæƒåˆ©å—ä¿æŠ¤
âœ… å¢“ä½æ¸…ç©ºåï¼ŒAliceé¡ºåˆ©è½¬è®©
âœ… æµç¨‹åˆç†ï¼Œå„æ–¹æ»¡æ„
```

---

### åœºæ™¯2ï¼šé€è€…ownerè‡ªç”±è¿ç§»ï¼ˆéœ€æ±‚3ï¼‰

```
å‰æï¼š
- Bobæ˜¯é€è€…D1çš„owner
- D1åœ¨å¢“ä½Aï¼ˆå¢“ä¸»Aliceï¼‰
- Bobå¯¹å¢“ä½Aä¸æ»¡æ„

æµç¨‹ï¼š

Step 1: Bobæ‰¾åˆ°æ›´å¥½çš„å¢“ä½Bï¼ˆå¢“ä¸»Carolï¼‰
  â†’ å¢“ä½Bå‡†å…¥ç­–ç•¥ï¼šPublicï¼ˆå…¬å¼€æ¥æ”¶ï¼‰

Step 2: Bobç›´æ¥è¿ç§»D1
  â†’ Bob: transfer_deceased(D1, grave_B)
  â†’ æ£€æŸ¥ï¼šBobæ˜¯D1çš„owner âœ…
  â†’ æ£€æŸ¥ï¼šå¢“ä½Bå­˜åœ¨ âœ…
  â†’ æ£€æŸ¥ï¼šå¢“ä½Bå‡†å…¥ç­–ç•¥ = Public âœ…
  â†’ æ£€æŸ¥ï¼šå¢“ä½Bæœªæ»¡ âœ…
  â†’ æˆåŠŸè¿ç§»ï¼

Step 3: Aliceï¼ˆå¢“ä½Aå¢“ä¸»ï¼‰æ— æ³•é˜»æ­¢
  â†’ Aliceæ²¡æœ‰å¼ºåˆ¶ç•™ä½é€è€…çš„æƒåŠ›

ç»“æœï¼š
âœ… Bobè‡ªç”±é€‰æ‹©æ›´å¥½çš„å¢“ä½
âœ… å¸‚åœºæµåŠ¨æ€§å¢å¼º
âœ… å¢“ä½ç«äº‰ï¼Œä¼˜èƒœåŠ£æ±°
```

---

### åœºæ™¯3ï¼šå¢“ä½æ²»ç†æŠ•ç¥¨ï¼ˆéœ€æ±‚4ï¼‰

```
å‰æï¼š
- Aliceæ˜¯å¢“ä¸»
- å¢“ä½Aå†…æœ‰é€è€…D1ï¼ˆowner: Bobï¼‰ã€D2ï¼ˆowner: Carolï¼‰ã€D3ï¼ˆowner: Daveï¼‰
- å¢“ä½å¯ç”¨äº†æ²»ç†ï¼šIncludeDeceasedOwnersï¼Œæ™®é€šé˜ˆå€¼51%

æµç¨‹ï¼š

Step 1: Aliceæƒ³æ›´æ¢å¢“ä½å°é¢
  â†’ Alice: propose_grave_action(A, SetCover { new_cid })
  â†’ ææ¡ˆåˆ›å»ºï¼Œæ™®é€šäº‹é¡¹ï¼Œéœ€è¦>50%æŠ•ç¥¨

Step 2: æŠ•ç¥¨äººï¼šAliceï¼ˆå¢“ä¸»ï¼‰ã€Bobã€Carolã€Dave
  â†’ æ€»å…±4ç¥¨

Step 3: æŠ•ç¥¨
  â†’ Alice: vote_grave_proposal(proposal_id, Aye)  â† 1ç¥¨èµæˆ
  â†’ Bob: vote_grave_proposal(proposal_id, Aye)    â† 2ç¥¨èµæˆ
  â†’ Carol: vote_grave_proposal(proposal_id, Nay)   â† 1ç¥¨åå¯¹
  â†’ Dave: æœªæŠ•ç¥¨

Step 4: æŠ•ç¥¨æœŸç»“æŸï¼ˆ7å¤©åï¼‰
  â†’ finalize_grave_proposal(proposal_id)
  â†’ è®¡ç®—ï¼š2èµæˆ / 3å®é™…æŠ•ç¥¨ = 67% > 51%
  â†’ ææ¡ˆé€šè¿‡ï¼

Step 5: è‡ªåŠ¨æ‰§è¡Œ
  â†’ å¢“ä½Aå°é¢æ›´æ–°ä¸ºnew_cid

ç»“æœï¼š
âœ… æ°‘ä¸»å†³ç­–ï¼Œé€è€…ownerå‚ä¸
âœ… å¢“ä¸»æƒåŠ›å—åˆ¶è¡¡
âœ… é€æ˜å…¬å¼€
```

---

## ğŸš€ å®æ–½è®¡åˆ’

### Phase 1ï¼šæ ¸å¿ƒæƒé™é‡æ„ï¼ˆ2å‘¨ï¼‰

#### Week 1: éœ€æ±‚1+éœ€æ±‚2+éœ€æ±‚3ï¼ˆ13.5hï¼‰

**Day 1-2: éœ€æ±‚2å®ç°ï¼ˆ8hï¼‰**
```rust
// 1. ä¿®æ”¹transfer_deceased_ownerï¼ˆ2hï¼‰
//    - åˆ é™¤å¢“ä½æƒé™æ£€æŸ¥
//    - ä»…å…è®¸é€è€…ownerè½¬è®©

// 2. ä¿®æ”¹create_deceasedï¼ˆ1hï¼‰
//    - æ·»åŠ æ³¨é‡Šè¯´æ˜owneræƒåˆ©ä¿æŠ¤

// 3. å‰ç«¯ä¿®æ”¹ï¼ˆ3hï¼‰
//    - è½¬è®©ownerç•Œé¢
//    - æƒé™æç¤º

// 4. æµ‹è¯•ï¼ˆ2hï¼‰
```

**Day 3: éœ€æ±‚3å®ç°ï¼ˆ5hï¼‰**
```rust
// 1. ä¿®æ”¹transfer_deceasedï¼ˆ1hï¼‰
//    - åˆ é™¤å¢“ä½æƒé™æ£€æŸ¥
//    - æ·»åŠ å‡†å…¥ç­–ç•¥æ£€æŸ¥

// 2. å®ç°å‡†å…¥ç­–ç•¥ï¼ˆ3hï¼‰
//    - AdmissionPolicyæšä¸¾
//    - set_admission_policy
//    - ç™½åå•ç®¡ç†
//    - ç”³è¯·å®¡æ‰¹æµç¨‹

// 3. å‰ç«¯ä¿®æ”¹ï¼ˆ1hï¼‰
//    - è¿å¢“ç•Œé¢
//    - å‡†å…¥ç­–ç•¥è®¾ç½®
```

**Day 4: éœ€æ±‚1å®ç°ï¼ˆ0.5hï¼‰**
```rust
// 1. ä¿®æ”¹transfer_graveï¼ˆ0.5hï¼‰
//    - æ·»åŠ å¢“ä½ä¸ºç©ºæ£€æŸ¥
//    - æ–°å¢é”™è¯¯ç±»å‹
```

#### Week 2: éœ€æ±‚4å®ç°ï¼ˆ34hï¼‰

**Day 1-2: æ•°æ®ç»“æ„ä¸å­˜å‚¨ï¼ˆ6hï¼‰**
```rust
// 1. GraveGovernanceç»“æ„ï¼ˆ2hï¼‰
// 2. GraveProposalç»“æ„ï¼ˆ2hï¼‰
// 3. å­˜å‚¨é¡¹å®šä¹‰ï¼ˆ2hï¼‰
```

**Day 3-4: Extrinsicå®ç°ï¼ˆ16hï¼‰**
```rust
// 1. set_grave_governanceï¼ˆ2hï¼‰
// 2. propose_grave_actionï¼ˆ4hï¼‰
// 3. vote_grave_proposalï¼ˆ3hï¼‰
// 4. finalize_grave_proposalï¼ˆ4hï¼‰
// 5. è¾…åŠ©å‡½æ•°ï¼ˆ3hï¼‰
```

**Day 5: å‰ç«¯é›†æˆï¼ˆ12hï¼‰**
```typescript
// 1. æ²»ç†ç­–ç•¥é…ç½®ï¼ˆ3hï¼‰
// 2. ææ¡ˆåˆ›å»ºä¸åˆ—è¡¨ï¼ˆ4hï¼‰
// 3. æŠ•ç¥¨ç•Œé¢ï¼ˆ3hï¼‰
// 4. é€šçŸ¥ç³»ç»Ÿï¼ˆ2hï¼‰
```

---

### Phase 2ï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰

**æµ‹è¯•ç”¨ä¾‹**ï¼ˆ16hï¼‰:
```rust
// 1. éœ€æ±‚1æµ‹è¯•ï¼ˆ2hï¼‰
//    - å¢“ä½ä¸ºç©ºæ‰èƒ½è½¬è®©
//    - å¢“ä½éç©ºè½¬è®©å¤±è´¥

// 2. éœ€æ±‚2æµ‹è¯•ï¼ˆ3hï¼‰
//    - ä»…ownerå¯è½¬è®©
//    - å¢“ä¸»æ— æ³•å¼ºåˆ¶è½¬è®©

// 3. éœ€æ±‚3æµ‹è¯•ï¼ˆ4hï¼‰
//    - ä»…ownerå¯è¿ç§»
//    - å‡†å…¥ç­–ç•¥æµ‹è¯•ï¼ˆPublic/Whitelist/RequireApprovalï¼‰

// 4. éœ€æ±‚4æµ‹è¯•ï¼ˆ5hï¼‰
//    - ææ¡ˆåˆ›å»º
//    - æŠ•ç¥¨æµç¨‹
//    - æ‰§è¡Œææ¡ˆ

// 5. é›†æˆæµ‹è¯•ï¼ˆ2hï¼‰
//    - å®Œæ•´åœºæ™¯æµ‹è¯•
```

**æ–‡æ¡£ç¼–å†™**ï¼ˆ8hï¼‰:
```markdown
// 1. READMEæ›´æ–°ï¼ˆ3hï¼‰
// 2. ç”¨æˆ·æŒ‡å—ï¼ˆ3hï¼‰
// 3. APIæ–‡æ¡£ï¼ˆ2hï¼‰
```

---

## ğŸ“š å®Œæ•´æ–‡æ¡£ç»“æ„

### 1. ç”¨æˆ·æŒ‡å—

```markdown
## é€è€…Owneræƒåˆ©ä¿æŠ¤

### æˆ‘çš„æƒåˆ©
- âœ… æˆ‘å¯ä»¥è½¬è®©é€è€…ownerç»™ä»–äºº
- âœ… æˆ‘å¯ä»¥è¿ç§»é€è€…åˆ°å…¶ä»–å¢“ä½
- âœ… æˆ‘å¯ä»¥å‚ä¸å¢“ä½æ²»ç†æŠ•ç¥¨
- âŒ å¢“ä¸»ä¸èƒ½å¼ºåˆ¶æ”¶å›æˆ‘çš„ç®¡ç†æƒ

### å¢“ä¸»å¦‚ä½•ä¸æˆ‘åä½œ
1. å¢“ä¸»æƒ³è½¬è®©å¢“ä½
   â†’ å¢“ä¸»ä¼šè”ç³»æˆ‘ï¼Œè¯·æˆ‘è¿ç§»é€è€…
   â†’ æˆ‘è‡ªä¸»å†³å®šè¿åˆ°å“ªé‡Œ
   â†’ è¿ç§»åï¼Œå¢“ä¸»æ‰èƒ½è½¬è®©å¢“ä½

2. å¢“ä¸»æƒ³æ›´æ¢å¢“ä½å°é¢/éŸ³ä¹
   â†’ å¦‚æœå¢“ä½å¯ç”¨æ²»ç†ï¼Œæˆ‘å¯ä»¥æŠ•ç¥¨
   â†’ æŠ•ç¥¨é€šè¿‡åæ‰èƒ½æ‰§è¡Œ

### å¦‚ä½•è¿ç§»é€è€…
1. æ‰¾åˆ°ç›®æ ‡å¢“ä½
2. æ£€æŸ¥å‡†å…¥ç­–ç•¥ï¼š
   - Publicï¼šç›´æ¥è¿ç§»
   - Whitelistï¼šéœ€è¦åœ¨ç™½åå•
   - RequireApprovalï¼šéœ€è¦ç”³è¯·å®¡æ‰¹
3. è°ƒç”¨transfer_deceased
4. æˆåŠŸï¼
```

---

### 2. å¢“ä¸»æŒ‡å—

```markdown
## å¢“ä¸»èŒè´£ä¸é™åˆ¶

### æˆ‘å¯ä»¥åšä»€ä¹ˆ
- âœ… ç®¡ç†å¢“ä½åŸºç¡€è®¾æ–½ï¼ˆå°é¢ã€éŸ³ä¹ï¼‰
- âœ… è®¾ç½®å‡†å…¥ç­–ç•¥ï¼ˆè°å¯ä»¥è¿å…¥ï¼‰
- âœ… æ·»åŠ /ç§»é™¤ç®¡ç†å‘˜
- âœ… è½¬è®©å¢“ä½ï¼ˆå‰æï¼šå¢“ä½ä¸ºç©ºï¼‰
- âœ… å¯ç”¨å¢“ä½æ²»ç†ï¼ˆå¯é€‰ï¼‰

### æˆ‘ä¸èƒ½åšä»€ä¹ˆ
- âŒ å¼ºåˆ¶æ›¿æ¢é€è€…owner
- âŒ å¼ºåˆ¶è¿ç§»é€è€…
- âŒ é˜»æ­¢é€è€…ownerè¿å‡º

### å¦‚ä½•è½¬è®©å¢“ä½
1. è”ç³»æ‰€æœ‰é€è€…owner
2. è¯·ä»–ä»¬è¿ç§»é€è€…åˆ°å…¶ä»–å¢“ä½
3. ç­‰å¾…æ‰€æœ‰é€è€…è¿å‡º
4. è°ƒç”¨transfer_graveï¼ˆæˆ–å‘èµ·æ²»ç†ææ¡ˆï¼‰
5. æˆåŠŸï¼

### å¦‚ä½•ç®¡ç†å‡†å…¥
1. è®¾ç½®å‡†å…¥ç­–ç•¥ï¼š
   - GraveOwnerOnlyï¼šæˆ‘è‡ªå·±å†³å®š
   - Publicï¼šå…¬å¼€æ¥æ”¶
   - Whitelistï¼šç™½åå•åˆ¶
   - RequireApprovalï¼šç”³è¯·å®¡æ‰¹
2. ç®¡ç†ç™½åå•æˆ–å®¡æ‰¹ç”³è¯·
```

---

## ğŸ¯ æœ€ç»ˆè¯„ä¼°

### æ–¹æ¡ˆä¼˜åŠ¿

| ä¼˜åŠ¿ | è¯´æ˜ | ä»·å€¼ |
|------|------|------|
| **åŒå±‚Owneræ¸…æ™°** | å¢“ä½ownerç®¡åŸºç¡€è®¾æ–½ï¼Œé€è€…ownerç®¡å†…å®¹ | â­â­â­â­â­ |
| **é€è€…Ownerä¼˜å…ˆ** | æ¶‰åŠé€è€…çš„äº‹åŠ¡ï¼Œé€è€…owneræ‹¥æœ‰æœ€ç»ˆå†³ç­–æƒ | â­â­â­â­â­ |
| **æƒåŠ›åˆ¶è¡¡** | é€šè¿‡æ²»ç†æŠ•ç¥¨åˆ¶è¡¡å¢“ä¸»æƒåŠ› | â­â­â­â­â­ |
| **è‡ªç”±æµåŠ¨** | é€è€…å¯è‡ªç”±è¿ç§»ï¼Œå¸‚åœºæµåŠ¨æ€§é«˜ | â­â­â­â­â­ |
| **çµæ´»æ²»ç†** | å¯é€‰å¯ç”¨ï¼Œé»˜è®¤å…³é—­ | â­â­â­â­ |

### å®æ–½æˆæœ¬

| é¡¹ç›® | å·¥ä½œé‡ | éš¾åº¦ |
|------|--------|------|
| éœ€æ±‚1 | 0.5h | ğŸŸ¢ æ˜“ |
| éœ€æ±‚2 | 8h | ğŸŸ¢ æ˜“ |
| éœ€æ±‚3 | 5h | ğŸŸ¡ ä¸­ |
| éœ€æ±‚4 | 34h | ğŸŸ¡ ä¸­ |
| æµ‹è¯•æ–‡æ¡£ | 24h | ğŸŸ¢ æ˜“ |
| **æ€»è®¡** | **71.5h (çº¦2.5å‘¨)** | ğŸŸ¡ ä¸­ |

### é£é™©è¯„ä¼°

| é£é™© | ç­‰çº§ | åº”å¯¹ |
|------|------|------|
| ç”¨æˆ·ç†è§£æˆæœ¬ | ğŸŸ¡ ä¸­ | è¯¦ç»†æ–‡æ¡£+åˆ†æ­¥å¼•å¯¼ |
| æ²»ç†å‚ä¸åº¦ä½ | ğŸŸ¡ ä¸­ | é»˜è®¤å…³é—­+å¯é€‰å¯ç”¨ |
| Gasæˆæœ¬å¢åŠ  | ğŸŸ¢ ä½ | æŠ•ç¥¨æ‰¹é‡åŒ–+é“¾ä¸‹ç­¾å |
| å¢“ä¸»å¤±æ§æ„Ÿ | ğŸŸ¡ ä¸­ | ä¿ç•™ç´§æ€¥å¦å†³æƒ |

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒä»·å€¼ä¸»å¼ 

**è¿™ä¸æ˜¯ç®€å•çš„åŠŸèƒ½å åŠ ï¼Œè€Œæ˜¯æ„å»ºäº†ä¸€ä¸ªå…¨æ–°çš„æƒé™æ¨¡å‹**ï¼š

```
ä¼ ç»Ÿæ¨¡å‹ï¼ˆå¢“ä½ç»å¯¹ä¸­å¿ƒï¼‰ï¼š
  å¢“ä¸»æ‹¥æœ‰ä¸€åˆ‡æƒåŠ›
    â†“
  é€è€…owneræƒåˆ©è„†å¼±
    â†“
  ç”¨æˆ·ä¸æ•¢æˆæƒ
    â†“
  å¸‚åœºåƒµåŒ–

æ–°æ¨¡å‹ï¼ˆåŒå±‚èŒè´£åˆ†ç¦»+é€è€…ä¼˜å…ˆï¼‰ï¼š
  å¢“ä½ownerç®¡åŸºç¡€è®¾æ–½
  é€è€…ownerç®¡å†…å®¹ï¼Œæƒåˆ©å—ä¿æŠ¤
    â†“
  åŒæ–¹åä½œå…±èµ¢
    â†“
  ç”¨æˆ·æ•¢äºæˆæƒ
    â†“
  å¸‚åœºæµåŠ¨æ€§é«˜
    â†“
  é€šè¿‡æ²»ç†åˆ¶è¡¡æƒåŠ›
    â†“
  çœŸæ­£çš„å»ä¸­å¿ƒåŒ–
```

### 4ä¸ªéœ€æ±‚çš„èåˆä»·å€¼

| éœ€æ±‚ | å•ç‹¬ä»·å€¼ | èåˆåä»·å€¼ |
|------|---------|-----------|
| éœ€æ±‚1ï¼ˆå¢“ä½è½¬è®©å‰æ¸…ç©ºï¼‰ | â­â­â­ | â­â­â­â­â­ï¼ˆå¼ºåˆ¶åå•†ï¼‰ |
| éœ€æ±‚2ï¼ˆç¦æ­¢å¼ºåˆ¶æ›¿æ¢ownerï¼‰ | â­â­â­â­â­ | â­â­â­â­â­ï¼ˆæ ¸å¿ƒä¿æŠ¤ï¼‰ |
| éœ€æ±‚3ï¼ˆä»…ownerå¯è¿å¢“ï¼‰ | â­â­â­â­â­ | â­â­â­â­â­ï¼ˆè‡ªç”±æµåŠ¨ï¼‰ |
| éœ€æ±‚4ï¼ˆowneræŠ•ç¥¨æ²»ç†ï¼‰ | â­â­â­ | â­â­â­â­â­ï¼ˆæƒåŠ›åˆ¶è¡¡ï¼‰ |

**èåˆæ•ˆæœ**ï¼š1+1+1+1 > 4

---

## âœ… æœ€ç»ˆå»ºè®®

**ç«‹å³å®æ–½**ï¼šåŒå±‚èŒè´£åˆ†ç¦»èåˆæ–¹æ¡ˆï¼ˆ71.5å°æ—¶ï¼Œ2.5å‘¨ï¼‰

**ç†ç”±**ï¼š
1. âœ… å®Œæ•´çš„æƒé™æ¨¡å‹ï¼Œå››ä¸ªéœ€æ±‚æ·±åº¦èåˆ
2. âœ… é€è€…owneræƒåˆ©å¾—åˆ°ç»å¯¹ä¿æŠ¤
3. âœ… å¢“ä¸»ä¸é€è€…owneråä½œå…±èµ¢
4. âœ… å¸‚åœºæµåŠ¨æ€§æœ€å¤§åŒ–
5. âœ… é€šè¿‡æ²»ç†å®ç°æƒåŠ›åˆ¶è¡¡
6. âœ… çœŸæ­£çš„å»ä¸­å¿ƒåŒ–

**é¢„æœŸæ•ˆæœ**ï¼š
- ç”¨æˆ·ä¿¡ä»»åº¦æå‡ 300%
- æˆæƒç®¡ç†æ¯”ä¾‹æå‡ 500%
- å¢“ä½æµåŠ¨æ€§æå‡ 200%
- ç”¨æˆ·æ»¡æ„åº¦æå‡ 250%

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-24  
**åˆ†æè€…**: AI Assistant  
**æ–‡æ¡£ç‰ˆæœ¬**: v2.0 - åŒå±‚èŒè´£åˆ†ç¦»èåˆç‰ˆ  
**çŠ¶æ€**: âœ… è®¾è®¡å®Œæˆï¼Œæ¨èç«‹å³å®æ–½  
**å·¥ä½œé‡**: 71.5å°æ—¶ï¼ˆ2.5å‘¨ï¼‰

