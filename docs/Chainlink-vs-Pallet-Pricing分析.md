# ğŸ” ç”¨ Chainlink Feeds æ›¿ä»£ pallet-pricing çš„å¯è¡Œæ€§åˆ†æ

**åˆ†ææ—¥æœŸ**: 2025-11-05  
**é—®é¢˜**: OTC åšå¸‚å•†èƒ½å¦ç”¨ Arbitrum Chainlink Feeds ç»„åˆè®¡ç®— DUST/USDC ä»·æ ¼ï¼Œæ›¿ä»£ pallet-pricingï¼Ÿ

---

## ğŸ“‹ èƒŒæ™¯å¯¹æ¯”

### å½“å‰æ¶æ„ï¼špallet-pricing

```
Stardust é“¾
  â”‚
  â”œâ”€ pallet-pricing
  â”‚   â”œâ”€ OTC åšå¸‚å•† A: å‘å¸ƒ DUST/USDC = $1.02
  â”‚   â”œâ”€ OTC åšå¸‚å•† B: å‘å¸ƒ DUST/USDC = $1.01
  â”‚   â”œâ”€ OTC åšå¸‚å•† C: å‘å¸ƒ DUST/USDC = $1.00
  â”‚   â””â”€ èšåˆä»·æ ¼: $1.01 (ä¸­ä½æ•°)
  â”‚
  â””â”€ å…¶ä»–æ¨¡å—ä½¿ç”¨ä»·æ ¼
```

**ç‰¹ç‚¹**ï¼š
- âœ… å®Œå…¨åœ¨ Stardust é“¾ä¸Š
- âœ… å®æ—¶ä»·æ ¼
- âœ… åšå¸‚å•†ä¸»åŠ¨æŠ¥ä»·
- âš ï¸ ä¾èµ–åšå¸‚å•†è¯šä¿¡

### æè®®æ¶æ„ï¼šChainlink Feeds

```
Arbitrum é“¾
  â”‚
  â”œâ”€ Chainlink USDC/USD Feed
  â”‚   â””â”€ ä»·æ ¼: $1.00
  â”‚
  â”œâ”€ Chainlink ETH/USD Feed (?)
  â”‚   â””â”€ ä»·æ ¼: $2000
  â”‚
  â””â”€ âŒ Chainlink DUST/USD Feed
      â””â”€ ä¸å­˜åœ¨ï¼DUST æ˜¯ Stardust åŸç”Ÿä»£å¸
```

**é—®é¢˜**ï¼š
- âŒ **Chainlink æ²¡æœ‰ DUST ä»·æ ¼æº**
- âŒ æ— æ³•ç›´æ¥è·å– DUST/USDC

---

## âŒ æ ¸å¿ƒé—®é¢˜ï¼šChainlink æ—  DUST ä»·æ ¼æº

### ä¸ºä»€ä¹ˆæ²¡æœ‰ DUST Feedï¼Ÿ

```
Chainlink Price Feeds çš„å‰ææ¡ä»¶:

1. æµåŠ¨æ€§è¦æ±‚
   - éœ€è¦åœ¨å¤šä¸ªä¸»æµ CEX ä¸Šäº¤æ˜“
   - æ—¥äº¤æ˜“é‡ > $10M
   - å¸‚å€¼ > $100M

2. å¸‚åœºæˆç†Ÿåº¦
   - ç¨³å®šçš„å¸‚åœºä»·æ ¼
   - å¤šä¸ªå¯ä¿¡æ•°æ®æº
   - è¶³å¤Ÿçš„å–‚ä»·èŠ‚ç‚¹

DUST ä»£å¸ç°çŠ¶:
   âŒ å¯èƒ½æœªåœ¨ä¸»æµ CEX ä¸Šå¸‚
   âŒ æµåŠ¨æ€§å¯èƒ½ä¸è¶³
   âŒ ä¸»è¦åœ¨ Stardust é“¾ä¸Šæµé€š
   
   â†’ Chainlink ä¸ä¼šä¸ºå…¶åˆ›å»º Feed
```

---

## ğŸ¤” å¯è¡Œçš„æ›¿ä»£æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šæ··åˆæ¶æ„ï¼ˆæ¨è â­â­â­â­â­ï¼‰

```
æ¶æ„è®¾è®¡:

Stardust é“¾ (ä¸»ä»·æ ¼æº)
  â”‚
  â”œâ”€ pallet-pricing
  â”‚   â”œâ”€ OTC åšå¸‚å•†æŠ¥ä»· (ä¸»è¦)
  â”‚   â””â”€ DEX ä»·æ ¼ (Uniswap DUST/USDC pool)
  â”‚
  â”œâ”€ OCW (é“¾ä¸‹å·¥ä½œæœº)
  â”‚   â””â”€ å®šæœŸæ¨é€ä»·æ ¼åˆ° Arbitrum
  â”‚
  â””â”€ è·¨é“¾æ¡¥æ¥
      â†“
      
Arbitrum é“¾ (éªŒè¯ä»·æ ¼)
  â”‚
  â”œâ”€ PriceOracle åˆçº¦
  â”‚   â”œâ”€ dustUsdcPrice (ä» Stardust OCW æ¨é€)
  â”‚   â””â”€ Chainlink USDC/USD (éªŒè¯ç”¨)
  â”‚
  â””â”€ StardustVaultRouter
      â””â”€ ä½¿ç”¨ PriceOracle éªŒè¯äº¤æ¢ä»·æ ¼
```

**ä¼˜åŠ¿**ï¼š
- âœ… **ä¿ç•™ pallet-pricing**ï¼šç»§ç»­ä½¿ç”¨é“¾ä¸Šåšå¸‚å•†
- âœ… **OCW æ¨é€ä»·æ ¼**ï¼šå°† Stardust ä»·æ ¼æ¨é€åˆ° Arbitrum
- âœ… **Chainlink è¾…åŠ©éªŒè¯**ï¼šç”¨ USDC/USD éªŒè¯ USDC ç¨³å®šæ€§
- âœ… **åŒé‡ä¿æŠ¤**ï¼šé“¾ä¸Šä»·æ ¼ + è·¨é“¾éªŒè¯

**å®ç°**ï¼š
```rust
// pallets/pricing/src/lib.rs (ä¿æŒä¸å˜)

impl<T: Config> Pallet<T> {
    /// OTC åšå¸‚å•†å‘å¸ƒä»·æ ¼
    pub fn set_price(
        origin: OriginFor<T>,
        asset_id: AssetId,
        price: Balance,
    ) -> DispatchResult {
        // ç°æœ‰é€»è¾‘
    }
    
    /// è·å–èšåˆä»·æ ¼
    pub fn get_price(asset_id: AssetId) -> Option<Balance> {
        // ä»å¤šä¸ªåšå¸‚å•†ä»·æ ¼ä¸­è®¡ç®—ä¸­ä½æ•°
    }
}

// pallets/dust-bridge/src/ocw.rs (æ–°å¢)

impl<T: Config> Pallet<T> {
    /// OCW: æ¨é€ä»·æ ¼åˆ° Arbitrum Oracle
    fn update_arbitrum_oracle(block_number: BlockNumberFor<T>) {
        // 1. ä» pallet-pricing è·å– DUST/USDC ä»·æ ¼
        if let Some(dust_price) = pallet_pricing::Pallet::<T>::get_price(DUST_ASSET_ID) {
            // 2. æ„å»º Arbitrum äº¤æ˜“
            let tx_data = Self::encode_update_price_call(dust_price);
            
            // 3. å‘é€åˆ° Arbitrum PriceOracle åˆçº¦
            let _ = Self::send_arbitrum_transaction(
                ORACLE_ADDRESS,
                tx_data,
            );
        }
    }
}
```

```solidity
// PriceOracle.sol (å·²å®ç°ï¼Œè§ ORACLE_INTEGRATION.md)

contract PriceOracle {
    /// DUST/USDC ä»·æ ¼ (ä» Stardust OCW æ¨é€)
    uint256 public dustUsdcPrice;
    
    /// Chainlink USDC/USD (è¾…åŠ©éªŒè¯)
    AggregatorV3Interface public usdcUsdFeed;
    
    /// æ›´æ–° DUST ä»·æ ¼ (OCW è°ƒç”¨)
    function updateDustPrice(uint256 _dustUsdcPrice) 
        external 
        onlyRole(UPDATER_ROLE) 
    {
        dustUsdcPrice = _dustUsdcPrice;
        lastUpdateTime = block.timestamp;
    }
    
    /// éªŒè¯ä»·æ ¼ (Router è°ƒç”¨)
    function validateSwapPrice(
        uint256 dustAmount,
        uint256 usdcAmount
    ) external view returns (bool isValid, uint256 deviation) {
        // ä½¿ç”¨ OCW æ¨é€çš„ DUST ä»·æ ¼éªŒè¯
        uint256 swapPrice = (usdcAmount * 1e18) / dustAmount * 1e12;
        uint256 priceDiff = abs(swapPrice - dustUsdcPrice);
        deviation = (priceDiff * 10000) / dustUsdcPrice;
        isValid = deviation <= maxDeviation;
    }
}
```

---

### æ–¹æ¡ˆ 2ï¼šå®Œå…¨ä¾èµ– DEX ä»·æ ¼ï¼ˆä¸æ¨è â­â­ï¼‰

```
æ¶æ„:

Arbitrum é“¾
  â”‚
  â”œâ”€ Uniswap V3 DUST/USDC Pool
  â”‚   â””â”€ å½“å‰ä»·æ ¼: $1.01
  â”‚
  â””â”€ PriceOracle
      â””â”€ ä» Uniswap TWAP è·å–ä»·æ ¼
```

**é—®é¢˜**ï¼š
- âŒ **æ˜“è¢«æ“çºµ**ï¼šé—ªç”µè´·æ”»å‡»
- âŒ **æµåŠ¨æ€§ä¾èµ–**ï¼šéœ€è¦è¶³å¤Ÿçš„æ± å­æµåŠ¨æ€§
- âŒ **å»¶è¿Ÿé—®é¢˜**ï¼šTWAP æœ‰æ»åæ€§
- âš ï¸ **æ— åšå¸‚å•†å‚ä¸**ï¼šå¤±å» OTC åšå¸‚åŠŸèƒ½

**ä¸æ¨èåŸå› **ï¼š
```
é—ªç”µè´·æ”»å‡»ç¤ºä¾‹:

1. æ”»å‡»è€…å€Ÿå…¥ 1,000,000 DUST
2. ç ¸ç›˜ Uniswap DUST/USDC æ± 
   - ä»·æ ¼: $1.00 â†’ $0.70 (-30%)
3. Oracle è¯»å–ä»·æ ¼: $0.70
4. ç”¨æˆ·äº¤æ˜“ä»¥ä½ä»·æˆäº¤
5. æ”»å‡»è€…è·åˆ©

å³ä½¿ä½¿ç”¨ TWAPï¼Œä¹Ÿåªæ˜¯å¢åŠ æ”»å‡»æˆæœ¬ï¼Œæ— æ³•å®Œå…¨é˜²æ­¢ã€‚
```

---

### æ–¹æ¡ˆ 3ï¼šæ”¾å¼ƒ Arbitrumï¼Œçº¯ Stardustï¼ˆå¯è¡Œ â­â­â­ï¼‰

```
æ¶æ„:

Stardust é“¾ (å…¨éƒ¨åœ¨é“¾ä¸Š)
  â”‚
  â”œâ”€ pallet-pricing (OTC åšå¸‚å•†ä»·æ ¼)
  â”œâ”€ pallet-dex (DEX äº¤æ¢)
  â”œâ”€ pallet-ai-trader (AI äº¤æ˜“)
  â””â”€ æ‰€æœ‰åŠŸèƒ½éƒ½åœ¨ Stardust é“¾ä¸Š
  
ä¸éœ€è¦ Arbitrum
ä¸éœ€è¦ Chainlink
```

**ä¼˜åŠ¿**ï¼š
- âœ… å®Œå…¨å»ä¸­å¿ƒåŒ–
- âœ… æ— è·¨é“¾é£é™©
- âœ… æ—  Oracle ä¾èµ–

**åŠ£åŠ¿**ï¼š
- âŒ å¤±å» Arbitrum ç”Ÿæ€
- âŒ æ— æ³•å¯¹æ¥ Uniswap
- âŒ ç”¨æˆ·éœ€è¦ä¸¤æ¡é“¾

---

## ğŸ“Š è¯¦ç»†å¯¹æ¯”åˆ†æ

### ä»·æ ¼å‡†ç¡®æ€§

| æ–¹æ¡ˆ | ä»·æ ¼æ¥æº | å‡†ç¡®æ€§ | å®æ—¶æ€§ | æŠ—æ“çºµæ€§ |
|------|----------|--------|--------|----------|
| **pallet-pricing** | OTC åšå¸‚å•† | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| **Chainlink DUST** | âŒ ä¸å­˜åœ¨ | âŒ | âŒ | âŒ |
| **Uniswap TWAP** | DEX | â­â­â­ | â­â­â­ | â­â­ |
| **æ··åˆæ¶æ„** | åšå¸‚å•†+OCW | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ |

### å»ä¸­å¿ƒåŒ–ç¨‹åº¦

| æ–¹æ¡ˆ | Stardust | Arbitrum | æ€»ä½“ | å¤‡æ³¨ |
|------|----------|----------|------|------|
| **pallet-pricing** | âœ… å»ä¸­å¿ƒåŒ– | - | â­â­â­â­ | å¤šä¸ªåšå¸‚å•† |
| **Chainlink DUST** | - | âŒ ä¸å­˜åœ¨ | âŒ | - |
| **Uniswap TWAP** | - | âœ… å»ä¸­å¿ƒåŒ– | â­â­â­ | ä¾èµ–æµåŠ¨æ€§ |
| **æ··åˆæ¶æ„** | âœ… å»ä¸­å¿ƒåŒ– | âœ… OCWæ¨é€ | â­â­â­â­â­ | æœ€ä½³æ–¹æ¡ˆ |

### æˆæœ¬åˆ†æ

| æ–¹æ¡ˆ | å¼€å‘æˆæœ¬ | è¿è¥æˆæœ¬ | Gasæˆæœ¬ | æ€»æˆæœ¬ |
|------|----------|----------|---------|--------|
| **pallet-pricing** | ä½ï¼ˆå·²æœ‰ï¼‰ | ä½ | ä½ | â­â­â­â­â­ |
| **Chainlink DUST** | - | âŒ ä¸å¯è¡Œ | - | âŒ |
| **Uniswap TWAP** | ä¸­ | ä½ | ä¸­ | â­â­â­ |
| **æ··åˆæ¶æ„** | ä¸­ | ä¸­ï¼ˆOCWï¼‰ | ä¸­ | â­â­â­â­ |

### å¯é æ€§

| æ–¹æ¡ˆ | å•ç‚¹æ•…éšœ | ä»·æ ¼å»¶è¿Ÿ | æ”»å‡»é£é™© | å¯é æ€§ |
|------|----------|----------|----------|--------|
| **pallet-pricing** | ä½ | æä½ | ä½ | â­â­â­â­â­ |
| **Chainlink DUST** | - | - | - | âŒ |
| **Uniswap TWAP** | ä¸­ | ä¸­ | é«˜ | â­â­ |
| **æ··åˆæ¶æ„** | ä½ | ä½ | æä½ | â­â­â­â­â­ |

---

## âœ… æ¨èæ–¹æ¡ˆï¼šæ··åˆæ¶æ„

### æ¶æ„è¯¦ç»†è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Stardust é“¾ (ä»·æ ¼æºå¤´)                     â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ pallet-pricing (ä¸»ä»·æ ¼ç®¡ç†)                             â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  OTC åšå¸‚å•† A: DUST/USDC = $1.02  â”€â”€â”€â”€â”                â”‚ â”‚
â”‚  â”‚  OTC åšå¸‚å•† B: DUST/USDC = $1.01  â”€â”€â”€â”€â”¼â”€> èšåˆç®—æ³•     â”‚ â”‚
â”‚  â”‚  OTC åšå¸‚å•† C: DUST/USDC = $1.00  â”€â”€â”€â”€â”˜   (ä¸­ä½æ•°)     â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  èšåˆä»·æ ¼: $1.01                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                    â”‚
â”‚                          â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ OCW (é“¾ä¸‹å·¥ä½œæœº)                                        â”‚ â”‚
â”‚  â”‚  - æ¯ 10 åˆ†é’Ÿä» pallet-pricing è¯»å–ä»·æ ¼                â”‚ â”‚
â”‚  â”‚  - æˆ–ä»·æ ¼å˜åŒ– > 1% æ—¶è§¦å‘                               â”‚ â”‚
â”‚  â”‚  - ç­¾åäº¤æ˜“æ¨é€åˆ° Arbitrum                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ è·¨é“¾æ¨é€
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Arbitrum é“¾ (ä»·æ ¼éªŒè¯)                    â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ PriceOracle åˆçº¦                                        â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  dustUsdcPrice: $1.01 â† Stardust OCW æ¨é€             â”‚ â”‚
â”‚  â”‚  lastUpdateTime: 12:00:00                               â”‚ â”‚
â”‚  â”‚  priceStaleThreshold: 1 hour                            â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  Chainlink USDC/USD: $1.00 (è¾…åŠ©éªŒè¯ USDC ç¨³å®šæ€§)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                    â”‚
â”‚                          â†“ ä»·æ ¼éªŒè¯                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ StardustVaultRouter                                     â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  ç”¨æˆ·äº¤æ¢: 100 DUST â†’ ? USDC                           â”‚ â”‚
â”‚  â”‚  â†“                                                       â”‚ â”‚
â”‚  â”‚  Uniswap æ‰§è¡Œ: è·å¾— 95 USDC                            â”‚ â”‚
â”‚  â”‚  â†“                                                       â”‚ â”‚
â”‚  â”‚  Oracle éªŒè¯:                                           â”‚ â”‚
â”‚  â”‚    - Oracle ä»·æ ¼: $1.01                                 â”‚ â”‚
â”‚  â”‚    - Uniswap ä»·æ ¼: $0.95                                â”‚ â”‚
â”‚  â”‚    - åå·®: 6%                                            â”‚ â”‚
â”‚  â”‚    - æ£€æŸ¥: 6% > maxDeviation (5%) âŒ                    â”‚ â”‚
â”‚  â”‚  â†“                                                       â”‚ â”‚
â”‚  â”‚  äº¤æ˜“å›æ»šï¼Œç”¨æˆ·èµ„é‡‘å—ä¿æŠ¤ âœ…                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®ç°æ­¥éª¤

#### 1. Stardust é“¾ç«¯ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

```rust
// pallet-pricing å·²æœ‰åŠŸèƒ½ï¼Œä¿æŒä¸å˜
// åšå¸‚å•†ç»§ç»­é€šè¿‡ set_price å‘å¸ƒä»·æ ¼
```

#### 2. OCW æ¨é€é€»è¾‘ï¼ˆæ–°å¢ï¼‰

```rust
// pallets/dust-bridge/src/ocw.rs

impl<T: Config> Pallet<T> {
    /// OCW ä¸»å‡½æ•°
    pub fn offchain_worker(block_number: BlockNumberFor<T>) {
        // æ¯ 100 ä¸ªåŒºå—ï¼ˆçº¦ 10 åˆ†é’Ÿï¼‰æ›´æ–°ä¸€æ¬¡
        if block_number % 100 == 0 {
            Self::update_arbitrum_oracle(block_number);
        }
        
        // æˆ–ä»·æ ¼å˜åŒ– > 1% æ—¶è§¦å‘
        if Self::should_update_price() {
            Self::update_arbitrum_oracle(block_number);
        }
    }
    
    /// æ¨é€ä»·æ ¼åˆ° Arbitrum
    fn update_arbitrum_oracle(block_number: BlockNumberFor<T>) {
        // 1. ä» pallet-pricing è·å– DUST/USDC ä»·æ ¼
        let dust_asset_id = T::DustAssetId::get();
        let usdc_asset_id = T::UsdcAssetId::get();
        
        if let Some(dust_price) = pallet_pricing::Pallet::<T>::get_price(
            dust_asset_id,
            usdc_asset_id,
        ) {
            // 2. è½¬æ¢ä¸º 18 ä½å°æ•°ï¼ˆArbitrum æ ¼å¼ï¼‰
            let price_18_decimals = Self::convert_to_18_decimals(dust_price);
            
            // 3. æ„å»º Arbitrum äº¤æ˜“
            // updateDustPrice(uint256 _dustUsdcPrice)
            let call_data = Self::encode_update_price_call(price_18_decimals);
            
            // 4. ç­¾åå¹¶å‘é€
            let result = Self::send_arbitrum_transaction(
                T::ArbitrumOracleAddress::get(),
                call_data,
                0, // value
            );
            
            match result {
                Ok(tx_hash) => {
                    log::info!(
                        "âœ… Oracle price updated: {} at tx {:?}",
                        dust_price,
                        tx_hash
                    );
                    
                    // è®°å½•æœ€åæ›´æ–°æ—¶é—´å’Œä»·æ ¼
                    <LastOraclePriceUpdate<T>>::put((block_number, dust_price));
                },
                Err(e) => {
                    log::error!("âŒ Oracle update failed: {:?}", e);
                }
            }
        }
    }
    
    /// åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ä»·æ ¼
    fn should_update_price() -> bool {
        if let Some((last_block, last_price)) = <LastOraclePriceUpdate<T>>::get() {
            let current_price = pallet_pricing::Pallet::<T>::get_price(
                T::DustAssetId::get(),
                T::UsdcAssetId::get(),
            );
            
            if let Some(current_price) = current_price {
                // è®¡ç®—ä»·æ ¼å˜åŒ–ç™¾åˆ†æ¯”
                let price_diff = if current_price > last_price {
                    current_price - last_price
                } else {
                    last_price - current_price
                };
                
                let change_percent = (price_diff * 10000) / last_price;
                
                // å¦‚æœå˜åŒ– > 1% (100 åŸºç‚¹)ï¼Œè§¦å‘æ›´æ–°
                return change_percent > 100;
            }
        }
        
        // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œè§¦å‘æ›´æ–°
        true
    }
}
```

#### 3. Arbitrum åˆçº¦ï¼ˆå·²å®ç°ï¼‰

```solidity
// PriceOracle.sol (å·²å®Œæˆï¼Œè§å‰é¢çš„å®ç°)
// StardustVaultRouter.sol (å·²é›†æˆï¼Œè§å‰é¢çš„ä¿®æ”¹)
```

### æ•°æ®æµç¤ºä¾‹

```
æ—¶é—´çº¿:

T = 0:00
  Stardust: åšå¸‚å•† A å‘å¸ƒä»·æ ¼ $1.01
  Stardust: pallet-pricing èšåˆ â†’ $1.01
  Stardust: OCW æ£€æµ‹åˆ°æ–°ä»·æ ¼
  Arbitrum: OCW æ¨é€ â†’ PriceOracle.updateDustPrice($1.01)
  
T = 0:05
  Arbitrum: ç”¨æˆ·è°ƒç”¨ Router.depositWithDUST(100 DUST)
  Arbitrum: Uniswap äº¤æ¢ â†’ 99 USDC
  Arbitrum: Oracle éªŒè¯:
    - Oracle: $1.01
    - Uniswap: $0.99
    - åå·®: 2% < 5% âœ…
  Arbitrum: äº¤æ˜“æˆåŠŸ
  
T = 0:10
  Stardust: åšå¸‚å•† B æ›´æ–°ä»·æ ¼ â†’ $1.02
  Stardust: pallet-pricing èšåˆ â†’ $1.015
  Stardust: OCW æ£€æµ‹ä»·æ ¼å˜åŒ– < 1%ï¼Œä¸è§¦å‘æ¨é€
  
T = 0:15
  Stardust: åšå¸‚å•† C æ›´æ–°ä»·æ ¼ â†’ $1.05
  Stardust: pallet-pricing èšåˆ â†’ $1.03
  Stardust: OCW æ£€æµ‹ä»·æ ¼å˜åŒ– > 1%ï¼Œè§¦å‘æ¨é€
  Arbitrum: OCW æ¨é€ â†’ $1.03
  
T = 0:20
  Arbitrum: æ”»å‡»è€…å°è¯•ç ¸ç›˜ Uniswap
  Arbitrum: DUST ä»·æ ¼ â†’ $0.70 (-30%)
  Arbitrum: ç”¨æˆ·äº¤æ˜“è§¦å‘
  Arbitrum: Oracle éªŒè¯:
    - Oracle: $1.03 (æ¥è‡ª Stardust)
    - Uniswap: $0.70
    - åå·®: 32% > 5% âŒ
  Arbitrum: äº¤æ˜“å›æ»š âœ…
  Arbitrum: ç”¨æˆ·èµ„é‡‘å—ä¿æŠ¤
```

---

## ğŸ¯ ç»“è®º

### âŒ ä¸å¯è¡Œï¼šç›´æ¥ä½¿ç”¨ Chainlink Feeds

**åŸå› **ï¼š
1. **Chainlink æ²¡æœ‰ DUST ä»·æ ¼æº**
   - DUST æ˜¯ Stardust åŸç”Ÿä»£å¸
   - æµåŠ¨æ€§ä¸è¶³ä»¥æ”¯æŒ Chainlink Feed
   - å¸‚åœºæ•°æ®æºä¸è¶³

2. **æ— æ³•ç»„åˆè®¡ç®—**
   - æ²¡æœ‰ DUST/ETHã€DUST/USD ç­‰åŸºç¡€æ•°æ®
   - æ— æ³•é€šè¿‡ Chainlink ç°æœ‰ Feeds æ¨å¯¼

3. **é€»è¾‘ä¸é€š**
   - Chainlink éœ€è¦å·²æœ‰çš„å¸‚åœºä»·æ ¼
   - pallet-pricing æ‰æ˜¯ä»·æ ¼çš„æºå¤´
   - æœ¬æœ«å€’ç½®

### âœ… æ¨èï¼šæ··åˆæ¶æ„

**æ ¸å¿ƒæ€è·¯**ï¼š
```
pallet-pricing (ä»·æ ¼æºå¤´)
    â†“
  OCW (è·¨é“¾æ¨é€)
    â†“
PriceOracle (Arbitrum éªŒè¯)
    â†“
Router (ä½¿ç”¨ä»·æ ¼)
```

**ä¼˜åŠ¿**ï¼š
1. âœ… **ä¿ç•™ pallet-pricing**
   - OTC åšå¸‚å•†ç»§ç»­å‘æŒ¥ä½œç”¨
   - ä»·æ ¼å‡†ç¡®ã€å®æ—¶
   
2. âœ… **è·¨é“¾ä»·æ ¼éªŒè¯**
   - OCW æ¨é€åˆ° Arbitrum
   - é˜²æ­¢ Arbitrum ä¾§ä»·æ ¼æ“çºµ
   
3. âœ… **Chainlink è¾…åŠ©**
   - éªŒè¯ USDC ç¨³å®šæ€§
   - æä¾›é¢å¤–æ•°æ®æº
   
4. âœ… **å®Œå…¨å»ä¸­å¿ƒåŒ–**
   - æ— ä¸­å¿ƒåŒ–æ•°æ®åº“
   - å¤šå±‚éªŒè¯æœºåˆ¶

### ğŸ“Š æ–¹æ¡ˆè¯„åˆ†

| æ–¹æ¡ˆ | å¯è¡Œæ€§ | åˆç†æ€§ | æˆæœ¬ | å®‰å…¨æ€§ | æ€»è¯„ |
|------|--------|--------|------|--------|------|
| **Chainlink DUST** | âŒ 0/10 | âŒ 0/10 | - | - | âŒ **ä¸å¯è¡Œ** |
| **æ”¾å¼ƒ Arbitrum** | âœ… 8/10 | âœ… 7/10 | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ |
| **çº¯ DEX ä»·æ ¼** | âš ï¸ 5/10 | âš ï¸ 4/10 | â­â­â­ | â­â­ | â­â­ |
| **æ··åˆæ¶æ„** | âœ… 10/10 | âœ… 10/10 | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ **æ¨è** |

---

## ğŸ”§ å®æ–½å»ºè®®

### çŸ­æœŸï¼ˆå·²å®Œæˆï¼‰

- [x] PriceOracle åˆçº¦å®ç°
- [x] Router é›†æˆ Oracle
- [x] ç¼–è¯‘æµ‹è¯•é€šè¿‡

### ä¸­æœŸï¼ˆæœ¬å‘¨ï¼‰

- [ ] OCW ä»·æ ¼æ¨é€å®ç°
- [ ] pallet-pricing é›†æˆ
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•

### é•¿æœŸï¼ˆä¸‹æœˆï¼‰

- [ ] ä¸»ç½‘éƒ¨ç½²
- [ ] ç›‘æ§å‘Šè­¦
- [ ] æ€§èƒ½ä¼˜åŒ–

---

## ğŸ’¡ å…³é”®è¦ç‚¹

### ä¸ºä»€ä¹ˆä¸èƒ½ç”¨ Chainlinkï¼Ÿ

```
1. Chainlink æ˜¯"ä»·æ ¼èšåˆå™¨"ï¼Œä¸æ˜¯"ä»·æ ¼åˆ›é€ è€…"
   - å®ƒä»ç°æœ‰å¸‚åœºè·å–ä»·æ ¼
   - å®ƒä¸èƒ½å‡­ç©ºåˆ›é€ ä»·æ ¼
   
2. DUST çš„ä»·æ ¼æ¥æºæ˜¯ Stardust é“¾ä¸Šçš„åšå¸‚å•†
   - åšå¸‚å•†é€šè¿‡ pallet-pricing å‘å¸ƒä»·æ ¼
   - è¿™æ˜¯å”¯ä¸€çš„æƒå¨ä»·æ ¼æº
   
3. æ­£ç¡®çš„æµç¨‹åº”è¯¥æ˜¯:
   pallet-pricing â†’ OCW â†’ Arbitrum â†’ Chainlink (æœªæ¥)
   è€Œä¸æ˜¯:
   Chainlink â†’ pallet-pricing (ä¸å¯èƒ½)
```

### ä¸ºä»€ä¹ˆéœ€è¦ pallet-pricingï¼Ÿ

```
1. OTC åšå¸‚å•†éœ€è¦å‘å¸ƒä»·æ ¼
   - åšå¸‚å•†åœ¨ Stardust é“¾ä¸Š
   - éœ€è¦é“¾ä¸Šä»·æ ¼ç®¡ç†æ¨¡å—
   
2. ä»·æ ¼èšåˆå’ŒéªŒè¯
   - å¤šä¸ªåšå¸‚å•†æŠ¥ä»·
   - è®¡ç®—ä¸­ä½æ•°/åŠ æƒå¹³å‡
   - æ£€æµ‹å¼‚å¸¸ä»·æ ¼
   
3. é“¾ä¸Šå…¶ä»–æ¨¡å—ä½¿ç”¨
   - AI äº¤æ˜“ç­–ç•¥
   - æ¸…ç®—æœºåˆ¶
   - é£é™©ç®¡ç†
```

### æœªæ¥çš„æ”¹è¿›æ–¹å‘

```
1. å½“ DUST æµåŠ¨æ€§è¶³å¤Ÿæ—¶
   â”œâ”€ å¯ä»¥ç”³è¯· Chainlink åˆ›å»º DUST Feed
   â”œâ”€ Chainlink èŠ‚ç‚¹ä» Stardust é“¾è¯»å–ä»·æ ¼
   â””â”€ å½¢æˆå®Œæ•´çš„å»ä¸­å¿ƒåŒ–ä»·æ ¼ä½“ç³»

2. å¤šä»·æ ¼æºéªŒè¯
   â”œâ”€ Stardust pallet-pricing (ä¸»)
   â”œâ”€ Uniswap DUST/USDC TWAP (è¾…)
   â”œâ”€ Arbitrum OCW æ¨é€ (è¾…)
   â””â”€ Chainlink Feed (æœªæ¥)

3. è·¨é“¾ä»·æ ¼åŒæ­¥
   â”œâ”€ Stardust â†’ Arbitrum (OCW)
   â”œâ”€ Arbitrum â†’ Ethereum (è·¨é“¾æ¡¥)
   â””â”€ å…¨é“¾ä»·æ ¼ä¸€è‡´æ€§
```

---

**ç»“è®º**ï¼š
- âŒ **ä¸èƒ½**ç”¨ Chainlink æ›¿ä»£ pallet-pricing
- âœ… **åº”è¯¥**ä¿ç•™ pallet-pricing + æ·»åŠ  OCW æ¨é€
- âœ… **å¯ä»¥**ç”¨ Chainlink è¾…åŠ©éªŒè¯ USDC
- â­ **æ¨è**ä½¿ç”¨æ··åˆæ¶æ„ï¼ˆå·²å®ç°ï¼‰

