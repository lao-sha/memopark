# Phase 7 - æµ‹è¯•ä¸éªŒè¯è§„åˆ’

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**ç”Ÿæˆæ—¶é—´**: 2025-10-28  
**è§„åˆ’å‘¨æœŸ**: 4-6 å‘¨  
**è´Ÿè´£å›¢é˜Ÿ**: å¼€å‘å›¢é˜Ÿ + QAå›¢é˜Ÿ + è¿è¥å›¢é˜Ÿ

---

## ğŸ“‹ ç›®å½•

1. [Phase 7 æ¦‚è¿°](#phase-7-æ¦‚è¿°)
2. [æµ‹è¯•ç­–ç•¥](#æµ‹è¯•ç­–ç•¥)
3. [æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–](#æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–)
4. [ç”¨æˆ·éªŒæ”¶æµ‹è¯•](#ç”¨æˆ·éªŒæ”¶æµ‹è¯•)
5. [æ—¶é—´è§„åˆ’](#æ—¶é—´è§„åˆ’)
6. [äº¤ä»˜ç‰©æ¸…å•](#äº¤ä»˜ç‰©æ¸…å•)
7. [é£é™©è¯„ä¼°ä¸åº”å¯¹](#é£é™©è¯„ä¼°ä¸åº”å¯¹)

---

## Phase 7 æ¦‚è¿°

### ğŸ¯ ç›®æ ‡

å®Œæˆ Phase 1-6 çš„æ‰€æœ‰ä»£ç æ•´åˆåï¼Œè¿›è¡Œå…¨é¢çš„æµ‹è¯•ã€éªŒè¯å’Œä¼˜åŒ–ï¼Œç¡®ä¿ç³»ç»Ÿï¼š
- âœ… åŠŸèƒ½å®Œæ•´æ€§ï¼ˆæ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼‰
- âœ… æ€§èƒ½è¾¾æ ‡ï¼ˆæ»¡è¶³é¢„æœŸçš„ TPS å’Œå“åº”æ—¶é—´ï¼‰
- âœ… å®‰å…¨å¯é ï¼ˆæ— é‡å¤§å®‰å…¨æ¼æ´ï¼‰
- âœ… ç”¨æˆ·ä½“éªŒè‰¯å¥½ï¼ˆç¬¦åˆä¸šåŠ¡éœ€æ±‚ï¼‰

### ğŸ“¦ Phase 7 èŒƒå›´

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡è€—æ—¶ | ä¼˜å…ˆçº§ |
|-----|------|---------|--------|
| **7.1** | å•å…ƒæµ‹è¯•è¡¥å…… | 1.5 å‘¨ | ğŸ”´ é«˜ |
| **7.2** | é›†æˆæµ‹è¯• | 1 å‘¨ | ğŸ”´ é«˜ |
| **7.3** | æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ– | 1.5 å‘¨ | ğŸŸ¡ ä¸­ |
| **7.4** | å®‰å…¨å®¡è®¡ | 1 å‘¨ | ğŸ”´ é«˜ |
| **7.5** | ç”¨æˆ·éªŒæ”¶æµ‹è¯•ï¼ˆUATï¼‰ | 1 å‘¨ | ğŸŸ¡ ä¸­ |
| **æ€»è®¡** | - | **4-6 å‘¨** | - |

---

## æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•è¡¥å……ï¼ˆPhase 7.1ï¼‰

#### ç›®æ ‡
ä¸ºæ‰€æœ‰æ ¸å¿ƒ Pallet è¡¥å……å®Œæ•´çš„å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–ç‡è¾¾åˆ° **80%+**ã€‚

#### æµ‹è¯•èŒƒå›´

**7.1.1 Trading æµ‹è¯•ï¼ˆ1-2å¤©ï¼‰**
```rust
// pallets/trading/src/tests.rs

#[test]
fn test_create_otc_order() {
    // âœ… æ­£å¸¸åˆ›å»ºè®¢å•
    // âŒ é‡‘é¢ä½äºæœ€å°å€¼
    // âŒ é‡‘é¢é«˜äºæœ€å¤§å€¼
    // âŒ æœªæˆæƒçš„ä¹°å®¶
    // âŒ é¦–è´­èµ„é‡‘æ± ä½™é¢ä¸è¶³
}

#[test]
fn test_take_order() {
    // âœ… æ­£å¸¸åƒå•
    // âŒ è®¢å•ä¸å­˜åœ¨
    // âŒ è®¢å•å·²è¢«å ç”¨
    // âŒ é™é¢‘è¶…é™
}

#[test]
fn test_mark_paid() {
    // âœ… æ­£å¸¸æ ‡è®°æ”¯ä»˜
    // âŒ æœªæˆæƒçš„è°ƒç”¨è€…
    // âŒ è®¢å•çŠ¶æ€ä¸æ­£ç¡®
    // âŒ è¶…æ—¶æœªç¡®è®¤
}

#[test]
fn test_release_memo() {
    // âœ… æ­£å¸¸é‡Šæ”¾MEMO
    // âŒ æœªæˆæƒçš„åšå¸‚å•†
    // âŒ è®¢å•çŠ¶æ€ä¸æ­£ç¡®
    // âŒ é‡å¤é‡Šæ”¾
}

#[test]
fn test_swap_bridge() {
    // âœ… æ­£å¸¸æ¡¥æ¥å…‘æ¢
    // âŒ é‡‘é¢è¶…é™
    // âŒ ä»·æ ¼åç¦»è¿‡å¤§
    // âŒ TRONäº¤æ˜“å“ˆå¸Œé‡å¤
}

#[test]
fn test_maker_swap() {
    // âœ… æ­£å¸¸åšå¸‚å•†å…‘æ¢
    // âŒ ä»·æ ¼åç¦»ä¿æŠ¤
    // âŒ æœªæˆæƒçš„åšå¸‚å•†
}

#[test]
fn test_cleanup_expired_orders() {
    // âœ… æ¸…ç†è¿‡æœŸè®¢å•
    // âœ… åŒæ˜ å°„ç´¢å¼•æ›´æ–°
    // âœ… æ¯å—æœ€å¤šæ¸…ç†æ•°é‡é™åˆ¶
}
```

**7.1.2 Credit æµ‹è¯•ï¼ˆ1å¤©ï¼‰**
```rust
// pallets/credit/src/tests.rs

#[test]
fn test_buyer_credit_flow() {
    // âœ… åˆå§‹ä¿¡ç”¨ç­‰çº§
    // âœ… äº¤æ˜“å®Œæˆå¢åŠ ä¿¡ç”¨
    // âœ… ä¿¡ç”¨ç­‰çº§æå‡
    // âœ… é¢åº¦å¢åŠ 
}

#[test]
fn test_buyer_breach() {
    // âœ… ä¹°å®¶è¿çº¦è®°å½•
    // âœ… ä¿¡ç”¨ç­‰çº§é™ä½
    // âœ… é¢åº¦å‡å°‘
    // âœ… ä¿è¯é‡‘å¢åŠ 
}

#[test]
fn test_maker_credit_flow() {
    // âœ… åšå¸‚å•†ä¿¡ç”¨è¯„åˆ†
    // âœ… å®Œæˆè®¢å•å¢åŠ åˆ†æ•°
    // âœ… ä¿¡ç”¨ç­‰çº§æå‡
}

#[test]
fn test_maker_breach() {
    // âœ… åšå¸‚å•†è¿çº¦è®°å½•
    // âœ… ä¿¡ç”¨ç­‰çº§é™ä½
    // âœ… æƒ©ç½šæœºåˆ¶
}
```

**7.1.3 Deceased æµ‹è¯•ï¼ˆ0.5å¤©ï¼‰**
```rust
// pallets/deceased/src/tests.rs

#[test]
fn test_create_deceased() {
    // âœ… æ­£å¸¸åˆ›å»ºé€è€…ä¿¡æ¯
    // âŒ æœªæˆæƒçš„åˆ›å»ºè€…
    // âŒ å¿…å¡«å­—æ®µç¼ºå¤±
}

#[test]
fn test_update_deceased() {
    // âœ… æ­£å¸¸æ›´æ–°ä¿¡æ¯
    // âŒ æœªæˆæƒçš„ç¼–è¾‘è€…
    // âŒ è®°å½•ä¸å­˜åœ¨
}

#[test]
fn test_pin_to_ipfs() {
    // âœ… è‡ªåŠ¨Pinå…³é”®æ•°æ®
    // âœ… CIDåŠ å¯†æ£€æŸ¥
}
```

**7.1.4 Memorial æµ‹è¯•ï¼ˆ1.5å¤©ï¼‰**
```rust
// pallets/memorial/src/tests.rs

#[test]
fn test_create_sacrifice() {
    // âœ… æ­£å¸¸åˆ›å»ºç¥­ç¥€å“
    // âŒ ä»·æ ¼è®¾ç½®é”™è¯¯
    // âŒ åœºæ™¯ç±»åˆ«æ— æ•ˆ
}

#[test]
fn test_offer() {
    // âœ… æ­£å¸¸ä¾›å¥‰
    // âŒ é‡‘é¢ä½äºæœ€å°å€¼
    // âŒ ç›®æ ‡ä¸å­˜åœ¨
    // âŒ é™é¢‘è¶…é™
}

#[test]
fn test_offer_by_sacrifice() {
    // âœ… é€šè¿‡ç¥­ç¥€å“ç›®å½•ä¾›å¥‰
    // âœ… VIPæŠ˜æ‰£è®¡ç®—
    // âœ… è‡ªåŠ¨å®šä»·
    // âŒ ç¥­ç¥€å“ä¸å­˜åœ¨
    // âŒ ä»…é™VIP
}

#[test]
fn test_simple_route_distribution() {
    // âœ… èµ„é‡‘åˆ†é…è·¯ç”±
    // âœ… å¹³å°åˆ†æˆ
    // âœ… è¿è¥è€…å¥–åŠ±
    // âœ… ç›®æ ‡è´¦æˆ·æ¥æ”¶
}
```

**7.1.5 Affiliate æµ‹è¯•ï¼ˆ2å¤©ï¼‰**
```rust
// pallets/affiliate/src/tests.rs

#[test]
fn test_bind_sponsor() {
    // âœ… æ­£å¸¸ç»‘å®šæ¨èäºº
    // âŒ æ¨èç æ— æ•ˆ
    // âŒ å¾ªç¯æ¨èæ£€æµ‹
    // âŒ å·²æ³¨å†Œç”¨æˆ·
}

#[test]
fn test_claim_code() {
    // âœ… æ­£å¸¸è®¤é¢†æ¨èç 
    // âŒ æ¨èç å·²è¢«å ç”¨
    // âŒ æ¨èç é•¿åº¦ä¸ç¬¦
}

#[test]
fn test_instant_distribution() {
    // âœ… å³æ—¶åˆ†æˆè®¡ç®—
    // âœ… æ¨èé“¾éå†
    // âœ… åˆ†æˆæ¯”ä¾‹åº”ç”¨
    // âœ… ç³»ç»Ÿè´¹ç”¨æ‰£é™¤
}

#[test]
fn test_weekly_accumulation() {
    // âœ… å‘¨ç»“ç®—ç´¯è®¡
    // âœ… å‘¨æœŸç®¡ç†
    // âœ… å¾…æ”¯ä»˜åˆ—è¡¨
}

#[test]
fn test_weekly_settlement() {
    // âœ… å‘¨ç»“ç®—æ‰§è¡Œ
    // âœ… æ¸¸æ ‡åˆ†é¡µå¤„ç†
    // âœ… æ‰¹é‡è½¬è´¦
    // âœ… æ¸¸æ ‡æ¸…ç†
}

#[test]
fn test_hybrid_mode() {
    // âœ… æ··åˆæ¨¡å¼åˆ†é…
    // âœ… å‰Nå±‚å³æ—¶
    // âœ… åMå±‚å‘¨ç»“ç®—
}
```

#### æµ‹è¯•å·¥å…·
- âœ… Substrate `mock.rs`ï¼ˆæ¨¡æ‹Ÿè¿è¡Œæ—¶ï¼‰
- âœ… `frame_support::assert_ok!` / `assert_noop!`
- âœ… `ExtBuilder` æ¨¡å¼

#### éªŒæ”¶æ ‡å‡†
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- âœ… æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- âœ… å…³é”®è·¯å¾„æµ‹è¯•è¦†ç›–ç‡ 100%

---

### 2. é›†æˆæµ‹è¯•ï¼ˆPhase 7.2ï¼‰

#### ç›®æ ‡
æµ‹è¯•å¤šä¸ª Pallet ä¹‹é—´çš„äº¤äº’ï¼Œç¡®ä¿ç«¯åˆ°ç«¯æµç¨‹æ­£å¸¸å·¥ä½œã€‚

#### æµ‹è¯•åœºæ™¯

**7.2.1 ä¼šå‘˜è´­ä¹° â†’ æ¨èå…³ç³» â†’ è”ç›Ÿè®¡é…¬ï¼ˆ1å¤©ï¼‰**
```rust
#[test]
fn test_membership_purchase_with_referral_and_commission() {
    // 1. ç”¨æˆ·Aè´­ä¹°ä¼šå‘˜ï¼ˆä½¿ç”¨æ¨èç ï¼‰
    // 2. éªŒè¯æ¨èå…³ç³»ç»‘å®šæˆåŠŸ
    // 3. éªŒè¯è”ç›Ÿè®¡é…¬åˆ†é…ï¼ˆå³æ—¶æˆ–å‘¨ç»“ç®—ï¼‰
    // 4. éªŒè¯æ¨èäººæ”¶ç›Š
    // 5. éªŒè¯ç³»ç»Ÿè´¹ç”¨æ‰£é™¤
}
```

**7.2.2 OTCè®¢å• â†’ ä¿¡ç”¨ç³»ç»Ÿ â†’ æ‰˜ç®¡ï¼ˆ1å¤©ï¼‰**
```rust
#[test]
fn test_otc_order_with_credit_and_escrow() {
    // 1. åšå¸‚å•†åˆ›å»ºè®¢å•
    // 2. ä¹°å®¶åƒå•ï¼ˆæ£€æŸ¥ä¿¡ç”¨é¢åº¦ï¼‰
    // 3. MEMOæ‰˜ç®¡åˆ°Escrow
    // 4. ä¹°å®¶æ ‡è®°æ”¯ä»˜
    // 5. åšå¸‚å•†é‡Šæ”¾MEMO
    // 6. æ›´æ–°åŒæ–¹ä¿¡ç”¨è®°å½•
}
```

**7.2.3 ä¾›å¥‰ â†’ èµ„é‡‘è·¯ç”± â†’ å¤šæ–¹åˆ†è´¦ï¼ˆ1å¤©ï¼‰**
```rust
#[test]
fn test_offering_with_route_and_distribution() {
    // 1. ç”¨æˆ·ä¾›å¥‰ï¼ˆé€šè¿‡ç¥­ç¥€å“ç›®å½•ï¼‰
    // 2. VIPæŠ˜æ‰£è®¡ç®—
    // 3. èµ„é‡‘åˆ†é…è·¯ç”±
    //    - å¹³å°åˆ†æˆï¼ˆ20%ï¼‰
    //    - è¿è¥è€…å¥–åŠ±
    //    - ç›®æ ‡è´¦æˆ·æ¥æ”¶
    // 4. ä¾›å¥‰è®°å½•å†™å…¥
    // 5. äº‹ä»¶å‘å°„
}
```

**7.2.4 æ¡¥æ¥å…‘æ¢ â†’ TRONäº¤æ˜“å“ˆå¸ŒéªŒè¯ â†’ æ¸…ç†ï¼ˆ0.5å¤©ï¼‰**
```rust
#[test]
fn test_bridge_swap_with_hash_validation_and_cleanup() {
    // 1. ç”¨æˆ·æäº¤æ¡¥æ¥å…‘æ¢
    // 2. éªŒè¯TRONäº¤æ˜“å“ˆå¸Œå”¯ä¸€æ€§
    // 3. éªŒè¯ä»·æ ¼åç¦»ä¿æŠ¤
    // 4. å®Œæˆå…‘æ¢
    // 5. è‡ªåŠ¨æ¸…ç†æ—§å“ˆå¸Œè®°å½•
}
```

**7.2.5 å‘¨ç»“ç®— â†’ æ¸¸æ ‡åˆ†é¡µ â†’ æ‰¹é‡è½¬è´¦ï¼ˆ0.5å¤©ï¼‰**
```rust
#[test]
fn test_weekly_settlement_with_cursor_and_batch() {
    // 1. å¯åŠ¨å‘¨ç»“ç®—å‘¨æœŸ
    // 2. æ¸¸æ ‡åˆ†é¡µå¤„ç†ï¼ˆæ¯å—æœ€å¤š100ä¸ªè´¦æˆ·ï¼‰
    // 3. æ‰¹é‡è½¬è´¦
    // 4. æ¸¸æ ‡å‰è¿›
    // 5. ç»“ç®—å®Œæˆï¼Œæ¸¸æ ‡æ¸…ç†
}
```

#### æµ‹è¯•å·¥å…·
- âœ… Substrate `sp-io::TestExternalities`
- âœ… `construct_runtime!` å®
- âœ… æ¨¡æ‹Ÿå¤šè´¦æˆ·åœºæ™¯

#### éªŒæ”¶æ ‡å‡†
- âœ… æ‰€æœ‰é›†æˆæµ‹è¯•åœºæ™¯é€šè¿‡
- âœ… ç«¯åˆ°ç«¯æµç¨‹æ— é˜»å¡
- âœ… äº‹ä»¶å‘å°„æ­£ç¡®

---

### 3. æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆPhase 7.3ï¼‰

#### ç›®æ ‡
ç¡®ä¿ç³»ç»Ÿåœ¨é«˜è´Ÿè½½ä¸‹çš„æ€§èƒ½è¡¨ç°ï¼Œä¼˜åŒ–ç“¶é¢ˆç‚¹ã€‚

#### æµ‹è¯•æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|-----|--------|--------|------|
| **TPSï¼ˆäº¤æ˜“ååé‡ï¼‰** | â‰¥ 100 TPS | å¾…æµ‹ | â³ |
| **åŒºå—æ—¶é—´** | 6 ç§’ | 6 ç§’ | âœ… |
| **å•ç¬”äº¤æ˜“å»¶è¿Ÿ** | < 12 ç§’ | å¾…æµ‹ | â³ |
| **æ¨èé“¾æŸ¥è¯¢** | < 100ms | å¾…æµ‹ | â³ |
| **å‘¨ç»“ç®—å¤„ç†** | < 5ç§’/100è´¦æˆ· | å¾…æµ‹ | â³ |
| **IPFS Pin** | < 2ç§’/CID | å¾…æµ‹ | â³ |

#### æ€§èƒ½æµ‹è¯•åœºæ™¯

**7.3.1 Trading é«˜å¹¶å‘æµ‹è¯•ï¼ˆ1å¤©ï¼‰**
```bash
# æ¨¡æ‹Ÿ100ä¸ªä¹°å®¶åŒæ—¶åƒå•
- åˆ›å»º100ä¸ªè®¢å•
- 100ä¸ªä¹°å®¶åŒæ—¶è°ƒç”¨ take_order
- éªŒè¯é™é¢‘æœºåˆ¶
- éªŒè¯å­˜å‚¨å†™å…¥æ•ˆç‡
```

**7.3.2 æ¨èé“¾æ·±åº¦æµ‹è¯•ï¼ˆ0.5å¤©ï¼‰**
```bash
# æµ‹è¯•15å±‚æ¨èé“¾çš„æŸ¥è¯¢æ€§èƒ½
- æ„å»º15å±‚æ¨èå…³ç³»
- 100æ¬¡æŸ¥è¯¢æ¨èé“¾
- æµ‹é‡å¹³å‡æŸ¥è¯¢æ—¶é—´
- ä¼˜åŒ–ç®—æ³•ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰
```

**7.3.3 å‘¨ç»“ç®—å¤§æ•°æ®æµ‹è¯•ï¼ˆ1å¤©ï¼‰**
```bash
# æ¨¡æ‹Ÿ10,000ä¸ªè´¦æˆ·çš„å‘¨ç»“ç®—
- åˆ›å»º10,000ä¸ªå¾…æ”¯ä»˜è®°å½•
- å¯åŠ¨å‘¨ç»“ç®—
- æµ‹é‡æ¸¸æ ‡åˆ†é¡µæ•ˆç‡
- éªŒè¯æ‰¹é‡è½¬è´¦æ€§èƒ½
```

**7.3.4 Memorial ä¾›å¥‰å‹åŠ›æµ‹è¯•ï¼ˆ0.5å¤©ï¼‰**
```bash
# æ¨¡æ‹Ÿ1000ä¸ªç”¨æˆ·åŒæ—¶ä¾›å¥‰
- 1000ä¸ªç”¨æˆ·è°ƒç”¨ offer_by_sacrifice
- éªŒè¯é™é¢‘æœºåˆ¶
- éªŒè¯èµ„é‡‘è·¯ç”±æ•ˆç‡
- æµ‹é‡Gasæ¶ˆè€—
```

**7.3.5 æ•°æ®æ¸…ç†æµ‹è¯•ï¼ˆ0.5å¤©ï¼‰**
```bash
# æµ‹è¯•è‡ªåŠ¨æ¸…ç†æ•ˆç‡
- åˆ›å»º5000ä¸ªè¿‡æœŸè®¢å•
- è§¦å‘ on_initialize è‡ªåŠ¨æ¸…ç†
- éªŒè¯æ¸…ç†é€Ÿåº¦ï¼ˆæ¯å—æœ€å¤š50ä¸ªï¼‰
- æµ‹é‡å­˜å‚¨é‡Šæ”¾æ•ˆç‡
```

#### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

**7.3.6 å­˜å‚¨ä¼˜åŒ–**
```rust
// å·²å®Œæˆçš„ä¼˜åŒ–
âœ… BoundedVec é™åˆ¶ï¼ˆCID: 64å­—èŠ‚ï¼ŒTronAddress: 34å­—èŠ‚ï¼‰
âœ… åŒæ˜ å°„ç´¢å¼•ï¼ˆO(1)æŸ¥è¯¢ï¼‰
âœ… æ¸¸æ ‡åˆ†é¡µï¼ˆé˜²æ­¢å•åŒºå—è¿‡è½½ï¼‰

// å¾…ä¼˜åŒ–é¡¹
â³ è€ƒè™‘ä½¿ç”¨ StorageNMapï¼ˆå¤šç»´ç´¢å¼•ï¼‰
â³ å†·æ•°æ®å½’æ¡£ï¼ˆè¶…è¿‡6ä¸ªæœˆçš„è®¢å•ï¼‰
```

**7.3.7 æƒé‡Benchmark**
```rust
// å·²å®Œæˆçš„Benchmark
âœ… pallet-trading: benchmarking.rs

// å¾…è¡¥å……é¡¹
â³ pallet-credit: weights.rs
â³ pallet-deceased: weights.rs
â³ pallet-memorial: weights.rs
â³ pallet-affiliate: weights.rs
```

**7.3.8 äº‹ä»¶ä¼˜åŒ–**
```rust
// å·²å®Œæˆçš„ä¼˜åŒ–
âœ… äº‹ä»¶åˆå¹¶ï¼ˆOrderStateChanged, SwapStateChangedï¼‰
âœ… äº‹ä»¶ç²¾ç®€ï¼ˆå‡å°‘æ•°æ®å­—æ®µï¼‰

// å¾…ä¼˜åŒ–é¡¹
â³ æ‰¹é‡äº‹ä»¶å‘å°„ï¼ˆå‡å°‘å­˜å‚¨å†™å…¥æ¬¡æ•°ï¼‰
```

#### éªŒæ”¶æ ‡å‡†
- âœ… TPS â‰¥ 100
- âœ… æ¨èé“¾æŸ¥è¯¢ < 100ms
- âœ… å‘¨ç»“ç®—å¤„ç† < 5ç§’/100è´¦æˆ·
- âœ… å…³é”®è·¯å¾„æƒé‡å·²Benchmark

---

### 4. å®‰å…¨å®¡è®¡ï¼ˆPhase 7.4ï¼‰

#### ç›®æ ‡
è¯†åˆ«å’Œä¿®å¤æ½œåœ¨çš„å®‰å…¨æ¼æ´ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨å¯é ã€‚

#### å®¡è®¡èŒƒå›´

**7.4.1 æƒé™æ§åˆ¶å®¡è®¡ï¼ˆ1å¤©ï¼‰**
```rust
// æ£€æŸ¥é¡¹
âœ… æ‰€æœ‰ extrinsic çš„ Origin æ£€æŸ¥
âœ… AdminOrigin / GovernanceOrigin æ­£ç¡®ä½¿ç”¨
âœ… ensure_signed / ensure_root æ­£ç¡®ä½¿ç”¨

// é‡ç‚¹å®¡æŸ¥çš„ Pallet
- pallet-trading: åšå¸‚å•†æƒé™ã€æ‰˜ç®¡é‡Šæ”¾
- pallet-credit: è¿çº¦è®°å½•ã€ä¿¡ç”¨è°ƒæ•´
- pallet-memorial: gov_* å‡½æ•°æƒé™
- pallet-affiliate: é…ç½®ç®¡ç†æƒé™
```

**7.4.2 èµ„é‡‘å®‰å…¨å®¡è®¡ï¼ˆ2å¤©ï¼‰**
```rust
// æ£€æŸ¥é¡¹
âœ… æ‰€æœ‰è½¬è´¦éƒ½ä½¿ç”¨ KeepAlive
âœ… æ‰˜ç®¡è´¦æˆ·ä½™é¢æ£€æŸ¥
âœ… æº¢å‡º/ä¸‹æº¢ä¿æŠ¤ï¼ˆsaturating_add/saturating_subï¼‰
âœ… é‡å…¥æ”»å‡»é˜²æŠ¤

// é‡ç‚¹å®¡æŸ¥çš„æµç¨‹
1. OTCè®¢å•çš„MEMOæ‰˜ç®¡/é‡Šæ”¾
2. SimpleBridgeçš„æ¡¥æ¥å…‘æ¢
3. Memorialçš„èµ„é‡‘è·¯ç”±åˆ†é…
4. Affiliateçš„å‘¨ç»“ç®—æ‰¹é‡è½¬è´¦
5. FirstPurchasePoolçš„èµ„é‡‘æ± ç®¡ç†
```

**7.4.3 æ•°æ®å®Œæ•´æ€§å®¡è®¡ï¼ˆ1å¤©ï¼‰**
```rust
// æ£€æŸ¥é¡¹
âœ… å­˜å‚¨ä¸€è‡´æ€§ï¼ˆStorage â†’ Event â†’ Storageï¼‰
âœ… åŒæ˜ å°„ç´¢å¼•åŒæ­¥æ›´æ–°
âœ… çŠ¶æ€æœºè½¬æ¢åˆæ³•æ€§
âœ… æ•°æ®æ¸…ç†ä¸ä¸¢å¤±

// é‡ç‚¹å®¡æŸ¥çš„å­˜å‚¨
- Trading: Orders, Swaps, UserOrders, MakerOrders
- Credit: BuyerCredit, MakerCredit, BuyerBreachRecords
- Memorial: OfferingRecords, OfferingsByTarget
- Affiliate: Sponsors, AccountByCode, WeeklyPayouts
```

**7.4.4 æ”»å‡»å‘é‡åˆ†æï¼ˆ1å¤©ï¼‰**
```rust
// æ”»å‡»åœºæ™¯æ¨¡æ‹Ÿ
âŒ é‡æ”¾æ”»å‡»ï¼šTRONäº¤æ˜“å“ˆå¸Œé‡å¤æäº¤
âŒ å¾ªç¯æ¨èï¼šAâ†’Bâ†’Câ†’A
âŒ é™é¢‘ç»•è¿‡ï¼šçŸ­æ—¶é—´å¤§é‡è¯·æ±‚
âŒ èµ„é‡‘æ± è€—å°½ï¼šå¤§é‡é¦–è´­è®¢å•
âŒ æ¶æ„æ¸…ç†ï¼šåˆ é™¤ä»–äººæ•°æ®

// é˜²æŠ¤æªæ–½éªŒè¯
âœ… UsedTronTxHashes å­˜å‚¨ + è‡ªåŠ¨æ¸…ç†
âœ… would_create_cycle å¾ªç¯æ£€æµ‹
âœ… OfferRate / OrderRate é™é¢‘
âœ… é¦–è´­èµ„é‡‘æ± æœ€å°å€¼ä¿æŠ¤
âœ… Origin æƒé™æ£€æŸ¥
```

#### å®¡è®¡å·¥å…·
- âœ… æ‰‹åŠ¨ä»£ç å®¡æŸ¥
- âœ… Substrate å®‰å…¨æœ€ä½³å®è·µæ£€æŸ¥
- âœ… è‡ªåŠ¨åŒ–é™æ€åˆ†æå·¥å…·ï¼ˆcargo-audit, clippyï¼‰

#### éªŒæ”¶æ ‡å‡†
- âœ… æ— é«˜å±æ¼æ´
- âœ… ä¸­å±æ¼æ´å·²ä¿®å¤æˆ–æœ‰ç¼“è§£æªæ–½
- âœ… å®‰å…¨å®¡è®¡æŠ¥å‘Šå·²ç”Ÿæˆ

---

### 5. ç”¨æˆ·éªŒæ”¶æµ‹è¯•ï¼ˆPhase 7.5ï¼‰

#### ç›®æ ‡
ç”±è¿è¥å›¢é˜Ÿå’Œæ—©æœŸç”¨æˆ·è¿›è¡Œå®é™…åœºæ™¯æµ‹è¯•ï¼ŒéªŒè¯åŠŸèƒ½ç¬¦åˆä¸šåŠ¡éœ€æ±‚ã€‚

#### æµ‹è¯•åœºæ™¯

**7.5.1 ä¼šå‘˜è´­ä¹°æµç¨‹ï¼ˆ1å¤©ï¼‰**
```
ã€åœºæ™¯ã€‘ï¼šæ–°ç”¨æˆ·è´­ä¹°å¹´è´¹ä¼šå‘˜
1. ç”¨æˆ·æ‰“å¼€é’±åŒ…ï¼ˆstardust-dappï¼‰
2. ç‚¹å‡»"è´­ä¹°ä¼šå‘˜"
3. è¾“å…¥æ¨èç 
4. é€‰æ‹©ä¼šå‘˜ç­‰çº§ï¼ˆ1å¹´/3å¹´/5å¹´/10å¹´ï¼‰
5. ç¡®è®¤æ”¯ä»˜
6. éªŒè¯ï¼š
   âœ… ä¼šå‘˜ä¿¡æ¯æ˜¾ç¤ºæ­£ç¡®
   âœ… æ¨èå…³ç³»ç»‘å®šæˆåŠŸ
   âœ… æ¨èäººæ”¶åˆ°ä½£é‡‘ï¼ˆå³æ—¶æˆ–å‘¨ç»“ç®—ï¼‰
```

**7.5.2 OTCè®¢å•æµç¨‹ï¼ˆ1å¤©ï¼‰**
```
ã€åœºæ™¯ã€‘ï¼šä¹°å®¶è´­ä¹°USDT
1. ä¹°å®¶æŸ¥çœ‹åšå¸‚å•†æŒ‚å•åˆ—è¡¨
2. é€‰æ‹©åˆé€‚çš„è®¢å•ï¼ˆä»·æ ¼ã€é¢åº¦ï¼‰
3. ç‚¹å‡»"åƒå•"
4. ç¡®è®¤MEMOæ‰˜ç®¡
5. è½¬è´¦USDTç»™åšå¸‚å•†
6. æ ‡è®°"å·²æ”¯ä»˜"
7. åšå¸‚å•†ç¡®è®¤æ”¶æ¬¾ï¼Œé‡Šæ”¾MEMO
8. éªŒè¯ï¼š
   âœ… MEMOåˆ°è´¦
   âœ… ä¿¡ç”¨åˆ†æ•°å¢åŠ 
   âœ… è®¢å•çŠ¶æ€æ›´æ–°
```

**7.5.3 ä¾›å¥‰æµç¨‹ï¼ˆ0.5å¤©ï¼‰**
```
ã€åœºæ™¯ã€‘ï¼šç”¨æˆ·ä¸ºé€è€…ä¾›å¥‰ç¥­å“
1. ç”¨æˆ·æ‰“å¼€Memorialé¡µé¢
2. æœç´¢é€è€…ä¿¡æ¯
3. é€‰æ‹©ç¥­ç¥€å“ï¼ˆé²œèŠ±ã€èœ¡çƒ›ç­‰ï¼‰
4. ç¡®è®¤ä¾›å¥‰
5. éªŒè¯ï¼š
   âœ… VIPä¼šå‘˜äº«å—æŠ˜æ‰£
   âœ… èµ„é‡‘æ­£ç¡®åˆ†é…ï¼ˆå¹³å°ã€è¿è¥è€…ã€ç›®æ ‡è´¦æˆ·ï¼‰
   âœ… ä¾›å¥‰è®°å½•æ˜¾ç¤º
```

**7.5.4 æ¡¥æ¥å…‘æ¢æµç¨‹ï¼ˆ0.5å¤©ï¼‰**
```
ã€åœºæ™¯ã€‘ï¼šç”¨æˆ·é€šè¿‡SimpleBridgeè´­ä¹°MEMO
1. ç”¨æˆ·æ‰“å¼€SimpleBridgeé¡µé¢
2. è¾“å…¥USDTé‡‘é¢
3. æŸ¥çœ‹å®æ—¶å…‘æ¢ç‡
4. ç¡®è®¤å…‘æ¢
5. è½¬è´¦USDTåˆ°TRONåœ°å€
6. æäº¤TRONäº¤æ˜“å“ˆå¸Œ
7. éªŒè¯ï¼š
   âœ… MEMOåˆ°è´¦
   âœ… ä»·æ ¼åç¦»ä¿æŠ¤ç”Ÿæ•ˆ
   âœ… äº¤æ˜“è®°å½•æ˜¾ç¤º
```

**7.5.5 æ¨èç ç®¡ç†æµç¨‹ï¼ˆ0.5å¤©ï¼‰**
```
ã€åœºæ™¯ã€‘ï¼šç”¨æˆ·è®¤é¢†å’Œåˆ†äº«æ¨èç 
1. ç”¨æˆ·è´­ä¹°ä¼šå‘˜å
2. ç‚¹å‡»"è®¤é¢†æ¨èç "
3. è¾“å…¥è‡ªå®šä¹‰æ¨èç 
4. åˆ†äº«æ¨èç ç»™æœ‹å‹
5. æŸ¥çœ‹æ¨èæ”¶ç›Š
6. éªŒè¯ï¼š
   âœ… æ¨èç å”¯ä¸€æ€§æ£€æŸ¥
   âœ… æ¨èé“¾æ˜¾ç¤ºæ­£ç¡®
   âœ… æ”¶ç›Šç»Ÿè®¡å‡†ç¡®
```

#### æµ‹è¯•ç¯å¢ƒ
- âœ… æµ‹è¯•ç½‘ç»œï¼ˆRococoæˆ–è‡ªå»ºæµ‹è¯•ç½‘ï¼‰
- âœ… å‰ç«¯DAppï¼ˆstardust-dappï¼‰
- âœ… æµ‹è¯•è´¦æˆ·ï¼ˆé¢„å……å€¼MEMOï¼‰

#### éªŒæ”¶æ ‡å‡†
- âœ… æ‰€æœ‰UATåœºæ™¯é€šè¿‡
- âœ… ç”¨æˆ·åé¦ˆæ”¶é›†å®Œæˆ
- âœ… å…³é”®BUGå·²ä¿®å¤

---

## æ—¶é—´è§„åˆ’

### ç”˜ç‰¹å›¾

```
Week 1-2: å•å…ƒæµ‹è¯•è¡¥å……ï¼ˆPhase 7.1ï¼‰
â”œâ”€ Day 1-2: Trading æµ‹è¯•
â”œâ”€ Day 3: Credit æµ‹è¯•
â”œâ”€ Day 4: Deceased æµ‹è¯•
â”œâ”€ Day 5-6: Memorial æµ‹è¯•
â””â”€ Day 7-8: Affiliate æµ‹è¯•

Week 3: é›†æˆæµ‹è¯•ï¼ˆPhase 7.2ï¼‰
â”œâ”€ Day 1: ä¼šå‘˜è´­ä¹°é›†æˆæµ‹è¯•
â”œâ”€ Day 2: OTCè®¢å•é›†æˆæµ‹è¯•
â”œâ”€ Day 3: ä¾›å¥‰é›†æˆæµ‹è¯•
â”œâ”€ Day 4: æ¡¥æ¥å…‘æ¢é›†æˆæµ‹è¯•
â””â”€ Day 5: å‘¨ç»“ç®—é›†æˆæµ‹è¯•

Week 4-5: æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆPhase 7.3ï¼‰
â”œâ”€ Day 1-2: Trading é«˜å¹¶å‘æµ‹è¯•
â”œâ”€ Day 3: æ¨èé“¾æ·±åº¦æµ‹è¯•
â”œâ”€ Day 4-5: å‘¨ç»“ç®—å¤§æ•°æ®æµ‹è¯•
â”œâ”€ Day 6: Memorial ä¾›å¥‰å‹åŠ›æµ‹è¯•
â””â”€ Day 7-8: æ•°æ®æ¸…ç†æµ‹è¯• + ä¼˜åŒ–å®æ–½

Week 6: å®‰å…¨å®¡è®¡ï¼ˆPhase 7.4ï¼‰
â”œâ”€ Day 1: æƒé™æ§åˆ¶å®¡è®¡
â”œâ”€ Day 2-3: èµ„é‡‘å®‰å…¨å®¡è®¡
â”œâ”€ Day 4: æ•°æ®å®Œæ•´æ€§å®¡è®¡
â””â”€ Day 5: æ”»å‡»å‘é‡åˆ†æ

Week 7: ç”¨æˆ·éªŒæ”¶æµ‹è¯•ï¼ˆPhase 7.5ï¼‰
â”œâ”€ Day 1: ä¼šå‘˜è´­ä¹°UAT
â”œâ”€ Day 2: OTCè®¢å•UAT
â”œâ”€ Day 3: ä¾›å¥‰UAT
â”œâ”€ Day 4: æ¡¥æ¥å…‘æ¢UAT
â””â”€ Day 5: æ¨èç ç®¡ç†UAT
```

---

## äº¤ä»˜ç‰©æ¸…å•

### 7.1 å•å…ƒæµ‹è¯•
- [ ] `pallets/trading/src/tests.rs`ï¼ˆæ–°å¢20+æµ‹è¯•ç”¨ä¾‹ï¼‰
- [ ] `pallets/credit/src/tests.rs`ï¼ˆæ–°å¢15+æµ‹è¯•ç”¨ä¾‹ï¼‰
- [ ] `pallets/deceased/src/tests.rs`ï¼ˆæ–°å¢10+æµ‹è¯•ç”¨ä¾‹ï¼‰
- [ ] `pallets/memorial/src/tests.rs`ï¼ˆæ–°å¢25+æµ‹è¯•ç”¨ä¾‹ï¼‰
- [ ] `pallets/affiliate/src/tests.rs`ï¼ˆæ–°å¢30+æµ‹è¯•ç”¨ä¾‹ï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼ˆâ‰¥80%ï¼‰

### 7.2 é›†æˆæµ‹è¯•
- [ ] `tests/integration/membership_referral_commission.rs`
- [ ] `tests/integration/otc_credit_escrow.rs`
- [ ] `tests/integration/offering_route_distribution.rs`
- [ ] `tests/integration/bridge_hash_cleanup.rs`
- [ ] `tests/integration/weekly_settlement_cursor.rs`
- [ ] é›†æˆæµ‹è¯•æŠ¥å‘Š

### 7.3 æ€§èƒ½æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•è„šæœ¬ï¼ˆ`tests/performance/`ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•æŠ¥å‘Šï¼ˆTPSã€å»¶è¿Ÿã€ååé‡ï¼‰
- [ ] æƒé‡Benchmarkç»“æœ
- [ ] ä¼˜åŒ–å»ºè®®æ¸…å•

### 7.4 å®‰å…¨å®¡è®¡
- [ ] å®‰å…¨å®¡è®¡æŠ¥å‘Šï¼ˆæ¼æ´åˆ—è¡¨ + ä¿®å¤æ–¹æ¡ˆï¼‰
- [ ] æ”»å‡»å‘é‡åˆ†ææ–‡æ¡£
- [ ] èµ„é‡‘å®‰å…¨éªŒè¯æŠ¥å‘Š
- [ ] æ•°æ®å®Œæ•´æ€§æ£€æŸ¥æ¸…å•

### 7.5 ç”¨æˆ·éªŒæ”¶æµ‹è¯•
- [ ] UATæµ‹è¯•ç”¨ä¾‹æ¸…å•
- [ ] UATæµ‹è¯•æŠ¥å‘Šï¼ˆé€šè¿‡ç‡ã€é—®é¢˜åˆ—è¡¨ï¼‰
- [ ] ç”¨æˆ·åé¦ˆæ”¶é›†è¡¨
- [ ] BUGä¿®å¤è®°å½•

### 7.6 æ–‡æ¡£
- [ ] Phase 7 å®ŒæˆæŠ¥å‘Š
- [ ] æµ‹è¯•æ€»ç»“æ–‡æ¡£
- [ ] æ€§èƒ½åŸºå‡†æ–‡æ¡£
- [ ] è¿ç»´æ‰‹å†Œæ›´æ–°

---

## é£é™©è¯„ä¼°ä¸åº”å¯¹

### é£é™©æ¸…å•

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|-----|------|------|----------|
| **å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä¸è¾¾æ ‡** | ä¸­ | é«˜ | ä¼˜å…ˆæµ‹è¯•å…³é”®è·¯å¾„ï¼Œå¯æ¥å—70%è¦†ç›–ç‡ |
| **æ€§èƒ½æµ‹è¯•æœªè¾¾é¢„æœŸ** | é«˜ | é«˜ | æå‰ä¼˜åŒ–ï¼Œå¿…è¦æ—¶è°ƒæ•´ç›®æ ‡å€¼ |
| **å‘ç°é«˜å±å®‰å…¨æ¼æ´** | ä¸­ | é«˜ | ç«‹å³ä¿®å¤ï¼Œå»¶è¿Ÿä¸Šçº¿ |
| **UATç”¨æˆ·åé¦ˆé—®é¢˜å¤š** | ä¸­ | ä¸­ | å¿«é€Ÿè¿­ä»£ä¿®å¤ï¼Œåˆ†ä¼˜å…ˆçº§å¤„ç† |
| **æµ‹è¯•ç¯å¢ƒä¸ç¨³å®š** | ä½ | ä¸­ | æ­å»ºç‹¬ç«‹æµ‹è¯•ç½‘ï¼Œé¿å…å¹²æ‰° |
| **æ—¶é—´è¶…æœŸ** | ä¸­ | ä¸­ | å‹ç¼©éå…³é”®æµ‹è¯•ï¼Œä¿ç•™æ ¸å¿ƒæµ‹è¯• |

### åº”æ€¥é¢„æ¡ˆ

**å¦‚æœæ—¶é—´ç´§è¿«ï¼ˆ4å‘¨ â†’ 3å‘¨ï¼‰**
1. ä¼˜å…ˆçº§è°ƒæ•´ï¼š
   - ğŸ”´ **å¿…é¡»å®Œæˆ**ï¼šå•å…ƒæµ‹è¯•ï¼ˆå…³é”®è·¯å¾„ï¼‰ã€é›†æˆæµ‹è¯•ã€èµ„é‡‘å®‰å…¨å®¡è®¡
   - ğŸŸ¡ **å¯å»¶å**ï¼šæ€§èƒ½æµ‹è¯•ã€å…¨é¢å®‰å…¨å®¡è®¡ã€UAT
2. å¹¶è¡Œå¤„ç†ï¼š
   - å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•å¹¶è¡Œ
   - æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–åŒæ­¥è¿›è¡Œ

**å¦‚æœå‘ç°é‡å¤§BUG**
1. ç«‹å³æš‚åœæµ‹è¯•
2. BUGåˆ†çº§ï¼ˆP0/P1/P2/P3ï¼‰
3. P0/P1 ç«‹å³ä¿®å¤ï¼ŒP2/P3 è®°å½•åç»­å¤„ç†
4. å›å½’æµ‹è¯•ç›¸å…³æ¨¡å—

---

## æ€»ç»“

Phase 7 æ˜¯ç¡®ä¿ç³»ç»Ÿè´¨é‡çš„å…³é”®é˜¶æ®µï¼Œéœ€è¦ï¼š
- âœ… **å…¨é¢æµ‹è¯•**ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€å®‰å…¨å®¡è®¡ã€UAT
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šè¾¾åˆ°é¢„æœŸçš„ TPS å’Œå“åº”æ—¶é—´
- âœ… **å®‰å…¨å¯é **ï¼šæ— é«˜å±æ¼æ´ï¼Œèµ„é‡‘å®‰å…¨
- âœ… **ç”¨æˆ·æ»¡æ„**ï¼šç¬¦åˆä¸šåŠ¡éœ€æ±‚ï¼Œä½“éªŒè‰¯å¥½

**é¢„è®¡è€—æ—¶**: 4-6 å‘¨  
**å›¢é˜Ÿé…ç½®**: 2-3 åå¼€å‘ + 1 å QA + 1 åè¿è¥  
**ä¸‹ä¸€é˜¶æ®µ**: Phase 8 - ä¸»ç½‘ä¸Šçº¿å‡†å¤‡

---

**æ–‡æ¡£ç»“æŸ**

