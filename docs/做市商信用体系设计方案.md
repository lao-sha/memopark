# åšå¸‚å•†ä¿¡ç”¨ä½“ç³»è®¾è®¡æ–¹æ¡ˆ

**é¡¹ç›®åç§°**: stardust  
**æ¨¡å—åç§°**: pallet-maker-creditï¼ˆåšå¸‚å•†ä¿¡ç”¨é£æ§ç®¡ç†æ¨¡å—ï¼‰  
**è®¾è®¡æ—¥æœŸ**: 2025-10-22  
**è®¾è®¡äºº**: AI Assistant (Claude)

---

## ä¸€ã€è®¾è®¡èƒŒæ™¯

### 1.1 ç°çŠ¶åˆ†æ

**å·²æœ‰æ¨¡å—**ï¼š
1. âœ… `pallet-buyer-credit`ï¼šä¹°å®¶ä¿¡ç”¨ç³»ç»Ÿï¼ˆé£é™©åˆ†+ä¿¡ç”¨ç­‰çº§+è¿çº¦æƒ©ç½šï¼‰
2. âœ… `pallet-market-maker`ï¼šåšå¸‚å•†æ²»ç†æ¨¡å—ï¼ˆç”³è¯·-å®¡æ ¸-æ¿€æ´»ï¼‰
3. âœ… `pallet-otc-order`ï¼šOTCè®¢å•ç³»ç»Ÿï¼ˆè®¢å•çŠ¶æ€æœº+äº‰è®®è§£å†³ï¼‰

**ç¼ºå¤±åŠŸèƒ½**ï¼š
- âŒ **åšå¸‚å•†ä¿¡ç”¨è¯„åˆ†**ï¼šæ— æ³•é‡åŒ–åšå¸‚å•†æœåŠ¡è´¨é‡
- âŒ **å±¥çº¦ç‡è¿½è¸ª**ï¼šæ— æ³•è¯†åˆ«ä½è´¨é‡åšå¸‚å•†
- âŒ **åŠ¨æ€ä¿è¯é‡‘**ï¼šæŠ¼é‡‘å›ºå®šï¼Œæ— æ³•æ ¹æ®ä¿¡ç”¨è°ƒæ•´
- âŒ **æœåŠ¡è´¨é‡è¯„ä»·**ï¼šä¹°å®¶æ— æ³•è¯„ä»·åšå¸‚å•†
- âŒ **è‡ªåŠ¨é™çº§/ç¦ç”¨**ï¼šæ¶æ„åšå¸‚å•†éœ€äººå·¥å¹²é¢„

### 1.2 æ ¸å¿ƒéœ€æ±‚

| éœ€æ±‚ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|-----|--------|------|
| **ä¿¡ç”¨è¯„åˆ†ä½“ç³»** | P0 | é‡åŒ–åšå¸‚å•†æœåŠ¡è´¨é‡ï¼Œ800-1000åˆ† |
| **å±¥çº¦ç‡è¿½è¸ª** | P0 | è®¢å•å®Œæˆç‡ã€å“åº”é€Ÿåº¦ã€è¶…æ—¶ç‡ |
| **è¿çº¦æƒ©ç½š** | P0 | è¶…æ—¶ä¸é‡Šæ”¾ã€æ¶æ„æ“ä½œ â†’ æ‰£åˆ†+ä¿è¯é‡‘ç½šæ²¡ |
| **åŠ¨æ€ä¿è¯é‡‘** | P1 | ä¿¡ç”¨åˆ†é«˜ â†’ é™ä½ä¿è¯é‡‘ï¼›ä¿¡ç”¨åˆ†ä½ â†’ æé«˜ä¿è¯é‡‘ |
| **æœåŠ¡è´¨é‡è¯„ä»·** | P1 | ä¹°å®¶è¯„åˆ†ï¼ˆ1-5æ˜Ÿï¼‰å½±å“ä¿¡ç”¨åˆ† |
| **è‡ªåŠ¨é™çº§/ç¦ç”¨** | P1 | ä¿¡ç”¨åˆ†è¿‡ä½ â†’ è‡ªåŠ¨ç¦ç”¨æ¥å• |
| **äº‰è®®è§£å†³å½±å“** | P1 | ä»²è£ç»“æœ â†’ ä¿¡ç”¨åˆ†å¢å‡ |
| **å¥–åŠ±æœºåˆ¶** | P2 | é«˜ä¿¡ç”¨åšå¸‚å•† â†’ é™ä½æ‰‹ç»­è´¹ã€ä¼˜å…ˆå±•ç¤º |

---

## äºŒã€æ•´ä½“æ¶æ„

### 2.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **å¯¹æ ‡ä¹°å®¶ä¿¡ç”¨ç³»ç»Ÿ**
   - å‚è€ƒ `pallet-buyer-credit` çš„æˆç†Ÿè®¾è®¡
   - é£é™©åˆ† â†’ ä¿¡ç”¨åˆ†ï¼ˆåšå¸‚å•†ç”¨æ­£å‘æ¿€åŠ±ï¼‰
   - å¤šç»´åº¦è¯„ä¼°ï¼ˆå±¥çº¦ã€èµ„é‡‘ã€æ´»è·ƒåº¦ã€è¯„ä»·ï¼‰

2. **ä½è€¦åˆè®¾è®¡**
   - ç‹¬ç«‹ `pallet-maker-credit` æ¨¡å—
   - `pallet-market-maker` æŸ¥è¯¢ä¿¡ç”¨åˆ†
   - `pallet-otc-order` è°ƒç”¨ä¿¡ç”¨æ›´æ–°æ¥å£

3. **è‡ªåŠ¨åŒ–é£æ§**
   - è®¢å•å®Œæˆ/è¶…æ—¶ â†’ è‡ªåŠ¨æ›´æ–°ä¿¡ç”¨åˆ†
   - ä¿¡ç”¨åˆ†è¿‡ä½ â†’ è‡ªåŠ¨æš‚åœæ¥å•
   - ä¿è¯é‡‘ä¸è¶³ â†’ è‡ªåŠ¨é™çº§

### 2.2 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   pallet-maker-credit                     â”‚
â”‚                  ï¼ˆåšå¸‚å•†ä¿¡ç”¨é£æ§æ¨¡å—ï¼‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ä¿¡ç”¨è¯„åˆ†å¼•æ“   â”‚  â”‚ å±¥çº¦ç‡è¿½è¸ª     â”‚  â”‚ è¿çº¦æƒ©ç½š   â”‚ â”‚
â”‚  â”‚ - å¤šç»´åº¦è¯„ä¼°   â”‚  â”‚ - å®Œæˆç‡       â”‚  â”‚ - æ‰£ä¿¡ç”¨åˆ† â”‚ â”‚
â”‚  â”‚ - ä¿¡ç”¨ç­‰çº§     â”‚  â”‚ - å“åº”é€Ÿåº¦     â”‚  â”‚ - ä¿è¯é‡‘   â”‚ â”‚
â”‚  â”‚ - 800-1000åˆ†   â”‚  â”‚ - è¶…æ—¶ç‡       â”‚  â”‚ - è‡ªåŠ¨ç¦ç”¨ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ åŠ¨æ€ä¿è¯é‡‘     â”‚  â”‚ æœåŠ¡è´¨é‡è¯„ä»·   â”‚  â”‚ äº‰è®®å¤„ç†   â”‚ â”‚
â”‚  â”‚ - æŒ‰ä¿¡ç”¨è°ƒæ•´   â”‚  â”‚ - ä¹°å®¶è¯„åˆ†     â”‚  â”‚ - ä»²è£å½±å“ â”‚ â”‚
â”‚  â”‚ - æœ€ä½ä¿è¯é‡‘   â”‚  â”‚ - 1-5æ˜Ÿ        â”‚  â”‚ - æ‰£åˆ†åŠ å€ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–²                    â–²                    â–²
           â”‚                    â”‚                    â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
     â”‚   pallet-  â”‚      â”‚   pallet-  â”‚      â”‚   pallet-  â”‚
     â”‚   market-  â”‚      â”‚   otc-     â”‚      â”‚   arbitra- â”‚
     â”‚   maker    â”‚      â”‚   order    â”‚      â”‚   tion     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€ä¿¡ç”¨è¯„åˆ†ä½“ç³»

### 3.1 è¯„åˆ†èŒƒå›´ä¸ç­‰çº§

**ä¿¡ç”¨åˆ†èŒƒå›´**ï¼š800-1000 åˆ†ï¼ˆæ­£å‘æ¿€åŠ±ï¼Œä¸åŒäºä¹°å®¶é£é™©åˆ†ï¼‰

| ä¿¡ç”¨ç­‰çº§ | ä¿¡ç”¨åˆ†èŒƒå›´ | è®¢å•é‡è¦æ±‚ | æœåŠ¡çŠ¶æ€ | ä¿è¯é‡‘æŠ˜æ‰£ | ç‰¹æƒ |
|---------|-----------|-----------|---------|-----------|------|
| **é’»çŸ³ (Diamond)** | 950-1000 | 500+ ç¬” | â­â­â­â­â­ | 50% | ä¼˜å…ˆå±•ç¤ºã€æœ€ä½æ‰‹ç»­è´¹ã€VIPæ ‡è¯† |
| **ç™½é‡‘ (Platinum)** | 900-949 | 200-499 ç¬” | â­â­â­â­ | 30% | ä¼˜å…ˆå±•ç¤ºã€ä½æ‰‹ç»­è´¹ |
| **é»„é‡‘ (Gold)** | 850-899 | 100-199 ç¬” | â­â­â­ | 20% | æ¨èæ ‡è¯† |
| **ç™½é“¶ (Silver)** | 820-849 | 50-99 ç¬” | â­â­ | 10% | æ­£å¸¸å±•ç¤º |
| **é’é“œ (Bronze)** | 800-819 | 0-49 ç¬” | â­ | 0% | æ–°æ‰‹æ ‡è¯† |
| **è­¦å‘Š (Warning)** | 750-799 | - | âš ï¸ | +20% | è­¦å‘Šæç¤º |
| **æš‚åœ (Suspended)** | < 750 | - | ğŸš« | ä¸å¯æ¥å• | è‡ªåŠ¨æš‚åœ |

**åˆå§‹ä¿¡ç”¨åˆ†**ï¼š820 åˆ†ï¼ˆBronze é¡¶éƒ¨ï¼Œéœ€è¦é å±¥çº¦æå‡ï¼‰

### 3.2 å¤šç»´åº¦è¯„ä¼°

#### ç»´åº¦ 1ï¼šå±¥çº¦è¡¨ç°ï¼ˆæƒé‡ 40%ï¼‰

| æŒ‡æ ‡ | æƒé‡ | è®¡ç®—æ–¹å¼ | æ»¡åˆ† | è¯´æ˜ |
|-----|------|---------|------|------|
| **è®¢å•å®Œæˆç‡** | 15% | å®Œæˆè®¢å• / æ€»è®¢å• | 100% = 150åˆ† | å®Œæˆç‡ < 95% â†’ æ‰£åˆ† |
| **åŠæ—¶é‡Šæ”¾ç‡** | 15% | 24å°æ—¶å†…é‡Šæ”¾ / æ€»é‡Šæ”¾ | 100% = 150åˆ† | è¶…æ—¶é‡Šæ”¾ â†’ æ‰£åˆ† |
| **è¶…æ—¶ç‡** | 10% | è¶…æ—¶æœªå¤„ç† / æ€»è®¢å• | 0% = 100åˆ† | è¶…æ—¶ > 5% â†’ é‡ç½š |

**æ€»åˆ†**ï¼š400åˆ†

#### ç»´åº¦ 2ï¼šæœåŠ¡è´¨é‡ï¼ˆæƒé‡ 30%ï¼‰

| æŒ‡æ ‡ | æƒé‡ | è®¡ç®—æ–¹å¼ | æ»¡åˆ† | è¯´æ˜ |
|-----|------|---------|------|------|
| **ä¹°å®¶è¯„åˆ†** | 20% | å¹³å‡æ˜Ÿçº§ / 5 | 5æ˜Ÿ = 200åˆ† | 1-5æ˜Ÿè¯„ä»· |
| **å“åº”é€Ÿåº¦** | 10% | å¹³å‡å“åº”æ—¶é—´ | < 1å°æ—¶ = 100åˆ† | å“åº”è¶Šå¿«ï¼Œåˆ†æ•°è¶Šé«˜ |

**æ€»åˆ†**ï¼š300åˆ†

#### ç»´åº¦ 3ï¼šèµ„é‡‘å……è¶³æ€§ï¼ˆæƒé‡ 20%ï¼‰

| æŒ‡æ ‡ | æƒé‡ | è®¡ç®—æ–¹å¼ | æ»¡åˆ† | è¯´æ˜ |
|-----|------|---------|------|------|
| **ä¿è¯é‡‘å……è¶³ç‡** | 10% | å®é™…ä¿è¯é‡‘ / æœ€ä½è¦æ±‚ | 200% = 100åˆ† | å……è¶³ç‡ < 100% â†’ ç¦ç”¨ |
| **æµåŠ¨æ€§å……è¶³** | 10% | MEMOåº“å­˜ / æ—¥å‡è®¢å•é‡ | > 10å€ = 100åˆ† | åº“å­˜ä¸è¶³ â†’ é™çº§ |

**æ€»åˆ†**ï¼š200åˆ†

#### ç»´åº¦ 4ï¼šæ´»è·ƒåº¦ï¼ˆæƒé‡ 10%ï¼‰

| æŒ‡æ ‡ | æƒé‡ | è®¡ç®—æ–¹å¼ | æ»¡åˆ† | è¯´æ˜ |
|-----|------|---------|------|------|
| **è®¢å•å¤„ç†é‡** | 5% | æœˆè®¢å•é‡ | > 100ç¬” = 50åˆ† | æ´»è·ƒåº¦é«˜ â†’ åŠ åˆ† |
| **è¿ç»­æœåŠ¡å¤©æ•°** | 5% | è¿ç»­å¤©æ•° | > 30å¤© = 50åˆ† | ç¨³å®šæ€§å¥–åŠ± |

**æ€»åˆ†**ï¼š100åˆ†

### 3.3 ä¿¡ç”¨åˆ†è®¡ç®—å…¬å¼

```rust
ä¿¡ç”¨åˆ† = åŸºç¡€åˆ† + å±¥çº¦åˆ† + æœåŠ¡åˆ† + èµ„é‡‘åˆ† + æ´»è·ƒåˆ† - è¿çº¦æ‰£åˆ†

å…¶ä¸­ï¼š
- åŸºç¡€åˆ† = 820ï¼ˆBronzeåˆå§‹åˆ†ï¼‰
- å±¥çº¦åˆ† = (å®Œæˆç‡*150 + åŠæ—¶é‡Šæ”¾ç‡*150 + (1-è¶…æ—¶ç‡)*100) * 40%
- æœåŠ¡åˆ† = (ä¹°å®¶è¯„åˆ†å¹³å‡*40 + å“åº”é€Ÿåº¦åˆ†*100) * 30%
- èµ„é‡‘åˆ† = (ä¿è¯é‡‘å……è¶³ç‡*100 + æµåŠ¨æ€§å……è¶³*100) * 20%
- æ´»è·ƒåˆ† = (è®¢å•å¤„ç†é‡åˆ†*50 + è¿ç»­æœåŠ¡å¤©æ•°åˆ†*50) * 10%
- è¿çº¦æ‰£åˆ† = è¿çº¦æ¬¡æ•° * æƒ©ç½šç³»æ•°
```

### 3.4 ä¿¡ç”¨åˆ†æ›´æ–°è§¦å‘ç‚¹

| è§¦å‘äº‹ä»¶ | ä¿¡ç”¨åˆ†å˜åŒ– | è¯´æ˜ |
|---------|-----------|------|
| **è®¢å•å®Œæˆï¼ˆæ­£å¸¸ï¼‰** | +2 åˆ† | æ¯ç¬”è®¢å• +2 åˆ† |
| **åŠæ—¶é‡Šæ”¾ï¼ˆ< 24hï¼‰** | +1 åˆ† | å¿«é€ŸæœåŠ¡å¥–åŠ± |
| **ä¹°å®¶5æ˜Ÿè¯„ä»·** | +5 åˆ† | ä¼˜è´¨æœåŠ¡å¥–åŠ± |
| **ä¹°å®¶4æ˜Ÿè¯„ä»·** | +2 åˆ† | è‰¯å¥½æœåŠ¡ |
| **ä¹°å®¶3æ˜Ÿè¯„ä»·** | +0 åˆ† | ä¸­æ€§è¯„ä»· |
| **ä¹°å®¶1-2æ˜Ÿè¯„ä»·** | -5 åˆ† | å·®è¯„æƒ©ç½š |
| **è®¢å•è¶…æ—¶æœªé‡Šæ”¾** | -10 åˆ† | ä¸¥é‡è¿çº¦ |
| **è®¢å•è¢«å–æ¶ˆï¼ˆåšå¸‚å•†è´£ä»»ï¼‰** | -5 åˆ† | æœåŠ¡ä¸­æ–­ |
| **äº‰è®®ä»²è£å¤±è´¥** | -20 åˆ† | æ¶æ„è¡Œä¸º |
| **è¿ç»­3ç¬”å·®è¯„** | -30 åˆ† | ä¸¥é‡æœåŠ¡é—®é¢˜ |
| **ä¿è¯é‡‘ä¸è¶³** | -50 åˆ† + æš‚åœæ¥å• | èµ„é‡‘é£é™© |

---

## å››ã€å­˜å‚¨ç»“æ„è®¾è®¡

### 4.1 MakerCreditScoreï¼ˆåšå¸‚å•†ä¿¡ç”¨è®°å½•ï¼‰

```rust
#[pallet::storage]
#[pallet::getter(fn maker_credit)]
pub type MakerCreditScore<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    u64,  // maker_id
    CreditRecord<T::BlockNumber>,
    OptionQuery,
>;

pub struct CreditRecord<BlockNumber> {
    /// å½“å‰ä¿¡ç”¨åˆ†ï¼ˆ800-1000ï¼‰
    pub credit_score: u16,
    /// ä¿¡ç”¨ç­‰çº§
    pub level: CreditLevel,
    
    // === å±¥çº¦æ•°æ® ===
    /// æ€»è®¢å•æ•°
    pub total_orders: u32,
    /// å®Œæˆè®¢å•æ•°
    pub completed_orders: u32,
    /// è¶…æ—¶è®¢å•æ•°
    pub timeout_orders: u32,
    /// å–æ¶ˆè®¢å•æ•°ï¼ˆåšå¸‚å•†è´£ä»»ï¼‰
    pub cancelled_orders: u32,
    /// åŠæ—¶é‡Šæ”¾è®¢å•æ•°ï¼ˆ< 24hï¼‰
    pub timely_release_orders: u32,
    
    // === æœåŠ¡è´¨é‡ ===
    /// ä¹°å®¶è¯„åˆ†æ€»å’Œ
    pub rating_sum: u32,
    /// è¯„åˆ†æ¬¡æ•°
    pub rating_count: u32,
    /// å¹³å‡å“åº”æ—¶é—´ï¼ˆç§’ï¼‰
    pub avg_response_time: u32,
    
    // === èµ„é‡‘æ•°æ® ===
    /// å½“å‰ä¿è¯é‡‘
    pub current_deposit: Balance,
    /// æœ€ä½ä¿è¯é‡‘è¦æ±‚
    pub required_deposit: Balance,
    
    // === æ´»è·ƒåº¦ ===
    /// æœ€åä¸€æ¬¡è®¢å•åŒºå—
    pub last_order_block: BlockNumber,
    /// è¿ç»­æœåŠ¡å¤©æ•°
    pub consecutive_days: u16,
    
    // === è¿çº¦è®°å½• ===
    /// è¿çº¦æ¬¡æ•°
    pub default_count: u16,
    /// äº‰è®®å¤±è´¥æ¬¡æ•°
    pub dispute_loss_count: u16,
    /// æœ€åä¸€æ¬¡è¿çº¦åŒºå—
    pub last_default_block: Option<BlockNumber>,
    
    /// æœåŠ¡çŠ¶æ€
    pub status: ServiceStatus,
}

pub enum CreditLevel {
    Diamond,     // 950-1000
    Platinum,    // 900-949
    Gold,        // 850-899
    Silver,      // 820-849
    Bronze,      // 800-819
}

pub enum ServiceStatus {
    Active,      // æ­£å¸¸æœåŠ¡
    Warning,     // è­¦å‘ŠçŠ¶æ€ï¼ˆ750-799ï¼‰
    Suspended,   // æš‚åœæœåŠ¡ï¼ˆ< 750ï¼‰
}
```

### 4.2 MakerRatingsï¼ˆä¹°å®¶è¯„ä»·è®°å½•ï¼‰

```rust
#[pallet::storage]
#[pallet::getter(fn maker_ratings)]
pub type MakerRatings<T: Config> = StorageDoubleMap<
    _,
    Blake2_128Concat,
    u64,  // maker_id
    Blake2_128Concat,
    u64,  // order_id
    Rating<T::AccountId>,
    OptionQuery,
>;

pub struct Rating<AccountId> {
    /// ä¹°å®¶è´¦æˆ·
    pub buyer: AccountId,
    /// è¯„åˆ†ï¼ˆ1-5æ˜Ÿï¼‰
    pub stars: u8,
    /// è¯„ä»·æ ‡ç­¾
    pub tags: BoundedVec<RatingTag, ConstU32<5>>,
    /// è¯„ä»·æ—¶é—´
    pub timestamp: u32,
}

pub enum RatingTag {
    FastRelease,       // å¿«é€Ÿé‡Šæ”¾
    GoodCommunication, // æ²Ÿé€šè‰¯å¥½
    FairPrice,         // ä»·æ ¼åˆç†
    SlowRelease,       // é‡Šæ”¾æ…¢
    PoorCommunication, // æ²Ÿé€šå·®
    Unresponsive,      // ä¸å›åº”
}
```

### 4.3 DefaultHistoryï¼ˆè¿çº¦å†å²ï¼‰

```rust
#[pallet::storage]
#[pallet::getter(fn default_history)]
pub type DefaultHistory<T: Config> = StorageDoubleMap<
    _,
    Blake2_128Concat,
    u64,  // maker_id
    Blake2_128Concat,
    u64,  // order_id
    DefaultRecord<T::BlockNumber>,
    OptionQuery,
>;

pub struct DefaultRecord<BlockNumber> {
    /// è¿çº¦ç±»å‹
    pub default_type: DefaultType,
    /// è¿çº¦æ—¶é—´
    pub block: BlockNumber,
    /// æƒ©ç½šåˆ†æ•°
    pub penalty_score: u16,
    /// æ˜¯å¦å·²æ¢å¤
    pub recovered: bool,
}

pub enum DefaultType {
    Timeout,          // è¶…æ—¶æœªé‡Šæ”¾
    Cancellation,     // æ¶æ„å–æ¶ˆ
    DisputeLoss,      // äº‰è®®è´¥è¯‰
    InsufficientFund, // ä¿è¯é‡‘ä¸è¶³
}
```

### 4.4 DynamicDepositRequirementï¼ˆåŠ¨æ€ä¿è¯é‡‘è¦æ±‚ï¼‰

```rust
#[pallet::storage]
#[pallet::getter(fn dynamic_deposit)]
pub type DynamicDepositRequirement<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    u64,  // maker_id
    Balance,
    ValueQuery,
>;

// è®¡ç®—å…¬å¼ï¼š
// åŸºç¡€ä¿è¯é‡‘ = 1,000,000 DUST
// åŠ¨æ€ä¿è¯é‡‘ = åŸºç¡€ä¿è¯é‡‘ * è°ƒæ•´ç³»æ•°
//
// è°ƒæ•´ç³»æ•°ï¼š
// - Diamond (950+):  0.5xï¼ˆå‡50%ï¼‰
// - Platinum (900+): 0.7xï¼ˆå‡30%ï¼‰
// - Gold (850+):     0.8xï¼ˆå‡20%ï¼‰
// - Silver (820+):   0.9xï¼ˆå‡10%ï¼‰
// - Bronze (800+):   1.0xï¼ˆæ— æŠ˜æ‰£ï¼‰
// - Warning (750+):  1.2xï¼ˆåŠ 20%ï¼‰
// - Suspended (<750): ä¸å¯æ¥å•
```

---

## äº”ã€å¯è°ƒç”¨æ¥å£è®¾è®¡

### 5.1 å†…éƒ¨æ¥å£ï¼ˆç”±å…¶ä»–Palletè°ƒç”¨ï¼‰

#### 1. `record_order_completed`

**åŠŸèƒ½**ï¼šè®°å½•è®¢å•å®Œæˆï¼Œæ›´æ–°ä¿¡ç”¨åˆ†

```rust
pub fn record_order_completed(
    maker_id: u64,
    order_id: u64,
    response_time_seconds: u32,  // å“åº”æ—¶é—´ï¼ˆç§’ï¼‰
) -> DispatchResult;
```

**è°ƒç”¨æ–¹**ï¼š`pallet-otc-order::release_memo`

**é€»è¾‘**ï¼š
1. è·å–åšå¸‚å•†ä¿¡ç”¨è®°å½•
2. `total_orders += 1`
3. `completed_orders += 1`
4. å¦‚æœ `response_time_seconds < 86400`ï¼ˆ24å°æ—¶ï¼‰ï¼š`timely_release_orders += 1`
5. è®¡ç®—æ–°ä¿¡ç”¨åˆ†ï¼š`credit_score += 2`ï¼ˆåŸºç¡€å¥–åŠ±ï¼‰
6. å¦‚æœåŠæ—¶é‡Šæ”¾ï¼š`credit_score += 1`ï¼ˆé¢å¤–å¥–åŠ±ï¼‰
7. æ›´æ–°ä¿¡ç”¨ç­‰çº§
8. è§¦å‘äº‹ä»¶ `OrderCompleted { maker_id, order_id, credit_score }`

---

#### 2. `record_order_timeout`

**åŠŸèƒ½**ï¼šè®°å½•è®¢å•è¶…æ—¶ï¼Œæƒ©ç½šä¿¡ç”¨åˆ†

```rust
pub fn record_order_timeout(
    maker_id: u64,
    order_id: u64,
) -> DispatchResult;
```

**è°ƒç”¨æ–¹**ï¼š`pallet-otc-order::timeout_handler`

**é€»è¾‘**ï¼š
1. è·å–åšå¸‚å•†ä¿¡ç”¨è®°å½•
2. `total_orders += 1`
3. `timeout_orders += 1`
4. `default_count += 1`
5. æƒ©ç½šä¿¡ç”¨åˆ†ï¼š`credit_score -= 10`
6. è®°å½•è¿çº¦å†å²
7. æ£€æŸ¥æ˜¯å¦é™çº§/æš‚åœ
8. è§¦å‘äº‹ä»¶ `OrderTimeout { maker_id, order_id, penalty: 10 }`

---

#### 3. `record_dispute_result`

**åŠŸèƒ½**ï¼šè®°å½•äº‰è®®ä»²è£ç»“æœ

```rust
pub fn record_dispute_result(
    maker_id: u64,
    order_id: u64,
    maker_win: bool,  // åšå¸‚å•†æ˜¯å¦èƒœè¯‰
) -> DispatchResult;
```

**è°ƒç”¨æ–¹**ï¼š`pallet-arbitration::resolve_dispute`

**é€»è¾‘**ï¼š
1. å¦‚æœ `maker_win == true`ï¼šåšå¸‚å•†èƒœè¯‰ï¼Œæ— å˜åŒ–
2. å¦‚æœ `maker_win == false`ï¼šåšå¸‚å•†è´¥è¯‰
   - `dispute_loss_count += 1`
   - `credit_score -= 20`ï¼ˆä¸¥é‡æƒ©ç½šï¼‰
   - æ£€æŸ¥æ˜¯å¦æš‚åœæœåŠ¡
3. è®°å½•è¿çº¦å†å²
4. è§¦å‘äº‹ä»¶ `DisputeResolved { maker_id, order_id, maker_win, credit_score }`

---

### 5.2 å¤–éƒ¨æ¥å£ï¼ˆç”±ç”¨æˆ·/æ²»ç†è°ƒç”¨ï¼‰

#### 1. `rate_maker`

**åŠŸèƒ½**ï¼šä¹°å®¶è¯„ä»·åšå¸‚å•†

```rust
#[pallet::call_index(0)]
#[pallet::weight(10_000)]
pub fn rate_maker(
    origin: OriginFor<T>,
    maker_id: u64,
    order_id: u64,
    stars: u8,  // 1-5æ˜Ÿ
    tags: BoundedVec<RatingTag, ConstU32<5>>,
) -> DispatchResult;
```

**æƒé™**ï¼šä¹°å®¶ï¼ˆè®¢å•çš„takerï¼‰

**é€»è¾‘**ï¼š
1. éªŒè¯ `origin` æ˜¯è®¢å•çš„ä¹°å®¶
2. éªŒè¯è®¢å•å·²å®Œæˆ
3. éªŒè¯æœªé‡å¤è¯„ä»·
4. å­˜å‚¨è¯„ä»·è®°å½•
5. æ›´æ–°ä¿¡ç”¨åˆ†ï¼š
   - 5æ˜Ÿï¼š`+5åˆ†`
   - 4æ˜Ÿï¼š`+2åˆ†`
   - 3æ˜Ÿï¼š`0åˆ†`
   - 1-2æ˜Ÿï¼š`-5åˆ†`
6. æ›´æ–° `rating_sum` å’Œ `rating_count`
7. è§¦å‘äº‹ä»¶ `MakerRated { maker_id, order_id, stars, credit_score }`

---

#### 2. `query_credit_score`

**åŠŸèƒ½**ï¼šæŸ¥è¯¢åšå¸‚å•†ä¿¡ç”¨åˆ†ï¼ˆå…¬å¼€æŸ¥è¯¢ï¼‰

```rust
pub fn query_credit_score(maker_id: u64) -> Option<u16>;
```

**è°ƒç”¨æ–¹**ï¼šå‰ç«¯ã€å…¶ä»–Pallet

---

#### 3. `check_service_status`

**åŠŸèƒ½**ï¼šæ£€æŸ¥åšå¸‚å•†æ˜¯å¦å¯æ¥å•

```rust
pub fn check_service_status(maker_id: u64) -> Result<ServiceStatus, DispatchError>;
```

**è°ƒç”¨æ–¹**ï¼š`pallet-otc-order::open_order`ï¼ˆåˆ›å»ºè®¢å•å‰æ£€æŸ¥ï¼‰

**é€»è¾‘**ï¼š
1. æŸ¥è¯¢ä¿¡ç”¨åˆ†
2. å¦‚æœ `credit_score < 750` â†’ `Suspended`ï¼ˆä¸å¯æ¥å•ï¼‰
3. å¦‚æœ `750 <= credit_score < 800` â†’ `Warning`ï¼ˆå¯æ¥å•ï¼Œä½†æœ‰è­¦å‘Šï¼‰
4. å¦‚æœ `credit_score >= 800` â†’ `Active`ï¼ˆæ­£å¸¸æ¥å•ï¼‰

---

## å…­ã€è‡ªåŠ¨åŒ–æœºåˆ¶

### 6.1 ä¿¡ç”¨åˆ†è‡ªåŠ¨æ›´æ–°

| è§¦å‘äº‹ä»¶ | è‡ªåŠ¨æ“ä½œ | è°ƒç”¨æ–¹ |
|---------|---------|--------|
| è®¢å•å®Œæˆ | +2-3åˆ† | `pallet-otc-order` |
| è®¢å•è¶…æ—¶ | -10åˆ† | `pallet-otc-order` |
| ä¹°å®¶è¯„ä»· | -5 ~ +5åˆ† | ä¹°å®¶ç›´æ¥è°ƒç”¨ |
| äº‰è®®è´¥è¯‰ | -20åˆ† | `pallet-arbitration` |

### 6.2 è‡ªåŠ¨é™çº§/æš‚åœ

```rust
fn check_and_update_status(maker_id: u64) -> DispatchResult {
    MakerCreditScore::<T>::mutate(maker_id, |record_opt| {
        if let Some(record) = record_opt {
            let new_status = match record.credit_score {
                0..=749 => ServiceStatus::Suspended,    // è‡ªåŠ¨æš‚åœ
                750..=799 => ServiceStatus::Warning,    // è­¦å‘Š
                800..=1000 => ServiceStatus::Active,    // æ­£å¸¸
                _ => ServiceStatus::Suspended,
            };
            
            let old_status = record.status;
            record.status = new_status;
            
            // è§¦å‘é™çº§äº‹ä»¶
            if old_status != new_status {
                Self::deposit_event(Event::StatusChanged {
                    maker_id,
                    old_status,
                    new_status,
                    credit_score: record.credit_score,
                });
            }
        }
        Ok(())
    })
}
```

### 6.3 åŠ¨æ€ä¿è¯é‡‘è°ƒæ•´

```rust
fn calculate_required_deposit(maker_id: u64) -> Balance {
    const BASE_DEPOSIT: Balance = 1_000_000 * UNIT;  // 100ä¸‡ DUST
    
    let credit_score = Self::query_credit_score(maker_id).unwrap_or(820);
    
    let multiplier = match credit_score {
        950..=1000 => 0.5,  // Diamond: -50%
        900..=949  => 0.7,  // Platinum: -30%
        850..=899  => 0.8,  // Gold: -20%
        820..=849  => 0.9,  // Silver: -10%
        800..=819  => 1.0,  // Bronze: æ— æŠ˜æ‰£
        750..=799  => 1.2,  // Warning: +20%
        _          => 2.0,  // Suspended: +100%ï¼ˆä½†ä¸å¯æ¥å•ï¼‰
    };
    
    (BASE_DEPOSIT as f64 * multiplier) as Balance
}
```

---

## ä¸ƒã€ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

### 7.1 pallet-market-maker é›†æˆ

#### ä¿®æ”¹ç‚¹ 1ï¼šç”³è¯·å®¡æ ¸æ—¶åˆå§‹åŒ–ä¿¡ç”¨è®°å½•

```rust
// pallets/market-maker/src/lib.rs
#[pallet::call_index(2)]
pub fn approve(
    origin: OriginFor<T>,
    app_id: u64,
) -> DispatchResult {
    // ... ç°æœ‰å®¡æ ¸é€»è¾‘ ...
    
    // ğŸ†• åˆå§‹åŒ–åšå¸‚å•†ä¿¡ç”¨è®°å½•
    pallet_maker_credit::Pallet::<T>::initialize_credit(app_id)?;
    
    // ...
}
```

#### ä¿®æ”¹ç‚¹ 2ï¼šæ˜¾ç¤ºä¿¡ç”¨åˆ†

```rust
// æ–°å¢å‡½æ•°ï¼šæŸ¥è¯¢åšå¸‚å•†ä¿¡ç”¨åˆ†
pub fn get_maker_with_credit(maker_id: u64) -> Option<(Application, u16)> {
    if let Some(app) = ActiveMarketMakers::<T>::get(maker_id) {
        let credit_score = pallet_maker_credit::Pallet::<T>::query_credit_score(maker_id)
            .unwrap_or(820);
        Some((app, credit_score))
    } else {
        None
    }
}
```

### 7.2 pallet-otc-order é›†æˆ

#### ä¿®æ”¹ç‚¹ 1ï¼šåˆ›å»ºè®¢å•å‰æ£€æŸ¥ä¿¡ç”¨

```rust
// pallets/otc-order/src/lib.rs
#[pallet::call_index(11)]
pub fn open_order(...) -> DispatchResult {
    // ğŸ†• æ£€æŸ¥åšå¸‚å•†ä¿¡ç”¨çŠ¶æ€
    let status = pallet_maker_credit::Pallet::<T>::check_service_status(maker_id)?;
    ensure!(
        matches!(status, ServiceStatus::Active | ServiceStatus::Warning),
        Error::<T>::MakerSuspended
    );
    
    // ... ç°æœ‰åˆ›å»ºè®¢å•é€»è¾‘ ...
}
```

#### ä¿®æ”¹ç‚¹ 2ï¼šè®¢å•å®Œæˆæ—¶æ›´æ–°ä¿¡ç”¨

```rust
// pallets/otc-order/src/lib.rs
#[pallet::call_index(3)]
pub fn release_memo(...) -> DispatchResult {
    // ... ç°æœ‰é‡Šæ”¾é€»è¾‘ ...
    
    // ğŸ†• è®¡ç®—å“åº”æ—¶é—´
    let response_time = now_timestamp.saturating_sub(order.created_at);
    
    // ğŸ†• æ›´æ–°åšå¸‚å•†ä¿¡ç”¨åˆ†
    pallet_maker_credit::Pallet::<T>::record_order_completed(
        order.maker_id,
        id,
        response_time,
    )?;
    
    Ok(())
}
```

#### ä¿®æ”¹ç‚¹ 3ï¼šè®¢å•è¶…æ—¶æ—¶æƒ©ç½š

```rust
// pallets/otc-order/src/lib.rsï¼ˆæ–°å¢å‡½æ•°ï¼‰
pub fn handle_order_timeout(order_id: u64) -> DispatchResult {
    let order = Orders::<T>::get(order_id).ok_or(Error::<T>::NotFound)?;
    
    // åˆ¤æ–­è´£ä»»æ–¹
    if order.state == OrderState::Created {
        // ä¹°å®¶æœªä»˜æ¬¾ï¼Œæƒ©ç½šä¹°å®¶
        pallet_buyer_credit::Pallet::<T>::penalize_default(&order.taker);
    } else if order.state == OrderState::PaidOrCommitted {
        // åšå¸‚å•†æœªé‡Šæ”¾ï¼Œæƒ©ç½šåšå¸‚å•†
        pallet_maker_credit::Pallet::<T>::record_order_timeout(
            order.maker_id,
            order_id,
        )?;
    }
    
    Ok(())
}
```

### 7.3 pallet-arbitration é›†æˆ

```rust
// pallets/arbitration/src/lib.rs
#[pallet::call_index(2)]
pub fn resolve_dispute(..., winner: DisputeWinner) -> DispatchResult {
    // ... ç°æœ‰ä»²è£é€»è¾‘ ...
    
    // ğŸ†• æ›´æ–°åšå¸‚å•†ä¿¡ç”¨åˆ†
    let maker_win = matches!(winner, DisputeWinner::Maker);
    pallet_maker_credit::Pallet::<T>::record_dispute_result(
        order.maker_id,
        order_id,
        maker_win,
    )?;
    
    Ok(())
}
```

---

## å…«ã€å‰ç«¯é›†æˆ

### 8.1 åšå¸‚å•†åˆ—è¡¨å±•ç¤º

```typescript
// stardust-dapp/src/services/makerCreditService.ts

/**
 * æŸ¥è¯¢åšå¸‚å•†ä¿¡ç”¨åˆ†
 */
export async function getMakerCredit(makerId: number): Promise<MakerCredit> {
  const api = await getApi();
  const credit = await api.query.makerCredit.makerCreditScore(makerId);
  
  if (credit.isNone) {
    return {
      makerId,
      creditScore: 820,
      level: 'Bronze',
      status: 'Active',
      totalOrders: 0,
      completedOrders: 0,
      avgRating: 0,
    };
  }
  
  const record = credit.unwrap();
  return {
    makerId,
    creditScore: record.creditScore.toNumber(),
    level: record.level.toString(),
    status: record.status.toString(),
    totalOrders: record.totalOrders.toNumber(),
    completedOrders: record.completedOrders.toNumber(),
    avgRating: record.ratingCount.toNumber() > 0
      ? record.ratingSum.toNumber() / record.ratingCount.toNumber()
      : 0,
  };
}

/**
 * ä¹°å®¶è¯„ä»·åšå¸‚å•†
 */
export async function rateMaker(
  makerId: number,
  orderId: number,
  stars: 1 | 2 | 3 | 4 | 5,
  tags: string[]
): Promise<void> {
  const api = await getApi();
  const address = getCurrentAddress();
  
  const tx = api.tx.makerCredit.rateMaker(
    makerId,
    orderId,
    stars,
    tags
  );
  
  await signAndSendLocalFromKeystore(tx, address);
}
```

### 8.2 åšå¸‚å•†ä¿¡ç”¨å¾½ç« ç»„ä»¶

```tsx
// stardust-dapp/src/components/MakerCreditBadge.tsx

import React from 'react';
import { Badge, Tooltip } from 'antd';
import { StarFilled, WarningOutlined, StopOutlined } from '@ant-design/icons';

interface MakerCreditBadgeProps {
  creditScore: number;
  level: string;
  status: string;
  avgRating?: number;
}

export const MakerCreditBadge: React.FC<MakerCreditBadgeProps> = ({
  creditScore,
  level,
  status,
  avgRating = 0,
}) => {
  const getLevelConfig = () => {
    if (status === 'Suspended') {
      return { color: 'red', icon: <StopOutlined />, text: 'å·²æš‚åœ' };
    }
    if (status === 'Warning') {
      return { color: 'orange', icon: <WarningOutlined />, text: 'è­¦å‘Š' };
    }
    
    switch (level) {
      case 'Diamond': return { color: 'purple', icon: 'ğŸ’', text: 'é’»çŸ³' };
      case 'Platinum': return { color: 'blue', icon: 'ğŸ†', text: 'ç™½é‡‘' };
      case 'Gold': return { color: 'gold', icon: 'â­', text: 'é»„é‡‘' };
      case 'Silver': return { color: 'default', icon: 'ğŸ¥ˆ', text: 'ç™½é“¶' };
      case 'Bronze': return { color: 'default', icon: 'ğŸ¥‰', text: 'é’é“œ' };
      default: return { color: 'default', icon: '', text: 'æœªçŸ¥' };
    }
  };
  
  const config = getLevelConfig();
  
  return (
    <Tooltip
      title={
        <div>
          <div>ä¿¡ç”¨åˆ†: {creditScore}</div>
          <div>ç­‰çº§: {config.text}</div>
          {avgRating > 0 && (
            <div>
              å¹³å‡è¯„åˆ†: {avgRating.toFixed(1)} <StarFilled style={{ color: '#faad14' }} />
            </div>
          )}
        </div>
      }
    >
      <Badge
        count={`${config.icon} ${config.text}`}
        style={{
          backgroundColor: config.color === 'default' ? '#d9d9d9' : undefined,
        }}
      />
    </Tooltip>
  );
};
```

### 8.3 è¯„ä»·åšå¸‚å•†é¡µé¢

```tsx
// stardust-dapp/src/features/otc/RateMakerPage.tsx

import React, { useState } from 'react';
import { Card, Rate, Checkbox, Button, message } from 'antd';
import { useParams, useNavigate } from 'react-router-dom';
import { rateMaker } from '../../services/makerCreditService';

const RATING_TAGS = [
  { value: 'FastRelease', label: 'å¿«é€Ÿé‡Šæ”¾' },
  { value: 'GoodCommunication', label: 'æ²Ÿé€šè‰¯å¥½' },
  { value: 'FairPrice', label: 'ä»·æ ¼åˆç†' },
  { value: 'SlowRelease', label: 'é‡Šæ”¾æ…¢' },
  { value: 'PoorCommunication', label: 'æ²Ÿé€šå·®' },
  { value: 'Unresponsive', label: 'ä¸å›åº”' },
];

export const RateMakerPage: React.FC = () => {
  const { orderId, makerId } = useParams<{ orderId: string; makerId: string }>();
  const navigate = useNavigate();
  
  const [stars, setStars] = useState<number>(5);
  const [tags, setTags] = useState<string[]>([]);
  const [submitting, setSubmitting] = useState(false);
  
  const handleSubmit = async () => {
    if (!orderId || !makerId) return;
    
    try {
      setSubmitting(true);
      await rateMaker(
        parseInt(makerId),
        parseInt(orderId),
        stars as 1 | 2 | 3 | 4 | 5,
        tags
      );
      message.success('è¯„ä»·æˆåŠŸï¼');
      navigate(-1);
    } catch (error) {
      message.error(`è¯„ä»·å¤±è´¥: ${error}`);
    } finally {
      setSubmitting(false);
    }
  };
  
  return (
    <div style={{ padding: '16px' }}>
      <Card title="è¯„ä»·åšå¸‚å•†">
        <div style={{ marginBottom: '24px' }}>
          <div style={{ marginBottom: '8px' }}>æœåŠ¡è´¨é‡ï¼š</div>
          <Rate
            value={stars}
            onChange={setStars}
            style={{ fontSize: '32px' }}
          />
        </div>
        
        <div style={{ marginBottom: '24px' }}>
          <div style={{ marginBottom: '8px' }}>è¯„ä»·æ ‡ç­¾ï¼š</div>
          <Checkbox.Group
            options={RATING_TAGS}
            value={tags}
            onChange={setTags}
          />
        </div>
        
        <Button
          type="primary"
          block
          size="large"
          loading={submitting}
          onClick={handleSubmit}
        >
          æäº¤è¯„ä»·
        </Button>
      </Card>
    </div>
  );
};
```

---

## ä¹ã€å®æ–½è®¡åˆ’

### 9.1 ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆP0ï¼‰

| ä»»åŠ¡ | å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|-----|--------|--------|
| åˆ›å»º `pallet-maker-credit` æ¨¡å— | 3å¤© | P0 |
| å®ç°ä¿¡ç”¨è¯„åˆ†å¼•æ“ | 2å¤© | P0 |
| å®ç°å±¥çº¦ç‡è¿½è¸ª | 2å¤© | P0 |
| å®ç°è¿çº¦æƒ©ç½šæœºåˆ¶ | 2å¤© | P0 |
| é›†æˆåˆ° `pallet-market-maker` | 1å¤© | P0 |
| é›†æˆåˆ° `pallet-otc-order` | 1å¤© | P0 |
| é›†æˆåˆ° `pallet-arbitration` | 1å¤© | P0 |
| ç¼–å†™å•å…ƒæµ‹è¯• | 2å¤© | P0 |
| å‰ç«¯å±•ç¤ºä¿¡ç”¨å¾½ç«  | 1å¤© | P0 |

**å°è®¡**ï¼š15å¤©

### 9.2 ç¬¬äºŒé˜¶æ®µï¼šé«˜çº§åŠŸèƒ½ï¼ˆP1ï¼‰

| ä»»åŠ¡ | å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|-----|--------|--------|
| å®ç°åŠ¨æ€ä¿è¯é‡‘ | 2å¤© | P1 |
| å®ç°ä¹°å®¶è¯„ä»·åŠŸèƒ½ | 2å¤© | P1 |
| å®ç°è‡ªåŠ¨é™çº§/ç¦ç”¨ | 1å¤© | P1 |
| å‰ç«¯è¯„ä»·é¡µé¢ | 2å¤© | P1 |
| å‰ç«¯ä¿¡ç”¨è¯¦æƒ…é¡µ | 2å¤© | P1 |

**å°è®¡**ï¼š9å¤©

### 9.3 ç¬¬ä¸‰é˜¶æ®µï¼šä¼˜åŒ–ï¼ˆP2ï¼‰

| ä»»åŠ¡ | å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|-----|--------|--------|
| å¥–åŠ±æœºåˆ¶ï¼ˆé™ä½æ‰‹ç»­è´¹ï¼‰ | 1å¤© | P2 |
| ä¿¡ç”¨æ¢å¤æœºåˆ¶ | 1å¤© | P2 |
| ä¿¡ç”¨æŠ¥å‘Šç”Ÿæˆ | 1å¤© | P2 |
| æ€§èƒ½ä¼˜åŒ– | 1å¤© | P2 |

**å°è®¡**ï¼š4å¤©

**æ€»å·¥ä½œé‡**ï¼š28å¤©

---

## åã€æˆæœ¬åˆ†æ

### 10.1 å­˜å‚¨æˆæœ¬

| å­˜å‚¨é¡¹ | å•æ¡å¤§å° | é¢„ä¼°æ¡ç›® | æ€»å­˜å‚¨ |
|-------|---------|---------|--------|
| `MakerCreditScore` | ~200 bytes | 1,000 åšå¸‚å•† | 200 KB |
| `MakerRatings` | ~100 bytes | 100,000 è¯„ä»· | 10 MB |
| `DefaultHistory` | ~80 bytes | 10,000 è¿çº¦ | 800 KB |
| `DynamicDepositRequirement` | ~16 bytes | 1,000 åšå¸‚å•† | 16 KB |

**æ€»å­˜å‚¨**ï¼š~11 MBï¼ˆå¯æ¥å—ï¼‰

### 10.2 è®¡ç®—æˆæœ¬

| æ“ä½œ | Gas ä¼°ç®— | è§¦å‘é¢‘ç‡ | è¯´æ˜ |
|-----|---------|---------|------|
| `record_order_completed` | 20,000 | æ¯ç¬”è®¢å• | ä¸­ç­‰æˆæœ¬ |
| `record_order_timeout` | 25,000 | è¿çº¦è®¢å• | ä¸­ç­‰æˆæœ¬ |
| `rate_maker` | 15,000 | ç”¨æˆ·ä¸»åŠ¨ | ä½æˆæœ¬ |
| `check_service_status` | 5,000 | åˆ›å»ºè®¢å•å‰ | æä½æˆæœ¬ |

**ç»“è®º**ï¼šGas æˆæœ¬å¯æ¥å—ï¼Œä¸ä¼šæ˜¾è‘—å½±å“æ€§èƒ½

---

## åä¸€ã€é£é™©ä¸å¯¹ç­–

### 11.1 æ½œåœ¨é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | å¯¹ç­– |
|-----|------|------|------|
| **æ¶æ„å·®è¯„** | åšå¸‚å•†ä¿¡ç”¨åˆ†è¢«æ¶æ„é™ä½ | ä¸­ | é™åˆ¶è¯„ä»·æƒé™ï¼ˆä»…å®Œæˆè®¢å•çš„ä¹°å®¶ï¼‰ã€æ²»ç†ç”³è¯‰æœºåˆ¶ |
| **ä¿¡ç”¨åˆ†é€šèƒ€** | æ‰€æœ‰åšå¸‚å•†éƒ½å˜é’»çŸ³ | ä¸­ | è®¾ç½®ä¿¡ç”¨åˆ†è¡°å‡æœºåˆ¶ã€å®šæœŸé‡æ–°è¯„ä¼° |
| **ä¿è¯é‡‘ä¸è¶³** | åšå¸‚å•†è¿çº¦åèµ”ä»˜ä¸è¶³ | ä½ | åŠ¨æ€ä¿è¯é‡‘å®æ—¶ç›‘æ§ã€è‡ªåŠ¨æš‚åœ |
| **ç³»ç»Ÿæ»¥ç”¨** | åšå¸‚å•†åˆ·å•æå‡ä¿¡ç”¨ | ä½ | å…³è”è´¦æˆ·æ£€æµ‹ã€å¼‚å¸¸è®¢å•æ£€æµ‹ |

### 11.2 å¯¹ç­–å®æ–½

1. **é˜²æ¶æ„å·®è¯„**ï¼š
   - é™åˆ¶è¯„ä»·æƒé™ï¼šä»…è®¢å• `taker` å¯è¯„ä»·
   - è¯„ä»·æ—¶é—´çª—å£ï¼šè®¢å•å®Œæˆå 7 å¤©å†…
   - æ²»ç†ç”³è¯‰ï¼šåšå¸‚å•†å¯ç”³è¯‰æ¶æ„è¯„ä»·

2. **é˜²ä¿¡ç”¨åˆ†é€šèƒ€**ï¼š
   - ä¿¡ç”¨åˆ†è¡°å‡ï¼šæ¯æœˆè‡ªåŠ¨è¡°å‡ 1%ï¼ˆDiamond ä¸è¡°å‡ï¼‰
   - åŠ¨æ€è¯„ä¼°ï¼šæ ¹æ®å¸‚åœºæ•´ä½“è¡¨ç°è°ƒæ•´è¯„åˆ†æ ‡å‡†

3. **ä¿è¯é‡‘ç›‘æ§**ï¼š
   - å®æ—¶æ£€æŸ¥ï¼šæ¯ç¬”è®¢å•å‰æ£€æŸ¥ä¿è¯é‡‘å……è¶³æ€§
   - è‡ªåŠ¨è¡¥å……æé†’ï¼šä¿è¯é‡‘ä¸è¶³æ—¶é“¾ä¸Šäº‹ä»¶é€šçŸ¥
   - è‡ªåŠ¨æš‚åœï¼šä¿è¯é‡‘ < 50% æ—¶è‡ªåŠ¨æš‚åœæ¥å•

---

## åäºŒã€æ€»ç»“

### 12.1 æ ¸å¿ƒä¼˜åŠ¿

1. âœ… **å¯¹æ ‡ä¹°å®¶ä¿¡ç”¨**ï¼šå‚è€ƒæˆç†Ÿçš„ `pallet-buyer-credit` è®¾è®¡
2. âœ… **è‡ªåŠ¨åŒ–é£æ§**ï¼šè®¢å•å®Œæˆ/è¶…æ—¶è‡ªåŠ¨æ›´æ–°ä¿¡ç”¨åˆ†
3. âœ… **åŠ¨æ€ä¿è¯é‡‘**ï¼šä¿¡ç”¨é«˜ â†’ ä¿è¯é‡‘é™ä½50%ï¼Œé™ä½èµ„é‡‘å‹åŠ›
4. âœ… **æœåŠ¡è´¨é‡ä¿éšœ**ï¼šä¹°å®¶è¯„ä»·ç›´æ¥å½±å“ä¿¡ç”¨åˆ†
5. âœ… **ä½è€¦åˆè®¾è®¡**ï¼šç‹¬ç«‹æ¨¡å—ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•

### 12.2 å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|-----|--------|------|
| **åšå¸‚å•†å®Œæˆç‡** | > 98% | é«˜è´¨é‡æœåŠ¡ |
| **åŠæ—¶é‡Šæ”¾ç‡** | > 95% | 24å°æ—¶å†…é‡Šæ”¾ |
| **å¹³å‡è¯„åˆ†** | > 4.5æ˜Ÿ | ä¹°å®¶æ»¡æ„åº¦ |
| **ä¿¡ç”¨åˆ†åˆ†å¸ƒ** | Gold+ > 60% | å¤§éƒ¨åˆ†åšå¸‚å•†é«˜ä¿¡ç”¨ |
| **æš‚åœç‡** | < 2% | æå°‘åšå¸‚å•†è¢«æš‚åœ |

### 12.3 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… æ–¹æ¡ˆè¯„å®¡ï¼šå›¢é˜Ÿè®¨è®ºå¹¶ç¡®è®¤æ–¹æ¡ˆ
2. â³ å¼€å‘æ’æœŸï¼šå®‰æ’ 28 å¤©å¼€å‘å‘¨æœŸ
3. â³ å®æ–½ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ15å¤©ï¼‰
4. â³ æµ‹è¯•ä¸ä¼˜åŒ–ï¼šé›†æˆæµ‹è¯•ï¼ˆ5å¤©ï¼‰
5. â³ ä¸»ç½‘éƒ¨ç½²ï¼šåˆ†é˜¶æ®µç°åº¦ä¸Šçº¿

---

**æ–¹æ¡ˆçŠ¶æ€**ï¼šâœ… è®¾è®¡å®Œæˆï¼Œå¾…è¯„å®¡  
**é¢„è®¡äº¤ä»˜**ï¼š28 ä¸ªå·¥ä½œæ—¥  
**å»ºè®®ä¼˜å…ˆçº§**ï¼šP0ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

---

## é™„å½•ï¼šå‚è€ƒæ–‡æ¡£

1. `pallet-buyer-credit` - ä¹°å®¶ä¿¡ç”¨ç³»ç»Ÿ
2. `pallet-market-maker` - åšå¸‚å•†æ²»ç†æ¨¡å—
3. `pallet-otc-order` - OTCè®¢å•ç³»ç»Ÿ
4. `pallet-arbitration` - äº‰è®®ä»²è£æ¨¡å—

