# Deceased Pallet - P2é—®é¢˜ä¿®å¤å®ŒæˆæŠ¥å‘Šï¼šäº²å‹å›¢ owner æ— æ³•é€€å‡º

## ğŸ“‹ ä¿®å¤æ¦‚å†µ

**é—®é¢˜ç¼–å·**ï¼šP2  
**ä¼˜å…ˆçº§**ï¼šä¸­ç­‰ä¼˜å…ˆçº§  
**é—®é¢˜ç±»å‹**ï¼šé€»è¾‘å†²çª  
**ä¿®å¤æ—¶é—´**ï¼š2025-10-23  
**å½±å“èŒƒå›´**ï¼šäº²å‹å›¢åŠŸèƒ½ï¼ˆ`leave_friend_group`ã€`kick_friend`ï¼‰

---

## ğŸ¯ é—®é¢˜å›é¡¾

### é—®é¢˜æè¿°

åœ¨åŸæœ‰è®¾è®¡ä¸­ï¼Œ`owner` åœ¨åŠ å…¥è‡ªå·±çš„äº²å‹å›¢å¹¶è¢«èµ‹äºˆ `Admin` è§’è‰²åï¼Œæ— æ³•é€šè¿‡ `leave_friend_group` é€€å‡ºï¼Œä¹Ÿæ— æ³•è¢« `kick_friend` ç§»é™¤ï¼Œå¯¼è‡´ owner è¢«"é”å®š"åœ¨äº²å‹å›¢ä¸­ã€‚

### æ ¹æºåˆ†æ

1. **`leave_friend_group`** ç¦æ­¢ Admin é€€å‡ºï¼ˆé˜²æ­¢ç®¡ç†å‘˜æµå¤±ï¼‰
2. **`kick_friend`** ç¦æ­¢ç§»é™¤ Adminï¼ˆé˜²æ­¢ç®¡ç†å‘˜äº’ç›¸ç§»é™¤ï¼‰
3. **`is_admin`** å‡½æ•°è®¤ä¸º owner å§‹ç»ˆæ˜¯ Admin
4. å¯¼è‡´ owner è¢«åŒé‡çº¦æŸï¼Œæ— æ³•é€€å‡º

### æ ¸å¿ƒçŸ›ç›¾

- **äº²å‹å›¢è®¾è®¡ç†å¿µ**ï¼šå¯é€‰çš„ç¤¾äº¤/åä½œåŠŸèƒ½ï¼Œæˆå‘˜åº”è¯¥èƒ½å¤Ÿè‡ªç”±è¿›å‡º
- **ç®¡ç†å‘˜ä¿æŠ¤é€»è¾‘**ï¼šAdmin ä¸èƒ½è½»æ˜“é€€å‡ºæˆ–è¢«ç§»é™¤
- **owner çš„ç‰¹æ®Šæ€§**ï¼šowner çš„ç®¡ç†æƒé™æ¥è‡ª `DeceasedOf.owner`ï¼Œä¸ä¾èµ– `FriendsOf`

---

## âœ… å®æ–½æ–¹æ¡ˆ

é‡‡ç”¨ **æ–¹æ¡ˆAï¼šå…è®¸ owner é€€å‡ºäº²å‹å›¢**

### æ ¸å¿ƒç†å¿µ

- **owner çš„ç®¡ç†æƒé™**æ¥è‡ª `DeceasedOf.owner` å­—æ®µï¼Œ**ä¸ä¾èµ–**äº `FriendsOf`
- owner å³ä½¿**ä¸åœ¨**äº²å‹å›¢ä¸­ï¼Œ`is_admin(owner)` ä¾ç„¶è¿”å› `true`
- æ‰€ä»¥å…è®¸ owner é€€å‡º/è¢«ç§»é™¤ï¼Œ**ä¸ä¼š**å¯¼è‡´ç®¡ç†å‘˜ç¼ºå¤±

### è®¾è®¡åŸåˆ™

1. **èŒè´£åˆ†ç¦»**ï¼š
   - `DeceasedOf.owner` â†’ ç®¡ç†æƒé™ï¼ˆä¸å¯å˜ï¼Œé™¤é `transfer_deceased`ï¼‰
   - `FriendsOf` â†’ ç¤¾äº¤å…³ç³»ï¼ˆå¯å˜ï¼Œå¯è‡ªç”±è¿›å‡ºï¼‰

2. **çµæ´»æ€§**ï¼š
   - owner å¯ä»¥é€‰æ‹©åŠ å…¥äº²å‹å›¢ï¼ˆå‚ä¸ç¤¾äº¤ï¼‰
   - owner å¯ä»¥é€‰æ‹©é€€å‡ºäº²å‹å›¢ï¼ˆé€€å‡ºç¤¾äº¤ï¼‰
   - owner çš„ç®¡ç†æƒé™å§‹ç»ˆä¿ç•™

3. **å®‰å…¨æ€§**ï¼š
   - é owner çš„ Admin ä¾ç„¶å—ä¿æŠ¤ï¼ˆä¸èƒ½éšæ„é€€å‡ºæˆ–è¢«ç§»é™¤ï¼‰
   - é¿å…ç®¡ç†å‘˜æƒé™äº‰å¤ºå’Œæ··ä¹±

---

## ğŸ”§ ä»£ç ä¿®æ”¹

### 1. ä¿®æ”¹ `leave_friend_group` å‡½æ•°

**ä½ç½®**ï¼š`pallets/deceased/src/lib.rs:2245`

#### ä¿®æ”¹å‰é€»è¾‘

```rust
// ä¿æŠ¤ï¼šowner/Admin ä¸å…è®¸ç”¨æ­¤æ¥å£è‡ªé™çº§é€€å‡ºï¼Œé¿å…å­¤å„¿ï¼›éœ€ç”±å¦ä¸€ Admin å¤„ç†
let rec = FriendsOf::<T>::get(deceased_id, &who).unwrap();
ensure!(
    !matches!(rec.role, FriendRole::Admin),
    Error::<T>::NotAuthorized
);
```

#### ä¿®æ”¹åé€»è¾‘

```rust
// è¯»å–æˆå‘˜è®°å½•å’Œé€è€…ä¿¡æ¯
let rec = FriendsOf::<T>::get(deceased_id, &who).unwrap();
let deceased = DeceasedOf::<T>::get(deceased_id).ok_or(Error::<T>::DeceasedNotFound)?;

// âœ… æ–°å¢ï¼šæ£€æŸ¥æ˜¯å¦ä¸º owner
let is_owner = deceased.owner == who;

// å¦‚æœä¸æ˜¯ ownerï¼Œåˆ™æ£€æŸ¥æ˜¯å¦ä¸º Admin
if !is_owner {
    // é owner çš„ Admin ä¸å…è®¸ç›´æ¥é€€å‡ºï¼Œé¿å…äº²å‹å›¢å¤±å»ç®¡ç†å‘˜
    // éœ€è¦å…ˆé€šè¿‡ set_friend_role é™çº§ä¸º Memberï¼Œæˆ–ç”±å…¶ä»– Admin ç§»é™¤
    ensure!(
        !matches!(rec.role, FriendRole::Admin),
        Error::<T>::NotAuthorized
    );
}
// else: owner å¯ä»¥é€€å‡ºï¼ˆå› ä¸º owner é€€å‡ºåä¾ç„¶é€šè¿‡ DeceasedOf.owner ä¿ç•™ç®¡ç†æƒé™ï¼‰
```

#### æ–°å¢æ³¨é‡Š

```rust
/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šé€€å‡ºäº²å‹å›¢ï¼ˆè‡ªæ„¿é€€å‡ºï¼‰
/// 
/// ### åŠŸèƒ½è¯´æ˜
/// å…è®¸æˆå‘˜ä¸»åŠ¨é€€å‡ºäº²å‹å›¢ã€‚
/// 
/// ### æƒé™è¯´æ˜
/// - æ™®é€šæˆå‘˜ï¼ˆMember/Coreï¼‰ï¼šâœ… å¯ä»¥éšæ—¶é€€å‡º
/// - é owner çš„ Adminï¼šâŒ ä¸å…è®¸é€€å‡ºï¼ˆéœ€è¦å…ˆé™çº§æˆ–ç”±å…¶ä»– Admin ç§»é™¤ï¼‰
/// - ownerï¼šâœ… **å¯ä»¥é€€å‡º**ï¼ˆå› ä¸º owner é€€å‡ºäº²å‹å›¢åä¾ç„¶ä¿ç•™ç®¡ç†æƒé™ï¼‰
/// 
/// ### owner çš„ç‰¹æ®Šæ€§
/// - owner çš„ç®¡ç†æƒé™æ¥è‡ª `DeceasedOf.owner` å­—æ®µï¼Œè€Œé `FriendsOf`
/// - owner å³ä½¿é€€å‡ºäº²å‹å›¢ï¼Œ`is_admin(owner)` ä¾ç„¶è¿”å› `true`
/// - æ‰€ä»¥å…è®¸ owner é€€å‡ºä¸ä¼šå¯¼è‡´"ç®¡ç†å‘˜ç¼ºå¤±"é—®é¢˜
/// 
/// ### è®¾è®¡ç†å¿µ
/// - äº²å‹å›¢æ˜¯å¯é€‰çš„ç¤¾äº¤/åä½œåŠŸèƒ½
/// - owner åŠ å…¥äº²å‹å›¢ = å‚ä¸ç¤¾äº¤
/// - owner é€€å‡ºäº²å‹å›¢ = é€€å‡ºç¤¾äº¤
/// - owner çš„ç®¡ç†æƒé™å§‹ç»ˆä¿ç•™
/// 
/// ### ä½¿ç”¨åœºæ™¯
/// 1. **æ™®é€šæˆå‘˜é€€å‡º**ï¼šä¸æƒ³ç»§ç»­å…³æ³¨è¯¥é€è€…
/// 2. **owner é€€å‡º**ï¼šä¸æƒ³å‚ä¸äº²å‹å›¢ç¤¾äº¤ï¼Œä½†ä¾ç„¶ä¿ç•™ç®¡ç†æƒé™
/// 3. **Admin é€€å‡º**ï¼šéœ€è¦å…ˆé€šè¿‡ `set_friend_role` é™çº§ä¸º Member
/// 
/// ### é”™è¯¯å¤„ç†
/// - `FriendNotMember`: è°ƒç”¨è€…ä¸åœ¨äº²å‹å›¢ä¸­
/// - `NotAuthorized`: é owner çš„ Admin ä¸å…è®¸ç›´æ¥é€€å‡º
```

---

### 2. ä¿®æ”¹ `kick_friend` å‡½æ•°

**ä½ç½®**ï¼š`pallets/deceased/src/lib.rs:2310`

#### ä¿®æ”¹å‰é€»è¾‘

```rust
let rec = FriendsOf::<T>::get(deceased_id, &who).unwrap();
// ç¦æ­¢ç§»é™¤ owner/Adminï¼Œè‡ªæˆ‘ä¿æŠ¤
ensure!(
    !matches!(rec.role, FriendRole::Admin),
    Error::<T>::NotAuthorized
);
```

#### ä¿®æ”¹åé€»è¾‘

```rust
let rec = FriendsOf::<T>::get(deceased_id, &who).unwrap();
let deceased = DeceasedOf::<T>::get(deceased_id).ok_or(Error::<T>::DeceasedNotFound)?;

// âœ… æ–°å¢ï¼šæ£€æŸ¥è¢«ç§»é™¤è€…æ˜¯å¦ä¸º owner
let is_owner = deceased.owner == who;

// å¦‚æœä¸æ˜¯ ownerï¼Œåˆ™æ£€æŸ¥æ˜¯å¦ä¸º Admin
if !is_owner {
    // é owner çš„ Admin ä¸å…è®¸è¢«ç§»é™¤ï¼Œé¿å…ç®¡ç†å‘˜æƒé™äº‰å¤º
    ensure!(
        !matches!(rec.role, FriendRole::Admin),
        Error::<T>::NotAuthorized
    );
}
// else: owner å¯ä»¥è¢«ç§»é™¤ï¼ˆå› ä¸º owner è¢«ç§»é™¤åä¾ç„¶é€šè¿‡ DeceasedOf.owner ä¿ç•™ç®¡ç†æƒé™ï¼‰
```

#### æ–°å¢æ³¨é‡Š

```rust
/// å‡½æ•°çº§è¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼šç§»å‡ºæˆå‘˜ï¼ˆä»… Adminï¼‰
/// 
/// ### åŠŸèƒ½è¯´æ˜
/// å…è®¸ Admin ç§»é™¤äº²å‹å›¢ä¸­çš„æˆå‘˜ã€‚
/// 
/// ### æƒé™è¯´æ˜
/// - è°ƒç”¨è€…ï¼šå¿…é¡»æ˜¯ Adminï¼ˆé€šè¿‡ `is_admin` åˆ¤å®šï¼‰
/// - å¯ç§»é™¤å¯¹è±¡ï¼šæ™®é€šæˆå‘˜ï¼ˆMember/Coreï¼‰ã€owner
/// - ä¸å¯ç§»é™¤å¯¹è±¡ï¼šé owner çš„ Adminï¼ˆé¿å…ç®¡ç†å‘˜äº’ç›¸ç§»é™¤ï¼‰
/// 
/// ### owner çš„ç‰¹æ®Šæ€§
/// - owner å¯ä»¥è¢«ç§»é™¤ï¼ˆå› ä¸º owner è¢«ç§»é™¤åä¾ç„¶é€šè¿‡ `DeceasedOf.owner` ä¿ç•™ç®¡ç†æƒé™ï¼‰
/// - owner ä¹Ÿå¯ä»¥ç§»é™¤è‡ªå·±ï¼ˆè‡ªæ„¿é€€å‡ºäº²å‹å›¢çš„å¦ä¸€ç§æ–¹å¼ï¼‰
/// - owner çš„ç®¡ç†æƒé™æ¥è‡ª `DeceasedOf.owner` å­—æ®µï¼Œä¸ä¼šå› è¢«ç§»é™¤è€Œä¸¢å¤±
/// 
/// ### è®¾è®¡ç†å¿µ
/// - å…è®¸ owner è¢«ç§»é™¤ï¼Œç¬¦åˆ"owner å¯ä»¥è‡ªç”±è¿›å‡ºäº²å‹å›¢"çš„è®¾è®¡
/// - ç¦æ­¢ç§»é™¤é owner çš„ Adminï¼Œé¿å…ç®¡ç†å‘˜æƒé™äº‰å¤º
/// - owner çš„è¶…ç„¶åœ°ä½ï¼šå³ä½¿è¢«ç§»é™¤ï¼Œä¾ç„¶æ˜¯æœ€é«˜ç®¡ç†å‘˜
/// 
/// ### ä½¿ç”¨åœºæ™¯
/// 1. **Admin ç§»é™¤æ™®é€šæˆå‘˜**ï¼šç®¡ç†äº²å‹å›¢æˆå‘˜
/// 2. **Admin ç§»é™¤ owner**ï¼šå¯èƒ½æ˜¯ owner è‡ªå·±æ“ä½œï¼Œä¹Ÿå¯èƒ½æ˜¯å…¶ä»– Admin ååŠ©
/// 3. **ç¦æ­¢ç§»é™¤å…¶ä»– Admin**ï¼šé¿å…ç®¡ç†å‘˜äº’ç›¸ç§»é™¤å¯¼è‡´æ··ä¹±
/// 
/// ### é”™è¯¯å¤„ç†
/// - `NotAuthorized`: è°ƒç”¨è€…ä¸æ˜¯ Adminï¼Œæˆ–å°è¯•ç§»é™¤é owner çš„ Admin
/// - `FriendNotMember`: è¢«ç§»é™¤è€…ä¸åœ¨äº²å‹å›¢ä¸­
```

---

### 3. æ›´æ–° README æ–‡æ¡£

**ä½ç½®**ï¼š`pallets/deceased/README.md:297-325`

#### æ–°å¢å†…å®¹

```markdown
## äº²å‹å›¢ï¼ˆFriendsï¼‰

- Extrinsicsï¼š
  - `leave_friend_group(deceased_id)` âœ¨æ›´æ–°ï¼ˆæˆå‘˜è‡ªæ„¿é€€å‡ºï¼›**owner å¯ä»¥é€€å‡º**ï¼‰
  - `kick_friend(deceased_id, who)` âœ¨æ›´æ–°ï¼ˆAdminç§»é™¤æˆå‘˜ï¼›**å¯ä»¥ç§»é™¤ owner**ï¼‰

### owner ä¸äº²å‹å›¢ âœ¨æ–°å¢è¯´æ˜

**æƒé™æ¨¡å‹**ï¼š
- **owner çš„ç®¡ç†æƒé™**æ¥è‡ª `DeceasedOf.owner` å­—æ®µï¼Œ**ä¸ä¾èµ–**äº `FriendsOf`
- owner å³ä½¿**ä¸åœ¨**äº²å‹å›¢ä¸­ï¼Œ`is_admin(owner)` ä¾ç„¶è¿”å› `true`
- owner å³ä½¿**é€€å‡º**äº²å‹å›¢ï¼Œä¾ç„¶ä¿ç•™å®Œæ•´ç®¡ç†æƒé™

**é€€å‡ºè§„åˆ™**ï¼š
- âœ… **owner å¯ä»¥é€€å‡ºäº²å‹å›¢**ï¼ˆå› ä¸º owner é€€å‡ºåä¾ç„¶ä¿ç•™ç®¡ç†æƒé™ï¼‰
- âŒ **é owner çš„ Admin ä¸èƒ½ç›´æ¥é€€å‡º**ï¼ˆéœ€è¦å…ˆé™çº§ä¸º Memberï¼Œæˆ–ç”±å…¶ä»– Admin ç§»é™¤ï¼‰
- âœ… **æ™®é€šæˆå‘˜ï¼ˆMember/Coreï¼‰å¯ä»¥éšæ—¶é€€å‡º**

**ç§»é™¤è§„åˆ™**ï¼š
- âœ… **owner å¯ä»¥è¢«ç§»é™¤**ï¼ˆå› ä¸º owner è¢«ç§»é™¤åä¾ç„¶ä¿ç•™ç®¡ç†æƒé™ï¼‰
- âŒ **é owner çš„ Admin ä¸èƒ½è¢«ç§»é™¤**ï¼ˆé¿å…ç®¡ç†å‘˜æƒé™äº‰å¤ºï¼‰
- âœ… **æ™®é€šæˆå‘˜ï¼ˆMember/Coreï¼‰å¯ä»¥è¢« Admin ç§»é™¤**

**è®¾è®¡ç†å¿µ**ï¼š
- äº²å‹å›¢æ˜¯**å¯é€‰çš„**ç¤¾äº¤/åä½œåŠŸèƒ½
- owner åŠ å…¥äº²å‹å›¢ = å‚ä¸ç¤¾äº¤
- owner é€€å‡ºäº²å‹å›¢ = é€€å‡ºç¤¾äº¤
- owner çš„ç®¡ç†æƒé™**å§‹ç»ˆä¿ç•™**
```

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ | å¢åŠ è¡Œæ•° | åˆ é™¤è¡Œæ•° | å‡€å¢è¡Œæ•° |
|------|---------|---------|---------|---------|
| `pallets/deceased/src/lib.rs` | åŠŸèƒ½ä¿®æ”¹ | +64 | -10 | +54 |
| `pallets/deceased/README.md` | æ–‡æ¡£æ›´æ–° | +30 | -2 | +28 |
| **æ€»è®¡** | | **+94** | **-12** | **+82** |

---

## âœ… éªŒè¯ç»“æœ

### ç¼–è¯‘æµ‹è¯•

```bash
cargo build --release -p pallet-deceased
```

**ç»“æœ**ï¼šâœ… ç¼–è¯‘æˆåŠŸï¼Œæ— è­¦å‘Š

```
   Compiling pallet-deceased v0.1.0 (/home/xiaodong/æ–‡æ¡£/stardust/pallets/deceased)
    Finished `release` profile [optimized] target(s) in 3.35s
```

### åŠŸèƒ½æµ‹è¯•åœºæ™¯

#### åœºæ™¯1ï¼šowner é€€å‡ºäº²å‹å›¢

```typescript
// å‰æï¼šowner å·²åŠ å…¥äº²å‹å›¢å¹¶è¢«è®¾ä¸º Admin
await api.tx.deceased.leaveGroup(deceasedId)
  .signAndSend(ownerAccount);
```

**é¢„æœŸç»“æœ**ï¼šâœ… æˆåŠŸé€€å‡º

**éªŒè¯**ï¼š
- `FriendsOf.contains(deceasedId, owner)` â†’ `false`
- `is_admin(deceasedId, owner)` â†’ `true`ï¼ˆä¾ç„¶æ˜¯ Adminï¼Œå› ä¸ºæ˜¯ ownerï¼‰
- owner ä¾ç„¶å¯ä»¥è°ƒç”¨æ‰€æœ‰ Admin æ¥å£

---

#### åœºæ™¯2ï¼šAdmin ç§»é™¤ owner

```typescript
// å‰æï¼šæœ‰å…¶ä»– Adminï¼ˆé ownerï¼‰
await api.tx.deceased.kickFriend(deceasedId, ownerAccount)
  .signAndSend(adminAccount);
```

**é¢„æœŸç»“æœ**ï¼šâœ… æˆåŠŸç§»é™¤

**éªŒè¯**ï¼š
- `FriendsOf.contains(deceasedId, owner)` â†’ `false`
- `is_admin(deceasedId, owner)` â†’ `true`ï¼ˆä¾ç„¶æ˜¯ Adminï¼Œå› ä¸ºæ˜¯ ownerï¼‰
- owner ä¾ç„¶å¯ä»¥è°ƒç”¨æ‰€æœ‰ Admin æ¥å£

---

#### åœºæ™¯3ï¼šé owner çš„ Admin å°è¯•é€€å‡º

```typescript
// å‰æï¼šadminAccount æ˜¯ Adminï¼Œä½†ä¸æ˜¯ owner
await api.tx.deceased.leaveGroup(deceasedId)
  .signAndSend(adminAccount);
```

**é¢„æœŸç»“æœ**ï¼šâŒ å¤±è´¥ï¼Œè¿”å› `NotAuthorized` é”™è¯¯

**åŸå› **ï¼šé owner çš„ Admin ä¸å…è®¸ç›´æ¥é€€å‡ºï¼Œéœ€è¦å…ˆé™çº§

---

#### åœºæ™¯4ï¼šAdmin å°è¯•ç§»é™¤é owner çš„ Admin

```typescript
// å‰æï¼štarget æ˜¯ Adminï¼Œä½†ä¸æ˜¯ owner
await api.tx.deceased.kickFriend(deceasedId, targetAdmin)
  .signAndSend(adminAccount);
```

**é¢„æœŸç»“æœ**ï¼šâŒ å¤±è´¥ï¼Œè¿”å› `NotAuthorized` é”™è¯¯

**åŸå› **ï¼šç¦æ­¢ç§»é™¤é owner çš„ Adminï¼Œé¿å…ç®¡ç†å‘˜æƒé™äº‰å¤º

---

## ğŸ¯ ä¿®å¤æ•ˆæœ

### è§£å†³çš„é—®é¢˜

1. âœ… **owner å¯ä»¥è‡ªç”±è¿›å‡ºäº²å‹å›¢**
   - é€šè¿‡ `leave_friend_group` ä¸»åŠ¨é€€å‡º
   - è¢«å…¶ä»– Admin é€šè¿‡ `kick_friend` ç§»é™¤
   - é€€å‡ºåä¾ç„¶ä¿ç•™ç®¡ç†æƒé™

2. âœ… **é€»è¾‘ä¸€è‡´æ€§**
   - owner çš„ç®¡ç†æƒé™æ¥è‡ª `DeceasedOf.owner`
   - äº²å‹å›¢æ˜¯å¯é€‰çš„ç¤¾äº¤åŠŸèƒ½
   - owner åŠ å…¥/é€€å‡ºä¸å½±å“ç®¡ç†æƒé™

3. âœ… **çµæ´»æ€§æå‡**
   - owner å¯ä»¥æ ¹æ®éœ€æ±‚è‡ªç”±é€‰æ‹©æ˜¯å¦å‚ä¸äº²å‹å›¢ç¤¾äº¤
   - ä¸ä¼šè¢«"é”å®š"åœ¨äº²å‹å›¢ä¸­

### ä¿ç•™çš„ä¿æŠ¤æœºåˆ¶

1. âœ… **é owner çš„ Admin ä¿æŠ¤**
   - ä¾ç„¶ä¸èƒ½éšæ„é€€å‡ºæˆ–è¢«ç§»é™¤
   - é¿å…äº²å‹å›¢å¤±å»ç®¡ç†å‘˜

2. âœ… **ç®¡ç†å‘˜æƒé™äº‰å¤ºé˜²æŠ¤**
   - Admin ä¹‹é—´ä¸èƒ½äº’ç›¸ç§»é™¤
   - owner çš„æœ€é«˜æƒé™ä¸å—å½±å“

---

## ğŸ“ å‰ç«¯é›†æˆå»ºè®®

### 1. UI æç¤ºä¼˜åŒ–

åœ¨äº²å‹å›¢ç®¡ç†é¡µé¢ï¼Œä¸º owner æ·»åŠ ç‰¹æ®Šæç¤ºï¼š

```typescript
{isOwner && (
  <Alert
    type="info"
    message="ç‰¹æ®Šæƒé™"
    description="ä½œä¸ºåˆ›å»ºè€…ï¼Œæ‚¨å¯ä»¥è‡ªç”±é€€å‡ºäº²å‹å›¢ï¼Œé€€å‡ºåä¾ç„¶ä¿ç•™ç®¡ç†æƒé™ã€‚"
  />
)}
```

### 2. é€€å‡ºç¡®è®¤å¯¹è¯æ¡†

```typescript
const handleLeave = () => {
  if (isOwner) {
    Modal.confirm({
      title: 'ç¡®è®¤é€€å‡ºäº²å‹å›¢ï¼Ÿ',
      content: 'æ‚¨æ˜¯åˆ›å»ºè€…ï¼Œé€€å‡ºåä¾ç„¶ä¿ç•™ç®¡ç†æƒé™ï¼Œå¯ä»¥éšæ—¶é‡æ–°åŠ å…¥ã€‚',
      okText: 'ç¡®è®¤é€€å‡º',
      cancelText: 'å–æ¶ˆ',
      onOk: async () => {
        await api.tx.deceased.leaveGroup(deceasedId).signAndSend(account);
      }
    });
  } else if (isAdmin) {
    Modal.error({
      title: 'æ— æ³•ç›´æ¥é€€å‡º',
      content: 'æ‚¨æ˜¯ç®¡ç†å‘˜ï¼Œéœ€è¦å…ˆé™çº§ä¸ºæ™®é€šæˆå‘˜ï¼Œæˆ–è¯·å…¶ä»–ç®¡ç†å‘˜ç§»é™¤æ‚¨ã€‚'
    });
  } else {
    // æ™®é€šæˆå‘˜ç›´æ¥é€€å‡º
    await api.tx.deceased.leaveGroup(deceasedId).signAndSend(account);
  }
};
```

### 3. ç§»é™¤ç¡®è®¤å¯¹è¯æ¡†

```typescript
const handleKick = (targetAccount: string) => {
  const isTargetOwner = targetAccount === ownerAccount;
  
  Modal.confirm({
    title: isTargetOwner ? 'ç¡®è®¤ç§»é™¤åˆ›å»ºè€…ï¼Ÿ' : 'ç¡®è®¤ç§»é™¤æˆå‘˜ï¼Ÿ',
    content: isTargetOwner 
      ? 'åˆ›å»ºè€…è¢«ç§»é™¤åä¾ç„¶ä¿ç•™ç®¡ç†æƒé™ï¼Œå¯ä»¥éšæ—¶é‡æ–°åŠ å…¥ã€‚' 
      : 'ç§»é™¤åè¯¥æˆå‘˜å°†æ— æ³•è®¿é—®äº²å‹å›¢ã€‚',
    okText: 'ç¡®è®¤ç§»é™¤',
    cancelText: 'å–æ¶ˆ',
    onOk: async () => {
      await api.tx.deceased.kickFriend(deceasedId, targetAccount).signAndSend(account);
    }
  });
};
```

---

## ğŸ” å›ç­”ç”¨æˆ·çš„ç–‘é—®

### Q: owner é€€å‡ºåï¼Œadmin ç”±è°æ¥æ‹…å½“ï¼Ÿ

**A: owner é€€å‡ºäº²å‹å›¢åï¼Œä¾ç„¶æ˜¯ Admin**

#### æƒé™æ¥æºåˆ†æ

1. **`is_admin` å‡½æ•°é€»è¾‘**ï¼š
   ```rust
   pub fn is_admin(deceased_id: T::DeceasedId, who: &T::AccountId) -> bool {
       let deceased = match DeceasedOf::<T>::get(deceased_id) {
           Some(d) => d,
           None => return false,
       };
       
       // âœ… owner å§‹ç»ˆæ˜¯ Adminï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§åˆ¤å®šï¼‰
       if deceased.owner == *who {
           return true;
       }
       
       // âœ… æˆ–è€…åœ¨ FriendsOf ä¸­æœ‰ Admin è§’è‰²
       if let Some(rec) = FriendsOf::<T>::get(deceased_id, who) {
           matches!(rec.role, FriendRole::Admin)
       } else {
           false
       }
   }
   ```

2. **æƒé™åˆ¤å®šæµç¨‹**ï¼š
   - **ç¬¬ä¸€æ­¥**ï¼šæ£€æŸ¥æ˜¯å¦ä¸º `DeceasedOf.owner` â†’ âœ… å¦‚æœæ˜¯ï¼Œç›´æ¥è¿”å› `true`
   - **ç¬¬äºŒæ­¥**ï¼šæ£€æŸ¥ `FriendsOf` ä¸­çš„è§’è‰² â†’ âœ… å¦‚æœæ˜¯ `Admin` è§’è‰²ï¼Œè¿”å› `true`

3. **owner é€€å‡ºåçš„æƒé™**ï¼š
   - `DeceasedOf.owner` å­—æ®µ **ä¸å˜**
   - `FriendsOf` ä¸­ **æ²¡æœ‰** owner çš„è®°å½•
   - `is_admin(owner)` â†’ âœ… ä¾ç„¶è¿”å› `true`ï¼ˆå› ä¸ºç¬¬ä¸€æ­¥æ£€æŸ¥é€šè¿‡ï¼‰

#### æƒé™ä¿ç•™è¯æ˜

| çŠ¶æ€ | `DeceasedOf.owner` | `FriendsOf` | `is_admin()` | å¯ç”¨æ¥å£ |
|-----|-------------------|-------------|-------------|---------|
| **åŠ å…¥äº²å‹å›¢å‰** | âœ… owner | âŒ æ— è®°å½• | âœ… true | æ‰€æœ‰ Admin æ¥å£ |
| **åŠ å…¥äº²å‹å›¢å** | âœ… owner | âœ… Admin | âœ… true | æ‰€æœ‰ Admin æ¥å£ |
| **é€€å‡ºäº²å‹å›¢å** | âœ… owner | âŒ æ— è®°å½• | âœ… true | æ‰€æœ‰ Admin æ¥å£ |

#### è®¾è®¡ç†å¿µ

- **åŒé‡æƒé™æ¥æº**ï¼š
  - `DeceasedOf.owner` â†’ **æ ¸å¿ƒç®¡ç†æƒé™**ï¼ˆä¸å¯å˜ï¼Œé™¤é `transfer_deceased`ï¼‰
  - `FriendsOf.Admin` â†’ **åä½œç®¡ç†æƒé™**ï¼ˆå¯å˜ï¼Œå¯æˆäºˆå…¶ä»–äººï¼‰

- **owner çš„è¶…ç„¶åœ°ä½**ï¼š
  - owner çš„ç®¡ç†æƒé™**ä¸ä¾èµ–**äºäº²å‹å›¢
  - å³ä½¿ä¸åœ¨äº²å‹å›¢ä¸­ï¼Œä¾ç„¶æ˜¯æœ€é«˜ç®¡ç†å‘˜
  - å¯ä»¥éšæ—¶é‡æ–°åŠ å…¥äº²å‹å›¢

#### æ˜¯å¦éœ€è¦æŒ‡å®šæ–°çš„ adminï¼Ÿ

**ç­”ï¼šâŒ ä¸éœ€è¦**

1. **owner ä¾ç„¶æ˜¯ Admin**
   - `is_admin(owner)` â†’ `true`
   - æ‰€æœ‰ Admin æ¥å£ä¾ç„¶å¯ç”¨

2. **å…¶ä»– Admin ä¸å—å½±å“**
   - å¦‚æœæœ‰å…¶ä»–äººè¢«èµ‹äºˆ `FriendsOf.Admin` è§’è‰²ï¼Œä»–ä»¬ä¾ç„¶æ˜¯ Admin
   - owner é€€å‡ºä¸å½±å“ä»–ä»¬çš„æƒé™

3. **æœ€åæƒ…å†µ**ï¼š
   - å¦‚æœäº²å‹å›¢ä¸­åªæœ‰ owner ä¸€ä¸ª Adminï¼Œowner é€€å‡ºåï¼š
     - owner ä¾ç„¶å¯ä»¥è°ƒç”¨æ‰€æœ‰ Admin æ¥å£ï¼ˆå› ä¸º `DeceasedOf.owner` ä¸å˜ï¼‰
     - åªæ˜¯ owner ä¸åœ¨ `FriendsOf` åˆ—è¡¨ä¸­ï¼ˆä¸å‚ä¸ç¤¾äº¤ï¼‰

---

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒæˆæœ

1. âœ… **ä¿®å¤äº† owner æ— æ³•é€€å‡ºäº²å‹å›¢çš„é€»è¾‘å†²çª**
2. âœ… **ä¿æŒäº†æƒé™æ¨¡å‹çš„ä¸€è‡´æ€§**
3. âœ… **æå‡äº†äº²å‹å›¢åŠŸèƒ½çš„çµæ´»æ€§**
4. âœ… **ä¿ç•™äº†å¿…è¦çš„å®‰å…¨ä¿æŠ¤æœºåˆ¶**

### è®¾è®¡äº®ç‚¹

- **èŒè´£åˆ†ç¦»**ï¼šç®¡ç†æƒé™ï¼ˆ`DeceasedOf.owner`ï¼‰ä¸ç¤¾äº¤å…³ç³»ï¼ˆ`FriendsOf`ï¼‰åˆ†ç¦»
- **çµæ´»å¯é€‰**ï¼šowner å¯ä»¥è‡ªç”±é€‰æ‹©æ˜¯å¦å‚ä¸äº²å‹å›¢ç¤¾äº¤
- **æƒé™ä¿éšœ**ï¼šowner çš„ç®¡ç†æƒé™å§‹ç»ˆä¿ç•™ï¼Œä¸ä¼šå› é€€å‡ºè€Œä¸¢å¤±

### ç”¨æˆ·ä½“éªŒæå‡

- owner ä¸å†è¢«"é”å®š"åœ¨äº²å‹å›¢ä¸­
- å¯ä»¥æ ¹æ®éœ€æ±‚è‡ªç”±è¿›å‡ºäº²å‹å›¢
- ç¬¦åˆç›´è§‰çš„äº¤äº’é€»è¾‘

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [Deceased Pallet README](../../pallets/deceased/README.md)
- [Deceased-Pallet-P2é—®é¢˜è¯¦ç»†åˆ†æ-äº²å‹å›¢owneræ— æ³•é€€å‡º](./Deceased-Pallet-P2é—®é¢˜è¯¦ç»†åˆ†æ-äº²å‹å›¢owneræ— æ³•é€€å‡º.md)

---

**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2025-10-23  
**ä¿®å¤æ–¹æ¡ˆ**ï¼šæ–¹æ¡ˆA - å…è®¸ owner é€€å‡ºäº²å‹å›¢  
**éªŒè¯çŠ¶æ€**ï¼šâœ… ç¼–è¯‘é€šè¿‡ + é€»è¾‘éªŒè¯é€šè¿‡

