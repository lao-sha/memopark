# pallet-arbitration ä¸ pallet-evidence å…³ç³»åˆ†æ

## ğŸ“‹ æ¦‚è¿°

`pallet-arbitration` å’Œ `pallet-evidence` æ˜¯ä¸¤ä¸ª**ä½è€¦åˆã€èŒè´£åˆ†ç¦»**çš„ palletï¼Œé€šè¿‡"å¼•ç”¨ ID"çš„æ–¹å¼åä½œï¼Œå®ç°äº†**è¯æ®å­˜å‚¨ä¸ä»²è£ä¸šåŠ¡çš„è§£è€¦**ã€‚

## ğŸ¯ è®¾è®¡ç†å¿µ

### 1. èŒè´£åˆ†ç¦»åŸåˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   pallet-evidence                       â”‚
â”‚  èŒè´£ï¼šé€šç”¨è¯æ®å­˜å‚¨ä¸ç®¡ç†ï¼ˆè·¨åŸŸå¤ç”¨ï¼‰                    â”‚
â”‚  â”œâ”€â”€ å­˜å‚¨è¯æ®æœ¬ä½“ï¼ˆCIDã€æ‰¿è¯ºå“ˆå¸Œã€å¤‡æ³¨ï¼‰                 â”‚
â”‚  â”œâ”€â”€ ç®¡ç†è¯æ®æƒé™ï¼ˆå‘½åç©ºé—´æˆæƒï¼‰                        â”‚
â”‚  â”œâ”€â”€ é…é¢ä¸é™é¢‘æ§åˆ¶                                      â”‚
â”‚  â””â”€â”€ å…¨å±€å»é‡ï¼ˆå¯é€‰ï¼‰                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–²
                            â”‚ å¼•ç”¨å…³ç³»ï¼ˆå­˜å‚¨ evidence_idï¼‰
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  pallet-arbitration                     â”‚
â”‚  èŒè´£ï¼šä»²è£æµç¨‹ç®¡ç†ï¼ˆäº‰è®®ç™»è®°ã€è£å†³æ‰§è¡Œï¼‰                â”‚
â”‚  â”œâ”€â”€ ç™»è®°äº‰è®®çŠ¶æ€                                        â”‚
â”‚  â”œâ”€â”€ å¼•ç”¨è¯æ®IDï¼ˆä¸å­˜å‚¨è¯æ®æœ¬ä½“ï¼‰                        â”‚
â”‚  â”œâ”€â”€ æ‰§è¡Œè£å†³å†³ç­–ï¼ˆé€šè¿‡Routerè·¯ç”±åˆ°ä¸šåŠ¡palletï¼‰         â”‚
â”‚  â””â”€â”€ è§¦å‘èµ„é‡‘æµå˜æ›´ï¼ˆé€šè¿‡Escrowæ‰˜ç®¡ï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ ¸å¿ƒè®¾è®¡æ¨¡å¼

**æ¨¡å¼åç§°**ï¼š**å¼•ç”¨åˆ†ç¦»æ¨¡å¼**ï¼ˆReference Separation Patternï¼‰

- **pallet-evidence**ï¼šé€šç”¨è¯æ®åº“ï¼Œè´Ÿè´£å­˜å‚¨å’Œç®¡ç†
- **pallet-arbitration**ï¼šä¸šåŠ¡åè°ƒå™¨ï¼Œä»…ä¿å­˜è¯æ®å¼•ç”¨
- **è§£è€¦ä¼˜åŠ¿**ï¼š
  - è¯æ®å¯è·¨åŸŸå¤ç”¨ï¼ˆåŒä¸€è¯æ®å¯è¢«å¤šä¸ªä»²è£æ¡ˆä»¶å¼•ç”¨ï¼‰
  - è¯æ®å­˜å‚¨ç‹¬ç«‹äºä¸šåŠ¡é€»è¾‘
  - ä¾¿äºæ‰©å±•åˆ°å…¶ä»–éœ€è¦è¯æ®çš„åœºæ™¯ï¼ˆä¸ä»…é™äºä»²è£ï¼‰

## ğŸ“Š ä¸¤è€…ä¹‹é—´çš„å…³ç³»

### 1. ä¾èµ–å…³ç³»

#### Cargo ä¾èµ–åˆ†æ
```toml
# pallets/arbitration/Cargo.toml
[dependencies]
# âŒ æ— ç›´æ¥ä¾èµ– pallet-evidence
pallet-escrow = { path = "../escrow", default-features = false }
```

**ç»“è®º**ï¼š
- âœ… **é›¶ä¾èµ–**ï¼š`pallet-arbitration` åœ¨ä»£ç å±‚é¢**å®Œå…¨ä¸ä¾èµ–** `pallet-evidence`
- âœ… **æ¾è€¦åˆ**ï¼šä»…é€šè¿‡ `u64` ç±»å‹çš„ `evidence_id` è¿›è¡Œå¼•ç”¨
- âœ… **å¯ç‹¬ç«‹éƒ¨ç½²**ï¼šä¸¤ä¸ª pallet å¯ä»¥ç‹¬ç«‹ç¼–è¯‘å’Œæµ‹è¯•

### 2. æ•°æ®å…³ç³»

#### å­˜å‚¨ç»“æ„å¯¹æ¯”

**pallet-arbitration å­˜å‚¨**ï¼š
```rust
/// äº‰è®®ç™»è®°ï¼š(domain, object_id) => ()
pub type Disputed<T: Config> = StorageDoubleMap<
    _, Blake2_128Concat, [u8; 8],  // domainï¼ˆåŸŸï¼‰
    Blake2_128Concat, u64,          // object_idï¼ˆè®¢å•IDç­‰ï¼‰
    (),                             // æ ‡è®°å­˜åœ¨
    OptionQuery
>;

/// è¯æ®å¼•ç”¨åˆ—è¡¨ï¼š(domain, object_id) => [evidence_id, ...]
pub type EvidenceIds<T: Config> = StorageDoubleMap<
    _, Blake2_128Concat, [u8; 8],  // domain
    Blake2_128Concat, u64,          // object_id
    BoundedVec<u64, T::MaxEvidence>, // è¯æ®IDåˆ—è¡¨
    ValueQuery
>;
```

**pallet-evidence å­˜å‚¨**ï¼š
```rust
/// è¯æ®æœ¬ä½“ï¼ˆV1ï¼šæ˜æ–‡CIDæ¨¡å¼ï¼‰
pub struct Evidence<AccountId, MaxCidLen, MaxImg, MaxVid, MaxDoc, MaxMemoLen> {
    pub id: u64,                    // è¯æ®IDï¼ˆå…¨å±€å”¯ä¸€ï¼‰
    pub domain: u8,                 // åŸŸæ ‡è¯†
    pub target_id: u64,             // ç›®æ ‡å¯¹è±¡ID
    pub owner: AccountId,           // æäº¤è€…
    pub imgs: BoundedVec<...>,      // å›¾ç‰‡CIDåˆ—è¡¨
    pub vids: BoundedVec<...>,      // è§†é¢‘CIDåˆ—è¡¨
    pub docs: BoundedVec<...>,      // æ–‡æ¡£CIDåˆ—è¡¨
    pub memo: Option<...>,          // å¤‡æ³¨
    pub commit: Option<H256>,       // V2ï¼šæ‰¿è¯ºå“ˆå¸Œ
    pub ns: Option<[u8; 8]>,        // V2ï¼šå‘½åç©ºé—´
}
```

#### å¼•ç”¨å…³ç³»ç¤ºæ„å›¾

```
pallet-arbitration               pallet-evidence
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Disputed         â”‚            â”‚ Evidence (id=1001)      â”‚
â”‚ â”œâ”€ domain: "otc" â”‚            â”‚ â”œâ”€ id: 1001             â”‚
â”‚ â”œâ”€ id: 12345     â”‚            â”‚ â”œâ”€ imgs: [cid1, cid2]   â”‚
â”‚ â””â”€ status: ()    â”‚            â”‚ â”œâ”€ vids: [cid3]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚ â””â”€ memo: "description"  â”‚
â”‚ EvidenceIds      â”‚  å¼•ç”¨ID     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”œâ”€ domain: "otc" â”‚â”€ â”€ â”€ â”€ â”€>â”‚ Evidence (id=1002)      â”‚
â”‚ â”œâ”€ id: 12345     â”‚   1001    â”‚ â”œâ”€ id: 1002             â”‚
â”‚ â””â”€ ids: [1001,   â”‚   1002    â”‚ â”œâ”€ imgs: [cid4]         â”‚
â”‚         1002]    â”‚â”€ â”€ â”€ â”€ â”€>â”‚ â””â”€ docs: [cid5]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æ¥å£åä½œæµç¨‹

#### æ ‡å‡†ä»²è£æµç¨‹ï¼ˆå¸¦è¯æ®ï¼‰

```typescript
// ============ æ­¥éª¤ 1: æäº¤è¯æ®åˆ° pallet-evidence ============
// æ–¹å¼ Aï¼šV1 æ˜æ–‡ CID æ¨¡å¼
const evidenceTx1 = api.tx.evidence.commit(
    domain,          // u8: åŸŸæ ‡è¯†
    orderId,         // u64: è®¢å•ID
    ['QmHash1'],     // imgs: å›¾ç‰‡CIDåˆ—è¡¨
    ['QmHash2'],     // vids: è§†é¢‘CIDåˆ—è¡¨
    [],              // docs: æ–‡æ¡£CIDåˆ—è¡¨
    'My evidence'    // memo: è¯´æ˜
);

// æ–¹å¼ Bï¼šV2 æ‰¿è¯ºå“ˆå¸Œæ¨¡å¼ï¼ˆæ¨èï¼Œéšç§ä¿æŠ¤ï¼‰
const commitment = sha256(ns + subject_id + encrypted_cid + salt + version);
const evidenceTx2 = api.tx.evidence.commitHash(
    'arb_evid',      // ns: å‘½åç©ºé—´ [u8;8]
    orderId,         // subject_id: u64
    commitment,      // commit: H256
    'Encrypted'      // memo: è¯´æ˜
);

await evidenceTx1.signAndSend(buyer);
// å‡è®¾è¿”å›çš„ evidence_id = 1001

// ============ æ­¥éª¤ 2: å‘èµ·ä»²è£å¹¶å¼•ç”¨è¯æ® ============
const disputeTx = api.tx.arbitration.disputeWithEvidenceId(
    domain,          // [u8;8]: 'otc_ord_'
    orderId,         // u64
    1001             // evidence_id: å¼•ç”¨ pallet-evidence ä¸­çš„è¯æ®
);

await disputeTx.signAndSend(buyer);

// ============ æ­¥éª¤ 3: è¡¥å……è¯æ®ï¼ˆå¯é€‰ï¼‰============
// æäº¤æ›´å¤šè¯æ®åˆ° pallet-evidence
const evidenceTx3 = api.tx.evidence.commit(...);
await evidenceTx3.signAndSend(seller);
// å‡è®¾è¿”å› evidence_id = 1002

// è¿½åŠ è¯æ®å¼•ç”¨åˆ°ä»²è£æ¡ˆä»¶
const appendTx = api.tx.arbitration.appendEvidenceId(
    domain,
    orderId,
    1002             // æ–°çš„ evidence_id
);
await appendTx.signAndSend(seller);

// ============ æ­¥éª¤ 4: æ²»ç†æ‰§è¡Œè£å†³ ============
const arbitrateTx = api.tx.sudo.sudo(
    api.tx.arbitration.arbitrate(
        domain,
        orderId,
        1,           // decision_code: 1=Refund
        null
    )
);
await arbitrateTx.signAndSend(councilMember);
```

#### æ—§æ–¹å¼ï¼ˆV1ï¼šä¸æ¨èï¼‰

```typescript
// ç›´æ¥åœ¨ dispute è°ƒç”¨ä¸­ä¼ é€’ CIDï¼ˆå·²åºŸå¼ƒï¼Œä¸æ¨èï¼‰
const disputeTx = api.tx.arbitration.dispute(
    domain,
    orderId,
    [cid1, cid2]     // ç›´æ¥ä¼ é€’ CIDï¼ˆä»…åœ¨ä»²è£ä¾§å­˜å‚¨ï¼Œæ— å¤ç”¨æ€§ï¼‰
);
```

**é—®é¢˜**ï¼š
- âŒ è¯æ®ä»…å­˜å‚¨åœ¨ä»²è£ä¾§ï¼Œæ— æ³•è·¨åŸŸå¤ç”¨
- âŒ æ²¡æœ‰æƒé™æ§åˆ¶å’Œé…é¢ç®¡ç†
- âŒ ç¼ºä¹è¯æ®çš„ç»Ÿä¸€ç®¡ç†æ¥å£

## ğŸ”„ æ¶æ„æ¼”è¿›

### V1 æ¶æ„ï¼ˆæ—§ç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    pallet-arbitration             â”‚
â”‚  â”œâ”€ dispute(domain, id, [cid])    â”‚
â”‚  â”‚   â””â”€ ç›´æ¥å­˜å‚¨ CIDï¼ˆè€¦åˆï¼‰       â”‚
â”‚  â””â”€ arbitrate(...)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜**ï¼š
- è¯æ®ç®¡ç†èŒè´£æ··å…¥ä»²è£é€»è¾‘
- æ— æ³•è·¨åŸŸå¤ç”¨è¯æ®
- ç¼ºä¹ç»Ÿä¸€çš„è¯æ®ç®¡ç†

### V2 æ¶æ„ï¼ˆå½“å‰ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              pallet-evidence                        â”‚
â”‚  é€šç”¨è¯æ®å­˜å‚¨å±‚ï¼ˆè·¨åŸŸå¤ç”¨ï¼‰                          â”‚
â”‚  â”œâ”€ commit(domain, target, imgs, vids, docs)        â”‚
â”‚  â”œâ”€ commit_hash(ns, subject_id, commit)            â”‚
â”‚  â”œâ”€ æƒé™æ§åˆ¶ï¼ˆAuthorizerï¼‰                          â”‚
â”‚  â”œâ”€ é…é¢ç®¡ç†ï¼ˆMaxPerSubjectï¼‰                       â”‚
â”‚  â””â”€ é™é¢‘æ§åˆ¶ï¼ˆWindowBlocksï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ è¿”å› evidence_id
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           pallet-arbitration                        â”‚
â”‚  ä»²è£æµç¨‹åè°ƒå±‚ï¼ˆä»…å¼•ç”¨ï¼‰                            â”‚
â”‚  â”œâ”€ dispute_with_evidence_id(domain, id, evi_id)   â”‚
â”‚  â”œâ”€ append_evidence_id(domain, id, evi_id)         â”‚
â”‚  â”œâ”€ arbitrate(domain, id, decision)                â”‚
â”‚  â””â”€ Router â†’ ä¸šåŠ¡ palletï¼ˆèµ„é‡‘æµï¼‰                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š
- âœ… èŒè´£æ¸…æ™°ï¼šè¯æ®å­˜å‚¨ä¸ä»²è£æµç¨‹åˆ†ç¦»
- âœ… å¯å¤ç”¨æ€§ï¼šåŒä¸€è¯æ®å¯è¢«å¤šä¸ªæ¡ˆä»¶å¼•ç”¨
- âœ… æ‰©å±•æ€§ï¼šè¯æ®ç³»ç»Ÿå¯ç”¨äºå…¶ä»–åœºæ™¯ï¼ˆä¸ä»…é™äºä»²è£ï¼‰
- âœ… å®‰å…¨æ€§ï¼šæ”¯æŒéšç§ä¿æŠ¤ï¼ˆV2 æ‰¿è¯ºå“ˆå¸Œæ¨¡å¼ï¼‰

## ğŸ“ å…³é”®æ¥å£å¯¹æ¯”

| åŠŸèƒ½ | pallet-arbitration | pallet-evidence |
|------|-------------------|-----------------|
| **æ ¸å¿ƒèŒè´£** | äº‰è®®ç™»è®°ã€è£å†³æ‰§è¡Œ | è¯æ®å­˜å‚¨ä¸ç®¡ç† |
| **å­˜å‚¨å†…å®¹** | äº‰è®®çŠ¶æ€ã€è¯æ®IDå¼•ç”¨ | è¯æ®æœ¬ä½“ï¼ˆCID/æ‰¿è¯ºå“ˆå¸Œï¼‰ |
| **æƒé™æ§åˆ¶** | DecisionOriginï¼ˆæ²»ç†ï¼‰ | Authorizerï¼ˆå‘½åç©ºé—´æˆæƒï¼‰ |
| **é…é¢ç®¡ç†** | âŒ æ—  | âœ… MaxPerSubject + é™é¢‘ |
| **å»é‡æœºåˆ¶** | âŒ æ—  | âœ… V2 CommitIndex å…¨å±€å»é‡ |
| **è·¨åŸŸå¤ç”¨** | âŒ ä»…é™æœ¬åŸŸ | âœ… æ”¯æŒè·¨åŸŸ |
| **éšç§ä¿æŠ¤** | âŒ æ—  | âœ… V2 æ‰¿è¯ºå“ˆå¸Œæ¨¡å¼ |

## ğŸ” å®‰å…¨ä¸æƒé™è®¾è®¡

### pallet-arbitration æƒé™

```rust
/// ä»²è£è£å†³éœ€è¦æ²»ç†èµ·æº
type DecisionOrigin: EnsureOrigin<Self::RuntimeOrigin>;

// Runtime é…ç½®ï¼ˆç¤ºä¾‹ï¼‰
impl pallet_arbitration::Config for Runtime {
    type DecisionOrigin = EitherOfDiverse<
        EnsureRoot<AccountId>,                              // Root æƒé™
        pallet_collective::EnsureProportionAtLeast<         // æˆ–å§”å‘˜ä¼š 2/3 å¤šæ•°
            AccountId, 
            pallet_collective::Instance1, 
            2, 3
        >
    >;
}
```

### pallet-evidence æƒé™

```rust
/// è¯æ®æäº¤éœ€è¦æˆæƒéªŒè¯
type Authorizer: EvidenceAuthorizer<Self::AccountId>;

pub trait EvidenceAuthorizer<AccountId> {
    /// æ£€æŸ¥è´¦æˆ·æ˜¯å¦æœ‰æƒåœ¨æŒ‡å®šå‘½åç©ºé—´æäº¤è¯æ®
    fn authorize(ns: [u8; 8], who: &AccountId) -> bool;
}

// ç¤ºä¾‹ï¼šä»…å…è®¸äº‰è®®åŒæ–¹æäº¤è¯æ®
impl EvidenceAuthorizer<AccountId> for Runtime {
    fn authorize(ns: [u8; 8], who: &AccountId) -> bool {
        if ns == b"arb_evid" {
            // æ£€æŸ¥ who æ˜¯å¦ä¸ºè®¢å•çš„ä¹°å®¶æˆ–å–å®¶
            OtcOrder::is_party_of_order(who)
        } else {
            true  // å…¶ä»–å‘½åç©ºé—´å¼€æ”¾
        }
    }
}
```

## ğŸ¨ è®¾è®¡ä¼˜åŠ¿æ€»ç»“

### 1. ä½è€¦åˆæ¶æ„
- **é›¶ä»£ç ä¾èµ–**ï¼šarbitration æ— éœ€å¯¼å…¥ evidence pallet
- **æ¥å£ç¨³å®š**ï¼šä»…é€šè¿‡ `u64` ID å¼•ç”¨ï¼Œæ¥å£å˜æ›´å½±å“å°
- **ç‹¬ç«‹æ¼”è¿›**ï¼šä¸¤ä¸ª pallet å¯ä»¥ç‹¬ç«‹å‡çº§

### 2. é«˜å†…èšè®¾è®¡
- **å•ä¸€èŒè´£**ï¼ševidence ä¸“æ³¨è¯æ®ç®¡ç†ï¼Œarbitration ä¸“æ³¨æµç¨‹åè°ƒ
- **åŠŸèƒ½å®Œæ•´**ï¼šå„è‡ªåŒ…å«å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘
- **æ˜“äºæµ‹è¯•**ï¼šå¯ä»¥åˆ†åˆ«è¿›è¡Œå•å…ƒæµ‹è¯•

### 3. å¯æ‰©å±•æ€§
- **è·¨åŸŸå¤ç”¨**ï¼šè¯æ®å¯ç”¨äºä»²è£ã€å®¡è®¡ã€åˆè§„ç­‰å¤šç§åœºæ™¯
- **å¤šç‰ˆæœ¬æ”¯æŒ**ï¼šV1ï¼ˆæ˜æ–‡ï¼‰+ V2ï¼ˆæ‰¿è¯ºå“ˆå¸Œï¼‰å¹¶å­˜
- **çµæ´»æˆæƒ**ï¼šé€šè¿‡ Authorizer trait é€‚é…ä¸åŒæƒé™ç­–ç•¥

### 4. éšç§ä¿æŠ¤
- **V2 æ‰¿è¯ºæ¨¡å¼**ï¼šé“¾ä¸Šä»…å­˜ `H256` æ‰¿è¯ºå“ˆå¸Œ
- **é“¾ä¸‹å­˜å‚¨**ï¼šæ•æ„Ÿå†…å®¹åŠ å¯†åå­˜å‚¨åœ¨ IPFS
- **æˆæƒè®¿é—®**ï¼šä»…æˆæƒæ–¹å¯è§£å¯†æŸ¥çœ‹è¯æ®å†…å®¹

## ğŸš€ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šOTC è®¢å•ä»²è£

```typescript
// 1. ä¹°å®¶æäº¤äº‰è®®è¯æ®ï¼ˆèŠå¤©è®°å½•æˆªå›¾ï¼‰
const evidenceId = await submitEvidence(
    'arb_evid',
    orderId,
    encryptedChatImages
);

// 2. å‘èµ·ä»²è£å¹¶å¼•ç”¨è¯æ®
await arbitration.disputeWithEvidenceId(
    'otc_ord_',
    orderId,
    evidenceId
);

// 3. å–å®¶è¡¥å……åé©³è¯æ®
const evidenceId2 = await submitEvidence(
    'arb_evid',
    orderId,
    encryptedTransferProof
);
await arbitration.appendEvidenceId(
    'otc_ord_',
    orderId,
    evidenceId2
);

// 4. å§”å‘˜ä¼šæŸ¥çœ‹æ‰€æœ‰è¯æ®åè£å†³
const evidenceIds = await api.query.arbitration.evidenceIds('otc_ord_', orderId);
// [1001, 1002]

// é€ä¸€è§£å¯†æŸ¥çœ‹ï¼ˆé“¾ä¸‹ï¼‰
for (const id of evidenceIds) {
    const evidence = await api.query.evidence.evidences(id);
    // è§£å¯†å¹¶å®¡æŸ¥
}

// æ‰§è¡Œè£å†³
await api.tx.sudo.sudo(
    api.tx.arbitration.arbitrate('otc_ord_', orderId, 1, null)
).signAndSend(council);
```

### åœºæ™¯ 2ï¼šåˆè§„å®¡è®¡ï¼ˆå¤ç”¨è¯æ®ï¼‰

```typescript
// åŒä¸€è¯æ®å¯è¢«å¤šä¸ªåœºæ™¯å¼•ç”¨
const evidenceId = 5678;  // å·²å­˜åœ¨çš„è¯æ®

// ç”¨äºä»²è£
await arbitration.appendEvidenceId('otc_ord_', orderId1, evidenceId);

// åŒæ—¶ç”¨äºåˆè§„å®¡è®¡ï¼ˆå‡è®¾æœ‰ pallet-complianceï¼‰
await compliance.submitAuditEvidence(merchantId, evidenceId);

// åŒæ—¶ç”¨äºé£æ§æ£€æŸ¥ï¼ˆå‡è®¾æœ‰ pallet-riskï¼‰
await risk.attachEvidence(accountId, evidenceId);
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **ä»²è£ç³»ç»Ÿè¯¦ç»†æ–‡æ¡£**ï¼š`pallets/arbitration/README.md`
- **è¯æ®ç³»ç»Ÿè¯¦ç»†æ–‡æ¡£**ï¼š`pallets/evidence/README.md`
- **æ¥å£æ–‡æ¡£**ï¼š`palletsæ¥å£æ–‡æ¡£.md`
- **OTC è®¢å•é›†æˆ**ï¼š`pallets/otc-order/README.md`

## ğŸ” æ€»ç»“

| ç»´åº¦ | è¯„ä»· | è¯´æ˜ |
|------|------|------|
| **æ¶æ„è®¾è®¡** | â­â­â­â­â­ | èŒè´£åˆ†ç¦»ã€ä½è€¦åˆã€é«˜å†…èš |
| **ä»£ç å¤ç”¨** | â­â­â­â­â­ | è¯æ®è·¨åŸŸå¤ç”¨ï¼Œé¿å…é‡å¤å­˜å‚¨ |
| **å®‰å…¨æ€§** | â­â­â­â­â­ | å¤šå±‚æƒé™æ§åˆ¶ + éšç§ä¿æŠ¤ |
| **å¯ç»´æŠ¤æ€§** | â­â­â­â­â­ | ç‹¬ç«‹æ¼”è¿›ã€é›¶ä¾èµ– |
| **æ‰©å±•æ€§** | â­â­â­â­â­ | æ˜“äºæ‰©å±•åˆ°å…¶ä»–ä¸šåŠ¡åœºæ™¯ |

**æ ¸å¿ƒç»“è®º**ï¼š
`pallet-arbitration` å’Œ `pallet-evidence` æ˜¯**æ¾è€¦åˆã€å¼ºåä½œ**çš„å…¸èŒƒè®¾è®¡ï¼Œé€šè¿‡"å¼•ç”¨åˆ†ç¦»æ¨¡å¼"å®ç°äº†è¯æ®å­˜å‚¨ä¸ä»²è£ä¸šåŠ¡çš„å®Œç¾è§£è€¦ï¼Œæ—¢ä¿è¯äº†åŠŸèƒ½å®Œæ•´æ€§ï¼Œåˆå…·å¤‡æé«˜çš„å¯å¤ç”¨æ€§å’Œå¯æ‰©å±•æ€§ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025-10-24  
**ä½œè€…**: Claude (AI Assistant)

