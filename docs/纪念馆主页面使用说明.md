# 逝者纪念馆主页面使用说明

## 📋 概述

基于参考网页设计，实现了一个功能完善、体验优秀的逝者纪念馆主页面。

**创建日期**: 2025-11-02  
**版本**: 1.0.0  
**状态**: ✅ 开发完成

---

## 🎯 实现的功能

### 1. 核心模块

#### 1.1 头部横幅（HeaderBanner）
- ✅ 逝者头像和基本信息展示
- ✅ 个性化背景图片
- ✅ 快捷操作按钮（返回、分享、编辑、设置）
- ✅ 亲友团展示
- ✅ 毛玻璃效果和深金色装饰

**组件路径**: `src/features/memorial/components/HeaderBanner.tsx`

#### 1.2 导航标签页（NavigationTabs）
- ✅ 6个标签页：首页、生平、相册、留言、家谱、供品
- ✅ 移动端横向滚动
- ✅ 当前激活标签高亮
- ✅ 支持动态切换

**组件路径**: `src/features/memorial/components/NavigationTabs.tsx`

#### 1.3 统计卡片（StatisticsCards）
- ✅ 主要统计：访问量、祭拜数、留言数
- ✅ 祭品统计：鲜花、蜡烛、香数量
- ✅ 数字动画效果
- ✅ 响应式网格布局

**组件路径**: `src/features/memorial/components/StatisticsCards.tsx`

#### 1.4 祭拜动态流（OfferingsTimelineView）
- ✅ 时间线展示供奉记录
- ✅ 显示供奉人、金额、时间、媒体附件
- ✅ 支持查看图片预览
- ✅ 限制显示数量

**组件路径**: `src/features/memorial/components/OfferingsTimelineView.tsx`

#### 1.5 底部操作栏（MemorialActionsBar）
- ✅ 5个快捷操作：献花🌸、蜡烛🕯️、敬香🔥、祭品🍎、留言✍️
- ✅ 固定在底部
- ✅ 大按钮设计（移动端友好）
- ✅ 点击弹出供奉表单

**组件路径**: `src/features/memorial/components/MemorialActionsBar.tsx`

#### 1.6 标签页内容

**首页内容（HomeSection）**
- ✅ 生命历程卡片（出生/逝世日期、享年）
- ✅ 生平概要（3行摘要）
- ✅ 精选照片
- ✅ 最新留言预览
- ✅ 快速导航按钮

**组件路径**: `src/features/memorial/components/HomeSection.tsx`

**生平简介（BiographySection）**
- ✅ 完整生平简介展示
- ✅ 支持折叠展开
- ✅ 重要事件时间轴
- ✅ 精美卡片布局

**组件路径**: `src/features/memorial/components/BiographySection.tsx`

**相册墙（PhotoGallerySection）**
- ✅ 照片网格展示
- ✅ 支持图片预览
- ✅ 支持上传新照片（权限控制）
- ✅ 空状态引导

**组件路径**: `src/features/memorial/components/PhotoGallerySection.tsx`

**留言板（MessageBoardSection）**
- ✅ 留言列表展示
- ✅ 发布新留言表单
- ✅ 点赞功能
- ✅ 时间显示（相对时间）

**组件路径**: `src/features/memorial/components/MessageBoardSection.tsx`

### 2. 核心Hooks

#### useDeceasedInfo
获取逝者基本信息

```typescript
const { deceased, loading, error } = useDeceasedInfo(deceasedId)
```

#### useOfferingsData
获取供奉记录数据

```typescript
const { offerings, loading, error, refresh } = useOfferingsData(target, limit)
```

#### useMemorialStatistics
计算统计数据

```typescript
const statistics = useMemorialStatistics(deceasedId, offerings)
```

**Hooks路径**: `src/hooks/useMemorialHall.ts`

### 3. 供奉功能

#### 供奉表单Modal
- ✅ 动态标题（根据操作类型）
- ✅ 金额输入（DUST单位）
- ✅ 持续时长（蜡烛类型）
- ✅ 留言输入（可选）
- ✅ 链上交易提交
- ✅ 成功反馈

---

## 🚀 使用方法

### 1. 访问纪念馆

**URL格式**:
```
#/memorial/{deceasedId}
```

**示例**:
```
http://localhost:5173/#/memorial/1
http://localhost:5173/#/memorial/123
```

### 2. 页面操作

#### 2.1 查看纪念馆
1. 打开纪念馆URL
2. 查看头部横幅的逝者信息
3. 浏览统计数据
4. 查看祭拜动态

#### 2.2 切换标签页
1. 点击导航栏的标签
2. 内容区域自动切换
3. 支持横向滑动（移动端）

#### 2.3 献花/供奉
1. 点击底部操作栏按钮（献花/蜡烛/敬香/祭品）
2. 在弹出的表单中输入金额
3. （可选）输入留言
4. 点击"确认供奉"
5. 钱包签名确认
6. 等待交易完成

#### 2.4 发布留言
1. 切换到"留言"标签页
2. 在文本框输入留言内容（最多500字）
3. 点击"发布留言"
4. 留言显示在列表顶部

#### 2.5 查看照片
1. 切换到"相册"标签页
2. 点击照片查看大图
3. 支持左右滑动浏览
4. （所有者）点击"上传照片"添加新照片

#### 2.6 分享纪念馆
1. 点击头部的"分享"按钮
2. 使用系统分享功能（支持的浏览器）
3. 或自动复制链接到剪贴板

---

## 📁 文件结构

```
stardust-dapp/src/
├── features/memorial/
│   ├── MemorialHallDetailPage.tsx          # 主页面组件
│   └── components/
│       ├── index.ts                         # 组件导出索引
│       ├── HeaderBanner.tsx                 # 头部横幅
│       ├── NavigationTabs.tsx               # 导航标签页
│       ├── StatisticsCards.tsx              # 统计卡片
│       ├── OfferingsTimelineView.tsx        # 祭拜动态流
│       ├── MemorialActionsBar.tsx           # 底部操作栏
│       ├── HomeSection.tsx                  # 首页内容
│       ├── BiographySection.tsx             # 生平简介
│       ├── PhotoGallerySection.tsx          # 相册墙
│       └── MessageBoardSection.tsx          # 留言板
├── hooks/
│   └── useMemorialHall.ts                   # 纪念馆数据Hooks
└── routes.tsx                               # 路由配置（已更新）
```

---

## 🎨 设计规范

### 色彩方案

遵循项目主题色彩系统（`src/theme/colors.ts`）：

- **主色**: 深金色 `#B8860B` - 庄重、永恒
- **辅色**: 墨绿色 `#2F4F4F` - 生命、希望
- **背景**: 米白色 `#F5F5DC` - 温暖、怀念
- **强调**: 朱红色 `#DC143C` - 祭品、献花

### 布局尺寸

- **最大宽度**: 640px（移动端优先）
- **卡片圆角**: 12px
- **卡片间距**: 16px
- **按钮高度**: 44px / 50px
- **头像尺寸**: 140x180px（大）/ 48px（中）/ 32px（小）

### 动画效果

- **页面切换**: 淡入淡出（fade）
- **卡片加载**: 从下往上滑入（slideUp）
- **统计数字**: 计数动画（CountUp）
- **图片加载**: 骨架屏（Skeleton）

---

## 🔗 链端数据对接

### 数据来源

#### 1. 逝者信息
- **Pallet**: `pallet-deceased`
- **查询**: `deceasedOf(id)`
- **字段**: 
  - fullName（姓名）
  - birthDate / deathDate（生卒日期）
  - mainImageCid（主图CID）
  - bio（生平简介）
  - owner / creator（所有者/创建者）

#### 2. 供奉记录
- **Pallet**: `pallet-memorial`
- **查询**: `OfferingsByTarget(domain, id)`
- **字段**:
  - who（供奉人）
  - kindCode（供奉类型）
  - amount（金额）
  - duration（持续时长）
  - media（媒体附件）
  - time（时间区块号）

#### 3. 统计数据
- **计算方式**: 聚合供奉记录
- **统计项**:
  - totalOffers（总供奉次数）
  - totalAmount（累计金额）
  - flowerCount / candleCount / incenseCount（各类型数量）

### 链上操作

#### 供奉交易
```typescript
memorial.offer(
  origin,
  target,              // [domain, id]
  kindCode,            // 1=鲜花, 2=蜡烛, 3=香, 4=祭品
  amount,              // 金额（最小单位）
  media,               // 媒体CID列表
  duration             // 持续时长（周）
)
```

---

## 🔧 权限控制

### 访客权限
- ✅ 查看纪念馆内容
- ✅ 查看统计数据
- ✅ 查看供奉记录
- ✅ 查看照片和留言
- ❌ 无法供奉（需连接钱包）
- ❌ 无法发布留言（需连接钱包）

### 注册用户权限
- ✅ 访客所有权限
- ✅ 供奉（献花/蜡烛/敬香/祭品）
- ✅ 发布留言
- ✅ 点赞留言

### 所有者权限
- ✅ 注册用户所有权限
- ✅ 编辑逝者信息
- ✅ 上传照片
- ✅ 管理留言
- ✅ 设置纪念馆

### 创建者权限
- ✅ 所有者所有权限
- ✅ 删除纪念馆

---

## ⚡ 性能优化

### 已实现的优化

1. **懒加载**
   - 组件按需加载（React.lazy）
   - 图片懒加载（Image组件自带）

2. **缓存策略**
   - 逝者信息缓存（5分钟）
   - 供奉记录分页加载（限制50条）

3. **骨架屏**
   - 首屏加载显示Spin加载器
   - 图片加载显示占位符

4. **响应式设计**
   - 移动端优先（max-width: 640px）
   - 触摸优化（大按钮区域）

---

## 🧪 测试建议

### 功能测试

#### 1. 基础功能
- [ ] 访问纪念馆页面
- [ ] 头部横幅正确显示
- [ ] 统计数据正确计算
- [ ] 供奉记录正确加载

#### 2. 标签页切换
- [ ] 首页内容正确显示
- [ ] 生平简介正确展开/收起
- [ ] 相册正确显示照片
- [ ] 留言板正确显示留言
- [ ] 供品标签显示供奉记录

#### 3. 供奉功能
- [ ] 献花表单正确弹出
- [ ] 蜡烛表单包含时长输入
- [ ] 金额输入验证正确
- [ ] 交易签名提交成功
- [ ] 成功后数据刷新

#### 4. 留言功能
- [ ] 留言表单正确显示
- [ ] 字数限制生效（500字）
- [ ] 留言发布成功
- [ ] 留言显示在列表顶部
- [ ] 点赞功能正常

#### 5. 权限控制
- [ ] 未连接钱包禁用供奉按钮
- [ ] 非所有者隐藏编辑按钮
- [ ] 非创建者隐藏删除按钮

### 性能测试

- [ ] 首屏加载时间 < 2秒
- [ ] 标签页切换流畅（无卡顿）
- [ ] 图片加载优化（懒加载）
- [ ] 大量供奉记录加载正常

### 兼容性测试

- [ ] Chrome浏览器
- [ ] Firefox浏览器
- [ ] Safari浏览器（iOS）
- [ ] 移动端浏览器

---

## 🐛 已知问题

### 待优化功能

1. **家谱标签页**: 功能占位，待开发
2. **照片上传**: IPFS上传逻辑待完善
3. **留言存储**: 需要链下数据库或IPFS存储
4. **访问量统计**: 暂时为模拟数据
5. **亲友团**: 数据接口待对接

### 待扩展功能

1. 虚拟宠物系统集成
2. 音频/视频祭品支持
3. 实时通知功能
4. 社交分享优化
5. 多语言支持

---

## 📚 相关文档

- [Phase2-纪念层整合方案.md](/docs/Phase2-纪念层整合方案.md)
- [Pallet Memorial README](/pallets/memorial/README.md)
- [前端组件化设计规范](/docs/前端组件化设计规范.md)

---

## 👥 开发团队

- **设计**: 基于 https://m.yssn.cn/wap/index/pc_index/m/personal/id/52498.html
- **开发**: Claude Sonnet 4.5
- **日期**: 2025-11-02

---

## 📄 更新日志

### v1.0.0 (2025-11-02)
- ✅ 完成纪念馆主页面设计
- ✅ 实现头部横幅组件
- ✅ 实现导航标签页组件
- ✅ 实现统计卡片组件
- ✅ 实现祭拜动态流组件
- ✅ 实现底部操作栏组件
- ✅ 实现6个标签页内容组件
- ✅ 实现供奉表单和交互功能
- ✅ 集成链端数据
- ✅ 更新路由配置
- ✅ 代码质量检查（无linter错误）

---

**文档生成日期**: 2025-11-02  
**Stardust 项目 - 纪念馆主页面**

