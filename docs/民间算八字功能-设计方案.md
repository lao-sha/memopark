# 民间算八字功能 - 完整设计方案

## 一、功能概述

### 1.1 业务背景
民间算八字是中国传统命理文化的重要组成部分。本功能旨在将传统算命服务数字化、去中心化，让用户能够安全、便捷地获取算命服务，同时保护用户隐私，并为算命师提供收益渠道。

### 1.2 核心价值
- **用户价值**：便捷获取专业算命服务，隐私安全有保障
- **算命师价值**：展示专业技能，获取收益，建立口碑
- **平台价值**：丰富生态应用场景，增加MEMO代币使用场景
- **文化价值**：传承和弘扬中国传统命理文化

### 1.3 功能定位
- 基于区块链的去中心化算命服务平台
- 采用订单匹配模式，用户发布需求，算命师接单
- 使用MEMO代币作为支付手段
- 引入托管和仲裁机制保障交易安全
- 隐私保护机制保障用户敏感信息安全

## 二、系统架构设计

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                        前端应用层                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  用户端界面   │  │ 算命师端界面  │  │  管理端界面   │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
                            ↓ Polkadot.js API
┌─────────────────────────────────────────────────────────────┐
│                         链端服务层                             │
│  ┌────────────────────────────────────────────────────────┐ │
│  │           pallet-fortune-telling (核心pallet)           │ │
│  │  - 算命师注册管理     - 订单创建与匹配                    │ │
│  │  - 八字计算辅助       - 托管与结算                        │ │
│  │  - 评价与信用         - 争议仲裁                          │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ pallet-otc   │  │pallet-referrals│ │pallet-arbitration│  │
│  │  (支付托管)   │  │  (推荐分成)    │  │   (仲裁服务)    │  │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
                            ↓ 链上存储
┌─────────────────────────────────────────────────────────────┐
│                         数据存储层                             │
│  - 算命师信息 (加密)    - 订单记录                            │
│  - 用户八字 (加密)      - 评价记录                            │
│  - 服务配置            - 信用积分                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 与现有系统的集成

#### 2.2.1 复用现有Pallet
1. **pallet-otc**：用于托管支付和资金结算
2. **pallet-stardust-referrals**：用于推荐人分成
3. **pallet-arbitration**：用于争议仲裁
4. **pallet-market-maker**：算命师可以同时是做市商

#### 2.2.2 新增Pallet
**pallet-fortune-telling**：专门处理算命业务逻辑

## 三、核心业务流程

### 3.1 算命师注册流程

```
用户 → 提交申请 → 填写资质信息 → 缴纳保证金 → 委员会审核 → 通过/拒绝
                     ↓
              (姓名、经验、专长、联系方式等)
                     ↓
              (数据加密存储，仅委员会可解密)
```

**流程说明**：
1. 用户提交成为算命师的申请
2. 填写个人资质信息（加密存储）
3. 缴纳保证金（防止恶意行为）
4. 委员会审核资质
5. 审核通过后成为认证算命师

### 3.2 用户下单流程

```
用户 → 输入生辰信息 → 选择服务类型 → 选择算命师 → 支付订单 → 等待服务
         ↓                ↓               ↓            ↓
    (加密存储)      (基础/高级/详批)   (指定/随机)  (托管到pallet-otc)
```

**流程说明**：
1. 用户输入生辰八字信息（加密存储，仅用户和接单算命师可解密）
2. 选择服务类型（影响价格）
3. 选择算命师或随机分配
4. 支付费用（托管在pallet-otc）
5. 等待算命师接单

### 3.3 算命师接单流程

```
算命师 → 查看待接订单 → 选择订单 → 解密用户八字 → 进行推算 → 提交结果 → 等待确认
                         ↓                           ↓
                   (获取解密权限)              (批文加密存储)
                                                     ↓
                                            (用户确认 / 发起争议)
```

**流程说明**：
1. 算命师查看可接订单列表
2. 选择订单并接单
3. 系统授予算命师解密该订单用户八字的权限
4. 算命师推算并撰写批文
5. 提交结果（批文加密，仅用户可解密）
6. 等待用户确认

### 3.4 订单完成流程

```
用户收到结果 → 查看批文 → 确认满意 → 资金释放给算命师 → 评价算命师
                            ↓
                      (不满意发起争议)
                            ↓
                      委员会仲裁
                            ↓
                   (裁决资金分配方案)
```

**流程说明**：
1. 用户收到算命师的批文
2. 用户确认满意或发起争议
3. 确认满意：资金释放给算命师，平台抽成，推荐人分成
4. 发起争议：进入仲裁流程
5. 完成后用户可以评价算命师

## 四、数据结构设计

### 4.1 算命师信息 (FortuneTeller)

```rust
/// 算命师信息
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub struct FortuneTeller<AccountId, Balance> {
    /// 算命师账户
    pub account: AccountId,
    /// 认证状态
    pub status: FortuneTellerStatus,
    /// 保证金金额
    pub deposit: Balance,
    /// 服务定价配置
    pub pricing: ServicePricing<Balance>,
    /// 加密的个人资质信息（委员会可解密）
    pub encrypted_profile: BoundedVec<u8, ConstU32<2048>>,
    /// 公开展示信息
    pub display_info: DisplayInfo,
    /// 信用积分
    pub credit_score: u32,
    /// 总接单数
    pub total_orders: u32,
    /// 完成订单数
    pub completed_orders: u32,
    /// 好评率（百分比）
    pub positive_rate: u8,
    /// 平均响应时间（秒）
    pub avg_response_time: u32,
    /// 是否接受随机分配
    pub accept_random: bool,
    /// 专长领域
    pub specialties: BoundedVec<Specialty, ConstU32<10>>,
    /// 注册时间
    pub registered_at: BlockNumber,
}

/// 认证状态
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub enum FortuneTellerStatus {
    /// 待审核
    Pending,
    /// 已认证
    Certified,
    /// 已拒绝
    Rejected,
    /// 已暂停
    Suspended,
    /// 已注销
    Revoked,
}

/// 服务定价
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub struct ServicePricing<Balance> {
    /// 基础服务价格（简批）
    pub basic: Balance,
    /// 标准服务价格（详批）
    pub standard: Balance,
    /// 高级服务价格（超详批+建议）
    pub premium: Balance,
}

/// 公开展示信息
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub struct DisplayInfo {
    /// 昵称/法号
    pub nickname: BoundedVec<u8, ConstU32<64>>,
    /// 简介
    pub bio: BoundedVec<u8, ConstU32<512>>,
    /// 从业年限
    pub years_experience: u8,
    /// 头像CID（加密）
    pub avatar_cid: Option<BoundedVec<u8, ConstU32<128>>>,
}

/// 专长领域
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub enum Specialty {
    /// 事业运势
    Career,
    /// 婚姻感情
    Marriage,
    /// 财运分析
    Wealth,
    /// 健康运势
    Health,
    /// 学业考试
    Education,
    /// 子女运势
    Children,
    /// 流年运势
    YearlyFortune,
    /// 起名改名
    Naming,
}
```

### 4.2 订单信息 (FortuneOrder)

```rust
/// 算命订单
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub struct FortuneOrder<AccountId, Balance, BlockNumber> {
    /// 订单ID
    pub order_id: OrderId,
    /// 用户账户
    pub user: AccountId,
    /// 算命师账户（可选，随机分配时初始为None）
    pub fortune_teller: Option<AccountId>,
    /// 订单状态
    pub status: OrderStatus,
    /// 服务类型
    pub service_type: ServiceType,
    /// 订单金额
    pub amount: Balance,
    /// 加密的用户生辰信息（用户+算命师可解密）
    pub encrypted_birth_info: BoundedVec<u8, ConstU32<512>>,
    /// 用户问题描述（加密）
    pub encrypted_question: BoundedVec<u8, ConstU32<1024>>,
    /// 加密的批文结果（用户可解密）
    pub encrypted_result: Option<BoundedVec<u8, ConstU32<4096>>>,
    /// 创建时间
    pub created_at: BlockNumber,
    /// 接单时间
    pub accepted_at: Option<BlockNumber>,
    /// 完成时间
    pub completed_at: Option<BlockNumber>,
    /// 是否随机分配
    pub is_random: bool,
    /// 对应的OTC订单ID
    pub otc_order_id: Option<u64>,
}

/// 订单状态
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub enum OrderStatus {
    /// 待接单
    Pending,
    /// 已接单（进行中）
    Accepted,
    /// 已提交结果（待确认）
    Submitted,
    /// 已完成
    Completed,
    /// 争议中
    Disputed,
    /// 已取消
    Cancelled,
    /// 已过期
    Expired,
}

/// 服务类型
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub enum ServiceType {
    /// 基础服务（简批，500字内）
    Basic,
    /// 标准服务（详批，1500字内）
    Standard,
    /// 高级服务（超详批+建议，3000字内）
    Premium,
}

pub type OrderId = u64;
```

### 4.3 评价信息 (Review)

```rust
/// 评价信息
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub struct Review<AccountId, BlockNumber> {
    /// 订单ID
    pub order_id: OrderId,
    /// 评价人
    pub reviewer: AccountId,
    /// 被评价人（算命师）
    pub fortune_teller: AccountId,
    /// 评分（1-5星）
    pub rating: u8,
    /// 评价内容（可选，加密）
    pub encrypted_comment: Option<BoundedVec<u8, ConstU32<512>>>,
    /// 评价时间
    pub created_at: BlockNumber,
    /// 是否匿名
    pub is_anonymous: bool,
}
```

### 4.4 八字信息 (BaZi)

```rust
/// 生辰八字信息（用于链上计算辅助）
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub struct BirthInfo {
    /// 公历年
    pub year: u16,
    /// 公历月
    pub month: u8,
    /// 公历日
    pub day: u8,
    /// 公历时
    pub hour: u8,
    /// 公历分
    pub minute: u8,
    /// 性别（影响某些推算）
    pub gender: Gender,
    /// 是否闰月
    pub is_leap_month: bool,
}

#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub enum Gender {
    Male,
    Female,
}

/// 八字（链上不存储，仅用于传递）
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo)]
pub struct BaZi {
    /// 年柱
    pub year_pillar: Pillar,
    /// 月柱
    pub month_pillar: Pillar,
    /// 日柱
    pub day_pillar: Pillar,
    /// 时柱
    pub hour_pillar: Pillar,
}

/// 柱（天干地支）
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo)]
pub struct Pillar {
    /// 天干
    pub heavenly_stem: HeavenlyStem,
    /// 地支
    pub earthly_branch: EarthlyBranch,
}

/// 天干
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo)]
pub enum HeavenlyStem {
    Jia, Yi, Bing, Ding, Wu, Ji, Geng, Xin, Ren, Gui,
}

/// 地支
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo)]
pub enum EarthlyBranch {
    Zi, Chou, Yin, Mao, Chen, Si, Wu, Wei, Shen, You, Xu, Hai,
}
```

## 五、核心功能接口设计

### 5.1 算命师相关接口

```rust
#[pallet::call]
impl<T: Config> Pallet<T> {
    /// 申请成为算命师
    /// 
    /// # 参数
    /// - `origin`: 签名来源
    /// - `encrypted_profile`: 加密的个人资质信息（委员会可解密）
    /// - `display_info`: 公开展示信息
    /// - `pricing`: 服务定价
    /// - `specialties`: 专长领域
    /// - `accept_random`: 是否接受随机分配
    /// 
    /// # 错误
    /// - `AlreadyRegistered`: 已经注册过
    /// - `InsufficientDeposit`: 保证金不足
    #[pallet::weight(10_000)]
    pub fn apply_fortune_teller(
        origin: OriginFor<T>,
        encrypted_profile: BoundedVec<u8, ConstU32<2048>>,
        display_info: DisplayInfo,
        pricing: ServicePricing<BalanceOf<T>>,
        specialties: BoundedVec<Specialty, ConstU32<10>>,
        accept_random: bool,
    ) -> DispatchResult {
        // 实现逻辑
    }

    /// 更新算命师信息
    /// 
    /// # 参数
    /// - `origin`: 签名来源（必须是已认证的算命师）
    /// - `display_info`: 新的公开展示信息（可选）
    /// - `pricing`: 新的服务定价（可选）
    /// - `specialties`: 新的专长领域（可选）
    /// - `accept_random`: 是否接受随机分配（可选）
    #[pallet::weight(10_000)]
    pub fn update_fortune_teller_info(
        origin: OriginFor<T>,
        display_info: Option<DisplayInfo>,
        pricing: Option<ServicePricing<BalanceOf<T>>>,
        specialties: Option<BoundedVec<Specialty, ConstU32<10>>>,
        accept_random: Option<bool>,
    ) -> DispatchResult {
        // 实现逻辑
    }

    /// 暂停/恢复接单
    /// 
    /// # 参数
    /// - `origin`: 签名来源（必须是已认证的算命师）
    /// - `suspend`: true表示暂停，false表示恢复
    #[pallet::weight(10_000)]
    pub fn toggle_fortune_teller_status(
        origin: OriginFor<T>,
        suspend: bool,
    ) -> DispatchResult {
        // 实现逻辑
    }

    /// 委员会审核算命师申请
    /// 
    /// # 参数
    /// - `origin`: 签名来源（必须是委员会成员）
    /// - `account`: 申请人账户
    /// - `approve`: true表示通过，false表示拒绝
    /// - `reason`: 拒绝原因（可选）
    #[pallet::weight(10_000)]
    pub fn review_fortune_teller_application(
        origin: OriginFor<T>,
        account: T::AccountId,
        approve: bool,
        reason: Option<BoundedVec<u8, ConstU32<256>>>,
    ) -> DispatchResult {
        // 实现逻辑
    }
}
```

### 5.2 订单相关接口

```rust
#[pallet::call]
impl<T: Config> Pallet<T> {
    /// 创建算命订单
    /// 
    /// # 参数
    /// - `origin`: 签名来源
    /// - `service_type`: 服务类型
    /// - `encrypted_birth_info`: 加密的生辰信息
    /// - `encrypted_question`: 加密的问题描述
    /// - `fortune_teller`: 指定算命师（可选，None表示随机分配）
    /// 
    /// # 返回
    /// - 订单ID
    #[pallet::weight(10_000)]
    pub fn create_order(
        origin: OriginFor<T>,
        service_type: ServiceType,
        encrypted_birth_info: BoundedVec<u8, ConstU32<512>>,
        encrypted_question: BoundedVec<u8, ConstU32<1024>>,
        fortune_teller: Option<T::AccountId>,
    ) -> DispatchResultWithPostInfo {
        // 实现逻辑：
        // 1. 验证用户余额
        // 2. 如果指定算命师，验证算命师状态
        // 3. 创建订单
        // 4. 调用pallet-otc创建托管订单
        // 5. 如果是随机分配，触发分配逻辑
        // 6. 触发事件
    }

    /// 算命师接单
    /// 
    /// # 参数
    /// - `origin`: 签名来源（必须是已认证的算命师）
    /// - `order_id`: 订单ID
    #[pallet::weight(10_000)]
    pub fn accept_order(
        origin: OriginFor<T>,
        order_id: OrderId,
    ) -> DispatchResult {
        // 实现逻辑：
        // 1. 验证算命师状态
        // 2. 验证订单状态
        // 3. 更新订单状态为Accepted
        // 4. 授予算命师解密权限
        // 5. 触发事件
    }

    /// 提交算命结果
    /// 
    /// # 参数
    /// - `origin`: 签名来源（必须是接单的算命师）
    /// - `order_id`: 订单ID
    /// - `encrypted_result`: 加密的批文结果
    #[pallet::weight(10_000)]
    pub fn submit_result(
        origin: OriginFor<T>,
        order_id: OrderId,
        encrypted_result: BoundedVec<u8, ConstU32<4096>>,
    ) -> DispatchResult {
        // 实现逻辑：
        // 1. 验证算命师身份
        // 2. 验证订单状态
        // 3. 保存加密结果
        // 4. 更新订单状态为Submitted
        // 5. 触发事件通知用户
    }

    /// 用户确认订单完成
    /// 
    /// # 参数
    /// - `origin`: 签名来源（必须是订单用户）
    /// - `order_id`: 订单ID
    #[pallet::weight(10_000)]
    pub fn confirm_order(
        origin: OriginFor<T>,
        order_id: OrderId,
    ) -> DispatchResult {
        // 实现逻辑：
        // 1. 验证用户身份
        // 2. 验证订单状态
        // 3. 更新订单状态为Completed
        // 4. 调用pallet-otc释放资金
        // 5. 分润：平台抽成、推荐人分成
        // 6. 更新算命师统计数据
        // 7. 触发事件
    }

    /// 用户发起争议
    /// 
    /// # 参数
    /// - `origin`: 签名来源（必须是订单用户）
    /// - `order_id`: 订单ID
    /// - `encrypted_reason`: 加密的争议原因
    #[pallet::weight(10_000)]
    pub fn dispute_order(
        origin: OriginFor<T>,
        order_id: OrderId,
        encrypted_reason: BoundedVec<u8, ConstU32<1024>>,
    ) -> DispatchResult {
        // 实现逻辑：
        // 1. 验证用户身份
        // 2. 验证订单状态（必须是Submitted）
        // 3. 更新订单状态为Disputed
        // 4. 调用pallet-arbitration创建仲裁案件
        // 5. 触发事件
    }

    /// 取消订单（仅限待接单状态）
    /// 
    /// # 参数
    /// - `origin`: 签名来源（必须是订单用户）
    /// - `order_id`: 订单ID
    #[pallet::weight(10_000)]
    pub fn cancel_order(
        origin: OriginFor<T>,
        order_id: OrderId,
    ) -> DispatchResult {
        // 实现逻辑：
        // 1. 验证用户身份
        // 2. 验证订单状态（必须是Pending）
        // 3. 更新订单状态为Cancelled
        // 4. 调用pallet-otc退还资金
        // 5. 触发事件
    }
}
```

### 5.3 评价相关接口

```rust
#[pallet::call]
impl<T: Config> Pallet<T> {
    /// 用户评价算命师
    /// 
    /// # 参数
    /// - `origin`: 签名来源（必须是订单用户）
    /// - `order_id`: 订单ID
    /// - `rating`: 评分（1-5星）
    /// - `encrypted_comment`: 加密的评价内容（可选）
    /// - `is_anonymous`: 是否匿名
    #[pallet::weight(10_000)]
    pub fn submit_review(
        origin: OriginFor<T>,
        order_id: OrderId,
        rating: u8,
        encrypted_comment: Option<BoundedVec<u8, ConstU32<512>>>,
        is_anonymous: bool,
    ) -> DispatchResult {
        // 实现逻辑：
        // 1. 验证用户身份
        // 2. 验证订单状态（必须是Completed）
        // 3. 验证评分范围（1-5）
        // 4. 检查是否已评价
        // 5. 保存评价
        // 6. 更新算命师信用分和好评率
        // 7. 触发事件
    }
}
```

### 5.4 查询接口

```rust
#[pallet::call]
impl<T: Config> Pallet<T> {
    /// 查询算命师信息
    pub fn get_fortune_teller(account: T::AccountId) -> Option<FortuneTeller<T::AccountId, BalanceOf<T>>> {
        FortuneTellers::<T>::get(account)
    }

    /// 查询订单信息
    pub fn get_order(order_id: OrderId) -> Option<FortuneOrder<T::AccountId, BalanceOf<T>, T::BlockNumber>> {
        Orders::<T>::get(order_id)
    }

    /// 查询用户的订单列表
    pub fn get_user_orders(user: T::AccountId) -> Vec<OrderId> {
        UserOrders::<T>::get(user).into_inner()
    }

    /// 查询算命师的订单列表
    pub fn get_fortune_teller_orders(fortune_teller: T::AccountId) -> Vec<OrderId> {
        FortuneTellerOrders::<T>::get(fortune_teller).into_inner()
    }

    /// 查询待接单列表
    pub fn get_pending_orders() -> Vec<OrderId> {
        PendingOrders::<T>::get().into_inner()
    }

    /// 查询算命师的评价列表
    pub fn get_reviews(fortune_teller: T::AccountId) -> Vec<Review<T::AccountId, T::BlockNumber>> {
        Reviews::<T>::get(fortune_teller).into_inner()
    }
}
```

## 六、存储设计

```rust
#[pallet::storage]
#[pallet::getter(fn fortune_tellers)]
/// 算命师信息存储
/// Key: AccountId
/// Value: FortuneTeller
pub type FortuneTellers<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::AccountId,
    FortuneTeller<T::AccountId, BalanceOf<T>>,
    OptionQuery,
>;

#[pallet::storage]
#[pallet::getter(fn orders)]
/// 订单信息存储
/// Key: OrderId
/// Value: FortuneOrder
pub type Orders<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    OrderId,
    FortuneOrder<T::AccountId, BalanceOf<T>, T::BlockNumber>,
    OptionQuery,
>;

#[pallet::storage]
#[pallet::getter(fn next_order_id)]
/// 下一个订单ID
pub type NextOrderId<T: Config> = StorageValue<_, OrderId, ValueQuery>;

#[pallet::storage]
#[pallet::getter(fn user_orders)]
/// 用户订单列表
/// Key: AccountId (用户)
/// Value: BoundedVec<OrderId>
pub type UserOrders<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::AccountId,
    BoundedVec<OrderId, ConstU32<1000>>,
    ValueQuery,
>;

#[pallet::storage]
#[pallet::getter(fn fortune_teller_orders)]
/// 算命师订单列表
/// Key: AccountId (算命师)
/// Value: BoundedVec<OrderId>
pub type FortuneTellerOrders<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::AccountId,
    BoundedVec<OrderId, ConstU32<10000>>,
    ValueQuery,
>;

#[pallet::storage]
#[pallet::getter(fn pending_orders)]
/// 待接单列表（随机分配池）
pub type PendingOrders<T: Config> = StorageValue<
    _,
    BoundedVec<OrderId, ConstU32<1000>>,
    ValueQuery,
>;

#[pallet::storage]
#[pallet::getter(fn reviews)]
/// 评价列表
/// Key: AccountId (算命师)
/// Value: BoundedVec<Review>
pub type Reviews<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::AccountId,
    BoundedVec<Review<T::AccountId, T::BlockNumber>, ConstU32<10000>>,
    ValueQuery,
>;

#[pallet::storage]
#[pallet::getter(fn config)]
/// 系统配置
pub type SystemConfig<T: Config> = StorageValue<
    _,
    FortuneConfig<BalanceOf<T>>,
    ValueQuery,
>;
```

## 七、事件设计

```rust
#[pallet::event]
#[pallet::generate_deposit(pub(super) fn deposit_event)]
pub enum Event<T: Config> {
    /// 算命师申请已提交 [申请人, 保证金金额]
    FortuneTellerApplicationSubmitted(T::AccountId, BalanceOf<T>),
    
    /// 算命师申请已审核 [申请人, 是否通过]
    FortuneTellerApplicationReviewed(T::AccountId, bool),
    
    /// 算命师信息已更新 [算命师账户]
    FortuneTellerInfoUpdated(T::AccountId),
    
    /// 算命师状态已切换 [算命师账户, 是否暂停]
    FortuneTellerStatusToggled(T::AccountId, bool),
    
    /// 订单已创建 [订单ID, 用户, 服务类型, 金额]
    OrderCreated(OrderId, T::AccountId, ServiceType, BalanceOf<T>),
    
    /// 订单已接单 [订单ID, 算命师]
    OrderAccepted(OrderId, T::AccountId),
    
    /// 结果已提交 [订单ID, 算命师]
    ResultSubmitted(OrderId, T::AccountId),
    
    /// 订单已完成 [订单ID, 用户, 算命师]
    OrderCompleted(OrderId, T::AccountId, T::AccountId),
    
    /// 订单已取消 [订单ID, 用户]
    OrderCancelled(OrderId, T::AccountId),
    
    /// 订单已发起争议 [订单ID, 用户]
    OrderDisputed(OrderId, T::AccountId),
    
    /// 评价已提交 [订单ID, 用户, 算命师, 评分]
    ReviewSubmitted(OrderId, T::AccountId, T::AccountId, u8),
}
```

## 八、错误设计

```rust
#[pallet::error]
pub enum Error<T> {
    /// 已经注册过算命师
    AlreadyRegistered,
    
    /// 未注册算命师
    NotRegistered,
    
    /// 保证金不足
    InsufficientDeposit,
    
    /// 算命师未认证
    NotCertified,
    
    /// 算命师已暂停
    FortuneTellerSuspended,
    
    /// 订单不存在
    OrderNotFound,
    
    /// 订单状态错误
    InvalidOrderStatus,
    
    /// 无权限操作此订单
    NoPermission,
    
    /// 余额不足
    InsufficientBalance,
    
    /// 算命师不存在
    FortuneTellerNotFound,
    
    /// 算命师不接受随机分配
    FortuneTellerNotAcceptRandom,
    
    /// 无可用算命师
    NoAvailableFortuneTeller,
    
    /// 评分超出范围
    InvalidRating,
    
    /// 已评价过
    AlreadyReviewed,
    
    /// 数据超出限制
    DataTooLarge,
    
    /// 订单已过期
    OrderExpired,
    
    /// OTC订单创建失败
    OtcOrderCreationFailed,
    
    /// 仲裁案件创建失败
    ArbitrationCreationFailed,
}
```

## 九、配置参数设计

```rust
/// 系统配置
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo, MaxEncodedLen)]
pub struct FortuneConfig<Balance> {
    /// 算命师保证金
    pub fortune_teller_deposit: Balance,
    
    /// 平台抽成比例（千分比）
    pub platform_fee_rate: u16,
    
    /// 推荐人分成比例（千分比）
    pub referral_fee_rate: u16,
    
    /// 订单超时时间（区块数）
    /// - 待接单超时
    pub pending_timeout: u32,
    
    /// 服务超时时间（区块数）
    /// - 接单后需在此时间内提交结果
    pub service_timeout: u32,
    
    /// 确认超时时间（区块数）
    /// - 提交结果后用户需在此时间内确认或发起争议
    /// - 超时自动确认
    pub confirm_timeout: u32,
    
    /// 最低服务价格
    pub min_service_price: Balance,
    
    /// 最高服务价格
    pub max_service_price: Balance,
    
    /// 信用分初始值
    pub initial_credit_score: u32,
    
    /// 好评加分
    pub positive_review_score: u32,
    
    /// 差评扣分
    pub negative_review_score: u32,
}

impl<Balance: Default> Default for FortuneConfig<Balance> {
    fn default() -> Self {
        Self {
            fortune_teller_deposit: Default::default(), // 由runtime配置
            platform_fee_rate: 50,  // 5%
            referral_fee_rate: 20,  // 2%
            pending_timeout: 28800, // 约48小时（按2秒一个块）
            service_timeout: 43200, // 约72小时
            confirm_timeout: 14400, // 约24小时
            min_service_price: Default::default(), // 由runtime配置
            max_service_price: Default::default(), // 由runtime配置
            initial_credit_score: 1000,
            positive_review_score: 10,
            negative_review_score: 50,
        }
    }
}
```

## 十、隐私保护机制

### 10.1 加密方案

#### 10.1.1 用户生辰信息加密
- **加密方式**：双层加密
  - 第一层：用户公钥加密（用户可解密）
  - 第二层：接单算命师公钥加密（算命师可解密）
- **存储**：链上存储加密数据
- **解密权限**：仅用户本人和接单算命师

#### 10.1.2 算命师资质信息加密
- **加密方式**：委员会公钥加密
- **存储**：链上存储加密数据
- **解密权限**：仅委员会成员（用于审核）

#### 10.1.3 批文结果加密
- **加密方式**：用户公钥加密
- **存储**：链上存储加密数据
- **解密权限**：仅用户本人

### 10.2 加密流程

```
用户创建订单:
1. 用户输入生辰信息（明文）
2. 前端使用用户私钥签名
3. 前端使用用户公钥加密 → encrypted_birth_info_user
4. 如果指定算命师，再用算命师公钥加密 → encrypted_birth_info_final
5. 提交到链上

算命师接单:
1. 算命师查询订单
2. 获取encrypted_birth_info_final
3. 使用算命师私钥解密 → encrypted_birth_info_user
4. （用户后续提供解密密钥或通过链下通道）
5. 解密获得明文生辰信息

算命师提交结果:
1. 算命师撰写批文（明文）
2. 使用用户公钥加密 → encrypted_result
3. 提交到链上

用户查看结果:
1. 用户查询订单
2. 获取encrypted_result
3. 使用用户私钥解密
4. 查看批文
```

### 10.3 隐私保护建议

1. **CID加密**：头像等IPFS内容的CID需要加密
2. **评价匿名**：支持匿名评价，保护用户隐私
3. **链下通道**：敏感信息交互建议使用pallet-chat
4. **数据最小化**：只在链上存储必要的加密数据

## 十一、经济模型设计

### 11.1 收费模式

#### 11.1.1 服务定价
- **基础服务（简批）**：100-500 DUST
  - 批文字数：≤500字
  - 响应时间：≤48小时
  
- **标准服务（详批）**：500-2000 DUST
  - 批文字数：≤1500字
  - 响应时间：≤72小时
  
- **高级服务（超详批+建议）**：2000-10000 DUST
  - 批文字数：≤3000字
  - 响应时间：≤72小时
  - 包含具体建议

#### 11.1.2 定价权
- 算命师自主定价
- 系统设置最低和最高价格限制
- 市场竞争自然调节价格

### 11.2 资金流向

```
用户支付金额
     ↓
托管在pallet-otc
     ↓
订单完成后释放
     ↓
├─→ 算命师收入 (93%)
├─→ 平台抽成 (5%)
└─→ 推荐人分成 (2%)
```

### 11.3 保证金机制

#### 11.3.1 算命师保证金
- **金额**：10,000 DUST（可配置）
- **用途**：
  - 防止恶意注册
  - 作为违约处罚来源
  - 提升算命师可信度
- **退还**：注销时退还（扣除罚款后）

#### 11.3.2 保证金罚没场景
1. **恶意接单不服务**：罚没部分保证金
2. **提交劣质内容**：经仲裁确认后罚没
3. **严重违规**：全额罚没并永久封禁

### 11.4 信用激励

#### 11.4.1 信用积分规则
- **初始积分**：1000分
- **好评加分**：+10分
- **差评扣分**：-50分
- **完成订单**：+1分
- **超时服务**：-20分
- **用户投诉**：-30分

#### 11.4.2 信用等级
- **5星算命师**：≥2000分，好评率≥95%
- **4星算命师**：≥1500分，好评率≥90%
- **3星算命师**：≥1000分，好评率≥80%
- **2星算命师**：≥500分，好评率≥70%
- **1星算命师**：<500分或好评率<70%

#### 11.4.3 信用权益
- **5星**：订单优先推荐、可设置更高价格、平台推广
- **4星**：订单正常推荐
- **3星**：订单正常推荐
- **2星**：订单降权推荐、限制接单数量
- **1星**：禁止接单、要求整改

## 十二、与现有系统集成

### 12.1 与pallet-otc集成

```rust
// 创建订单时调用OTC
let otc_order_id = pallet_otc::Pallet::<T>::create_order(
    user.clone(),
    fortune_teller.clone(),
    amount,
    Some(Self::on_otc_completed), // 完成回调
)?;

// OTC完成回调
fn on_otc_completed(order_id: u64, user: T::AccountId, seller: T::AccountId, amount: BalanceOf<T>) {
    // 分润逻辑
    let platform_fee = amount * config.platform_fee_rate / 1000;
    let referral_fee = amount * config.referral_fee_rate / 1000;
    let seller_amount = amount - platform_fee - referral_fee;
    
    // 转账给算命师
    // 转账平台费用
    // 调用pallet-referrals分成
}
```

### 12.2 与pallet-stardust-referrals集成

```rust
// 订单完成时触发推荐人分成
pallet_memo_referrals::Pallet::<T>::distribute_referral_fee(
    user.clone(),
    referral_fee,
)?;
```

### 12.3 与pallet-arbitration集成

```rust
// 用户发起争议时创建仲裁案件
let arbitration_id = pallet_arbitration::Pallet::<T>::create_case(
    user.clone(),
    fortune_teller.clone(),
    encrypted_evidence,
    amount,
)?;

// 存储仲裁ID关联
ArbitrationCases::<T>::insert(order_id, arbitration_id);
```

### 12.4 与pallet-chat集成（建议）

- 用户与算命师可以通过chat沟通
- 聊天记录可作为争议证据
- 算命师可以询问更详细信息

## 十三、前端设计方案

### 13.1 页面结构

```
/fortune-telling
  ├── /home                    # 首页（算命师列表）
  ├── /fortune-teller/:id      # 算命师详情页
  ├── /order/create            # 创建订单页
  ├── /order/:id               # 订单详情页
  ├── /my-orders               # 我的订单列表
  ├── /fortune-teller/apply    # 申请成为算命师
  ├── /fortune-teller/dashboard # 算命师工作台
  └── /fortune-teller/orders    # 算命师订单管理
```

### 13.2 核心组件

#### 13.2.1 FortuneTellerList（算命师列表）
```tsx
/**
 * 算命师列表组件
 * 功能：
 * - 展示所有认证算命师
 * - 支持按专长、价格、评分筛选
 * - 支持排序（评分、价格、接单量）
 * - 点击进入算命师详情页
 */
interface FortuneTellerListProps {
  filters?: {
    specialty?: Specialty;
    minPrice?: number;
    maxPrice?: number;
    minRating?: number;
  };
  sortBy?: 'rating' | 'price' | 'orders';
}
```

#### 13.2.2 FortuneTellerCard（算命师卡片）
```tsx
/**
 * 算命师卡片组件
 * 展示信息：
 * - 头像、昵称/法号
 * - 信用等级（星级）
 * - 专长领域
 * - 服务定价（基础/标准/高级）
 * - 好评率、完成订单数
 * - 从业年限
 */
interface FortuneTellerCardProps {
  fortuneTeller: FortuneTeller;
  onClick?: () => void;
}
```

#### 13.2.3 CreateOrderForm（创建订单表单）
```tsx
/**
 * 创建订单表单组件
 * 输入项：
 * - 生辰信息（年月日时分）
 * - 性别
 * - 问题描述（可选）
 * - 服务类型选择
 * - 算命师选择（可选，支持随机）
 * 
 * 功能：
 * - 实时计算价格
 * - 生辰信息自动加密
 * - 展示支付金额明细
 */
interface CreateOrderFormProps {
  fortuneTeller?: FortuneTeller; // 预选算命师
  onSubmit: (orderData: OrderData) => void;
}
```

#### 13.2.4 OrderDetail（订单详情）
```tsx
/**
 * 订单详情组件
 * 展示信息：
 * - 订单状态（进度条）
 * - 服务类型、价格
 * - 算命师信息
 * - 创建时间、接单时间、完成时间
 * - 批文结果（已完成时显示）
 * 
 * 操作按钮：
 * - 取消订单（待接单时）
 * - 确认完成（已提交结果时）
 * - 发起争议（已提交结果时）
 * - 提交评价（已完成时）
 * - 联系算命师（chat）
 */
interface OrderDetailProps {
  orderId: string;
}
```

#### 13.2.5 FortuneTellerDashboard（算命师工作台）
```tsx
/**
 * 算命师工作台组件
 * 展示信息：
 * - 待接单数量
 * - 进行中订单数量
 * - 待确认订单数量
 * - 总收入统计
 * - 信用积分、好评率
 * - 近期评价
 * 
 * 功能模块：
 * - 订单管理（待接单、进行中、已完成）
 * - 收入统计
 * - 个人信息管理
 * - 服务定价设置
 */
```

#### 13.2.6 SubmitResultModal（提交结果弹窗）
```tsx
/**
 * 提交结果弹窗组件
 * 输入项：
 * - 批文内容（富文本编辑器）
 * - 字数统计
 * 
 * 功能：
 * - 实时字数统计
 * - 自动加密批文
 * - 预览功能
 */
interface SubmitResultModalProps {
  orderId: string;
  onSubmit: (encryptedResult: string) => void;
}
```

#### 13.2.7 ReviewForm（评价表单）
```tsx
/**
 * 评价表单组件
 * 输入项：
 * - 评分（1-5星）
 * - 评价内容（可选）
 * - 是否匿名
 * 
 * 功能：
 * - 星级评分交互
 * - 评价内容加密
 */
interface ReviewFormProps {
  orderId: string;
  fortuneTeller: FortuneTeller;
  onSubmit: (review: ReviewData) => void;
}
```

### 13.3 页面流程

#### 13.3.1 用户下单流程

```
1. 首页浏览算命师
   ↓
2. 筛选/搜索算命师
   ↓
3. 查看算命师详情（专长、评价、定价）
   ↓
4. 点击"找TA算命"
   ↓
5. 填写生辰信息和问题
   ↓
6. 选择服务类型
   ↓
7. 确认价格
   ↓
8. 支付（连接钱包）
   ↓
9. 订单创建成功
   ↓
10. 等待算命师接单
   ↓
11. 收到结果通知
   ↓
12. 查看批文
   ↓
13. 确认满意 / 发起争议
   ↓
14. 提交评价
```

#### 13.3.2 算命师接单流程

```
1. 登录算命师工作台
   ↓
2. 查看待接单列表
   ↓
3. 选择订单查看详情
   ↓
4. 解密查看用户生辰信息
   ↓
5. 点击"接单"
   ↓
6. 进行推算
   ↓
7. 撰写批文
   ↓
8. 提交结果
   ↓
9. 等待用户确认
   ↓
10. 收到款项
   ↓
11. 查看用户评价
```

### 13.4 UI/UX设计要点

#### 13.4.1 色彩方案
- 主色调：沉稳的深蓝、金色（体现传统文化）
- 辅助色：浅灰、白色
- 强调色：红色（警示）、绿色（成功）

#### 13.4.2 设计风格
- 融入中国传统元素（祥云、印章、毛笔字体）
- 现代简约UI，避免过于花哨
- 卡片式布局，清晰分层

#### 13.4.3 响应式适配
- 移动端：卡片纵向排列，大按钮易点击
- 平板端：2列布局
- 桌面端：3-4列布局，侧边栏导航

#### 13.4.4 交互优化
- 加载状态：骨架屏
- 错误提示：Toast + 详细错误信息
- 表单验证：实时验证，友好提示
- 确认操作：重要操作二次确认（支付、发起争议）

### 13.5 技术实现要点

#### 13.5.1 加密库集成
```typescript
// 使用 @polkadot/util-crypto 进行加密
import { encryptData, decryptData } from '@/utils/crypto';

// 加密生辰信息
const encryptedBirthInfo = await encryptData(
  birthInfo,
  fortuneTellerPublicKey
);

// 解密批文
const decryptedResult = await decryptData(
  encryptedResult,
  userPrivateKey
);
```

#### 13.5.2 Polkadot.js API调用
```typescript
// 创建订单
const createOrder = async (orderData: OrderData) => {
  const api = await getApi();
  const tx = api.tx.fortuneTelling.createOrder(
    orderData.serviceType,
    orderData.encryptedBirthInfo,
    orderData.encryptedQuestion,
    orderData.fortuneTeller
  );
  
  await tx.signAndSend(currentAccount, ({ status, events }) => {
    if (status.isInBlock) {
      // 订单创建成功
      const orderCreatedEvent = events.find(
        e => api.events.fortuneTelling.OrderCreated.is(e.event)
      );
      const orderId = orderCreatedEvent.event.data[0];
      // 跳转到订单详情页
    }
  });
};
```

#### 13.5.3 实时数据订阅
```typescript
// 订阅订单状态变化
const subscribeOrderStatus = (orderId: string, callback: (status: OrderStatus) => void) => {
  const api = await getApi();
  const unsub = await api.query.fortuneTelling.orders(orderId, (order) => {
    if (order.isSome) {
      callback(order.unwrap().status);
    }
  });
  return unsub;
};
```

## 十四、扩展性设计

### 14.1 宠物养成游戏关联

本功能为后续宠物养成游戏预留扩展点：

#### 14.1.1 八字与宠物属性关联
- 用户的八字可以影响宠物的初始属性
- 年柱 → 宠物性格
- 月柱 → 宠物体质
- 日柱 → 宠物天赋
- 时柱 → 宠物运势

#### 14.1.2 算命服务与游戏道具
- 算命师可以推荐适合的宠物类型
- 算命结果可以转化为游戏道具（增运符、改运丹）
- 创建"宠物算命"服务类型

#### 14.1.3 预留数据结构
```rust
/// 八字属性（用于游戏）
#[derive(Clone, Encode, Decode, Eq, PartialEq, RuntimeDebug, TypeInfo)]
pub struct BaZiAttributes {
    /// 五行分布（金木水火土）
    pub elements: [u8; 5],
    /// 强弱指数
    pub strength: u8,
    /// 幸运元素
    pub lucky_element: Element,
}

/// 预留：宠物八字关联
#[pallet::storage]
pub type PetBaZiMapping<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    PetId,
    BaZiAttributes,
    OptionQuery,
>;
```

### 14.2 其他功能扩展

#### 14.2.1 起名服务
- 新增服务类型：宝宝起名、成人改名
- 根据八字推荐名字
- 名字五行分析

#### 14.2.2 合婚服务
- 双人八字合婚分析
- 需要两个用户授权
- 生成合婚报告

#### 14.2.3 择日服务
- 选择良辰吉日
- 结婚、开业、搬家等场景
- 生成日历推荐

#### 14.2.4 风水咨询
- 在线风水咨询
- 需要上传户型图（IPFS）
- 专业风水师分析

## 十五、开发计划

### 15.1 Phase 1: 核心功能（4周）

**Week 1-2: 链端开发**
- [ ] 创建pallet-fortune-telling骨架
- [ ] 实现算命师注册、审核功能
- [ ] 实现订单创建、接单功能
- [ ] 实现结果提交、确认功能
- [ ] 集成pallet-otc托管支付
- [ ] 编写单元测试

**Week 3: 前端开发（基础页面）**
- [ ] 创建算命师列表页
- [ ] 创建算命师详情页
- [ ] 创建订单创建页
- [ ] 创建订单详情页
- [ ] 集成Polkadot.js API

**Week 4: 前端开发（高级功能）**
- [ ] 创建算命师申请页
- [ ] 创建算命师工作台
- [ ] 实现加密/解密功能
- [ ] 实现实时订阅
- [ ] UI/UX优化

### 15.2 Phase 2: 高级功能（3周）

**Week 5: 信用系统**
- [ ] 实现评价功能
- [ ] 实现信用积分计算
- [ ] 实现信用等级划分
- [ ] 前端集成信用展示

**Week 6: 争议仲裁**
- [ ] 集成pallet-arbitration
- [ ] 实现争议发起
- [ ] 实现仲裁流程
- [ ] 前端集成争议功能

**Week 7: 推荐分成**
- [ ] 集成pallet-stardust-referrals
- [ ] 实现分成逻辑
- [ ] 前端展示推荐收益

### 15.3 Phase 3: 优化与扩展（2周）

**Week 8: 优化**
- [ ] 性能优化
- [ ] 安全审计
- [ ] 用户体验优化
- [ ] 编写README文档

**Week 9: 扩展功能**
- [ ] 随机分配算法优化
- [ ] 八字计算辅助功能
- [ ] 预留宠物游戏接口
- [ ] 集成测试

### 15.4 Phase 4: 测试与上线（1周）

**Week 10**
- [ ] 全链路测试
- [ ] Bug修复
- [ ] 用户手册编写
- [ ] 上线部署

## 十六、风险评估与应对

### 16.1 技术风险

**风险1：加密性能问题**
- **描述**：大量加密解密操作可能影响性能
- **应对**：
  - 前端进行加密/解密，减轻链端压力
  - 使用高效加密算法
  - 分批处理大数据

**风险2：存储成本**
- **描述**：批文等内容可能较大，占用存储
- **应对**：
  - 限制批文大小（4KB）
  - 考虑使用IPFS存储，链上仅存CID
  - 定期清理过期数据

### 16.2 业务风险

**风险1：算命师质量参差不齐**
- **描述**：可能出现滥竽充数的算命师
- **应对**：
  - 委员会严格审核
  - 用户评价机制
  - 信用积分淘汰机制
  - 保证金约束

**风险2：用户隐私泄露**
- **描述**：生辰八字属于敏感信息
- **应对**：
  - 强加密保护
  - 访问权限严格控制
  - 安全审计
  - 用户教育

**风险3：争议处理困难**
- **描述**：算命是主观服务，争议难以裁定
- **应对**：
  - 制定详细服务标准
  - 委员会介入仲裁
  - 参考服务类型和字数
  - 建立案例库

### 16.3 合规风险

**风险1：封建迷信监管**
- **描述**：可能被认为宣扬封建迷信
- **应对**：
  - 定位为"传统文化咨询服务"
  - 添加免责声明
  - 强调娱乐和文化属性
  - 禁止夸大宣传

**风险2：金融监管**
- **描述**：涉及资金托管和支付
- **应对**：
  - 使用去中心化托管（pallet-otc）
  - 明确资金流向
  - 合规披露

## 十七、成功指标

### 17.1 技术指标
- [ ] 订单创建成功率 > 99%
- [ ] 平均响应时间 < 3秒
- [ ] 加密/解密成功率 > 99.9%
- [ ] 系统稳定性 > 99.5%

### 17.2 业务指标
- [ ] 第一个月注册算命师 > 10人
- [ ] 第一个月完成订单 > 50单
- [ ] 用户满意度（好评率）> 80%
- [ ] 算命师平均收入 > 1000 DUST/月

### 17.3 用户指标
- [ ] 用户留存率（7天）> 30%
- [ ] 订单复购率 > 20%
- [ ] 用户评价率 > 60%

## 十八、总结

### 18.1 核心优势
1. **去中心化**：无需中心化平台，算命师直接服务用户
2. **隐私保护**：全程加密，保护用户敏感信息
3. **信用体系**：通过评价和积分建立可信环境
4. **托管保障**：资金托管，保障双方权益
5. **文化传承**：数字化传统命理文化

### 18.2 创新点
1. **区块链+传统文化**：将传统算命服务区块链化
2. **加密隐私保护**：多层加密保护用户生辰信息
3. **信用机制**：建立算命师信用体系
4. **游戏扩展**：为宠物养成游戏预留接口

### 18.3 后续展望
1. **AI辅助**：引入AI算法辅助推算
2. **社交功能**：算命师社区、用户分享
3. **教育功能**：在线学习命理知识
4. **跨链扩展**：支持其他区块链网络

---

## 附录

### A. 参考资料
- Substrate开发文档
- Polkadot.js API文档
- 中国传统命理文化资料
- 相关法律法规

### B. 术语表
- **八字**：年月日时的天干地支组合
- **天干**：甲乙丙丁戊己庚辛壬癸
- **地支**：子丑寅卯辰巳午未申酉戌亥
- **批文**：算命师撰写的命理分析结果
- **托管**：资金暂时锁定，待条件满足后释放

### C. FAQ

**Q1: 为什么要使用区块链？**
A: 区块链提供去中心化、不可篡改、透明可信的特性，保障用户和算命师的权益。

**Q2: 生辰信息安全吗？**
A: 绝对安全。所有生辰信息都经过加密存储，只有用户本人和接单算命师可以解密。

**Q3: 如果对结果不满意怎么办？**
A: 可以发起争议，委员会会介入仲裁，根据情况裁定资金分配。

**Q4: 算命师如何收费？**
A: 算命师可以自主定价，系统会设置合理的价格区间。

**Q5: 会员制和算命服务的区别？**
A: 会员制是长期订阅服务，算命是单次付费服务，两者资金流向不同。

---

**文档版本**：v1.0  
**创建时间**：2025-10-23  
**最后更新**：2025-10-23  
**作者**：Stardust开发团队

