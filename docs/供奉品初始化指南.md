# Stardust ä¾›å¥‰å“åˆå§‹åŒ–æŒ‡å—

> **æ•°æ®æ¥æº**: äº‘ä¸Šæ€å¿µç½‘ç«™ (https://m.yssn.cn)  
> **æå–æ—¥æœŸ**: 2025-11-08  
> **ä¾›å¥‰å“æ€»æ•°**: 541 ä¸ª  
> **åˆ†ç±»æ•°é‡**: 11 ä¸ª  
> **ç»´æŠ¤è€…**: Stardust Team

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ–‡ä»¶è¯´æ˜](#æ–‡ä»¶è¯´æ˜)
3. [ä½¿ç”¨æµç¨‹](#ä½¿ç”¨æµç¨‹)
4. [è„šæœ¬è¯¦è§£](#è„šæœ¬è¯¦è§£)
5. [æ•°æ®ç»“æ„](#æ•°æ®ç»“æ„)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
7. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®ä»äº‘ä¸Šæ€å¿µç½‘ç«™æå–äº†å®Œæ•´çš„ä¾›å¥‰å“æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š
- âœ… 541 ä¸ªä¾›å¥‰å“ä¿¡æ¯ï¼ˆåç§°ã€ä»·æ ¼ã€å›¾ç‰‡ï¼‰
- âœ… 11 ä¸ªä¾›å¥‰å“ç±»åˆ«
- âœ… å®Œæ•´çš„å›¾ç‰‡URL
- âœ… è‡ªåŠ¨åŒ–åˆå§‹åŒ–è„šæœ¬

### æ•°æ®ç»Ÿè®¡

| ç±»åˆ« | ä¾›å“æ•°é‡ | ä»·æ ¼èŒƒå›´ |
|------|---------|---------|
| é¦™çƒ› | ~80 | 0-8å…ƒ |
| èŠ±æœ | ~120 | 0-10å…ƒ |
| é…’èœ | ~100 | 2-10å…ƒ |
| å®¶å±…æ±½è½¦ | ~40 | 3-12å…ƒ |
| åˆ«å¢…ä½£äºº | ~10 | 2-12å…ƒ |
| æœé¥°åè¡¨ | ~60 | 2-6å…ƒ |
| æ•°ç ä¹å™¨ | ~30 | 3-5å…ƒ |
| èŠ‚æ—¥ | ~50 | 2-16å…ƒ |
| ç©å…·å® ç‰© | ~30 | 2-6å…ƒ |
| è¿åŠ¨ | ~15 | 3å…ƒ |
| å¥—é¤ | ~6 | 5-16å…ƒ |

---

## æ–‡ä»¶è¯´æ˜

### æ•°æ®æ–‡ä»¶

```
scripts/
â”œâ”€â”€ offerings-data.json              # åŸå§‹ä¾›å¥‰å“æ•°æ®ï¼ˆæŒ‰ç±»åˆ«ç»„ç»‡ï¼‰
â”œâ”€â”€ offerings-with-images.json       # å®Œæ•´ä¾›å¥‰å“æ•°æ®ï¼ˆå«å›¾ç‰‡URLï¼‰
â”œâ”€â”€ image-map.json                   # ä¾›å¥‰å“åç§° -> å›¾ç‰‡æ–‡ä»¶åæ˜ å°„
â”œâ”€â”€ ipfs-cid-map.json               # å›¾ç‰‡æ–‡ä»¶å -> IPFS CID æ˜ å°„
â””â”€â”€ offering-cid-map.json           # ä¾›å¥‰å“åç§° -> IPFS CID æ˜ å°„
```

### è„šæœ¬æ–‡ä»¶

```
scripts/
â”œâ”€â”€ init-sacrifices.js               # é“¾ç«¯ç¥­ç¥€å“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ download-offerings-images.js     # å›¾ç‰‡ä¸‹è½½è„šæœ¬
â”œâ”€â”€ upload-images-to-ipfs.js        # IPFS ä¸Šä¼ è„šæœ¬
â””â”€â”€ offerings-page.png              # é¡µé¢æˆªå›¾
```

### å‰ç«¯é…ç½®æ–‡ä»¶

```
stardust-dapp/src/config/
â””â”€â”€ offerings-config.ts              # å‰ç«¯ä¾›å¥‰å“é…ç½®
```

---

## ä½¿ç”¨æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šä¸‹è½½ä¾›å¥‰å“å›¾ç‰‡

```bash
cd /home/xiaodong/æ–‡æ¡£/stardust/scripts

# å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
npm install

# ä¸‹è½½æ‰€æœ‰å›¾ç‰‡åˆ° images æ–‡ä»¶å¤¹
node download-offerings-images.js
```

**è¾“å‡º**ï¼š
- `images/` æ–‡ä»¶å¤¹ï¼šåŒ…å« 541 ä¸ªå›¾ç‰‡æ–‡ä»¶
- `image-map.json`ï¼šä¾›å¥‰å“åç§°åˆ°å›¾ç‰‡æ–‡ä»¶åçš„æ˜ å°„

**é¢„è®¡æ—¶é—´**: 5-10 åˆ†é’Ÿï¼ˆå–å†³äºç½‘ç»œé€Ÿåº¦ï¼‰

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ å›¾ç‰‡åˆ° IPFSï¼ˆå¯é€‰ï¼‰

```bash
# ç¡®ä¿ IPFS èŠ‚ç‚¹è¿è¡Œä¸­
ipfs daemon &

# å®‰è£… IPFS å®¢æˆ·ç«¯ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
npm install ipfs-http-client

# ä¸Šä¼ æ‰€æœ‰å›¾ç‰‡åˆ° IPFS
node upload-images-to-ipfs.js
```

**è¾“å‡º**ï¼š
- `ipfs-cid-map.json`ï¼šå›¾ç‰‡æ–‡ä»¶ååˆ° IPFS CID çš„æ˜ å°„
- `offering-cid-map.json`ï¼šä¾›å¥‰å“åç§°åˆ° IPFS CID çš„æ˜ å°„

**é¢„è®¡æ—¶é—´**: 10-20 åˆ†é’Ÿï¼ˆå–å†³äº IPFS èŠ‚ç‚¹æ€§èƒ½ï¼‰

### ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–é“¾ç«¯ç¥­ç¥€å“

```bash
# ç¡®ä¿é“¾å·²å¯åŠ¨
./target/release/node-template --dev &

# å®‰è£… Polkadot.js ä¾èµ–ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
npm install @polkadot/api @polkadot/util-crypto

# è¿è¡Œåˆå§‹åŒ–è„šæœ¬
node init-sacrifices.js
```

**è¾“å‡º**ï¼š
- é“¾ä¸Šåˆ›å»º 500+ ä¸ªç¥­ç¥€å“è®°å½•
- æ¯ä¸ªç¥­ç¥€å“åŒ…å«ï¼šåç§°ã€èµ„æºURLã€æè¿°ã€ä»·æ ¼ã€åœºæ™¯ã€ç±»ç›®

**é¢„è®¡æ—¶é—´**: 20-30 åˆ†é’Ÿï¼ˆå–å†³äºé“¾æ€§èƒ½ï¼‰

### ç¬¬å››æ­¥ï¼šå‰ç«¯é…ç½®ï¼ˆå¯é€‰ï¼‰

```bash
# å‰ç«¯é…ç½®æ–‡ä»¶å·²è‡ªåŠ¨ç”Ÿæˆ
cat stardust-dapp/src/config/offerings-config.ts

# åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
import { FEATURED_OFFERINGS, CATEGORIES } from '@/config/offerings-config';
```

---

## è„šæœ¬è¯¦è§£

### 1. `download-offerings-images.js`

**åŠŸèƒ½**ï¼šä»äº‘ä¸Šæ€å¿µç½‘ç«™ä¸‹è½½æ‰€æœ‰ä¾›å¥‰å“å›¾ç‰‡

**å‚æ•°**ï¼šæ— éœ€é…ç½®ï¼Œè‡ªåŠ¨ä» `offerings-with-images.json` è¯»å–

**å¹¶å‘æ§åˆ¶**ï¼š5 ä¸ªå¹¶å‘è¯·æ±‚ï¼ˆå¯ä¿®æ”¹ `concurrency` å˜é‡ï¼‰

**é”™è¯¯å¤„ç†**ï¼š
- è‡ªåŠ¨è·³è¿‡å·²ä¸‹è½½çš„æ–‡ä»¶
- å¤±è´¥çš„å›¾ç‰‡ä¼šè®°å½•é”™è¯¯ï¼Œä¸ä¼šä¸­æ–­è„šæœ¬
- ç”ŸæˆæˆåŠŸ/å¤±è´¥ç»Ÿè®¡æŠ¥å‘Š

**è¾“å‡ºæ–‡ä»¶**ï¼š
```
scripts/images/          # å›¾ç‰‡æ–‡ä»¶å¤¹
scripts/image-map.json   # æ˜ å°„æ–‡ä»¶
```

### 2. `upload-images-to-ipfs.js`

**åŠŸèƒ½**ï¼šå°†ä¸‹è½½çš„å›¾ç‰‡ä¸Šä¼ åˆ° IPFSï¼Œç”Ÿæˆ CID æ˜ å°„

**å‰ç½®æ¡ä»¶**ï¼š
- IPFS èŠ‚ç‚¹å¿…é¡»è¿è¡Œ
- `images/` æ–‡ä»¶å¤¹å¿…é¡»å­˜åœ¨
- `image-map.json` å¿…é¡»å­˜åœ¨

**é…ç½®**ï¼š
```javascript
const ipfs = create({
  host: 'localhost',    // IPFS èŠ‚ç‚¹åœ°å€
  port: 5001,           // IPFS API ç«¯å£
  protocol: 'http'
});
```

**Pin ç­–ç•¥**ï¼šæ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶éƒ½ä¼šè‡ªåŠ¨ pinï¼ˆå›ºå®šï¼‰

**è¾“å‡ºæ–‡ä»¶**ï¼š
```
scripts/ipfs-cid-map.json        # æ–‡ä»¶å -> CID
scripts/offering-cid-map.json    # ä¾›å¥‰å“åç§° -> CID
```

### 3. `init-sacrifices.js`

**åŠŸèƒ½**ï¼šåœ¨é“¾ç«¯åˆ›å»ºæ‰€æœ‰ç¥­ç¥€å“è®°å½•

**å‰ç½®æ¡ä»¶**ï¼š
- é“¾å¿…é¡»è¿è¡Œï¼ˆé»˜è®¤ `ws://127.0.0.1:9944`ï¼‰
- ç®¡ç†å‘˜è´¦æˆ·æœ‰è¶³å¤Ÿä½™é¢ï¼ˆé»˜è®¤ä½¿ç”¨ Aliceï¼‰

**å®šä»·ç­–ç•¥**ï¼š
- å…è´¹ä¾›å“ï¼ˆprice = 0ï¼‰ï¼š`fixed_price = 0`
- æ™®é€šä¾›å“ï¼ˆ0 < price < 10ï¼‰ï¼š`fixed_price = price * 1 DUST`
- é«˜ä»·ä¾›å“ï¼ˆprice >= 10ï¼‰ï¼š`unit_price_per_week = price * 1 DUST`ï¼ŒVIP ä¸“å±

**åœºæ™¯æ˜ å°„**ï¼š
- æ‰€æœ‰ä¾›å¥‰å“é»˜è®¤ä½¿ç”¨ `Memorial`ï¼ˆçºªå¿µé¦†ï¼‰åœºæ™¯

**ç±»ç›®æ˜ å°„**ï¼š
```javascript
const CATEGORY_MAP = {
  'xiangzhu': 1,      // é¦™çƒ› -> Candle
  'huaguo': 0,        // èŠ±æœ -> Flower
  'jiucai': 2,        // é…’èœ -> Food
  'wanjuchongwu': 3,  // ç©å…·å® ç‰© -> Toy
  // å…¶ä»– -> Other (4)
};
```

**æ‰¹é‡å¤„ç†**ï¼šä¸€æ¬¡å¤„ç†ä¸€ä¸ªä¾›å“ï¼Œç¡®ä¿äº‹åŠ¡é¡ºåºæ€§

**è¾“å‡º**ï¼š
- é“¾ä¸Šç¥­ç¥€å“è®°å½•
- æ§åˆ¶å°ç»Ÿè®¡æŠ¥å‘Š

---

## æ•°æ®ç»“æ„

### offerings-with-images.json

```json
{
  "total": 541,
  "offerings": [
    {
      "index": 34,
      "name": "èœ¡çƒ›",
      "price": "0",
      "imageUrl": "http://static.yunmuyuan.net//ymy/uploads/20220831/875fbd27520af04c3065e786113cb72b.png",
      "alt": ""
    },
    ...
  ]
}
```

### image-map.json

```json
{
  "èœ¡çƒ›": "875fbd27520af04c3065e786113cb72b.png",
  "é²œèŠ±": "b250937060ffb06b7fa1660d62cd8c96.png",
  ...
}
```

### ipfs-cid-map.json

```json
{
  "875fbd27520af04c3065e786113cb72b.png": "QmXxx...abc",
  "b250937060ffb06b7fa1660d62cd8c96.png": "QmYyy...def",
  ...
}
```

### offering-cid-map.json

```json
{
  "èœ¡çƒ›": "QmXxx...abc",
  "é²œèŠ±": "QmYyy...def",
  ...
}
```

---

## å¸¸è§é—®é¢˜

### Q1: å›¾ç‰‡ä¸‹è½½å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: å›¾ç‰‡ä¸‹è½½è„šæœ¬ä¼šè‡ªåŠ¨è·³è¿‡å·²ä¸‹è½½çš„æ–‡ä»¶ï¼Œå¯ä»¥å¤šæ¬¡è¿è¡Œç›´åˆ°å…¨éƒ¨æˆåŠŸï¼š

```bash
# é‡æ–°è¿è¡Œä¸‹è½½è„šæœ¬
node download-offerings-images.js
```

### Q2: IPFS ä¸Šä¼ å¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ

**A**: å¯ä»¥è°ƒæ•´å¹¶å‘æ•°æˆ–ä½¿ç”¨ IPFS é›†ç¾¤ï¼š

```javascript
// ä¿®æ”¹ upload-images-to-ipfs.js
// æ·»åŠ æ‰¹é‡ä¸Šä¼ é€»è¾‘
const batchSize = 10;
for (let i = 0; i < files.length; i += batchSize) {
  const batch = files.slice(i, i + batchSize);
  await Promise.all(batch.map(file => uploadFile(file)));
}
```

### Q3: é“¾ç«¯åˆå§‹åŒ–äº¤æ˜“å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. é“¾èŠ‚ç‚¹æ˜¯å¦è¿è¡Œ
2. ç®¡ç†å‘˜è´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³
3. Memorial pallet æ˜¯å¦æ­£ç¡®éƒ¨ç½²
4. äº¤æ˜“å‚æ•°æ˜¯å¦æ­£ç¡®

å¯ä»¥æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š

```javascript
// init-sacrifices.js ä¼šè¾“å‡ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
// åŒ…æ‹¬ palletã€å‡½æ•°åã€é”™è¯¯æè¿°
```

### Q4: å¦‚ä½•è‡ªå®šä¹‰ä¾›å¥‰å“æ•°æ®ï¼Ÿ

**A**: ç¼–è¾‘ `offerings-with-images.json`ï¼Œç„¶åé‡æ–°è¿è¡Œåˆå§‹åŒ–è„šæœ¬ï¼š

```json
{
  "total": 542,
  "offerings": [
    {
      "index": 541,
      "name": "è‡ªå®šä¹‰ä¾›å“",
      "price": "5",
      "imageUrl": "http://example.com/image.png",
      "alt": ""
    }
  ]
}
```

### Q5: å¦‚ä½•æ›´æ–°é“¾ä¸Šçš„ç¥­ç¥€å“ï¼Ÿ

**A**: ä½¿ç”¨ Memorial pallet çš„æ›´æ–°æ¥å£ï¼š

```javascript
// æ›´æ–°ç¥­ç¥€å“ä¿¡æ¯
await api.tx.memorial.updateSacrifice(
  sacrificeId,
  newName,
  newResourceUrl,
  newDescription,
  isVipExclusive,
  fixedPrice,
  unitPricePerWeek,
  scene,
  category
).signAndSend(admin);
```

---

## æœ€ä½³å®è·µ

### 1. åˆ†æ‰¹å¤„ç†

å¯¹äºå¤§é‡æ•°æ®ï¼ˆ500+ ä¸ªä¾›å¥‰å“ï¼‰ï¼Œå»ºè®®åˆ†æ‰¹å¤„ç†ï¼š

```javascript
// æ¯æ‰¹å¤„ç† 100 ä¸ª
const BATCH_SIZE = 100;
for (let i = 0; i < offerings.length; i += BATCH_SIZE) {
  const batch = offerings.slice(i, i + BATCH_SIZE);
  await processBatch(batch);
  console.log(`å·²å¤„ç† ${i + batch.length}/${offerings.length}`);
}
```

### 2. é”™è¯¯é‡è¯•

å¯¹äºç½‘ç»œè¯·æ±‚ï¼ˆå›¾ç‰‡ä¸‹è½½ã€IPFSä¸Šä¼ ï¼‰ï¼Œæ·»åŠ é‡è¯•é€»è¾‘ï¼š

```javascript
async function retryOperation(fn, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await sleep(1000 * (i + 1)); // æŒ‡æ•°é€€é¿
    }
  }
}
```

### 3. æ•°æ®å¤‡ä»½

åœ¨è¿è¡Œè„šæœ¬å‰å¤‡ä»½æ•°æ®ï¼š

```bash
# å¤‡ä»½ä¾›å¥‰å“æ•°æ®
cp offerings-with-images.json offerings-with-images.json.bak

# å¤‡ä»½é“¾çŠ¶æ€ï¼ˆå¦‚æœéœ€è¦ï¼‰
./target/release/node-template export-state > state-backup.json
```

### 4. å¢é‡æ›´æ–°

åªæ›´æ–°å˜æ›´çš„ä¾›å¥‰å“ï¼š

```javascript
// æŸ¥è¯¢é“¾ä¸Šå·²æœ‰çš„ç¥­ç¥€å“
const existingSacrifices = await api.query.memorial.sacrificeOf.entries();

// å¯¹æ¯”å·®å¼‚ï¼Œåªåˆ›å»ºæ–°å¢çš„
const newOfferings = offerings.filter(item => 
  !existingSacrifices.some(([key, value]) => 
    value.unwrap().name.toUtf8() === item.name
  )
);
```

### 5. ç›‘æ§å’Œæ—¥å¿—

æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼š

```javascript
const fs = require('fs');
const logFile = 'init-log-' + Date.now() + '.txt';

function log(message) {
  const timestamp = new Date().toISOString();
  const logMessage = `[${timestamp}] ${message}\n`;
  fs.appendFileSync(logFile, logMessage);
  console.log(message);
}
```

---

## é™„å½•

### A. ä¾èµ–åŒ…åˆ—è¡¨

```json
{
  "dependencies": {
    "@polkadot/api": "^10.9.1",
    "@polkadot/util-crypto": "^12.3.2",
    "ipfs-http-client": "^60.0.1"
  }
}
```

### B. å®Œæ•´å‘½ä»¤æµç¨‹

```bash
# 1. å…‹éš†é¡¹ç›®
cd /home/xiaodong/æ–‡æ¡£/stardust

# 2. å®‰è£…ä¾èµ–
cd scripts
npm install

# 3. ä¸‹è½½å›¾ç‰‡
node download-offerings-images.js

# 4. å¯åŠ¨ IPFSï¼ˆå¯é€‰ï¼‰
ipfs daemon &

# 5. ä¸Šä¼ åˆ° IPFSï¼ˆå¯é€‰ï¼‰
node upload-images-to-ipfs.js

# 6. å¯åŠ¨é“¾
cd ..
./target/release/node-template --dev &

# 7. åˆå§‹åŒ–ç¥­ç¥€å“
cd scripts
node init-sacrifices.js

# 8. æŸ¥çœ‹ç»“æœ
# æµè§ˆå™¨æ‰“å¼€ Polkadot.js Apps
# https://polkadot.js.org/apps/?rpc=ws://127.0.0.1:9944
```

### C. ç›¸å…³æ–‡æ¡£é“¾æ¥

- [Memorial Pallet README](/home/xiaodong/æ–‡æ¡£/stardust/pallets/memorial/README.md)
- [å‰ç«¯ä¾›å¥‰ç»„ä»¶](/home/xiaodong/æ–‡æ¡£/stardust/stardust-dapp/src/components/offering/)
- [IPFS æ–‡æ¡£](https://docs.ipfs.tech/)
- [Polkadot.js API æ–‡æ¡£](https://polkadot.js.org/docs/)

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- **é¡¹ç›®ä»“åº“**: `/home/xiaodong/æ–‡æ¡£/stardust/`
- **å¼€å‘å›¢é˜Ÿ**: Stardust Team
- **æœ€åæ›´æ–°**: 2025-11-08

---

**ğŸŒŸ ç¥åˆå§‹åŒ–é¡ºåˆ©ï¼**

