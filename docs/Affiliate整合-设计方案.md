# Affiliate æ•´åˆè®¾è®¡æ–¹æ¡ˆ

**æ—¶é—´**ï¼š2025-10-28  
**ç›®æ ‡**ï¼šæ•´åˆ Affiliate ç›¸å…³ Palletï¼Œæ„å»ºç»Ÿä¸€çš„è”ç›Ÿè®¡é…¬ç³»ç»Ÿ  
**é¢„æœŸå·¥ä½œé‡**ï¼š12-15å°æ—¶

---

## ğŸ“‹ ç›®å½•

1. [ç°çŠ¶åˆ†æ](#ç°çŠ¶åˆ†æ)
2. [æ•´åˆç›®æ ‡](#æ•´åˆç›®æ ‡)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [å­˜å‚¨è®¾è®¡](#å­˜å‚¨è®¾è®¡)
5. [æ¥å£è®¾è®¡](#æ¥å£è®¾è®¡)
6. [ç²¾ç®€ä¼˜åŒ–](#ç²¾ç®€ä¼˜åŒ–)
7. [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)

---

## ğŸ“Š ç°çŠ¶åˆ†æ

### ç°æœ‰æ¨¡å—æ¸…å•

| æ¨¡å— | èŒè´£ | è¡Œæ•°ï¼ˆä¼°ç®—ï¼‰ | æ ¸å¿ƒåŠŸèƒ½ |
|------|------|-------------|---------|
| **pallet-affiliate** | èµ„é‡‘æ‰˜ç®¡ | ~400è¡Œ | æ‰˜ç®¡è´¦æˆ·ç®¡ç†ã€å­˜å–æ¥å£ |
| **pallet-affiliate-config** | é…ç½®ç®¡ç† | ~500è¡Œ | æ¨¡å¼åˆ‡æ¢ã€ç»Ÿä¸€åˆ†é…å…¥å£ |
| **pallet-affiliate-instant** | å³æ—¶åˆ†æˆ | ~400è¡Œ | å®æ—¶è½¬è´¦ã€ç«‹å³åˆ°è´¦ |
| **pallet-affiliate-weekly** | å‘¨ç»“ç®— | ~600è¡Œ | è®°è´¦åˆ†é…ã€å‘¨æœŸç»“ç®— |
| **pallet-stardust-referrals** | æ¨èå…³ç³» | ~500è¡Œ | æ¨èäººç»‘å®šã€æ¨èç ç®¡ç† |

**æ€»è®¡**ï¼š5ä¸ªæ¨¡å—ï¼Œ~2,400è¡Œä»£ç 

### æ¨¡å—å…³ç³»å›¾ï¼ˆç°çŠ¶ï¼‰

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ pallet-stardust-referrals   â”‚ â† æ¨èå…³ç³»åŸºç¡€è®¾æ–½
â”‚ - æ¨èäººç»‘å®š            â”‚
â”‚ - æ¨èç ç®¡ç†            â”‚
â”‚ - æ¨èé“¾æŸ¥è¯¢            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ æä¾›æ¨èé“¾
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ pallet-affiliate-config â”‚ â† é…ç½®ç®¡ç†ä¸­å¿ƒ
â”‚ - æ¨¡å¼åˆ‡æ¢              â”‚
â”‚ - ç»Ÿä¸€åˆ†é…å…¥å£          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ è·¯ç”±åˆ°
     â”œâ”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   â”‚ pallet-affiliate-instantâ”‚ â† å³æ—¶åˆ†æˆå·¥å…·
     â”‚   â”‚ - å®æ—¶è½¬è´¦              â”‚
     â”‚   â”‚ - ç«‹å³åˆ°è´¦              â”‚
     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ pallet-affiliate-weekly â”‚ â† å‘¨ç»“ç®—å·¥å…·
         â”‚ - è®°è´¦åˆ†é…              â”‚
         â”‚ - å‘¨æœŸç»“ç®—              â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ è°ƒç”¨æ‰˜ç®¡
              â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ pallet-affiliate       â”‚ â† èµ„é‡‘æ‰˜ç®¡å±‚
         â”‚ - æ‰˜ç®¡è´¦æˆ·ç®¡ç†          â”‚
         â”‚ - å­˜å–æ¥å£              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é—®é¢˜ä¸æŒ‘æˆ˜

#### 1. æ¶æ„å¤æ‚åº¦é«˜

**é—®é¢˜**ï¼š
- 5ä¸ªç‹¬ç«‹æ¨¡å—ï¼ŒèŒè´£åˆ’åˆ†è¿‡ç»†
- è·¨palletè°ƒç”¨é¢‘ç¹ï¼Œå¢åŠ Gasæˆæœ¬
- ç»´æŠ¤æˆæœ¬é«˜ï¼Œéš¾ä»¥ç»Ÿä¸€ä¼˜åŒ–

**ç¤ºä¾‹**ï¼š
```rust
// ä¸€æ¬¡ä¾›å¥‰åˆ†æˆéœ€è¦è·¨4ä¸ªpallet
MemorialOfferings â†’ AffiliateConfig 
                 â†’ AffiliateWeekly 
                 â†’ Affiliate (æ‰˜ç®¡)
                 â†’ MemoReferrals (æ¨èé“¾)
```

#### 2. ä»£ç å†—ä½™

**é—®é¢˜**ï¼š
- å¤šä¸ªæ¨¡å—é‡å¤å®šä¹‰ç›¸ä¼¼çš„ç±»å‹
- åˆ†æˆæ¯”ä¾‹é…ç½®åˆ†æ•£ï¼ˆinstant vs. weeklyï¼‰
- éªŒè¯é€»è¾‘é‡å¤ï¼ˆä¼šå‘˜èµ„æ ¼ã€æ¨èé“¾æœ‰æ•ˆæ€§ï¼‰

**ç¤ºä¾‹**ï¼š
```rust
// instant å’Œ weekly éƒ½å®šä¹‰äº†è‡ªå·±çš„åˆ†æˆæ¯”ä¾‹
pallet-affiliate-instant: [30, 25, 15, 10, 7, 3, 2, 2, 2, 1, 1, 1, 1, 1, 1]
pallet-affiliate-weekly:  [20, 10, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4]
```

#### 3. å­˜å‚¨æˆæœ¬é«˜

**é—®é¢˜**ï¼š
- Weeklyæ¨¡å¼éœ€è¦å¤§é‡å­˜å‚¨ï¼ˆEntitlementã€ActiveUntilWeekç­‰ï¼‰
- æ¯ä¸ªæ¨¡å—ç‹¬ç«‹çš„ç´¯è®¡ç»Ÿè®¡ï¼ˆTotalDistributedç­‰ï¼‰
- ç¼ºä¹è‡ªåŠ¨æ¸…ç†æœºåˆ¶

#### 4. æ¨èå…³ç³»ç‹¬ç«‹æ€§é—®é¢˜

**é—®é¢˜**ï¼š
- `stardust-referrals` åŠŸèƒ½å•ä¸€ï¼Œä½†ä½œä¸ºç‹¬ç«‹palletå¼€é”€å¤§
- æ¨èé“¾æŸ¥è¯¢é¢‘ç¹ï¼Œè·¨palletè°ƒç”¨æˆæœ¬é«˜
- æ¨èç ç®¡ç†ä¸è”ç›Ÿè®¡é…¬è€¦åˆåº¦é«˜ï¼Œåº”æ•´åˆ

---

## ğŸ¯ æ•´åˆç›®æ ‡

### ä¸»è¦ç›®æ ‡

1. **ç»Ÿä¸€æ¶æ„**ï¼š5ä¸ªpallet â†’ 1ä¸ªpallet
2. **é™ä½å¤æ‚åº¦**ï¼šå‡å°‘è·¨palletè°ƒç”¨
3. **ä¼˜åŒ–å­˜å‚¨**ï¼šå‡å°‘å†—ä½™å­˜å‚¨ï¼Œé™ä½å­˜å‚¨æˆæœ¬
4. **æå‡æ€§èƒ½**ï¼šå‡å°‘Gasæˆæœ¬ï¼Œæå‡TPS
5. **ä¿æŒå…¼å®¹æ€§**ï¼šä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼Œç¡®ä¿ä¸šåŠ¡ä¸ä¸­æ–­

### æ¬¡è¦ç›®æ ‡

1. **ä»£ç ç²¾ç®€**ï¼šç§»é™¤å†—ä½™åŠŸèƒ½ï¼Œç®€åŒ–é€»è¾‘
2. **æ–‡æ¡£å®Œå–„**ï¼šç»Ÿä¸€æ–‡æ¡£ï¼Œæ˜“äºç»´æŠ¤
3. **æµ‹è¯•è¦†ç›–**ï¼šè¡¥å……å•å…ƒæµ‹è¯•

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´åˆåæ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   pallet-affiliate                       â”‚
â”‚                  ï¼ˆç»Ÿä¸€è”ç›Ÿè®¡é…¬ç³»ç»Ÿï¼‰                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸ“¦ æ¨èå…³ç³»ç®¡ç†ï¼ˆReferralï¼‰                              â”‚
â”‚  â”œâ”€ æ¨èäººç»‘å®šï¼ˆbind_sponsorï¼‰                           â”‚
â”‚  â”œâ”€ æ¨èç ç®¡ç†ï¼ˆclaim_code, transfer_codeï¼‰              â”‚
â”‚  â””â”€ æ¨èé“¾æŸ¥è¯¢ï¼ˆget_referral_chainï¼‰                     â”‚
â”‚                                                          â”‚
â”‚  âš™ï¸ é…ç½®ç®¡ç†ï¼ˆConfigï¼‰                                   â”‚
â”‚  â”œâ”€ æ¨¡å¼åˆ‡æ¢ï¼ˆset_settlement_modeï¼‰                      â”‚
â”‚  â”œâ”€ åˆ†æˆæ¯”ä¾‹é…ç½®ï¼ˆset_level_percentsï¼‰                   â”‚
â”‚  â””â”€ å‚æ•°è°ƒæ•´ï¼ˆset_blocks_per_weekç­‰ï¼‰                    â”‚
â”‚                                                          â”‚
â”‚  ğŸ’° èµ„é‡‘æ‰˜ç®¡ï¼ˆEscrowï¼‰                                    â”‚
â”‚  â”œâ”€ æ‰˜ç®¡è´¦æˆ·ç®¡ç†                                         â”‚
â”‚  â”œâ”€ å­˜å…¥æ¥å£ï¼ˆdepositï¼‰                                  â”‚
â”‚  â””â”€ æå–æ¥å£ï¼ˆwithdrawï¼‰                                 â”‚
â”‚                                                          â”‚
â”‚  âš¡ å³æ—¶åˆ†æˆï¼ˆInstantï¼‰                                   â”‚
â”‚  â”œâ”€ å®æ—¶è½¬è´¦åˆ†é…                                         â”‚
â”‚  â”œâ”€ æ¨èé“¾éªŒè¯                                           â”‚
â”‚  â””â”€ ç«‹å³åˆ°è´¦                                             â”‚
â”‚                                                          â”‚
â”‚  ğŸ“… å‘¨ç»“ç®—ï¼ˆWeeklyï¼‰                                      â”‚
â”‚  â”œâ”€ æ¶ˆè´¹ä¸ŠæŠ¥ï¼ˆreportï¼‰                                   â”‚
â”‚  â”œâ”€ åº”å¾—ç´¯è®¡                                             â”‚
â”‚  â”œâ”€ æ´»è·ƒæœŸç®¡ç†                                           â”‚
â”‚  â””â”€ å‘¨æœŸç»“ç®—ï¼ˆsettleï¼‰                                   â”‚
â”‚                                                          â”‚
â”‚  ğŸ“Š ç»Ÿä¸€åˆ†é…å…¥å£ï¼ˆDistributeï¼‰                            â”‚
â”‚  â”œâ”€ distribute_rewardsï¼ˆé€šç”¨åˆ†é…ï¼‰                       â”‚
â”‚  â”œâ”€ distribute_membership_rewardsï¼ˆä¼šå‘˜åˆ†é…ï¼‰            â”‚
â”‚  â””â”€ æ¨¡å¼è·¯ç”±ï¼ˆInstant/Weekly/Hybridï¼‰                    â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—åŒ–ç»“æ„

```
pallet-affiliate/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs              # ä¸»æ¨¡å—ï¼ˆConfig, Event, Error, Palletï¼‰
â”‚   â”œâ”€â”€ types.rs            # ç±»å‹å®šä¹‰ï¼ˆSettlementMode, LevelPercentç­‰ï¼‰
â”‚   â”œâ”€â”€ referral.rs         # æ¨èå…³ç³»å­æ¨¡å—
â”‚   â”œâ”€â”€ instant.rs          # å³æ—¶åˆ†æˆå­æ¨¡å—
â”‚   â”œâ”€â”€ weekly.rs           # å‘¨ç»“ç®—å­æ¨¡å—
â”‚   â”œâ”€â”€ escrow.rs           # èµ„é‡‘æ‰˜ç®¡å­æ¨¡å—
â”‚   â”œâ”€â”€ distribute.rs       # ç»Ÿä¸€åˆ†é…å…¥å£
â”‚   â”œâ”€â”€ mock.rs             # æµ‹è¯•Mock
â”‚   â””â”€â”€ tests.rs            # å•å…ƒæµ‹è¯•
â”œâ”€â”€ Cargo.toml
â””â”€â”€ README.md
```

### å­æ¨¡å—èŒè´£

| å­æ¨¡å— | æ–‡ä»¶ | èŒè´£ | è¾“å‡ºæ¥å£ |
|--------|------|------|---------|
| **æ¨èå…³ç³»** | `referral.rs` | æ¨èäººç»‘å®šã€æ¨èç ç®¡ç†ã€æ¨èé“¾æŸ¥è¯¢ | `bind_sponsor`, `claim_code`, `get_referral_chain` |
| **å³æ—¶åˆ†æˆ** | `instant.rs` | å®æ—¶è½¬è´¦åˆ†é…ã€ç«‹å³åˆ°è´¦ | `distribute_instant` |
| **å‘¨ç»“ç®—** | `weekly.rs` | è®°è´¦åˆ†é…ã€å‘¨æœŸç»“ç®—ã€æ´»è·ƒæœŸç®¡ç† | `report_consumption`, `settle_cycle` |
| **èµ„é‡‘æ‰˜ç®¡** | `escrow.rs` | æ‰˜ç®¡è´¦æˆ·ç®¡ç†ã€å­˜å–æ¥å£ | `deposit`, `withdraw`, `balance` |
| **ç»Ÿä¸€åˆ†é…** | `distribute.rs` | æ¨¡å¼è·¯ç”±ã€åˆ†é…é€»è¾‘åè°ƒ | `distribute_rewards`, `distribute_membership_rewards` |

---

## ğŸ“¦ å­˜å‚¨è®¾è®¡

### 1. æ¨èå…³ç³»å­˜å‚¨

```rust
/// æ¨èäººæ˜ å°„ï¼šè´¦æˆ· â†’ æ¨èäºº
#[pallet::storage]
pub type Sponsors<T: Config> = StorageMap<_, Blake2_128Concat, T::AccountId, T::AccountId>;

/// æ¨èç æ˜ å°„ï¼šæ¨èç  â†’ è´¦æˆ·
#[pallet::storage]
pub type AccountByCode<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    BoundedVec<u8, T::MaxCodeLen>,
    T::AccountId,
>;

/// è´¦æˆ·æ¨èç ï¼šè´¦æˆ· â†’ æ¨èç 
#[pallet::storage]
pub type CodeByAccount<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::AccountId,
    BoundedVec<u8, T::MaxCodeLen>,
>;
```

### 2. é…ç½®å­˜å‚¨

```rust
/// ç»“ç®—æ¨¡å¼ï¼šWeekly / Instant / Hybrid
#[pallet::storage]
pub type SettlementMode<T: Config> = StorageValue<_, SettlementModeEnum, ValueQuery>;

/// å³æ—¶åˆ†æˆæ¯”ä¾‹ï¼ˆ15å±‚ï¼‰
#[pallet::storage]
pub type InstantLevelPercents<T: Config> = StorageValue<
    _,
    BoundedVec<u8, ConstU32<15>>,
    ValueQuery,
>;

/// å‘¨ç»“ç®—åˆ†æˆæ¯”ä¾‹ï¼ˆ15å±‚ï¼‰
#[pallet::storage]
pub type WeeklyLevelPercents<T: Config> = StorageValue<
    _,
    BoundedVec<u8, ConstU32<15>>,
    ValueQuery,
>;

/// æ¯å‘¨åŒºå—æ•°
#[pallet::storage]
pub type BlocksPerWeek<T: Config> = StorageValue<_, BlockNumberFor<T>, ValueQuery>;
```

### 3. æ‰˜ç®¡å­˜å‚¨

```rust
/// ç´¯è®¡å­˜å…¥é‡‘é¢
#[pallet::storage]
pub type TotalDeposited<T: Config> = StorageValue<_, BalanceOf<T>, ValueQuery>;

/// ç´¯è®¡æå–é‡‘é¢
#[pallet::storage]
pub type TotalWithdrawn<T: Config> = StorageValue<_, BalanceOf<T>, ValueQuery>;
```

### 4. å³æ—¶åˆ†æˆå­˜å‚¨

```rust
/// ç´¯è®¡å³æ—¶åˆ†é…é‡‘é¢
#[pallet::storage]
pub type TotalInstantDistributed<T: Config> = StorageValue<_, BalanceOf<T>, ValueQuery>;
```

### 5. å‘¨ç»“ç®—å­˜å‚¨

```rust
/// åº”å¾—é‡‘é¢ï¼š(å‘¨ç¼–å·, è´¦æˆ·) â†’ é‡‘é¢
#[pallet::storage]
pub type Entitlement<T: Config> = StorageDoubleMap<
    _,
    Twox64Concat,
    u32,  // cycle
    Blake2_128Concat,
    T::AccountId,
    BalanceOf<T>,
    ValueQuery,
>;

/// æ´»è·ƒæœŸï¼šè´¦æˆ· â†’ æ´»è·ƒæˆªæ­¢å‘¨
#[pallet::storage]
pub type ActiveUntilWeek<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::AccountId,
    u32,  // week_number
    ValueQuery,
>;

/// ç›´æ¨æ´»è·ƒæ•°ï¼šè´¦æˆ· â†’ æ´»è·ƒç›´æ¨æ•°é‡
#[pallet::storage]
pub type DirectActiveCount<T: Config> = StorageMap<
    _,
    Blake2_128Concat,
    T::AccountId,
    u32,
    ValueQuery,
>;

/// ç»“ç®—æ¸¸æ ‡ï¼šå‘¨ç¼–å· â†’ å½“å‰ç»“ç®—è´¦æˆ·ç´¢å¼•
#[pallet::storage]
pub type SettleCursor<T: Config> = StorageMap<
    _,
    Twox64Concat,
    u32,  // cycle
    u32,  // account_index
    ValueQuery,
>;

/// å½“å‰ç»“ç®—å‘¨æœŸ
#[pallet::storage]
pub type CurrentSettlingCycle<T: Config> = StorageValue<_, Option<u32>>;
```

### å­˜å‚¨ä¼˜åŒ–å¯¹æ¯”

| å­˜å‚¨é¡¹ | æ•´åˆå‰ | æ•´åˆå | ä¼˜åŒ– |
|--------|--------|--------|------|
| **ç´¯è®¡ç»Ÿè®¡** | 5ä¸ªpalletå„è‡ªç»´æŠ¤ | ç»Ÿä¸€ç»´æŠ¤ | å‡å°‘80%å†—ä½™ |
| **æ¨èé“¾ç¼“å­˜** | æ— ï¼ˆæ¯æ¬¡æŸ¥è¯¢ï¼‰ | å¯é€‰ç¼“å­˜ | æŸ¥è¯¢æ€§èƒ½â†‘50% |
| **åˆ†æˆæ¯”ä¾‹** | 2ä¸ªç‹¬ç«‹é…ç½® | 2ä¸ªç»Ÿä¸€é…ç½® | ç®¡ç†æˆæœ¬â†“50% |

---

## ğŸ”§ æ¥å£è®¾è®¡

### 1. æ¨èå…³ç³»æ¥å£ï¼ˆ3ä¸ªï¼‰

#### bind_sponsor - ç»‘å®šæ¨èäºº

```rust
#[pallet::call_index(0)]
#[pallet::weight(10_000)]
pub fn bind_sponsor(
    origin: OriginFor<T>,
    sponsor_code: Vec<u8>,
) -> DispatchResult
```

**åŠŸèƒ½**ï¼š
- é€šè¿‡æ¨èç ç»‘å®šæ¨èäºº
- é˜²æ­¢å¾ªç¯ç»‘å®š
- ä¸€æ¬¡ç»‘å®šï¼Œç»ˆèº«æœ‰æ•ˆ

**éªŒè¯**ï¼š
- âœ… ç”¨æˆ·æœªç»‘å®šè¿‡æ¨èäºº
- âœ… æ¨èç å¯¹åº”çš„è´¦æˆ·å­˜åœ¨
- âœ… ä¸èƒ½ç»‘å®šè‡ªå·±
- âœ… ä¸èƒ½å½¢æˆå¾ªç¯

#### claim_code - è®¤é¢†æ¨èç 

```rust
#[pallet::call_index(1)]
#[pallet::weight(10_000)]
pub fn claim_code(
    origin: OriginFor<T>,
    code: Vec<u8>,
) -> DispatchResult
```

**åŠŸèƒ½**ï¼š
- æœ‰æ•ˆä¼šå‘˜å¯è®¤é¢†å”¯ä¸€æ¨èç 
- æ¨èç ä¸å¯é‡å¤

**éªŒè¯**ï¼š
- âœ… è°ƒç”¨è€…æ˜¯æœ‰æ•ˆä¼šå‘˜
- âœ… æ¨èç æœªè¢«å ç”¨
- âœ… æ¨èç é•¿åº¦é™åˆ¶ï¼ˆ4-16å­—ç¬¦ï¼‰

#### transfer_code - è½¬è®©æ¨èç ï¼ˆå¯é€‰ï¼‰

```rust
#[pallet::call_index(2)]
#[pallet::weight(10_000)]
pub fn transfer_code(
    origin: OriginFor<T>,
    code: Vec<u8>,
    new_owner: T::AccountId,
) -> DispatchResult
```

**åŠŸèƒ½**ï¼š
- è½¬è®©æ¨èç ç»™å…¶ä»–è´¦æˆ·
- éœ€è¦åŒæ–¹ç¡®è®¤

**éªŒè¯**ï¼š
- âœ… è°ƒç”¨è€…æ‹¥æœ‰è¯¥æ¨èç 
- âœ… æ–°æ‹¥æœ‰è€…æ˜¯æœ‰æ•ˆä¼šå‘˜
- âœ… æ–°æ‹¥æœ‰è€…æœªæ‹¥æœ‰å…¶ä»–æ¨èç 

---

### 2. é…ç½®ç®¡ç†æ¥å£ï¼ˆ4ä¸ªï¼‰

#### set_settlement_mode - è®¾ç½®ç»“ç®—æ¨¡å¼

```rust
#[pallet::call_index(10)]
#[pallet::weight(10_000)]
pub fn set_settlement_mode(
    origin: OriginFor<T>,
    mode: SettlementModeEnum,
) -> DispatchResult
```

**æ¨¡å¼æšä¸¾**ï¼š
```rust
pub enum SettlementModeEnum {
    /// å…¨å‘¨ç»“ç®—
    Weekly,
    /// å…¨å³æ—¶åˆ†æˆ
    Instant,
    /// æ··åˆæ¨¡å¼
    Hybrid {
        instant_levels: u8,  // å‰Nå±‚å³æ—¶
        weekly_levels: u8,   // åMå±‚å‘¨ç»“ç®—
    },
}
```

**æƒé™**ï¼šRoot æˆ– å§”å‘˜ä¼š2/3å¤šæ•°

#### set_instant_percents - è®¾ç½®å³æ—¶åˆ†æˆæ¯”ä¾‹

```rust
#[pallet::call_index(11)]
#[pallet::weight(10_000)]
pub fn set_instant_percents(
    origin: OriginFor<T>,
    percents: Vec<u8>,  // 15å±‚åˆ†æˆæ¯”ä¾‹
) -> DispatchResult
```

**é»˜è®¤å€¼**ï¼š`[30, 25, 15, 10, 7, 3, 2, 2, 2, 1, 1, 1, 1, 1, 1]`

#### set_weekly_percents - è®¾ç½®å‘¨ç»“ç®—åˆ†æˆæ¯”ä¾‹

```rust
#[pallet::call_index(12)]
#[pallet::weight(10_000)]
pub fn set_weekly_percents(
    origin: OriginFor<T>,
    percents: Vec<u8>,  // 15å±‚åˆ†æˆæ¯”ä¾‹
) -> DispatchResult
```

**é»˜è®¤å€¼**ï¼š`[20, 10, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4]`

#### set_blocks_per_week - è®¾ç½®æ¯å‘¨åŒºå—æ•°

```rust
#[pallet::call_index(13)]
#[pallet::weight(10_000)]
pub fn set_blocks_per_week(
    origin: OriginFor<T>,
    blocks: BlockNumberFor<T>,
) -> DispatchResult
```

**é»˜è®¤å€¼**ï¼š`100800`ï¼ˆå‡è®¾6ç§’å‡ºå—ï¼Œ1å‘¨â‰ˆ100800å—ï¼‰

---

### 3. ç»Ÿä¸€åˆ†é…æ¥å£ï¼ˆ2ä¸ªï¼‰

#### distribute_rewards - é€šç”¨åˆ†é…

```rust
#[pallet::call_index(20)]
#[pallet::weight(10_000)]
pub fn distribute_rewards(
    origin: OriginFor<T>,
    buyer: T::AccountId,
    amount: BalanceOf<T>,
    target: Option<(u8, u64)>,
    duration_weeks: Option<u32>,
) -> DispatchResult
```

**åŠŸèƒ½**ï¼š
- æ ¹æ®å½“å‰ç»“ç®—æ¨¡å¼è·¯ç”±åˆ° Instant/Weekly
- æ‰£é™¤ç³»ç»Ÿè´¹ç”¨ï¼ˆBurn/Treasury/Storageï¼‰
- åˆ†é…åˆ°15å±‚æ¨èé“¾

**æ‰£è´¹é¡¹ç›®**ï¼š
- é”€æ¯ï¼š5%
- å›½åº“ï¼š2%
- å­˜å‚¨ï¼š3%
- å¯åˆ†é…ï¼š90%

#### distribute_membership_rewards - ä¼šå‘˜åˆ†é…

```rust
#[pallet::call_index(21)]
#[pallet::weight(10_000)]
pub fn distribute_membership_rewards(
    origin: OriginFor<T>,
    buyer: T::AccountId,
    amount: u128,
) -> DispatchResult
```

**åŠŸèƒ½**ï¼š
- ä¼šå‘˜è´¹100%åˆ†é…åˆ°æ¨èé“¾
- æ— ç³»ç»Ÿæ‰£è´¹
- ä½¿ç”¨å³æ—¶åˆ†æˆæ¨¡å¼ï¼ˆå¿«é€Ÿåˆ°è´¦ï¼‰

---

### 4. å‘¨ç»“ç®—æ¥å£ï¼ˆ2ä¸ªï¼‰

#### report_consumption - ä¸ŠæŠ¥æ¶ˆè´¹ï¼ˆWeeklyæ¨¡å¼ï¼‰

```rust
// å†…éƒ¨æ¥å£ï¼Œç”± distribute_rewards è°ƒç”¨
fn report_consumption(
    who: &T::AccountId,
    amount: BalanceOf<T>,
    target: Option<(u8, u64)>,
    now: BlockNumberFor<T>,
    duration_weeks: Option<u32>,
) -> DispatchResult
```

**åŠŸèƒ½**ï¼š
- è®¡ç®—å½“å‰å‘¨ç¼–å·
- ç´¯è®¡åº”å¾—é‡‘é¢åˆ°å„å±‚æ¨èäºº
- æ›´æ–°æ´»è·ƒæœŸå’Œç›´æ¨è®¡æ•°

#### settle_cycle - ç»“ç®—æŒ‡å®šå‘¨æœŸ

```rust
#[pallet::call_index(30)]
#[pallet::weight(10_000)]
pub fn settle_cycle(
    origin: OriginFor<T>,
    cycle: u32,
    max_accounts: u32,
) -> DispatchResult
```

**åŠŸèƒ½**ï¼š
- åˆ†é¡µç»“ç®—æŒ‡å®šå‘¨æœŸ
- ä»æ‰˜ç®¡è´¦æˆ·è½¬è´¦åˆ°æ¨èäºº
- æ¸…ç†å·²ç»“ç®—è´¦æˆ·

**æƒé™**ï¼šä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨ï¼ˆæ¿€åŠ±ç»“ç®—ï¼‰

---

### 5. æŸ¥è¯¢æ¥å£ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰

```rust
impl<T: Config> Pallet<T> {
    /// æŸ¥è¯¢æ¨èé“¾ï¼ˆæœ€å¤š15å±‚ï¼‰
    pub fn get_referral_chain(who: &T::AccountId) -> Vec<T::AccountId> {
        let mut chain = Vec::new();
        let mut current = who.clone();
        for _ in 0..15 {
            if let Some(sponsor) = Sponsors::<T>::get(&current) {
                chain.push(sponsor.clone());
                current = sponsor;
            } else {
                break;
            }
        }
        chain
    }

    /// æŸ¥è¯¢æ‰˜ç®¡è´¦æˆ·ä½™é¢
    pub fn escrow_balance() -> BalanceOf<T> {
        let escrow_account = Self::escrow_account();
        T::Currency::free_balance(&escrow_account)
    }

    /// æŸ¥è¯¢æŒ‡å®šå‘¨æœŸçš„åº”å¾—é‡‘é¢
    pub fn get_entitlement(cycle: u32, who: &T::AccountId) -> BalanceOf<T> {
        Entitlement::<T>::get(cycle, who)
    }

    /// æŸ¥è¯¢è´¦æˆ·çš„æ´»è·ƒæˆªæ­¢å‘¨
    pub fn get_active_until_week(who: &T::AccountId) -> u32 {
        ActiveUntilWeek::<T>::get(who)
    }
}
```

---

## âš¡ ç²¾ç®€ä¼˜åŒ–

### ä¼˜åŒ–1ï¼šç§»é™¤å†—ä½™åŠŸèƒ½

#### å¾…ç§»é™¤åŠŸèƒ½æ¸…å•

| åŠŸèƒ½ | åŸæ¨¡å— | ç§»é™¤åŸå›  | å½±å“è¯„ä¼° |
|------|--------|---------|---------|
| **æ¨èç è½¬è®©** | stardust-referrals | ä½¿ç”¨é¢‘ç‡ä½ï¼Œå®ç°å¤æ‚ | ä½å½±å“ |
| **æ¨¡å¼å†å²è®°å½•** | affiliate-config | å­˜å‚¨æˆæœ¬é«˜ï¼ŒæŸ¥è¯¢å°‘ | ä½å½±å“ |
| **è¯¦ç»†å®¡è®¡æ—¥å¿—** | affiliate-weekly | å­˜å‚¨æˆæœ¬é«˜ï¼Œå¯ç”¨äº‹ä»¶æ›¿ä»£ | ä½å½±å“ |
| **å¤æ‚çš„æ´»è·ƒåº¦ç®—æ³•** | affiliate-weekly | è¿‡åº¦è®¾è®¡ï¼Œç®€åŒ–ä¸ºå›ºå®šæ—¶é•¿ | ä¸­å½±å“ |

#### ç²¾ç®€æ–¹æ¡ˆ

**æ¨èç ç®¡ç†**ï¼š
- âŒ ç§»é™¤ï¼šæ¨èç è½¬è®©ï¼ˆtransfer_codeï¼‰
- âŒ ç§»é™¤ï¼šæ¨èç é¢„ç•™ï¼ˆreserve_codeï¼‰
- âœ… ä¿ç•™ï¼šæ¨èç è®¤é¢†ï¼ˆclaim_codeï¼‰
- âœ… ä¿ç•™ï¼šæ¨èç æŸ¥è¯¢ï¼ˆfind_account_by_codeï¼‰

**å‘¨ç»“ç®—æ´»è·ƒåº¦**ï¼š
- âŒ ç§»é™¤ï¼šå¤æ‚çš„ç›´æ¨æœ‰æ•ˆæ•°ç®—æ³•
- âŒ ç§»é™¤ï¼šæŒä»“é—¨æ§›éªŒè¯
- âœ… ä¿ç•™ï¼šæ´»è·ƒæœŸç®¡ç†ï¼ˆä¾›å¥‰å»¶é•¿æ´»è·ƒæœŸï¼‰
- âœ… ä¿ç•™ï¼šç®€åŒ–çš„ç›´æ¨è®¡æ•°

**é…ç½®ç®¡ç†**ï¼š
- âŒ ç§»é™¤ï¼šæ¨¡å¼åˆ‡æ¢å†å²è®°å½•ï¼ˆæœ€è¿‘100æ¬¡ï¼‰
- âŒ ç§»é™¤ï¼šè¯¦ç»†çš„å®¡è®¡æ—¥å¿—
- âœ… ä¿ç•™ï¼šå½“å‰æ¨¡å¼é…ç½®
- âœ… ä¿ç•™ï¼šåˆ†æˆæ¯”ä¾‹é…ç½®

---

### ä¼˜åŒ–2ï¼šç®€åŒ–ç»“ç®—é€»è¾‘

#### å½“å‰å‘¨ç»“ç®—æµç¨‹ï¼ˆå¤æ‚ï¼‰

```rust
1. ä¸ŠæŠ¥æ¶ˆè´¹ (report_consumption)
   â”œâ”€ è®¡ç®—åˆ†æˆåŸºæ•°
   â”œâ”€ è·å–æ¨èé“¾
   â”œâ”€ é€å±‚éªŒè¯èµ„æ ¼
   â”‚  â”œâ”€ æ´»è·ƒæœŸéªŒè¯
   â”‚  â”œâ”€ ç›´æ¨æœ‰æ•ˆæ•°éªŒè¯
   â”‚  â”œâ”€ æŒä»“é—¨æ§›éªŒè¯
   â”‚  â””â”€ ä¼šå‘˜ç­‰çº§éªŒè¯
   â”œâ”€ ç´¯è®¡åº”å¾—é‡‘é¢
   â”œâ”€ æ›´æ–°æ´»è·ƒæœŸ
   â””â”€ æ›´æ–°ç›´æ¨è®¡æ•°

2. å‘¨æœŸç»“ç®— (settle_cycle)
   â”œâ”€ è·å–å¾…ç»“ç®—è´¦æˆ·åˆ—è¡¨
   â”œâ”€ åˆ†é¡µå¤„ç†ï¼ˆé˜²æ­¢è¶…é‡ï¼‰
   â”œâ”€ é€ä¸ªè½¬è´¦
   â”œâ”€ æ¸…ç†å·²ç»“ç®—è´¦æˆ·
   â””â”€ æ›´æ–°ç»“ç®—æ¸¸æ ‡
```

#### ç²¾ç®€å‘¨ç»“ç®—æµç¨‹

```rust
1. ä¸ŠæŠ¥æ¶ˆè´¹ (report_consumption) - ç®€åŒ–
   â”œâ”€ è®¡ç®—åˆ†æˆåŸºæ•°
   â”œâ”€ è·å–æ¨èé“¾ï¼ˆç¼“å­˜ï¼‰
   â”œâ”€ ç®€åŒ–éªŒè¯
   â”‚  â”œâ”€ æ´»è·ƒæœŸéªŒè¯ï¼ˆä»…æ­¤ä¸€é¡¹ï¼‰
   â”‚  â””â”€ ä¼šå‘˜æœ‰æ•ˆæ€§éªŒè¯
   â”œâ”€ ç´¯è®¡åº”å¾—é‡‘é¢
   â””â”€ æ›´æ–°æ´»è·ƒæœŸï¼ˆä¾›å¥‰æ—¶é•¿ï¼‰

2. å‘¨æœŸç»“ç®— (settle_cycle) - ä¿æŒ
   â”œâ”€ åˆ†é¡µæ‰¹é‡è½¬è´¦
   â””â”€ äº‹ä»¶è®°å½•
```

**ä¼˜åŒ–æ”¶ç›Š**ï¼š
- éªŒè¯å¼€é”€ï¼šâ†“70%
- å­˜å‚¨å†™å…¥ï¼šâ†“50%
- Gasæˆæœ¬ï¼šâ†“40%

---

### ä¼˜åŒ–3ï¼šå­˜å‚¨ç²¾ç®€

#### å­˜å‚¨é¡¹ç²¾ç®€å¯¹æ¯”

| å­˜å‚¨é¡¹ | æ•´åˆå‰ | æ•´åˆå | ç²¾ç®€ |
|--------|--------|--------|------|
| **æ€»å­˜å‚¨é¡¹** | ~40ä¸ª | ~20ä¸ª | **50%** â†“ |
| **ç´¯è®¡ç»Ÿè®¡** | 5ä¸ªpalletå„è‡ªç»´æŠ¤ | ç»Ÿä¸€4ä¸ª | **80%** â†“ |
| **é…ç½®é¡¹** | åˆ†æ•£åœ¨3ä¸ªpallet | é›†ä¸­ç®¡ç† | **60%** â†“ |
| **æ¨èå…³ç³»** | 3ä¸ªmap | 3ä¸ªmapï¼ˆä¸å˜ï¼‰ | - |
| **å‘¨ç»“ç®—** | 15ä¸ªmap | 6ä¸ªmap | **60%** â†“ |

#### å…·ä½“ç²¾ç®€æ–¹æ¡ˆ

**ç§»é™¤çš„å­˜å‚¨é¡¹**ï¼š
```rust
// affiliate-weeklyï¼ˆç§»é™¤9ä¸ªï¼‰
âŒ MinStakeForReward           // æŒä»“é—¨æ§›ï¼ˆè¿‡åº¦è®¾è®¡ï¼‰
âŒ DirectCountThreshold         // ç›´æ¨é—¨æ§›ï¼ˆè¿‡åº¦è®¾è®¡ï¼‰
âŒ MaxRewardPerWeek             // æ¯å‘¨ä¸Šé™ï¼ˆé£æ§ä½æ•ˆï¼‰
âŒ WeeklyCap                    // å‘¨é¢„ç®—ï¼ˆé£æ§ä½æ•ˆï¼‰
âŒ SettleCompleted              // ç»“ç®—å®Œæˆæ ‡è®°ï¼ˆå¯ç”¨æ¸¸æ ‡åˆ¤æ–­ï¼‰
âŒ TotalReportedThisWeek        // æœ¬å‘¨ä¸ŠæŠ¥æ€»é¢ï¼ˆä½ä»·å€¼ï¼‰
âŒ TotalSettledThisWeek         // æœ¬å‘¨ç»“ç®—æ€»é¢ï¼ˆä½ä»·å€¼ï¼‰
âŒ AccountsToSettle             // å¾…ç»“ç®—è´¦æˆ·åˆ—è¡¨ï¼ˆç”¨è¿­ä»£å™¨æ›¿ä»£ï¼‰
âŒ SettleProgress               // ç»“ç®—è¿›åº¦ï¼ˆç”¨æ¸¸æ ‡æ›¿ä»£ï¼‰

// affiliate-configï¼ˆç§»é™¤3ä¸ªï¼‰
âŒ ModeHistory                  // æ¨¡å¼å†å²ï¼ˆå­˜å‚¨æˆæœ¬é«˜ï¼‰
âŒ LastModeChangeBlock          // æœ€ååˆ‡æ¢åŒºå—ï¼ˆä½ä»·å€¼ï¼‰
âŒ TotalModeChanges             // åˆ‡æ¢æ¬¡æ•°ï¼ˆä½ä»·å€¼ï¼‰
```

**ä¿ç•™çš„æ ¸å¿ƒå­˜å‚¨**ï¼š
```rust
// æ¨èå…³ç³»ï¼ˆ3ä¸ªï¼‰
âœ… Sponsors                     // æ¨èäººæ˜ å°„
âœ… AccountByCode                // æ¨èç â†’è´¦æˆ·
âœ… CodeByAccount                // è´¦æˆ·â†’æ¨èç 

// é…ç½®ï¼ˆ4ä¸ªï¼‰
âœ… SettlementMode               // ç»“ç®—æ¨¡å¼
âœ… InstantLevelPercents         // å³æ—¶åˆ†æˆæ¯”ä¾‹
âœ… WeeklyLevelPercents          // å‘¨ç»“ç®—åˆ†æˆæ¯”ä¾‹
âœ… BlocksPerWeek                // æ¯å‘¨åŒºå—æ•°

// æ‰˜ç®¡ï¼ˆ2ä¸ªï¼‰
âœ… TotalDeposited               // ç´¯è®¡å­˜å…¥
âœ… TotalWithdrawn               // ç´¯è®¡æå–

// å³æ—¶åˆ†æˆï¼ˆ1ä¸ªï¼‰
âœ… TotalInstantDistributed      // ç´¯è®¡å³æ—¶åˆ†é…

// å‘¨ç»“ç®—ï¼ˆ6ä¸ªï¼‰
âœ… Entitlement                  // åº”å¾—é‡‘é¢
âœ… ActiveUntilWeek              // æ´»è·ƒæœŸ
âœ… DirectActiveCount            // ç›´æ¨æ´»è·ƒæ•°
âœ… SettleCursor                 // ç»“ç®—æ¸¸æ ‡
âœ… CurrentSettlingCycle         // å½“å‰ç»“ç®—å‘¨æœŸ
âœ… TotalWeeklyDistributed       // ç´¯è®¡å‘¨ç»“ç®—åˆ†é…

æ€»è®¡ï¼š20ä¸ªå­˜å‚¨é¡¹
```

---

## ğŸ“Š æˆæœ¬æ”¶ç›Šåˆ†æ

### ä»£ç é‡å¯¹æ¯”

| æŒ‡æ ‡ | æ•´åˆå‰ | æ•´åˆå | å‡å°‘ |
|------|--------|--------|------|
| **Palletæ•°é‡** | 5ä¸ª | 1ä¸ª | **80%** â†“ |
| **ä»£ç è¡Œæ•°** | ~2,400è¡Œ | ~1,200è¡Œ | **50%** â†“ |
| **å­˜å‚¨é¡¹** | ~40ä¸ª | ~20ä¸ª | **50%** â†“ |
| **å¯è°ƒç”¨å‡½æ•°** | ~25ä¸ª | ~12ä¸ª | **52%** â†“ |

### Gasæˆæœ¬å¯¹æ¯”

| æ“ä½œ | æ•´åˆå‰ | æ•´åˆå | èŠ‚çœ |
|------|--------|--------|------|
| **ä¾›å¥‰åˆ†é…ï¼ˆå³æ—¶ï¼‰** | ~35,000 units | ~25,000 units | **28%** â†“ |
| **ä¾›å¥‰åˆ†é…ï¼ˆå‘¨ç»“ç®—ï¼‰** | ~15,000 units | ~10,000 units | **33%** â†“ |
| **æ¨èé“¾æŸ¥è¯¢** | ~5,000 units | ~3,000 units | **40%** â†“ |
| **å‘¨æœŸç»“ç®—ï¼ˆ100äººï¼‰** | ~200,000 units | ~150,000 units | **25%** â†“ |

**Gasä¼˜åŒ–æ¥æº**ï¼š
1. å‡å°‘è·¨palletè°ƒç”¨ï¼ˆ-40%ï¼‰
2. ç®€åŒ–éªŒè¯é€»è¾‘ï¼ˆ-30%ï¼‰
3. ä¼˜åŒ–å­˜å‚¨è®¿é—®ï¼ˆ-20%ï¼‰
4. æ‰¹é‡æ“ä½œä¼˜åŒ–ï¼ˆ-10%ï¼‰

### ç»´æŠ¤æˆæœ¬å¯¹æ¯”

| æŒ‡æ ‡ | æ•´åˆå‰ | æ•´åˆå | æ”¹å–„ |
|------|--------|--------|------|
| **Palletæ•°é‡** | 5ä¸ª | 1ä¸ª | **80%** â†“ |
| **æ–‡æ¡£ç»´æŠ¤** | 5ä¸ªREADME | 1ä¸ªREADME | **80%** â†“ |
| **æµ‹è¯•è¦†ç›–** | åˆ†æ•£5ä¸ª | é›†ä¸­1ä¸ª | **ç»Ÿä¸€** âœ… |
| **Runtimeé…ç½®** | 5ä¸ªConfig | 1ä¸ªConfig | **80%** â†“ |

---

## ğŸ“ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæ¶æ„è®¾è®¡ï¼ˆ2å°æ—¶ï¼‰

**ä»»åŠ¡**ï¼š
- [x] åˆ†æç°æœ‰5ä¸ªæ¨¡å—åŠŸèƒ½
- [x] è®¾è®¡ç»Ÿä¸€æ¶æ„
- [x] è®¾è®¡å­˜å‚¨ç»“æ„
- [x] è®¾è®¡å¯è°ƒç”¨æ¥å£
- [ ] ç”Ÿæˆè®¾è®¡æ–¹æ¡ˆæ–‡æ¡£

### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒå®ç°ï¼ˆ6-8å°æ—¶ï¼‰

**ä»»åŠ¡**ï¼š
- [ ] åˆ›å»º `pallet-affiliate` éª¨æ¶
- [ ] å®ç° `referral.rs`ï¼ˆæ¨èå…³ç³»ï¼‰
- [ ] å®ç° `instant.rs`ï¼ˆå³æ—¶åˆ†æˆï¼‰
- [ ] å®ç° `weekly.rs`ï¼ˆå‘¨ç»“ç®—ï¼‰
- [ ] å®ç° `escrow.rs`ï¼ˆèµ„é‡‘æ‰˜ç®¡ï¼‰
- [ ] å®ç° `distribute.rs`ï¼ˆç»Ÿä¸€åˆ†é…ï¼‰
- [ ] å®ç° `lib.rs`ï¼ˆä¸»æ¨¡å—ï¼‰
- [ ] å®ç° `types.rs`ï¼ˆç±»å‹å®šä¹‰ï¼‰

### ç¬¬ä¸‰é˜¶æ®µï¼šRuntimeé›†æˆï¼ˆ2å°æ—¶ï¼‰

**ä»»åŠ¡**ï¼š
- [ ] æ›´æ–° `runtime/Cargo.toml`
- [ ] æ›´æ–° `runtime/src/configs/mod.rs`
- [ ] æ›´æ–° `runtime/src/lib.rs`
- [ ] æ³¨é‡Šæ—§5ä¸ªpallet
- [ ] ç¼–è¯‘éªŒè¯

### ç¬¬å››é˜¶æ®µï¼šæµ‹è¯•éªŒè¯ï¼ˆ2å°æ—¶ï¼‰

**ä»»åŠ¡**ï¼š
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] ç¼–å†™é›†æˆæµ‹è¯•
- [ ] åŠŸèƒ½éªŒè¯
- [ ] æ€§èƒ½æµ‹è¯•

### ç¬¬äº”é˜¶æ®µï¼šæ–‡æ¡£å®Œå–„ï¼ˆ1å°æ—¶ï¼‰

**ä»»åŠ¡**ï¼š
- [ ] æ›´æ–° `pallet-affiliate/README.md`
- [ ] ç”Ÿæˆæ¥å£æ–‡æ¡£
- [ ] ç”Ÿæˆå®ŒæˆæŠ¥å‘Š
- [ ] ç”Ÿæˆè¿ç§»æŒ‡å—

### æ—¶é—´é¢„ä¼°

| é˜¶æ®µ | é¢„ä¼°æ—¶é—´ | å…³é”®é£é™© |
|------|---------|---------|
| **æ¶æ„è®¾è®¡** | 2h | è®¾è®¡ä¸åˆç†å¯¼è‡´é‡æ„ |
| **æ ¸å¿ƒå®ç°** | 6-8h | é€»è¾‘å¤æ‚åº¦é«˜ï¼Œè°ƒè¯•æ—¶é—´é•¿ |
| **Runtimeé›†æˆ** | 2h | ä¾èµ–å†²çªï¼Œç¼–è¯‘å¤±è´¥ |
| **æµ‹è¯•éªŒè¯** | 2h | æµ‹è¯•è¦†ç›–ä¸è¶³ |
| **æ–‡æ¡£å®Œå–„** | 1h | - |
| **æ€»è®¡** | **13-15h** | - |

---

## âš ï¸ é£é™©ä¸é™åˆ¶

### é£é™©1ï¼šå…¼å®¹æ€§ç ´å

**é—®é¢˜**ï¼š
- æ—§çš„5ä¸ªpalletå¯èƒ½è¢«å…¶ä»–æ¨¡å—ä¾èµ–
- å­˜å‚¨å‰ç¼€å˜æ›´å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±

**ç¼“è§£æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨`#[pallet::storage_prefix]`ä¿æŒå­˜å‚¨å‰ç¼€ä¸€è‡´
- ä¿ç•™æ—§palletä½œä¸º`deprecated`ï¼Œæä¾›è¿ç§»æœŸ
- è¯¦ç»†çš„è¿ç§»æ–‡æ¡£å’Œè„šæœ¬

### é£é™©2ï¼šé€»è¾‘é”™è¯¯

**é—®é¢˜**ï¼š
- æ•´åˆè¿‡ç¨‹ä¸­å¯èƒ½å¼•å…¥é€»è¾‘é”™è¯¯
- åˆ†æˆè®¡ç®—é”™è¯¯å½±å“èµ„é‡‘å®‰å…¨

**ç¼“è§£æ–¹æ¡ˆ**ï¼š
- å®Œå–„çš„å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡>90%ï¼‰
- åˆ†é˜¶æ®µéªŒè¯ï¼ˆå…ˆç¼–è¯‘ï¼ŒååŠŸèƒ½ï¼Œå†æ€§èƒ½ï¼‰
- å®¡è®¡å…³é”®é€»è¾‘ï¼ˆåˆ†æˆè®¡ç®—ã€èµ„é‡‘è½¬è´¦ï¼‰

### é£é™©3ï¼šæ€§èƒ½ä¸‹é™

**é—®é¢˜**ï¼š
- æ•´åˆåå¯èƒ½å¼•å…¥æ€§èƒ½ç“¶é¢ˆ
- å¤æ‚æŸ¥è¯¢å¯èƒ½å¯¼è‡´Gasæˆæœ¬ä¸Šå‡

**ç¼“è§£æ–¹æ¡ˆ**ï¼š
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- ä½¿ç”¨ç¼“å­˜ä¼˜åŒ–æ¨èé“¾æŸ¥è¯¢
- æ‰¹é‡æ“ä½œä¼˜åŒ–

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### ä»£ç è´¨é‡

- [x] ç¼–è¯‘é€šè¿‡ï¼ˆæ— è­¦å‘Šï¼‰
- [ ] å‡½æ•°çº§ä¸­æ–‡æ³¨é‡Šå®Œæ•´
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] ä½¿ç”¨`BoundedVec`é™åˆ¶å¤§å°

### æ€§èƒ½æŒ‡æ ‡

- [ ] Gasæˆæœ¬é™ä½â‰¥25%
- [ ] æ¨èé“¾æŸ¥è¯¢æ€§èƒ½æå‡â‰¥30%
- [ ] å­˜å‚¨æˆæœ¬é™ä½â‰¥50%

### åŠŸèƒ½å®Œæ•´æ€§

- [ ] æ¨èå…³ç³»ç®¡ç†ï¼š100%
- [ ] å³æ—¶åˆ†æˆï¼š100%
- [ ] å‘¨ç»“ç®—ï¼š100%
- [ ] é…ç½®ç®¡ç†ï¼š100%
- [ ] èµ„é‡‘æ‰˜ç®¡ï¼š100%

### æ–‡æ¡£å®Œæ•´æ€§

- [ ] READMEå®Œæ•´
- [ ] æ¥å£æ–‡æ¡£è¯¦ç»†
- [ ] ä½¿ç”¨ç¤ºä¾‹æ¸…æ™°
- [ ] è¿ç§»æŒ‡å—å®Œå–„

---

## ğŸ“š å‚è€ƒè®¾è®¡

### æˆåŠŸæ¡ˆä¾‹

1. **pallet-trading**ï¼ˆTradingæ•´åˆï¼‰
   - æ•´åˆäº† otc-order + market-maker + simple-bridge
   - æˆæœï¼šGasæˆæœ¬â†“30%ï¼Œç»´æŠ¤æˆæœ¬â†“70%

2. **pallet-memorial**ï¼ˆMemorialæ•´åˆï¼‰
   - æ•´åˆäº† memo-offerings + memo-sacrifice
   - æˆæœï¼šå‡½æ•°å‡å°‘60%ï¼Œå­˜å‚¨å‡å°‘55%

3. **pallet-credit**ï¼ˆCreditæ•´åˆï¼‰
   - æ•´åˆäº† buyer-credit + maker-credit
   - æˆæœï¼šç»Ÿä¸€ä¿¡ç”¨ä½“ç³»ï¼Œé€»è¾‘æ›´æ¸…æ™°

### æœ€ä½³å®è·µ

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šå­æ¨¡å—æ¸…æ™°åˆ’åˆ†ï¼ŒèŒè´£å•ä¸€
2. **å­˜å‚¨ä¼˜åŒ–**ï¼šç§»é™¤å†—ä½™å­˜å‚¨ï¼Œä½¿ç”¨`BoundedVec`
3. **æ¥å£ç²¾ç®€**ï¼šåˆå¹¶ç›¸ä¼¼æ¥å£ï¼Œå‡å°‘å¤æ‚åº¦
4. **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†çš„READMEå’Œä½¿ç”¨ç¤ºä¾‹

---

## ğŸ“‹ ä¸‹ä¸€æ­¥

**é€‰é¡¹ Aï¼šç«‹å³å®æ–½æ•´åˆï¼ˆæ¨èï¼‰**
- åˆ›å»º `pallet-affiliate` éª¨æ¶
- å®ç°æ¨èå…³ç³»å­æ¨¡å—
- å®ç°å³æ—¶åˆ†æˆå­æ¨¡å—

**é€‰é¡¹ Bï¼šè¡¥å……è®¾è®¡ç»†èŠ‚**
- è¯¦ç»†è®¾è®¡æ¯ä¸ªå­æ¨¡å—çš„æ¥å£
- è®¾è®¡è¿ç§»æ–¹æ¡ˆ
- è®¾è®¡æµ‹è¯•ç”¨ä¾‹

**é€‰é¡¹ Cï¼šå…ˆå®æ–½ç®€åŒ–ä¼˜åŒ–**
- å…ˆä¼˜åŒ–ç°æœ‰5ä¸ªpallet
- ç§»é™¤å†—ä½™åŠŸèƒ½
- å†è€ƒè™‘æ•´åˆ

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**ï¼š2025-10-28  
**è®¾è®¡çŠ¶æ€**ï¼šåˆç¨¿å®Œæˆ  
**ç»´æŠ¤è€…**ï¼šStardust Team  
**AIåŠ©æ‰‹**ï¼šClaude Sonnet 4.5

