# pallet-memo-content-governance æ¨¡å—åŠŸèƒ½åˆ†æ

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

**ä½œç”¨**ï¼šç¬¬ä¸‰æ–¹ç”³è¯‰ + æŠ¼é‡‘ç½šæ²¡ + å§”å‘˜ä¼šå¼ºåˆ¶æ‰§è¡Œï¼ˆå†…å®¹åŸŸæ²»ç†ï¼‰

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- âœ… ç”¨æˆ·æäº¤å†…å®¹ç”³è¯‰ï¼ˆæŠ•è¯‰ä¸å½“å†…å®¹ï¼‰
- âœ… å§”å‘˜ä¼šå®¡æ‰¹ï¼ˆRootæˆ–å†…å®¹å§”å‘˜ä¼š2/3é€šè¿‡ï¼‰
- âœ… å…¬ç¤ºæœŸè‡ªåŠ¨æ‰§è¡Œ
- âœ… æŠ¼é‡‘ç½šæ²¡æœºåˆ¶ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰
- âœ… é™é¢‘æ§åˆ¶ï¼ˆé˜²æ­¢spamï¼‰
- âœ… å¤±è´¥é‡è¯•æœºåˆ¶
- âœ… åº”ç­”è‡ªåŠ¨å¦å†³ï¼ˆownerä¸»åŠ¨å“åº”ï¼‰

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·å±‚ï¼ˆä»»ä½•äººï¼‰                          â”‚
â”‚  - æäº¤ç”³è¯‰ï¼ˆsubmit_appealï¼‰                                 â”‚
â”‚  - æ’¤å›ç”³è¯‰ï¼ˆwithdraw_appealï¼‰                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              pallet-memo-content-governance                 â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç”³è¯‰ç®¡ç†                                           â”‚  â”‚
â”‚  â”‚  - Appealså­˜å‚¨ï¼ˆç”³è¯‰è®°å½•ï¼‰                          â”‚  â”‚
â”‚  â”‚  - æŠ¼é‡‘å†»ç»“/è§£å†»                                    â”‚  â”‚
â”‚  â”‚  - é™é¢‘æ£€æŸ¥ï¼ˆAccountWindowsï¼‰                       â”‚  â”‚
â”‚  â”‚  - çŠ¶æ€æœºç®¡ç†                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å§”å‘˜ä¼šå®¡æ‰¹                                         â”‚  â”‚
â”‚  â”‚  - approve_appealï¼ˆæ‰¹å‡†ï¼‰                          â”‚  â”‚
â”‚  â”‚  - reject_appealï¼ˆæ‹’ç»ï¼‰                           â”‚  â”‚
â”‚  â”‚  - å…¬ç¤ºæœŸè®¾ç½®                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è‡ªåŠ¨æ‰§è¡Œå¼•æ“                                       â”‚  â”‚
â”‚  â”‚  - on_initializeï¼ˆæ¯å—è‡ªåŠ¨è§¦å‘ï¼‰                   â”‚  â”‚
â”‚  â”‚  - QueueByBlockï¼ˆæŒ‰å—æ’é˜Ÿï¼‰                        â”‚  â”‚
â”‚  â”‚  - å¤±è´¥é‡è¯•ï¼ˆRetryCount + NextRetryAtï¼‰            â”‚  â”‚
â”‚  â”‚  - åº”ç­”è‡ªåŠ¨å¦å†³ï¼ˆLastActiveProviderï¼‰              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ‰§è¡Œè·¯ç”±ï¼ˆRouter traitï¼‰                          â”‚  â”‚
â”‚  â”‚  - æ ¹æ®domain/actionè·¯ç”±åˆ°ç›®æ ‡pallet               â”‚  â”‚
â”‚  â”‚  - è°ƒç”¨gov_*å¼ºåˆ¶æ¥å£                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç›®æ ‡Palletï¼ˆ6ä¸ªåŸŸï¼‰                         â”‚
â”‚  - stardust-grave (domain=1)ï¼šå¢“åœ°æ²»ç†                          â”‚
â”‚  - deceased (domain=2)ï¼šé€è€…æ²»ç†                            â”‚
â”‚  - deceased-text (domain=3)ï¼šæ–‡æœ¬æ²»ç†                       â”‚
â”‚  - deceased-media (domain=4)ï¼šåª’ä½“æ²»ç†                      â”‚
â”‚  - stardust-park (domain=5)ï¼šå›­åŒºæ²»ç†                           â”‚
â”‚  - memo-offerings (domain=6)ï¼šä¾›å¥‰æ²»ç†                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ç”³è¯‰ç”Ÿå‘½å‘¨æœŸ

### çŠ¶æ€æœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   0=æäº¤     â”‚  submit_appeal()
â”‚  (submitted) â”‚  â† ç”¨æˆ·æäº¤
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â†’ 3=æ’¤å› (withdrawn) â† withdraw_appeal()
       â”‚
       â”œâ”€â”€â†’ 2=é©³å› (rejected) â† reject_appeal()
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1=æ‰¹å‡†     â”‚  approve_appeal()
â”‚  (approved)  â”‚  â† å§”å‘˜ä¼šæ‰¹å‡†ï¼Œè¿›å…¥å…¬ç¤ºæœŸ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â†’ 6=è‡ªåŠ¨å¦å†³ (auto_dismissed) â† owneråº”ç­”
       â”‚
       â–¼
  ã€å…¬ç¤ºæœŸåˆ°æœŸã€‘
       â”‚
       â–¼
  try_execute()
       â”‚
       â”œâ”€â”€â†’ 4=å·²æ‰§è¡Œ (executed) â† æ‰§è¡ŒæˆåŠŸ
       â”‚
       â””â”€â”€â†’ 5=é‡è¯•è€—å°½ (retry_exhausted) â† è¾¾åˆ°MaxRetries
```

### å®Œæ•´æµç¨‹å›¾

```
ç”¨æˆ·å‘ç°ä¸å½“å†…å®¹
    â”‚
    â–¼
æäº¤ç”³è¯‰ (submit_appeal)
    â”‚
    â”œâ”€ å†»ç»“æŠ¼é‡‘ (Currency::reserve)
    â”œâ”€ é™é¢‘æ£€æŸ¥ (AccountWindows)
    â”œâ”€ è¯æ®éªŒè¯ (evidence_cidé•¿åº¦æ£€æŸ¥)
    â””â”€ åˆ›å»ºç”³è¯‰è®°å½• (status=0)
    â”‚
    â–¼
ç­‰å¾…å§”å‘˜ä¼šå®¡æ‰¹
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚             â”‚
    â–¼             â–¼             â–¼
ç”¨æˆ·æ’¤å›      å§”å‘˜ä¼šæ‹’ç»     å§”å‘˜ä¼šæ‰¹å‡†
(withdraw)    (reject)      (approve)
    â”‚             â”‚             â”‚
    â”‚             â”‚             â”œâ”€ è®¾ç½®execute_at
    â”‚             â”‚             â”œâ”€ å†™å…¥QueueByBlock
    â”‚             â”‚             â”œâ”€ å ä½PendingBySubject
    â”‚             â”‚             â””â”€ åˆå§‹åŒ–é‡è¯•è®¡æ•°
    â”‚             â”‚             â”‚
    â–¼             â–¼             â–¼
ç½šæ²¡10%      ç½šæ²¡30%        è¿›å…¥å…¬ç¤ºæœŸ
é€€è¿˜90%      é€€è¿˜70%        (NoticeDefaultBlocks)
status=3     status=2            â”‚
    â”‚             â”‚               â–¼
    â”‚             â”‚         on_initializeç›‘å¬
    â”‚             â”‚               â”‚
    â”‚             â”‚               â”œâ”€ æ£€æŸ¥owneråº”ç­”?
    â”‚             â”‚               â”‚   â””â”€ Yes â†’ auto_dismiss (status=6)
    â”‚             â”‚               â”‚
    â”‚             â”‚               â–¼
    â”‚             â”‚         try_execute(id)
    â”‚             â”‚               â”‚
    â”‚             â”‚               â”œâ”€ Router::execute()
    â”‚             â”‚               â”‚
    â”‚             â”‚         â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚             â”‚         â”‚           â”‚
    â”‚             â”‚         â–¼           â–¼
    â”‚             â”‚      æˆåŠŸ        å¤±è´¥
    â”‚             â”‚         â”‚           â”‚
    â”‚             â”‚         â”‚           â”œâ”€ æœªè¾¾MaxRetries?
    â”‚             â”‚         â”‚           â”‚   â””â”€ Yes â†’ é‡è¯•å…¥é˜Ÿ
    â”‚             â”‚         â”‚           â”‚
    â”‚             â”‚         â”‚           â””â”€ No â†’ retry_exhausted
    â”‚             â”‚         â”‚                   (status=5)
    â”‚             â”‚         â”‚
    â”‚             â”‚         â–¼
    â”‚             â”‚     status=4
    â”‚             â”‚     é€€è¿˜æŠ¼é‡‘
    â”‚             â”‚     é‡Šæ”¾å ä½
    â”‚             â”‚     æ¸…ç†é‡è¯•
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
              ç”³è¯‰å®Œæˆ
```

---

## ğŸ’¾ æ•°æ®ç»“æ„

### æ ¸å¿ƒå­˜å‚¨

#### 1. Appeals - ç”³è¯‰è®°å½•

```rust
pub struct Appeal<AccountId, Balance, BlockNumber> {
    pub who: AccountId,              // ç”³è¯‰äºº
    pub domain: u8,                  // åŸŸç¼–ç ï¼ˆ1-6ï¼‰
    pub target: u64,                 // ç›®æ ‡ID
    pub action: u8,                  // åŠ¨ä½œç¼–ç 
    pub reason_cid: Vec<u8>,         // ç†ç”±CIDï¼ˆIPFSï¼‰
    pub evidence_cid: Vec<u8>,       // è¯æ®CIDï¼ˆIPFSï¼‰
    pub deposit: Balance,            // æŠ¼é‡‘é‡‘é¢
    pub status: u8,                  // çŠ¶æ€ï¼ˆ0-6ï¼‰
    pub execute_at: Option<BlockNumber>,    // æ‰§è¡Œå—é«˜
    pub approved_at: Option<BlockNumber>,   // æ‰¹å‡†å—é«˜
    pub new_owner: Option<AccountId>,       // æ–°ownerï¼ˆä»…domain=2,action=4ï¼‰
}

// å­˜å‚¨æ˜ å°„
Appeals: AppealId -> Appeal
NextId: u64  // è‡ªå¢ID
```

**çŠ¶æ€ç è¯´æ˜**ï¼š
- `0 = submitted`ï¼šå·²æäº¤ï¼Œç­‰å¾…å®¡æ‰¹
- `1 = approved`ï¼šå·²æ‰¹å‡†ï¼Œè¿›å…¥å…¬ç¤ºæœŸ
- `2 = rejected`ï¼šå·²æ‹’ç»
- `3 = withdrawn`ï¼šå·²æ’¤å›
- `4 = executed`ï¼šå·²æ‰§è¡ŒæˆåŠŸ
- `5 = retry_exhausted`ï¼šé‡è¯•è€—å°½
- `6 = auto_dismissed`ï¼šè‡ªåŠ¨å¦å†³ï¼ˆowneråº”ç­”ï¼‰

#### 2. AccountWindows - é™é¢‘çª—å£

```rust
pub struct WindowInfo<BlockNumber> {
    pub window_start: BlockNumber,   // çª—å£èµ·å§‹å—
    pub count: u32,                  // çª—å£å†…å·²æäº¤æ¬¡æ•°
}

AccountWindows: AccountId -> WindowInfo
```

**é™é¢‘æœºåˆ¶**ï¼š
- æ»‘åŠ¨çª—å£ï¼š`WindowBlocks`ï¼ˆå¦‚7å¤©=100,800å—ï¼‰
- çª—å£å†…æœ€å¤§æ¬¡æ•°ï¼š`MaxPerWindow`ï¼ˆå¦‚10æ¬¡ï¼‰
- é˜²æ­¢spamæ”»å‡»

#### 3. QueueByBlock - æ‰§è¡Œé˜Ÿåˆ—

```rust
QueueByBlock: BlockNumber -> BoundedVec<AppealId, MaxExecPerBlock>
```

**æ‰§è¡Œæœºåˆ¶**ï¼š
- æŒ‰å—ç»´åº¦ç»„ç»‡å¾…æ‰§è¡Œç”³è¯‰
- `on_initialize(n)` ä»…å¤„ç†å½“å‰å—çš„é˜Ÿåˆ—
- æ¯å—æœ€å¤šæ‰§è¡Œ `MaxExecPerBlock` æ¡ï¼ˆDoSé˜²æŠ¤ï¼‰
- å¤„ç†åæ¸…ç©ºé˜Ÿåˆ—

#### 4. PendingBySubject - å¹¶å‘æ§åˆ¶

```rust
PendingBySubject: (domain, target) -> AppealId
```

**ä¸²è¡ŒåŒ–ä¿è¯**ï¼š
- åŒä¸€ä¸»ä½“åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª"å·²æ‰¹å‡†"ç”³è¯‰
- é˜²æ­¢ç«æ€æ¡ä»¶
- æ‰¹å‡†æ—¶æ£€æŸ¥å ä½ï¼Œå­˜åœ¨åˆ™è¿”å› `AlreadyPending`

#### 5. RetryCount & NextRetryAt - é‡è¯•ç®¡ç†

```rust
RetryCount: AppealId -> u8              // å·²é‡è¯•æ¬¡æ•°
NextRetryAt: AppealId -> BlockNumber    // ä¸‹æ¬¡é‡è¯•å—é«˜
```

**é‡è¯•æœºåˆ¶**ï¼š
- æœ€å¤§é‡è¯•æ¬¡æ•°ï¼š`MaxRetries`ï¼ˆå¦‚3æ¬¡ï¼‰
- é€€é¿ç­–ç•¥ï¼šç¬¬kæ¬¡å»¶è¿Ÿ = `RetryBackoffBlocks Ã— k`
- è¾¾åˆ°ä¸Šé™åæ ‡è®° `retry_exhausted`

---

## ğŸ¯ åŠŸèƒ½æ¨¡å—è¯¦è§£

### 1. æäº¤ç”³è¯‰ï¼ˆsubmit_appealï¼‰

**æ¥å£**ï¼š
```rust
pub fn submit_appeal(
    origin: OriginFor<T>,
    domain: u8,             // åŸŸç¼–ç 
    target: u64,            // ç›®æ ‡ID
    action: u8,             // åŠ¨ä½œç¼–ç 
    reason_cid: Vec<u8>,    // ç†ç”±CIDï¼ˆå¯é€‰ï¼‰
    evidence_cid: Vec<u8>,  // è¯æ®CIDï¼ˆå¿…å¡«ï¼‰
) -> DispatchResult
```

**æ‰§è¡Œæµç¨‹**ï¼š
```
1. ç­¾åéªŒè¯ (ensure_signed)
    â†“
2. é™é¢‘æ£€æŸ¥ (touch_window)
    - æ»‘åŠ¨çª—å£æ£€æŸ¥
    - è®¡æ•°+1
    â†“
3. è¯æ®éªŒè¯
    - evidence_cid éç©º
    - é•¿åº¦ â‰¥ MinEvidenceCidLen
    - reason_cidï¼ˆè‹¥æœ‰ï¼‰é•¿åº¦ â‰¥ MinReasonCidLen
    â†“
4. è®¡ç®—æŠ¼é‡‘
    - ä¼˜å…ˆï¼šAppealDepositPolicy::calc_deposit()ï¼ˆåŠ¨æ€ï¼‰
    - å›é€€ï¼šAppealDepositï¼ˆå›ºå®šï¼‰
    â†“
5. å†»ç»“æŠ¼é‡‘ (Currency::reserve)
    â†“
6. åˆ›å»ºç”³è¯‰è®°å½•
    - åˆ†é…ID (NextId++)
    - status = 0 (submitted)
    - å­˜å…¥ Appeals
    â†“
7. å‘å‡ºäº‹ä»¶
    AppealSubmitted(id, who, domain, target, deposit)
```

**é˜²æŠ¤æœºåˆ¶**ï¼š
- âœ… é™é¢‘é˜²spam
- âœ… è¯æ®å¿…å¡«
- âœ… æŠ¼é‡‘é˜²æ»¥ç”¨
- âœ… é•¿åº¦æ ¡éªŒ

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```typescript
// ç”³è¯‰é€è€…ä¸»å›¾ä¸å½“
await api.tx.memoContentGovernance.submitAppeal(
  2,        // domain: deceased
  123,      // target: deceased_id
  2,        // action: gov_set_main_image(None)
  reasonCid,
  evidenceCid
).signAndSend(user);
```

---

### 2. å§”å‘˜ä¼šå®¡æ‰¹ï¼ˆapprove_appeal / reject_appealï¼‰

#### æ‰¹å‡†ç”³è¯‰

**æ¥å£**ï¼š
```rust
pub fn approve_appeal(
    origin: OriginFor<T>,
    id: u64,
    notice_blocks: Option<BlockNumber>,  // å…¬ç¤ºæœŸï¼ˆå¯é€‰ï¼‰
) -> DispatchResult
```

**æƒé™**ï¼šRoot æˆ– å†…å®¹å§”å‘˜ä¼š2/3

**æ‰§è¡Œæµç¨‹**ï¼š
```
1. æ²»ç†æƒé™éªŒè¯ (GovernanceOrigin)
    â†“
2. è·å–ç”³è¯‰è®°å½•
    - æ£€æŸ¥status=0 (submitted)
    â†“
3. å¹¶å‘æ£€æŸ¥
    - æ£€æŸ¥ PendingBySubject[(domain,target)]
    - è‹¥å·²å­˜åœ¨ â†’ è¿”å› AlreadyPending
    â†“
4. æ›´æ–°çŠ¶æ€
    - status = 1 (approved)
    - execute_at = now + notice_blocks
    - approved_at = now
    â†“
5. å…¥é˜Ÿæ‰§è¡Œ
    - QueueByBlock[execute_at].push(id)
    - é˜Ÿåˆ—æ»¡ â†’ è¿”å› QueueFull
    â†“
6. å ä½ä¸åˆå§‹åŒ–
    - PendingBySubject[(domain,target)] = id
    - RetryCount[id] = 0
    â†“
7. å‘å‡ºäº‹ä»¶
    AppealApproved(id, execute_at)
```

**å¹¶å‘æ§åˆ¶**ï¼š
- âœ… åŒä¸€ä¸»ä½“åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª"å·²æ‰¹å‡†"ç”³è¯‰
- âœ… é˜²æ­¢ç«æ€æ¡ä»¶
- âœ… ä¿è¯çŠ¶æ€ä¸€è‡´æ€§

#### æ‹’ç»ç”³è¯‰

**æ¥å£**ï¼š
```rust
pub fn reject_appeal(
    origin: OriginFor<T>,
    id: u64,
) -> DispatchResult
```

**æ‰§è¡Œæµç¨‹**ï¼š
```
1. æ²»ç†æƒé™éªŒè¯
    â†“
2. è·å–ç”³è¯‰è®°å½• (status=0)
    â†“
3. æ›´æ–°çŠ¶æ€ (status=2)
    â†“
4. å¤„ç†æŠ¼é‡‘
    - è§£å†» (Currency::unreserve)
    - è®¡ç®—ç½šæ²¡ (RejectedSlashBps)
    - è½¬è´¦åˆ°å›½åº“ (TreasuryAccount)
    â†“
5. æ¸…ç†å ä½ï¼ˆè‹¥æœ‰ï¼‰
    - PendingBySubject.remove()
    - RetryCount.remove()
    - NextRetryAt.remove()
    â†“
6. å‘å‡ºäº‹ä»¶
    AppealRejected(id, slash_bps, slashed)
```

**ç½šæ²¡æ¯”ä¾‹**ï¼š
- é»˜è®¤ï¼š`RejectedSlashBps = 3000`ï¼ˆ30%ï¼‰
- å»ºè®®æ”¹ä¸ºï¼š`1000`ï¼ˆ10%ï¼‰

---

### 3. æ’¤å›ç”³è¯‰ï¼ˆwithdraw_appealï¼‰

**æ¥å£**ï¼š
```rust
pub fn withdraw_appeal(
    origin: OriginFor<T>,
    id: u64,
) -> DispatchResult
```

**æƒé™**ï¼šä»…ç”³è¯‰äººæœ¬äºº

**æ‰§è¡Œæµç¨‹**ï¼š
```
1. ç­¾åéªŒè¯
    â†“
2. æƒé™æ£€æŸ¥ (a.who == who)
    â†“
3. çŠ¶æ€æ£€æŸ¥ (status=0)
    â†“
4. æ›´æ–°çŠ¶æ€ (status=3)
    â†“
5. å¤„ç†æŠ¼é‡‘
    - è§£å†»
    - è®¡ç®—ç½šæ²¡ (WithdrawSlashBps)
    - è½¬è´¦åˆ°å›½åº“
    â†“
6. æ¸…ç†å ä½
    â†“
7. å‘å‡ºäº‹ä»¶
    AppealWithdrawn(id, slash_bps, slashed)
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç”¨æˆ·å‘ç°æäº¤é”™è¯¯
- åŒæ–¹çº¿ä¸‹è¾¾æˆå’Œè§£
- ä¸æƒ³ç»§ç»­ç”³è¯‰

---

### 4. è‡ªåŠ¨æ‰§è¡Œï¼ˆon_initializeï¼‰

**æ ¸å¿ƒé€»è¾‘**ï¼š
```rust
fn on_initialize(n: BlockNumber) -> Weight {
    // 1. è·å–æœ¬å—å¾…æ‰§è¡Œé˜Ÿåˆ—
    if let Some(queue) = QueueByBlock[n] {
        let mut handled = 0;
        
        // 2. é€ä¸ªæ‰§è¡Œ
        while let Some(id) = queue.pop() {
            let _ = Self::try_execute(id);
            handled += 1;
            
            // 3. é™é¢ä¿æŠ¤
            if handled >= MaxExecPerBlock {
                break;
            }
        }
        
        // 4. æ¸…ç©ºé˜Ÿåˆ—
        QueueByBlock.remove(n);
    }
    
    // 5. è¿”å›æƒé‡
    WeightInfo::on_initialize(handled)
}
```

**try_execute æ‰§è¡Œæµç¨‹**ï¼š

```
è·å–ç”³è¯‰è®°å½• (status=1)
    â†“
æ£€æŸ¥ï¼šåº”ç­”è‡ªåŠ¨å¦å†³
    - ä»…domain=2 (deceased)
    - LastActiveProvider::last_active_of()
    - è‹¥ approved_at < last_active <= execute_at
    - åˆ™ï¼šstatus=6, é€€æŠ¼é‡‘, é‡Šæ”¾å ä½
    â†“
è°ƒç”¨ Router::execute(domain, target, action)
    â”‚
    â”œâ”€ æˆåŠŸ â”€â†’ status=4
    â”‚         é€€æŠ¼é‡‘
    â”‚         é‡Šæ”¾å ä½
    â”‚         æ¸…ç†é‡è¯•
    â”‚         Event: AppealExecuted
    â”‚
    â””â”€ å¤±è´¥ â”€â†’ Event: AppealExecuteFailed(code)
              â”‚
              â”œâ”€ æœªè¾¾MaxRetries?
              â”‚   â””â”€ Yes â†’ è®¡ç®—ä¸‹æ¬¡é‡è¯•å—é«˜
              â”‚           å…¥é˜Ÿ QueueByBlock
              â”‚           RetryCount++
              â”‚           Event: AppealRetryScheduled
              â”‚
              â””â”€ No â†’ status=5
                      é€€æŠ¼é‡‘
                      é‡Šæ”¾å ä½
                      æ¸…ç†é‡è¯•
                      Event: AppealRetryExhausted
```

**DoSé˜²æŠ¤**ï¼š
- âœ… æ¯å—æœ€å¤šæ‰§è¡Œ `MaxExecPerBlock` æ¡
- âœ… æŒ‰å—é˜Ÿåˆ—ï¼Œä¸ä¼šç´¯ç§¯
- âœ… æƒé‡è®¡ç®—åˆç†

---

### 5. åº”ç­”è‡ªåŠ¨å¦å†³ï¼ˆAuto Dismissï¼‰

**è®¾è®¡ç›®çš„**ï¼š
- ç»™ownerä¸»åŠ¨å“åº”çš„æœºä¼š
- åœ¨å…¬ç¤ºæœŸå†…ï¼Œè‹¥ownerä¸»åŠ¨ä¿®æ­£é—®é¢˜ï¼Œåˆ™è‡ªåŠ¨å¦å†³ç”³è¯‰

**è§¦å‘æ¡ä»¶**ï¼š
1. ç”³è¯‰å¤„äº"å·²æ‰¹å‡†"çŠ¶æ€ï¼ˆstatus=1ï¼‰
2. ä»…å¯¹ `domain=2` (deceased) ç”Ÿæ•ˆ
3. `LastActiveProvider::last_active_of(2, deceased_id)` è¿”å›æ´»è·ƒå—é«˜
4. æ»¡è¶³ï¼š`approved_at < last_active <= execute_at`

**æ‰§è¡Œé€»è¾‘**ï¼š
```rust
// åœ¨ try_execute å¼€å§‹å‰æ£€æŸ¥
if domain == 2 {
    if let Some(last_active) = LastActiveProvider::last_active_of(2, target) {
        if last_active > approved_at && last_active <= execute_at {
            // owneråœ¨å…¬ç¤ºæœŸå†…æœ‰æ´»è·ƒæ“ä½œï¼Œè§†ä¸ºåº”ç­”
            status = 6 (auto_dismissed)
            Currency::unreserve(&who, deposit)  // é€€è¿˜æŠ¼é‡‘
            PendingBySubject::remove()
            RetryCount::remove()
            NextRetryAt::remove()
            Event: AppealAutoDismissed(id)
            return Ok(())
        }
    }
}
```

**ç¤ºä¾‹åœºæ™¯**ï¼š
```
1. ç”¨æˆ·Aç”³è¯‰ï¼šé€è€…Bçš„ä¸»å›¾ä¸å½“
    â†“
2. å§”å‘˜ä¼šæ‰¹å‡†ï¼Œè¿›å…¥3å¤©å…¬ç¤ºæœŸ
    â†“
3. é€è€…owneråœ¨å…¬ç¤ºæœŸå†…ä¸»åŠ¨ä¿®æ”¹ä¸»å›¾
    â†“
4. ç³»ç»Ÿæ£€æµ‹åˆ°owneræ´»è·ƒæ“ä½œ
    â†“
5. è‡ªåŠ¨å¦å†³ç”³è¯‰ï¼Œé€€è¿˜æŠ¼é‡‘
    â†“
6. é¿å…ä¸å¿…è¦çš„å¼ºåˆ¶æ‰§è¡Œ
```

---

### 6. å¤±è´¥é‡è¯•æœºåˆ¶

**é‡è¯•ç­–ç•¥**ï¼š

| é‡è¯•æ¬¡æ•° | å»¶è¿Ÿæ—¶é—´ | è¯´æ˜ |
|---------|---------|------|
| 1 | RetryBackoffBlocks Ã— 1 | é¦–æ¬¡é‡è¯• |
| 2 | RetryBackoffBlocks Ã— 2 | ç¬¬äºŒæ¬¡é‡è¯• |
| 3 | RetryBackoffBlocks Ã— 3 | ç¬¬ä¸‰æ¬¡é‡è¯• |
| MaxRetries | - | è¾¾åˆ°ä¸Šé™ï¼Œæ”¾å¼ƒ |

**ç¤ºä¾‹**ï¼ˆRetryBackoffBlocks=100ï¼‰ï¼š

```
æ‰§è¡Œå¤±è´¥ï¼ˆå—é«˜ 1000ï¼‰
    â†“
é‡è¯•1ï¼šå—é«˜ 1100 (+100)
    â†“ å¤±è´¥
é‡è¯•2ï¼šå—é«˜ 1300 (+200)
    â†“ å¤±è´¥
é‡è¯•3ï¼šå—é«˜ 1600 (+300)
    â†“ å¤±è´¥
æ”¾å¼ƒï¼šstatus=5 (retry_exhausted)
      é€€è¿˜æŠ¼é‡‘
```

**ä¸ºä»€ä¹ˆéœ€è¦é‡è¯•**ï¼š
- æ‰§è¡Œå¤±è´¥å¯èƒ½æ˜¯ä¸´æ—¶æ€§çš„ï¼ˆå¦‚ä½™é¢ä¸è¶³ï¼‰
- ç»™ç³»ç»Ÿè‡ªæ„ˆçš„æœºä¼š
- é¿å…å› æš‚æ—¶æ€§é”™è¯¯å¯¼è‡´æŠ¼é‡‘æŸå¤±

---

### 7. æ‰§è¡Œè·¯ç”±ï¼ˆRouterï¼‰

**Traitå®šä¹‰**ï¼š
```rust
pub trait AppealRouter<AccountId> {
    fn execute(
        who: &AccountId,
        domain: u8,
        target: u64,
        action: u8
    ) -> DispatchResult;
}
```

**Runtimeå®ç°**ï¼ˆä¼ªä»£ç ï¼‰ï¼š
```rust
impl AppealRouter<AccountId> for Router {
    fn execute(who, domain, target, action) -> DispatchResult {
        match (domain, action) {
            // å¢“åœ°åŸŸ
            (1, 10) => MemoGrave::clear_cover_via_governance(target, evidence),
            (1, 11) => MemoGrave::gov_transfer_grave(target, new_owner, evidence),
            (1, 12) => MemoGrave::gov_set_restricted(target, true, code, evidence),
            (1, 13) => MemoGrave::gov_remove_grave(target, code, evidence),
            (1, 14) => MemoGrave::gov_restore_grave(target, evidence),
            
            // é€è€…åŸŸ
            (2, 1) => Deceased::gov_set_visibility(target, true, evidence),
            (2, 2) => Deceased::gov_set_main_image(target, None, evidence),
            (2, 3) => Deceased::gov_set_main_image(target, Some(default_cid), evidence),
            (2, 4) => Deceased::gov_transfer_owner(target, new_owner, evidence),
            
            // æ–‡æœ¬åŸŸ
            (3, 20) => DeceasedText::gov_remove_eulogy(target, evidence),
            (3, 21) => DeceasedText::gov_remove_text(target, evidence),
            (3, 22) => DeceasedText::gov_edit_text(target, cid, evidence),
            (3, 23) => DeceasedText::gov_set_life(target, cid, evidence),
            
            // åª’ä½“åŸŸ
            (4, 30) => DeceasedMedia::gov_set_media_hidden(target, true, evidence),
            (4, 31) => DeceasedMedia::gov_replace_media_uri(target, new_uri, evidence),
            (4, 32) => DeceasedMedia::gov_freeze_video_collection(target, true, evidence),
            
            // å›­åŒºåŸŸ
            (5, 40) => StarDust::gov_transfer_park(target, new_owner, evidence),
            (5, 41) => StarDust::gov_set_park_cover(target, cid, evidence),
            
            // ä¾›å¥‰åŸŸ
            (6, 50) => MemoOfferings::gov_set_pause_domain(target_domain, true, evidence),
            (6, 51) => MemoOfferings::gov_set_offering_enabled(target, enabled, evidence),
            
            _ => Err(DispatchError::BadOrigin),
        }
    }
}
```

**è·¯ç”±ç è¡¨**ï¼šè§READMEç¬¬75-100è¡Œ

---

## ğŸ”’ å®‰å…¨æœºåˆ¶

### 1. æƒé™æ§åˆ¶

| æ“ä½œ | æƒé™è¦æ±‚ | è¯´æ˜ |
|-----|---------|------|
| `submit_appeal` | ä»»ä½•ç­¾åè´¦æˆ· | ç”¨æˆ·æäº¤ |
| `withdraw_appeal` | ç”³è¯‰äººæœ¬äºº | ä»…ç”³è¯‰äººå¯æ’¤å› |
| `approve_appeal` | Root \| å†…å®¹å§”å‘˜ä¼š2/3 | æ²»ç†å†³ç­– |
| `reject_appeal` | Root \| å†…å®¹å§”å‘˜ä¼š2/3 | æ²»ç†å†³ç­– |
| `purge_appeals` | Root \| å†…å®¹å§”å‘˜ä¼š2/3 | æ¸…ç†å†å² |

### 2. é™é¢‘ä¿æŠ¤

```rust
// æ»‘åŠ¨çª—å£
WindowBlocks = 100,800å—ï¼ˆçº¦7å¤©ï¼‰
MaxPerWindow = 10æ¬¡

// æ£€æŸ¥é€»è¾‘
if now - window_start >= WindowBlocks {
    // æ–°çª—å£
    window_start = now
    count = 0
}
ensure!(count < MaxPerWindow, RateLimited)
count += 1
```

**é˜²æ­¢spamæ”»å‡»**

### 3. æŠ¼é‡‘æœºåˆ¶

| åœºæ™¯ | æŠ¼é‡‘å¤„ç† | è¯´æ˜ |
|-----|---------|------|
| **æäº¤** | å†»ç»“æŠ¼é‡‘ | é˜²æ­¢æ»¥ç”¨ |
| **æ‰¹å‡†+æ‰§è¡ŒæˆåŠŸ** | å…¨é¢é€€è¿˜ | é¼“åŠ±åˆç†ç”³è¯‰ |
| **æ‹’ç»** | ç½šæ²¡30%ï¼Œé€€è¿˜70% | æƒ©ç½šæ— æ•ˆç”³è¯‰ |
| **æ’¤å›** | ç½šæ²¡30%ï¼Œé€€è¿˜70% | é˜²æ­¢éšæ„æ’¤å› |
| **é‡è¯•è€—å°½** | å…¨é¢é€€è¿˜ | ä¸æ€ªç½ªç”³è¯‰äºº |
| **è‡ªåŠ¨å¦å†³** | å…¨é¢é€€è¿˜ | ownerä¸»åŠ¨å“åº” |

### 4. å¹¶å‘æ§åˆ¶

```rust
// åŒä¸€ä¸»ä½“åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª"å·²æ‰¹å‡†"ç”³è¯‰
PendingBySubject: (domain, target) -> AppealId

// æ‰¹å‡†æ—¶æ£€æŸ¥
ensure!(
    PendingBySubject::get((domain, target)).is_none(),
    AlreadyPending
)
```

**é˜²æ­¢ç«æ€æ¡ä»¶**

### 5. DoSé˜²æŠ¤

```rust
// æ¯å—æœ€å¤šæ‰§è¡Œæ¡æ•°
MaxExecPerBlock = 10

// on_initialize
let mut handled = 0;
while let Some(id) = queue.pop() {
    if handled >= MaxExecPerBlock {
        break;
    }
    try_execute(id);
    handled += 1;
}
```

**é˜²æ­¢å•å—æ‰§è¡Œè¿‡å¤šç”³è¯‰å¯¼è‡´é˜»å¡**

### 6. è¯æ®è¦æ±‚

```rust
// è¯æ®å¿…å¡«
ensure!(!evidence_cid.is_empty(), EvidenceRequired)

// æœ€å°é•¿åº¦
ensure!(
    evidence_cid.len() >= MinEvidenceCidLen,
    EvidenceTooShort
)

// ç†ç”±ï¼ˆå¯é€‰ï¼‰æœ€å°é•¿åº¦
if !reason_cid.is_empty() {
    ensure!(
        reason_cid.len() >= MinReasonCidLen,
        ReasonTooShort
    )
}
```

**é˜²æ­¢ç©ºè¯æ®æˆ–æ— æ•ˆè¯æ®**

---

## ğŸ“Š åªè¯»æ¥å£

### 1. è·å–ç”³è¯‰è¯¦æƒ…

```rust
pub fn appeal_of(id: u64) -> Option<Appeal>
```

**ç”¨é€”**ï¼šå‰ç«¯/ç´¢å¼•æŸ¥è¯¢ç”³è¯‰æ˜ç»†

### 2. æŒ‰è´¦æˆ·è¿‡æ»¤

```rust
pub fn list_by_account(
    who: &AccountId,
    status: Option<u8>,
    start_id: u64,
    limit: u32
) -> Vec<u64>
```

**ç”¨é€”**ï¼šæŸ¥è¯¢æŸè´¦æˆ·çš„ç”³è¯‰åˆ—è¡¨

**ç¤ºä¾‹**ï¼š
```typescript
// æŸ¥è¯¢userçš„æ‰€æœ‰å·²æ‰¹å‡†ç”³è¯‰
const appeals = await api.query.memoContentGovernance
  .listByAccount(user, 1, 0, 100);
```

### 3. æŒ‰çŠ¶æ€èŒƒå›´è¿‡æ»¤

```rust
pub fn list_by_status_range(
    status_min: u8,
    status_max: u8,
    start_id: u64,
    limit: u32
) -> Vec<u64>
```

**ç”¨é€”**ï¼šæŸ¥è¯¢ç‰¹å®šçŠ¶æ€èŒƒå›´çš„ç”³è¯‰

**ç¤ºä¾‹**ï¼š
```typescript
// æŸ¥è¯¢æ‰€æœ‰å¾…å®¡æ‰¹ç”³è¯‰ï¼ˆstatus=0ï¼‰
const pending = await api.query.memoContentGovernance
  .listByStatusRange(0, 0, 0, 100);
```

### 4. æŒ‰åˆ°æœŸåŒºé—´è¿‡æ»¤

```rust
pub fn list_due_between(
    from: BlockNumber,
    to: BlockNumber,
    start_id: u64,
    limit: u32
) -> Vec<u64>
```

**ç”¨é€”**ï¼šæŸ¥è¯¢å³å°†åˆ°æœŸçš„ç”³è¯‰

### 5. é˜Ÿåˆ—æŸ¥è¯¢

```rust
pub fn queue_len_at(block: BlockNumber) -> u32
pub fn due_at(block: BlockNumber) -> Vec<u64>
```

**ç”¨é€”**ï¼šç›‘æ§æ‰§è¡Œé˜Ÿåˆ—çŠ¶æ€

---

## ğŸ­ äº‹ä»¶åˆ—è¡¨

### ç”³è¯‰æäº¤/æ’¤å›/å®¡æ‰¹

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|-----|------|------|
| `AppealSubmitted` | `(id, who, domain, target, deposit)` | ç”³è¯‰å·²æäº¤ |
| `AppealWithdrawn` | `(id, slash_bps, slashed)` | ç”³è¯‰å·²æ’¤å› |
| `AppealApproved` | `(id, execute_at)` | ç”³è¯‰å·²æ‰¹å‡† |
| `AppealRejected` | `(id, slash_bps, slashed)` | ç”³è¯‰å·²æ‹’ç» |

### æ‰§è¡Œç›¸å…³

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|-----|------|------|
| `AppealExecuted` | `(id)` | ç”³è¯‰å·²æ‰§è¡ŒæˆåŠŸ |
| `AppealExecuteFailed` | `(id, error_code)` | ç”³è¯‰æ‰§è¡Œå¤±è´¥ |
| `AppealRetryScheduled` | `(id, attempt, at_block)` | å·²å®‰æ’é‡è¯• |
| `AppealRetryExhausted` | `(id, attempts)` | é‡è¯•å·²è€—å°½ |
| `AppealAutoDismissed` | `(id)` | è‡ªåŠ¨å¦å†³ï¼ˆowneråº”ç­”ï¼‰ |

### ç®¡ç†ç›¸å…³

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|-----|------|------|
| `AppealsPurged` | `(start_id, end_id, removed)` | å·²æ¸…ç†å†å²ç”³è¯‰ |

---

## âš™ï¸ é…ç½®å‚æ•°

### Runtimeé…ç½®ç¤ºä¾‹

```rust
impl pallet_memo_content_governance::Config for Runtime {
    type RuntimeEvent = RuntimeEvent;
    type Currency = Balances;
    
    // æŠ¼é‡‘é…ç½®
    type AppealDeposit = ConstU128<{ 100 * UNIT }>;  // å›ºå®š100 DUST
    type AppealDepositPolicy = DynamicDepositPolicy; // æˆ–åŠ¨æ€ç­–ç•¥
    
    // ç½šæ²¡æ¯”ä¾‹ï¼ˆå»ºè®®è°ƒæ•´ï¼‰
    type RejectedSlashBps = ConstU16<3000>;  // 30% â†’ å»ºè®®æ”¹ä¸º1000ï¼ˆ10%ï¼‰
    type WithdrawSlashBps = ConstU16<3000>;  // 30% â†’ å»ºè®®æ”¹ä¸º1000ï¼ˆ10%ï¼‰
    
    // é™é¢‘é…ç½®
    type WindowBlocks = ConstU32<100_800>;   // 7å¤©
    type MaxPerWindow = ConstU32<10>;        // 10æ¬¡/7å¤©
    
    // å…¬ç¤ºæœŸ
    type NoticeDefaultBlocks = ConstU32<43_200>;  // 3å¤©
    
    // æ‰§è¡Œé…ç½®
    type MaxExecPerBlock = ConstU32<10>;     // æ¯å—æœ€å¤š10æ¡
    type MaxRetries = ConstU8<3>;            // æœ€å¤šé‡è¯•3æ¬¡
    type RetryBackoffBlocks = ConstU32<100>; // é€€é¿100å—
    
    // è¯æ®é•¿åº¦
    type MinEvidenceCidLen = ConstU32<46>;   // IPFS CIDæœ€å°é•¿åº¦
    type MinReasonCidLen = ConstU32<46>;
    
    // å…¶ä»–
    type TreasuryAccount = TreasuryAccount;
    type Router = AppealRouter;
    type GovernanceOrigin = EitherOfDiverse<
        EnsureRoot<AccountId>,
        ContentCommitteeAtLeast2of3
    >;
    type LastActiveProvider = DeceasedLastActiveProvider;
    type WeightInfo = ();
    type MaxListLen = ConstU32<1000>;
}
```

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯é›†æˆ

#### 1. æäº¤ç”³è¯‰

```typescript
import { ApiPromise } from '@polkadot/api';

// ç”³è¯‰é€è€…ä¸»å›¾ä¸å½“
async function submitAppeal(
  api: ApiPromise,
  signer: KeyringPair,
  deceasedId: number,
  evidenceCid: string,
  reasonCid: string
) {
  const tx = api.tx.memoContentGovernance.submitAppeal(
    2,          // domain: deceased
    deceasedId, // target
    2,          // action: gov_set_main_image(None) - æ¸…ç©ºä¸»å›¾
    reasonCid,
    evidenceCid
  );
  
  // è·å–æŠ¼é‡‘é‡‘é¢
  const deposit = await api.consts.memoContentGovernance.appealDeposit;
  
  // ç¡®è®¤å¯¹è¯æ¡†
  const confirmed = await confirm(
    `ç¡®è®¤æäº¤ç”³è¯‰ï¼Ÿ\n` +
    `æŠ¼é‡‘ï¼š${deposit.toHuman()}\n` +
    `- æ‰¹å‡†ï¼šå…¨é¢é€€è¿˜\n` +
    `- æ‹’ç»ï¼šç½šæ²¡30%\n` +
    `- æ’¤å›ï¼šç½šæ²¡30%`
  );
  
  if (!confirmed) return;
  
  // æäº¤
  const unsub = await tx.signAndSend(signer, ({ status, events }) => {
    if (status.isInBlock) {
      // æŸ¥æ‰¾äº‹ä»¶
      events.forEach(({ event }) => {
        if (event.section === 'memoContentGovernance') {
          if (event.method === 'AppealSubmitted') {
            const [id, who, domain, target, deposit] = event.data;
            console.log(`ç”³è¯‰å·²æäº¤ï¼šID=${id}`);
            // è·³è½¬åˆ°ç”³è¯‰è¯¦æƒ…é¡µ
            router.push(`/appeals/${id}`);
          }
        }
      });
      unsub();
    }
  });
}
```

#### 2. å§”å‘˜ä¼šå®¡æ‰¹

```typescript
// æ‰¹å‡†ç”³è¯‰
async function approveAppeal(
  api: ApiPromise,
  committeeSigner: KeyringPair,
  appealId: number,
  noticeBlocks?: number
) {
  const tx = api.tx.memoContentGovernance.approveAppeal(
    appealId,
    noticeBlocks || null  // ä½¿ç”¨é»˜è®¤å…¬ç¤ºæœŸ
  );
  
  await tx.signAndSend(committeeSigner, ({ status }) => {
    if (status.isInBlock) {
      message.success(`ç”³è¯‰ #${appealId} å·²æ‰¹å‡†ï¼Œè¿›å…¥å…¬ç¤ºæœŸ`);
    }
  });
}

// æ‹’ç»ç”³è¯‰
async function rejectAppeal(
  api: ApiPromise,
  committeeSigner: KeyringPair,
  appealId: number
) {
  const tx = api.tx.memoContentGovernance.rejectAppeal(appealId);
  
  await tx.signAndSend(committeeSigner, ({ status }) => {
    if (status.isInBlock) {
      message.info(`ç”³è¯‰ #${appealId} å·²æ‹’ç»`);
    }
  });
}
```

#### 3. æŸ¥è¯¢ç”³è¯‰åˆ—è¡¨

```typescript
// æŸ¥è¯¢æˆ‘çš„ç”³è¯‰
async function queryMyAppeals(
  api: ApiPromise,
  account: string
) {
  const appealIds = await api.query.memoContentGovernance
    .listByAccount(account, null, 0, 100);
  
  const appeals = await Promise.all(
    appealIds.map(id => 
      api.query.memoContentGovernance.appealOf(id)
    )
  );
  
  return appeals.map((appeal, i) => ({
    id: appealIds[i],
    ...appeal.toJSON()
  }));
}

// æŸ¥è¯¢å¾…å®¡æ‰¹ç”³è¯‰ï¼ˆå§”å‘˜ä¼šé¡µé¢ï¼‰
async function queryPendingAppeals(api: ApiPromise) {
  const appealIds = await api.query.memoContentGovernance
    .listByStatusRange(0, 0, 0, 100);  // status=0 (submitted)
  
  // ... åŒä¸Š
}
```

#### 4. ç›‘å¬äº‹ä»¶

```typescript
// è®¢é˜…ç”³è¯‰äº‹ä»¶
api.query.system.events((events) => {
  events.forEach(({ event }) => {
    if (event.section === 'memoContentGovernance') {
      switch (event.method) {
        case 'AppealSubmitted':
          const [id, who, domain, target, deposit] = event.data;
          notification.info({
            message: 'æ–°ç”³è¯‰æäº¤',
            description: `ID: ${id}, åŸŸ: ${domain}, ç›®æ ‡: ${target}`
          });
          break;
          
        case 'AppealApproved':
          const [id, executeAt] = event.data;
          notification.success({
            message: 'ç”³è¯‰å·²æ‰¹å‡†',
            description: `ID: ${id}, æ‰§è¡Œå—é«˜: ${executeAt}`
          });
          break;
          
        case 'AppealExecuted':
          notification.success({
            message: 'ç”³è¯‰å·²æ‰§è¡Œ',
            description: `ID: ${event.data[0]}`
          });
          break;
          
        case 'AppealAutoDismissed':
          notification.info({
            message: 'ç”³è¯‰è‡ªåŠ¨å¦å†³',
            description: `ownerå·²ä¸»åŠ¨å“åº”ï¼ŒID: ${event.data[0]}`
          });
          break;
      }
    }
  });
});
```

---

## ğŸ“ˆ ä¼˜åŒ–å»ºè®®

### 1. æŠ¼é‡‘ç­–ç•¥ä¼˜åŒ–

**å½“å‰é—®é¢˜**ï¼š
- å›ºå®šæŠ¼é‡‘ï¼ˆ100 DUSTï¼‰ï¼Œä»·å€¼æ³¢åŠ¨å¤§
- ä¸åŒåŸŸ/åŠ¨ä½œçš„é£é™©ä¸åŒï¼Œåº”å·®å¼‚åŒ–

**å»ºè®®æ–¹æ¡ˆ**ï¼š
- âœ… å®æ–½åŠ¨æ€æŠ¼é‡‘ï¼ˆè¯¦è§"ç”³è¯‰æŠ¼é‡‘æ”¹è¿›éœ€æ±‚-å¯è¡Œæ€§åˆ†æ.md"ï¼‰
- âœ… æŠ¼é‡‘=10ç¾å…ƒç­‰å€¼MEMOï¼ˆæ ¹æ®pallet-pricingï¼‰
- âœ… ç½šæ²¡æ¯”ä¾‹ä»30%é™åˆ°10%

### 2. å…¬ç¤ºæœŸä¼˜åŒ–

**å½“å‰é—®é¢˜**ï¼š
- å›ºå®š3å¤©å…¬ç¤ºæœŸï¼Œå¯èƒ½è¿‡é•¿æˆ–è¿‡çŸ­

**å»ºè®®æ–¹æ¡ˆ**ï¼š
- ä½é£é™©æ“ä½œï¼š1å¤©
- ä¸­é£é™©æ“ä½œï¼š3å¤©ï¼ˆé»˜è®¤ï¼‰
- é«˜é£é™©æ“ä½œï¼š7å¤©
- æŒ‰domain/actionå·®å¼‚åŒ–é…ç½®

### 3. é‡è¯•ç­–ç•¥ä¼˜åŒ–

**å½“å‰é—®é¢˜**ï¼š
- å›ºå®šé€€é¿ç­–ç•¥ï¼Œå¯èƒ½ä¸å¤Ÿçµæ´»

**å»ºè®®æ–¹æ¡ˆ**ï¼š
- æŒ‡æ•°é€€é¿ï¼šdelay = base Ã— 2^(attempt-1)
- é¦–æ¬¡å¿«é€Ÿé‡è¯•ï¼Œåç»­é€æ­¥å»¶é•¿
- ä¸åŒé”™è¯¯ç±»å‹å·®å¼‚åŒ–å¤„ç†

### 4. æ‰¹é‡æ“ä½œ

**æ–°å¢éœ€æ±‚**ï¼š
- `batch_approve_appeals(ids[])`ï¼šæ‰¹é‡æ‰¹å‡†
- `batch_reject_appeals(ids[])`ï¼šæ‰¹é‡æ‹’ç»
- æé«˜å§”å‘˜ä¼šæ•ˆç‡

---

## ğŸ› å·²çŸ¥é™åˆ¶

### 1. å­˜å‚¨æˆæœ¬

**é—®é¢˜**ï¼š
- æ‰€æœ‰ç”³è¯‰æ°¸ä¹…å­˜å‚¨
- éšæ—¶é—´å¢é•¿ï¼Œå­˜å‚¨è†¨èƒ€

**ç¼“è§£**ï¼š
- âœ… å·²å®ç° `purge_appeals` æ¸…ç†å†å²
- å»ºè®®å®šæœŸæ¸…ç†å·²å®Œæˆç”³è¯‰

### 2. åªè¯»æŸ¥è¯¢æ€§èƒ½

**é—®é¢˜**ï¼š
- `list_by_account` ç­‰æ¥å£éå†å…¨éƒ¨ç”³è¯‰
- æ•°æ®é‡å¤§æ—¶æ€§èƒ½å·®

**ç¼“è§£**ï¼š
- å‰ç«¯/Subsquidå»ºç«‹ç´¢å¼•
- é“¾ä¸Šä»…ä¿ç•™æ ¸å¿ƒå­˜å‚¨

### 3. è·¯ç”±è€¦åˆ

**é—®é¢˜**ï¼š
- Routeréœ€è¦åœ¨runtimeå®ç°
- æ–°å¢domain/actionéœ€è¦ä¿®æ”¹runtime

**ç¼“è§£**ï¼š
- ä¿æŒä½è€¦åˆè®¾è®¡
- è·¯ç”±é€»è¾‘æ¸…æ™°åˆ†å±‚

---

## âœ… æ€»ç»“

### æ ¸å¿ƒä»·å€¼

1. **å»ä¸­å¿ƒåŒ–æ²»ç†**
   - ç”¨æˆ·å¯æäº¤ç”³è¯‰
   - å§”å‘˜ä¼šæ°‘ä¸»å†³ç­–
   - å…¬ç¤ºæœŸé€æ˜å…¬å¼€

2. **ç»æµæ¿€åŠ±**
   - æŠ¼é‡‘é˜²æ­¢æ»¥ç”¨
   - ç½šæ²¡æƒ©ç½šæ¶æ„
   - é€€æ¬¾é¼“åŠ±åˆç†ç”³è¯‰

3. **è‡ªåŠ¨åŒ–æ‰§è¡Œ**
   - å…¬ç¤ºæœŸåˆ°æœŸè‡ªåŠ¨æ‰§è¡Œ
   - å¤±è´¥è‡ªåŠ¨é‡è¯•
   - owneråº”ç­”è‡ªåŠ¨å¦å†³

4. **å®‰å…¨ä¿éšœ**
   - é™é¢‘é˜²spam
   - å¹¶å‘æ§åˆ¶é˜²ç«æ€
   - DoSé˜²æŠ¤

### æ¨¡å—ç‰¹è‰²

| ç‰¹æ€§ | è¯´æ˜ | ä¼˜åŠ¿ |
|-----|------|------|
| **åŒè½¨åˆ¶å®¡æ‰¹** | ç”¨æˆ·æäº¤+å§”å‘˜ä¼šå®¡æ‰¹ | å¹³è¡¡æ•ˆç‡ä¸å…¬æ­£ |
| **å…¬ç¤ºæœŸæœºåˆ¶** | æ‰¹å‡†åè¿›å…¥å…¬ç¤ºæœŸ | ç»™å„æ–¹ååº”æ—¶é—´ |
| **è‡ªåŠ¨æ‰§è¡Œ** | on_initializeè‡ªåŠ¨è§¦å‘ | æ— éœ€æ‰‹åŠ¨å¹²é¢„ |
| **å¤±è´¥é‡è¯•** | æœ€å¤š3æ¬¡è‡ªåŠ¨é‡è¯• | æé«˜æˆåŠŸç‡ |
| **åº”ç­”å¦å†³** | ownerä¸»åŠ¨å“åº”å¯è‡ªåŠ¨å¦å†³ | é¼“åŠ±ä¸»åŠ¨è§£å†³ |
| **å¹¶å‘æ§åˆ¶** | åŒä¸»ä½“ä¸²è¡ŒåŒ– | é˜²æ­¢ç«æ€æ¡ä»¶ |
| **åŠ¨æ€æŠ¼é‡‘** | æ”¯æŒæŒ‰åŸŸ/åŠ¨ä½œå·®å¼‚åŒ– | çµæ´»å¯æ‰©å±• |

### é€‚ç”¨åœºæ™¯

âœ… **å†…å®¹å®¡æ ¸**ï¼šä¸å½“å†…å®¹ç”³è¯‰
âœ… **æƒåˆ©ä¿æŠ¤**ï¼šä¾µæƒ/ç›—ç”¨ç”³è¯‰
âœ… **äº‰è®®ä»²è£**ï¼šç”¨æˆ·é—´çº çº·
âœ… **å¤±é’¥æ•‘æµ**ï¼šownerç§é’¥ä¸¢å¤±
âœ… **åˆè§„ç®¡ç†**ï¼šè¿è§„å†…å®¹å¤„ç†

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [pallet-memo-content-governance README](../pallets/memo-content-governance/README.md)
- [ç”³è¯‰æŠ¼é‡‘æ”¹è¿›éœ€æ±‚-å¯è¡Œæ€§åˆ†æ](./ç”³è¯‰æŠ¼é‡‘æ”¹è¿›éœ€æ±‚-å¯è¡Œæ€§åˆ†æ.md)
- [é€šè¿‡æŠ•è¯‰å¯æ›´æ”¹å­—æ®µåˆ†ææŠ¥å‘Š](./é€šè¿‡æŠ•è¯‰å¯æ›´æ”¹å­—æ®µåˆ†ææŠ¥å‘Š.md)
- [æ²»ç†è·¯ç”±ç è¡¨](../pallets/memo-content-governance/README.md#è·¯ç”±ç è¡¨)

---

*åŠŸèƒ½åˆ†ææ–‡æ¡£ | ç”Ÿæˆæ—¶é—´ï¼š2025-10-25*
*æ¨¡å—ç‰ˆæœ¬ï¼šv1.0*
*ä½œè€…ï¼šMemoMart Development Team*

