# Stardust DApp å‰ç«¯å†—ä½™ä»£ç å’ŒåŠŸèƒ½æ¸…ç†æŠ¥å‘Š

> ç”Ÿæˆæ—¥æœŸï¼š2025-10-27  
> é¡¹ç›®è·¯å¾„ï¼š/home/xiaodong/æ–‡æ¡£/stardust/stardust-dapp

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [ä¸¥é‡å†—ä½™](#ä¸¥é‡å†—ä½™)
3. [ä¸­ç­‰å†—ä½™](#ä¸­ç­‰å†—ä½™)
4. [è½»åº¦å†—ä½™](#è½»åº¦å†—ä½™)
5. [å»ºè®®çš„æ¸…ç†æ­¥éª¤](#å»ºè®®çš„æ¸…ç†æ­¥éª¤)
6. [æ½œåœ¨é£é™©æç¤º](#æ½œåœ¨é£é™©æç¤º)

---

## æ¦‚è¿°

æœ¬æŠ¥å‘Šé€šè¿‡ç³»ç»Ÿæ‰«æå’Œåˆ†æï¼Œè¯†åˆ«å‡ºé¡¹ç›®ä¸­çš„å†—ä½™ä»£ç ã€é‡å¤åŠŸèƒ½å’Œæœªä½¿ç”¨çš„æ–‡ä»¶ã€‚æŒ‰ç…§å½±å“ç¨‹åº¦åˆ†ä¸ºä¸‰ä¸ªç­‰çº§ï¼š

- **ä¸¥é‡å†—ä½™**ï¼šé‡å¤çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œé€ æˆç»´æŠ¤å›°éš¾å’Œæ½œåœ¨ bug
- **ä¸­ç­‰å†—ä½™**ï¼šå¤‡ä»½æ–‡ä»¶ã€æµ‹è¯•æ–‡ä»¶ç­‰å¯ä»¥åˆ é™¤çš„æ–‡ä»¶
- **è½»åº¦å†—ä½™**ï¼šä»£ç ç»“æ„å¯ä»¥ä¼˜åŒ–ä½†ä¸å½±å“åŠŸèƒ½

---

## ä¸¥é‡å†—ä½™

### 1. é‡å¤çš„ Context å¯¼å‡º

**é—®é¢˜æè¿°**ï¼šå­˜åœ¨3ä¸ªä¸åŒçš„æ–‡ä»¶å¯¼å‡ºç›¸åŒçš„ `WalletProvider`ï¼Œé€ æˆå¯¼å…¥æ··ä¹±ã€‚

#### ç›¸å…³æ–‡ä»¶ï¼š

1. **src/context/PolkadotContext.tsx**
   - é‡æ–°å¯¼å‡º `WalletProvider` ä¸º `PolkadotProvider`
   - é‡æ–°å¯¼å‡º `useWallet` ä¸º `usePolkadot`

2. **src/contexts/AccountContext.tsx**
   - é‡æ–°å¯¼å‡º `WalletProvider` ä¸º `AccountProvider`
   - é‡æ–°å¯¼å‡º `useWallet` ä¸º `useAccount`

3. **src/substrate/SubstrateContext.tsx**
   - é‡æ–°å¯¼å‡º `WalletProvider` ä¸º `SubstrateProvider`
   - é‡æ–°å¯¼å‡º `useWallet` ä¸º `useSubstrate` å’Œ `useSubstrateContext`

#### å®é™…ä½¿ç”¨æƒ…å†µï¼š

- `src/features/operator-rewards/OperatorRewardsDashboard.tsx` ä½¿ç”¨ `usePolkadot` (PolkadotContext)
- `src/features/chat/ChatWindow.tsx` ä½¿ç”¨ `useAccount` (AccountContext)
- `src/features/chat/ChatList.tsx` ä½¿ç”¨ `useAccount` (AccountContext)
- `src/features/storage-treasury/StorageTreasuryDashboard.tsx` ä½¿ç”¨ `useSubstrateContext` (SubstrateContext)

#### å½±å“ï¼š

- ğŸ”´ **é«˜é£é™©**ï¼šå¤šä¸ªåˆ«åå¯èƒ½å¯¼è‡´å¼€å‘è€…å›°æƒ‘
- ğŸ”´ **ç»´æŠ¤å›°éš¾**ï¼šå¦‚æœ `WalletProvider` æ”¹å˜ï¼Œéœ€è¦ç¡®è®¤æ‰€æœ‰åˆ«åä»ç„¶æœ‰æ•ˆ
- ğŸ”´ **ä»£ç ç†è§£å›°éš¾**ï¼šæ–°å¼€å‘è€…éš¾ä»¥ç†è§£è¿™äº› Context çš„åŒºåˆ«

#### å»ºè®®ï¼š

**æ–¹æ¡ˆ1ï¼ˆæ¨èï¼‰**ï¼šç»Ÿä¸€ä½¿ç”¨ `WalletProvider`
- åˆ é™¤è¿™3ä¸ªé‡æ–°å¯¼å‡ºæ–‡ä»¶
- å…¨å±€æ›¿æ¢æ‰€æœ‰å¼•ç”¨ä¸º `import { useWallet, WalletProvider } from './providers/WalletProvider'`

**æ–¹æ¡ˆ2**ï¼šä¿ç•™ä¸€ä¸ªåˆ«å
- åªä¿ç•™ä¸€ä¸ªæœ€å¸¸ç”¨çš„åˆ«åï¼ˆå¦‚ `AccountContext`ï¼‰
- åˆ é™¤å…¶ä»–ä¸¤ä¸ª
- æ›´æ–°æ‰€æœ‰å¼•ç”¨

---

### 2. é‡å¤çš„ Hook å¯¼å‡º

**é—®é¢˜æè¿°**ï¼š`hooks` ç›®å½•ä¸­å­˜åœ¨é‡å¤çš„ Hook å®šä¹‰ã€‚

#### ç›¸å…³æ–‡ä»¶ï¼š

1. **src/hooks/useAccount.ts**
   - ä» `WalletProvider` å¯¼å…¥ `useWallet`
   - å°è£…è¿”å› `selectedAccount || currentAccount`

2. **src/hooks/useWallet.ts**
   - ç›´æ¥é‡æ–°å¯¼å‡º `WalletProvider` çš„ `useWallet`

#### å½±å“ï¼š

- ğŸŸ¡ **ä¸­ç­‰é£é™©**ï¼šä¸¤ä¸ªåŠŸèƒ½ç•¥æœ‰ä¸åŒä½†å®¹æ˜“æ··æ·†
- ğŸŸ¡ **å‘½åå†²çª**ï¼šå­˜åœ¨ä¸¤ä¸ªä¸ wallet/account ç›¸å…³çš„ hooks

#### å»ºè®®ï¼š

- ä¿ç•™ `useWallet`ï¼ˆç›´æ¥é‡æ–°å¯¼å‡ºï¼‰
- å°† `useAccount` é‡å‘½åä¸º `useCurrentAccount` æˆ–åˆå¹¶åˆ° `useWallet` ä¸­

---

### 3. é‡å¤çš„å®‰å…¨å­˜å‚¨å®ç°

**é—®é¢˜æè¿°**ï¼šå­˜åœ¨ä¸¤ä¸ªä¸åŒçš„ `SecureStorage` ç±»å®ç°ã€‚

#### ç›¸å…³æ–‡ä»¶ï¼š

1. **src/lib/secureStorage.ts**
   - ä½¿ç”¨ CryptoJS è¿›è¡Œ AES åŠ å¯†
   - å®Œæ•´çš„åŠ å¯†å­˜å‚¨å®ç°
   - ä¾èµ– `crypto-js` åº“

2. **src/lib/secureStorageSimple.ts**
   - ä½¿ç”¨ Base64 ç¼–ç ï¼ˆéåŠ å¯†ï¼‰
   - æ³¨é‡Šè¯´æ˜æ˜¯"ä¸´æ—¶è§£å†³æ–¹æ¡ˆ"
   - é¿å… crypto-js å¯¼å…¥é”™è¯¯

#### å½±å“ï¼š

- ğŸ”´ **å®‰å…¨é£é™©**ï¼šä¸¤ä¸ªå®ç°çš„å®‰å…¨ç­‰çº§ä¸åŒ
- ğŸ”´ **æ··æ·†é£é™©**ï¼šå¼€å‘è€…å¯èƒ½ä¸çŸ¥é“ä½¿ç”¨å“ªä¸€ä¸ª
- ğŸ”´ **ç»´æŠ¤å›°éš¾**ï¼šæ¥å£ç›¸åŒä½†å®ç°ä¸åŒ

#### å»ºè®®ï¼š

1. ç¡®è®¤é¡¹ç›®ä¸­å®é™…ä½¿ç”¨çš„æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼ˆæœç´¢å¯¼å…¥è¯­å¥ï¼‰
2. å¦‚æœ `crypto-js` é—®é¢˜å·²è§£å†³ï¼Œåˆ é™¤ `secureStorageSimple.ts`
3. å¦‚æœä»éœ€è¦ç®€åŒ–ç‰ˆæœ¬ï¼Œåº”è¯¥æ”¹åä¸º `SecureStorageBase64` ä»¥æ˜ç¡®åŒºåˆ†

---

### 4. é‡å¤çš„å¤šæ¥æ”¶æ–¹åŠ å¯†æ¥å£

**é—®é¢˜æè¿°**ï¼šä¸¤ä¸ªæ–‡ä»¶å®šä¹‰äº†ç›¸ä¼¼ä½†ä¸åŒçš„ `MultiRecipientEncryptedData` æ¥å£ã€‚

#### ç›¸å…³æ–‡ä»¶ï¼š

1. **src/utils/committeeEncryption.ts**
   - å®šä¹‰äº† `MultiRecipientEncryptedData` æ¥å£
   - ç”¨äºå§”å‘˜ä¼šé—¨é™åŠ å¯†
   - `encrypted_keys` åªåŒ…å« `owner` å’Œ `committee` ä¸¤ä¸ªå­—æ®µ

2. **src/utils/multiRecipientEncryption.ts**
   - ä¹Ÿå®šä¹‰äº† `MultiRecipientEncryptedData` æ¥å£
   - ç”¨äºå¤šæ¥æ”¶æ–¹åŠ å¯†
   - `encrypted_keys` æ˜¯åŠ¨æ€çš„ `[accountId: string]` æ˜ å°„

#### å½±å“ï¼š

- ğŸ”´ **ç±»å‹å†²çª**ï¼šåŒåæ¥å£åœ¨ä¸åŒæ–‡ä»¶ä¸­å®šä¹‰ä¸åŒ
- ğŸŸ¡ **åŠŸèƒ½é‡å **ï¼šä¸¤è€…éƒ½æ˜¯å¤„ç†å¤šæ–¹åŠ å¯†ï¼Œä½†æ–¹æ³•ä¸åŒ

#### å»ºè®®ï¼š

1. é‡å‘½åæ¥å£ä»¥é¿å…å†²çªï¼š
   - `CommitteeEncryptedData`ï¼ˆå§”å‘˜ä¼šç‰ˆæœ¬ï¼‰
   - `MultiRecipientEncryptedData`ï¼ˆé€šç”¨ç‰ˆæœ¬ï¼‰
2. æˆ–è€…ç»Ÿä¸€ä¸¤ç§å®ç°ä¸ºä¸€ä¸ªé€šç”¨æ–¹æ¡ˆ

---

### 5. é‡å¤çš„ IPFS æœåŠ¡

**é—®é¢˜æè¿°**ï¼šIPFS ç›¸å…³åŠŸèƒ½åœ¨ä¸¤ä¸ªä½ç½®å®šä¹‰ã€‚

#### ç›¸å…³æ–‡ä»¶ï¼š

1. **src/lib/ipfs.ts**
   - æ ¸å¿ƒ IPFS ä¸Šä¼ å®ç° `uploadToIpfs`
   - ç›´æ¥ä¸ IPFS API äº¤äº’

2. **src/services/ipfs.ts**
   - é‡æ–°å¯¼å‡º `lib/ipfs` çš„åŠŸèƒ½
   - æ·»åŠ äº† `fetchFromIPFS` å’Œ `uploadJson` åŒ…è£…å‡½æ•°
   - åŒ…å«å‘½åå…¼å®¹æ€§å¯¼å‡ºï¼ˆ`uploadToIPFS`ï¼‰

#### å½±å“ï¼š

- ğŸŸ¡ **ä¸­ç­‰å†—ä½™**ï¼š`services` å±‚ä¸»è¦æ˜¯é‡æ–°å¯¼å‡º
- ğŸŸ¢ **å¯æ¥å—**ï¼šå¦‚æœéµå¾ªåˆ†å±‚æ¶æ„ï¼Œè¿™æ˜¯åˆç†çš„

#### å»ºè®®ï¼š

- å¦‚æœé¡¹ç›®é‡‡ç”¨åˆ†å±‚æ¶æ„ï¼ˆlib/services/componentsï¼‰ï¼Œä¿æŒç°çŠ¶
- å¦‚æœä¸éœ€è¦åˆ†å±‚ï¼Œç›´æ¥ä½¿ç”¨ `lib/ipfs`
- ç»Ÿä¸€å¯¼å…¥è·¯å¾„ï¼ˆè¦ä¹ˆéƒ½ç”¨ `lib`ï¼Œè¦ä¹ˆéƒ½ç”¨ `services`ï¼‰

---

## ä¸­ç­‰å†—ä½™

### 6. æµ‹è¯•å’Œå¤‡ä»½æ–‡ä»¶

**é—®é¢˜æè¿°**ï¼šå­˜åœ¨æ˜æ˜¾çš„æµ‹è¯•æ–‡ä»¶å’Œå¤‡ä»½æ–‡ä»¶ï¼Œåº”è¯¥æ¸…ç†æˆ–ç§»åˆ°å…¶ä»–ç›®å½•ã€‚

#### éœ€è¦æ¸…ç†çš„æ–‡ä»¶ï¼š

1. **src/main-basic.tsx**
   - åŸºç¡€æµ‹è¯•å…¥å£æ–‡ä»¶
   - åŒ…å«æœ€ç®€å•çš„ React ç»„ä»¶
   - ğŸŸ  å»ºè®®åˆ é™¤æˆ–ç§»åˆ° `tests/` ç›®å½•

2. **src/main-test.tsx**
   - æµ‹è¯•å…¥å£æ–‡ä»¶
   - ç®€åŒ–çš„æµ‹è¯• App ç»„ä»¶
   - ğŸŸ  å»ºè®®åˆ é™¤æˆ–ç§»åˆ° `tests/` ç›®å½•

3. **src/features/affiliate/RewardParamsPanel.tsx.bak**
   - å¤‡ä»½æ–‡ä»¶
   - ğŸ”´ **åº”è¯¥ç«‹å³åˆ é™¤**

4. **src/features/affiliate/RewardParamsPanel.tsx.new**
   - æ–°ç‰ˆæœ¬æ–‡ä»¶ï¼ˆåŒ…å«æœªå®Œæˆçš„ä»£ç ï¼Œæœ‰bugï¼‰
   - ä»£ç å¼•ç”¨äº†æœªå®šä¹‰çš„å˜é‡ï¼ˆ`forwardJson`, `setForwardJson`, `buildForwardRequest`, `NAMESPACES`, `AppConfig`ï¼‰
   - ğŸ”´ **åº”è¯¥ä¿®å¤æˆ–åˆ é™¤**

#### å½±å“ï¼š

- ğŸŸ¡ **ä»£ç æ··ä¹±**ï¼šå¢åŠ é¡¹ç›®æ–‡ä»¶æ•°é‡
- ğŸŸ¡ **æ½œåœ¨çš„æ‰“åŒ…é—®é¢˜**ï¼šå¯èƒ½è¢«é”™è¯¯æ‰“åŒ…
- ğŸŸ¡ **ç»´æŠ¤å›°éš¾**ï¼šä¸æ¸…æ¥šå“ªä¸ªæ˜¯æ­£åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬

#### å»ºè®®ï¼š

```bash
# åˆ é™¤å¤‡ä»½æ–‡ä»¶
rm src/features/affiliate/RewardParamsPanel.tsx.bak

# å†³å®šæ˜¯å¦éœ€è¦ .new æ–‡ä»¶
# å¦‚æœéœ€è¦ï¼Œä¿®å¤ä»£ç å¹¶æ›¿æ¢ä¸»æ–‡ä»¶
# å¦‚æœä¸éœ€è¦ï¼Œç›´æ¥åˆ é™¤
rm src/features/affiliate/RewardParamsPanel.tsx.new

# ç§»åŠ¨æµ‹è¯•æ–‡ä»¶
mkdir -p tests/manual
mv src/main-basic.tsx tests/manual/
mv src/main-test.tsx tests/manual/
```

---

### 7. é‡å¤çš„ç›®å½•ç»“æ„

**é—®é¢˜æè¿°**ï¼šå­˜åœ¨å¤§å°å†™ä¸åŒçš„ç›¸ä¼¼ç›®å½•ï¼Œå¯èƒ½å¯¼è‡´æ··æ·†ã€‚

#### ç›¸å…³ç›®å½•ï¼š

1. **src/components/governance/** (å°å†™)
   - åŒ…å«ï¼š`AppealEntry.tsx`

2. **src/components/Governance/** (å¤§å†™)
   - åŒ…å«ï¼š`ViewEncryptedEvidence.tsx`

#### å½±å“ï¼š

- ğŸŸ¡ **å‘½åæ··æ·†**ï¼šå¼€å‘è€…ä¸çŸ¥é“åº”è¯¥æŠŠæ–‡ä»¶æ”¾åœ¨å“ªä¸ªç›®å½•
- ğŸŸ¡ **è·¨å¹³å°é—®é¢˜**ï¼šæŸäº›æ–‡ä»¶ç³»ç»Ÿï¼ˆmacOSé»˜è®¤ï¼‰ä¸åŒºåˆ†å¤§å°å†™
- ğŸŸ¡ **å¯¼å…¥æ··ä¹±**ï¼šå¯èƒ½å‡ºç°å¤§å°å†™ä¸åŒ¹é…çš„å¯¼å…¥

#### å»ºè®®ï¼š

**æ–¹æ¡ˆ1ï¼ˆæ¨èï¼‰**ï¼šç»Ÿä¸€ä½¿ç”¨å°å†™
```bash
# ç§»åŠ¨æ–‡ä»¶åˆ°å°å†™ç›®å½•
mv src/components/Governance/ViewEncryptedEvidence.tsx src/components/governance/
rmdir src/components/Governance
```

**æ–¹æ¡ˆ2**ï¼šæŒ‰åŠŸèƒ½åŒºåˆ†
- `governance/` - æ™®é€šæ²»ç†åŠŸèƒ½
- `Governance/` - ç‰¹æ®Šæ²»ç†åŠŸèƒ½ï¼ˆå¦‚åŠ å¯†è¯æ®ï¼‰
- éœ€è¦åœ¨ README ä¸­æ˜ç¡®è¯´æ˜åŒºåˆ†æ ‡å‡†

---

### 8. ç¤ºä¾‹ä»£ç æ–‡ä»¶

**é—®é¢˜æè¿°**ï¼šç”Ÿäº§ä»£ç ä¸­å­˜åœ¨ç¤ºä¾‹æ–‡ä»¶ã€‚

#### ç›¸å…³æ–‡ä»¶ï¼š

1. **src/examples/MultiRecipientEncryptionExample.tsx**
   - å¤šæ¥æ”¶æ–¹åŠ å¯†çš„ç¤ºä¾‹ç»„ä»¶
   - ä»…ç”¨äºæ¼”ç¤ºå’Œæµ‹è¯•

#### ä½¿ç”¨æƒ…å†µï¼š

- é€šè¿‡ `grep` æ£€æŸ¥ï¼Œå‘ç°åªæœ‰ä»¥ä¸‹æ–‡ä»¶å¼•ç”¨äº†å¤šæ¥æ”¶æ–¹åŠ å¯†åŠŸèƒ½ï¼š
  - `src/components/Dispute/SubmitChatEvidence.tsx`
  - `src/components/Governance/ViewEncryptedEvidence.tsx`
  - ä½†å®ƒä»¬ä½¿ç”¨çš„æ˜¯ `utils/multiRecipientEncryption.ts`ï¼Œä¸æ˜¯ç¤ºä¾‹æ–‡ä»¶

#### å½±å“ï¼š

- ğŸŸ¢ **ä½å½±å“**ï¼šå¦‚æœæ²¡æœ‰è¢«è·¯ç”±å¼•ç”¨ï¼Œä¸ä¼šæ‰“åŒ…åˆ°ç”Ÿäº§ç¯å¢ƒ
- ğŸŸ¡ **ä»£ç æ¸…æ´åº¦**ï¼šå ç”¨é¡¹ç›®ç©ºé—´

#### å»ºè®®ï¼š

- å¦‚æœç”¨äºå¼€å‘æ–‡æ¡£æˆ–æ¼”ç¤ºï¼Œç§»åˆ° `docs/examples/` æˆ– `tests/examples/`
- å¦‚æœä¸å†ä½¿ç”¨ï¼Œç›´æ¥åˆ é™¤
- å¯ä»¥ä¿ç•™ä½†æ·»åŠ åˆ° `.gitignore` æˆ–å•ç‹¬çš„åˆ†æ”¯

---

## è½»åº¦å†—ä½™

### 9. å¤šä¸ª Dashboard é¡µé¢

**é—®é¢˜æè¿°**ï¼šå­˜åœ¨å¤šä¸ªç‹¬ç«‹çš„ Dashboard é¡µé¢ï¼Œå¯èƒ½æœ‰åŠŸèƒ½é‡å ã€‚

#### ç›¸å…³æ–‡ä»¶ï¼š

1. `src/features/dashboard/DashboardPage.tsx`
2. `src/features/bridge/MakerBridgeDashboard.tsx`
3. `src/features/market-maker/MakerCreditDashboard.tsx`
4. `src/features/monitoring/PriceDashboard.tsx`
5. `src/features/operator-rewards/OperatorRewardsDashboard.tsx`
6. `src/features/storage-treasury/IpfsFeeDashboard.tsx`
7. `src/features/storage-treasury/StorageTreasuryDashboard.tsx`

#### åˆ†æï¼š

è¿™äº› Dashboard é¡µé¢åŠŸèƒ½å„å¼‚ï¼Œå¯èƒ½æ˜¯åˆç†çš„ä¸šåŠ¡éœ€æ±‚ï¼š
- é€šç”¨ Dashboard
- åšå¸‚å•†ç›¸å…³ Dashboardï¼ˆæ¡¥æ¥ã€ä¿¡ç”¨ï¼‰
- ç›‘æ§ Dashboardï¼ˆä»·æ ¼ã€å­˜å‚¨è´¹ç”¨ï¼‰
- è¿è¥è€…å¥–åŠ± Dashboard

#### å½±å“ï¼š

- ğŸŸ¢ **å¯èƒ½åˆç†**ï¼šä¸åŒçš„ä¸šåŠ¡æ¨¡å—éœ€è¦ä¸åŒçš„ Dashboard
- ğŸŸ¡ **UIé‡å¤**ï¼šå¯èƒ½å­˜åœ¨ç›¸ä¼¼çš„å¸ƒå±€å’Œç»„ä»¶

#### å»ºè®®ï¼š

1. **ä»£ç å®¡æŸ¥**ï¼šæ£€æŸ¥è¿™äº› Dashboard æ˜¯å¦æœ‰ç›¸ä¼¼çš„å¸ƒå±€å’Œç»„ä»¶
2. **æå–å…±äº«ç»„ä»¶**ï¼šå¦‚æœæœ‰é‡å¤çš„å¡ç‰‡ã€å›¾è¡¨ç­‰ç»„ä»¶ï¼Œæå–ä¸ºå…±äº«ç»„ä»¶
3. **åˆ›å»º Dashboard æ¨¡æ¿**ï¼šåˆ›å»ºé€šç”¨çš„ Dashboard å¸ƒå±€ç»„ä»¶
4. **æš‚ä¸åˆ é™¤**ï¼šä¿æŒè¿™äº›ç‹¬ç«‹çš„ Dashboard é¡µé¢

---

### 10. Hooks å¯¼å‡ºä¸å®Œæ•´

**é—®é¢˜æè¿°**ï¼š`src/hooks/index.ts` åªå¯¼å‡ºäº†éƒ¨åˆ† hooksã€‚

#### å½“å‰å¯¼å‡ºï¼š

```typescript
export * from './usePinStatus';
export * from './useTripleChargeCheck';
export * from './useStoragePoolAccounts';
```

#### æœªå¯¼å‡ºçš„ Hooksï¼š

- `useAccount.ts`
- `useApi.ts`
- `useBalance.ts`
- `useChainInfo.ts`
- `useDeceasedEvents.ts`
- `useDeceasedPagination.ts`
- `useEffectSetEvents.ts`
- `useKyc.ts`
- `useMediaQuery.ts`
- `usePricing.ts`
- `useReferendumStatus.ts`
- `useRelationships.ts`
- `useWallet.ts`

#### å½±å“ï¼š

- ğŸŸ¢ **ä½å½±å“**ï¼šå¯èƒ½æ˜¯æœ‰æ„ä¸ºä¹‹ï¼ˆåªå¯¼å‡ºå…¬å…± hooksï¼‰
- ğŸŸ¡ **ä¸ä¸€è‡´**ï¼šæœ‰äº› hooks éœ€è¦æŒ‡å®šè·¯å¾„å¯¼å…¥

#### å»ºè®®ï¼š

**æ–¹æ¡ˆ1**ï¼šå¯¼å‡ºæ‰€æœ‰ hooksï¼ˆæ¨èï¼‰
```typescript
export * from './useAccount';
export * from './useApi';
export * from './useBalance';
// ... å¯¼å‡ºæ‰€æœ‰
```

**æ–¹æ¡ˆ2**ï¼šæ˜ç¡®åŒºåˆ†å…¬å…±å’Œç§æœ‰ hooks
- `hooks/` - ç§æœ‰ hooks
- `hooks/public.ts` - å…¬å…± hooks å¯¼å‡º

---

### 11. ä»£ç ä¸­çš„ TODO æ³¨é‡Š

**é—®é¢˜æè¿°**ï¼šä»£ç ä¸­å­˜åœ¨ 19 ä¸ª TODO/FIXME/XXX/HACK æ³¨é‡Šã€‚

#### åˆ†å¸ƒæƒ…å†µï¼š

é€šè¿‡æœç´¢å‘ç° 14 ä¸ªæ–‡ä»¶ä¸­æœ‰ 19 ä¸ª TODO æ ‡è®°ï¼š

- `src/services/unified-complaint.ts` - 1ä¸ª
- `src/components/deceased/RelationProposalManager.tsx` - 2ä¸ª
- `src/hooks/usePinStatus.ts` - 1ä¸ª
- `src/features/chat/ChatList.tsx` - 1ä¸ª
- `src/utils/committeeEncryption.ts` - 1ä¸ª
- `src/features/otc/CreateOrderPage.tsx` - 2ä¸ª
- `src/features/bridge/MakerBridgeComplaintPage.tsx` - 1ä¸ª
- `src/components/feedback/FeedbackModal.tsx` - 1ä¸ª
- `src/features/membership/MembershipAnalyticsPage.tsx` - 2ä¸ª
- `src/features/otc/DecryptFilePage.tsx` - 2ä¸ª
- `src/components/FileEncryptUpload.tsx` - 1ä¸ª
- `src/features/wallet/WalletManagePage.tsx` - 1ä¸ª
- `src/components/discovery/HotGravesList.tsx` - 2ä¸ª
- `src/lib/private-content.ts` - 1ä¸ª

#### å½±å“ï¼š

- ğŸŸ¢ **ä½å½±å“**ï¼šTODO æ³¨é‡Šæ˜¯æ­£å¸¸çš„å¼€å‘å®è·µ
- ğŸŸ¡ **æŠ€æœ¯å€ºåŠ¡**ï¼šåº”è¯¥å®šæœŸæ¸…ç†

#### å»ºè®®ï¼š

1. åˆ›å»º GitHub Issues è·Ÿè¸ªè¿™äº› TODO
2. å®šæœŸå®¡æŸ¥å¹¶å®ç°æˆ–åˆ é™¤è¿‡æ—¶çš„ TODO
3. ä½¿ç”¨å·¥å…·ï¼ˆå¦‚ `todo-tree` VS Code æ’ä»¶ï¼‰ç®¡ç† TODO

---

## å»ºè®®çš„æ¸…ç†æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šåˆ é™¤æ˜ç¡®çš„å†—ä½™æ–‡ä»¶ï¼ˆä½é£é™©ï¼‰

```bash
# 1. åˆ é™¤å¤‡ä»½æ–‡ä»¶
rm src/features/affiliate/RewardParamsPanel.tsx.bak
rm src/features/affiliate/RewardParamsPanel.tsx.new  # æˆ–ä¿®å¤åå†å†³å®š

# 2. ç§»åŠ¨æµ‹è¯•æ–‡ä»¶
mkdir -p tests/manual
mv src/main-basic.tsx tests/manual/
mv src/main-test.tsx tests/manual/

# 3. ç§»åŠ¨ç¤ºä¾‹æ–‡ä»¶
mkdir -p docs/examples
mv src/examples/MultiRecipientEncryptionExample.tsx docs/examples/
```

### ç¬¬äºŒé˜¶æ®µï¼šç»Ÿä¸€ç›®å½•ç»“æ„ï¼ˆä¸­ç­‰é£é™©ï¼‰

```bash
# åˆå¹¶ Governance ç›®å½•
mv src/components/Governance/ViewEncryptedEvidence.tsx src/components/governance/
rmdir src/components/Governance

# æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„
# ä½¿ç”¨ç¼–è¾‘å™¨çš„å…¨å±€æœç´¢æ›¿æ¢åŠŸèƒ½
```

### ç¬¬ä¸‰é˜¶æ®µï¼šç»Ÿä¸€ Context ä½¿ç”¨ï¼ˆé«˜é£é™©ï¼Œéœ€è¦æµ‹è¯•ï¼‰

1. **å‡†å¤‡é˜¶æ®µ**ï¼š
   - åˆ›å»ºæ–°åˆ†æ”¯ `refactor/unify-context`
   - ç¡®ä¿æœ‰å®Œæ•´çš„æµ‹è¯•è¦†ç›–

2. **æ‰§è¡Œæ›¿æ¢**ï¼š
   ```bash
   # å…¨å±€æ›¿æ¢å¯¼å…¥è¯­å¥
   # æ›¿æ¢ PolkadotContext
   find src -name "*.tsx" -o -name "*.ts" | xargs sed -i "s|from '../../context/PolkadotContext'|from '../../providers/WalletProvider'|g"
   find src -name "*.tsx" -o -name "*.ts" | xargs sed -i "s|usePolkadot|useWallet|g"
   
   # æ›¿æ¢ AccountContext
   find src -name "*.tsx" -o -name "*.ts" | xargs sed -i "s|from '../../contexts/AccountContext'|from '../../providers/WalletProvider'|g"
   # useAccount éœ€è¦ç‰¹æ®Šå¤„ç†ï¼ˆå› ä¸ºå®ƒçš„é€»è¾‘ä¸åŒï¼‰
   
   # æ›¿æ¢ SubstrateContext
   find src -name "*.tsx" -o -name "*.ts" | xargs sed -i "s|from '../../substrate/SubstrateContext'|from '../../providers/WalletProvider'|g"
   find src -name "*.tsx" -o -name "*.ts" | xargs sed -i "s|useSubstrateContext|useWallet|g"
   ```

3. **åˆ é™¤å†—ä½™æ–‡ä»¶**ï¼š
   ```bash
   rm src/context/PolkadotContext.tsx
   rm src/contexts/AccountContext.tsx
   rm src/substrate/SubstrateContext.tsx
   
   # åˆ é™¤ç©ºç›®å½•
   rmdir src/context
   rmdir src/contexts
   rmdir src/substrate
   ```

4. **æµ‹è¯•**ï¼š
   - è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
   - æ‰‹åŠ¨æµ‹è¯•æ‰€æœ‰æ¶‰åŠ wallet/account çš„åŠŸèƒ½

### ç¬¬å››é˜¶æ®µï¼šç»Ÿä¸€å®‰å…¨å­˜å‚¨å®ç°ï¼ˆé«˜é£é™©ï¼‰

1. **ç¡®è®¤ä½¿ç”¨æƒ…å†µ**ï¼š
   ```bash
   grep -r "from.*secureStorage" src/
   grep -r "from.*secureStorageSimple" src/
   ```

2. **å†³å®šä¿ç•™å“ªä¸ªç‰ˆæœ¬**ï¼š
   - å¦‚æœ `crypto-js` æ­£å¸¸å·¥ä½œ â†’ åˆ é™¤ `secureStorageSimple.ts`
   - å¦‚æœä»éœ€è¦ç®€åŒ–ç‰ˆæœ¬ â†’ é‡å‘½åå¹¶æ˜ç¡®åŒºåˆ†

3. **æ›´æ–°æ‰€æœ‰å¼•ç”¨**

### ç¬¬äº”é˜¶æ®µï¼šé‡æ„åŠ å¯†æ¥å£ï¼ˆé«˜é£é™©ï¼‰

1. **é‡å‘½åæ¥å£ä»¥é¿å…å†²çª**
2. **æ›´æ–°æ‰€æœ‰ä½¿ç”¨è¿™äº›æ¥å£çš„ä»£ç **
3. **è¯„ä¼°æ˜¯å¦å¯ä»¥ç»Ÿä¸€ä¸¤ç§å®ç°**

---

## æ½œåœ¨é£é™©æç¤º

### âš ï¸ åˆ é™¤æ–‡ä»¶å‰çš„æ£€æŸ¥æ¸…å•

åœ¨åˆ é™¤ä»»ä½•æ–‡ä»¶å‰ï¼Œè¯·ç¡®ä¿ï¼š

1. âœ… æœç´¢æ•´ä¸ªé¡¹ç›®ï¼Œç¡®è®¤æ–‡ä»¶æ²¡æœ‰è¢«å¼•ç”¨
   ```bash
   # æœç´¢æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰
   grep -r "æ–‡ä»¶å" src/
   
   # æœç´¢å¯¼å…¥è¯­å¥
   grep -r "from.*æ–‡ä»¶è·¯å¾„" src/
   ```

2. âœ… æ£€æŸ¥è·¯ç”±é…ç½®
   ```bash
   # æ£€æŸ¥ routes.tsx
   grep "æ–‡ä»¶è·¯å¾„" src/routes.tsx
   ```

3. âœ… æ£€æŸ¥åŠ¨æ€å¯¼å…¥
   ```bash
   # æœç´¢ import() è¯­å¥
   grep -r "import(.*æ–‡ä»¶" src/
   ```

4. âœ… ç¡®ä¿æœ‰ Git å¤‡ä»½
   ```bash
   git status
   git add .
   git commit -m "å¤‡ä»½ï¼šæ¸…ç†å‰çš„çŠ¶æ€"
   ```

### ğŸš¨ é«˜é£é™©æ“ä½œ

ä»¥ä¸‹æ“ä½œéœ€è¦ç‰¹åˆ«å°å¿ƒï¼Œå»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯ï¼š

1. **åˆ é™¤ Context æ–‡ä»¶**ï¼šå¯èƒ½å½±å“æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ç®¡ç†
2. **ä¿®æ”¹å®‰å…¨å­˜å‚¨**ï¼šå¯èƒ½å¯¼è‡´ç°æœ‰æ•°æ®æ— æ³•è§£å¯†
3. **ä¿®æ”¹åŠ å¯†æ¥å£**ï¼šå½±å“æ•æ„Ÿæ•°æ®çš„åŠ å¯†/è§£å¯†
4. **é‡å‘½å/ç§»åŠ¨ç›®å½•**ï¼šå¯èƒ½å½±å“å¤§é‡å¯¼å…¥è¯­å¥

### ğŸ“ æ¸…ç†åçš„éªŒè¯æ­¥éª¤

1. **ç¼–è¯‘æ£€æŸ¥**ï¼š
   ```bash
   npm run build
   ```

2. **ç±»å‹æ£€æŸ¥**ï¼š
   ```bash
   npm run type-check  # æˆ– tsc --noEmit
   ```

3. **Lint æ£€æŸ¥**ï¼š
   ```bash
   npm run lint
   ```

4. **è¿è¡Œæµ‹è¯•**ï¼š
   ```bash
   npm run test
   ```

5. **æ‰‹åŠ¨æµ‹è¯•**ï¼š
   - å¯åŠ¨å¼€å‘æœåŠ¡å™¨
   - æµ‹è¯•æ‰€æœ‰ä¸»è¦åŠŸèƒ½
   - ç‰¹åˆ«å…³æ³¨é’±åŒ…è¿æ¥ã€æ•°æ®åŠ å¯†ç­‰æ ¸å¿ƒåŠŸèƒ½

---

## æ€»ç»“

### å†—ä½™ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ | ä¼˜å…ˆçº§ |
|------|------|--------|
| é‡å¤çš„ Context å¯¼å‡º | 3 ä¸ªæ–‡ä»¶ | ğŸ”´ é«˜ |
| é‡å¤çš„å­˜å‚¨å®ç° | 2 ä¸ªæ–‡ä»¶ | ğŸ”´ é«˜ |
| é‡å¤çš„åŠ å¯†æ¥å£ | 2 ä¸ªæ¥å£ | ğŸ”´ é«˜ |
| å¤‡ä»½å’Œæµ‹è¯•æ–‡ä»¶ | 4 ä¸ªæ–‡ä»¶ | ğŸŸ  ä¸­ |
| é‡å¤ç›®å½•ç»“æ„ | 1 ç»„ç›®å½• | ğŸŸ  ä¸­ |
| ç¤ºä¾‹æ–‡ä»¶ | 1 ä¸ªæ–‡ä»¶ | ğŸŸ¡ ä½ |
| Dashboard é‡å¤ | 7 ä¸ªé¡µé¢ | ğŸŸ¡ ä½ï¼ˆéœ€å®¡æŸ¥ï¼‰|
| TODO æ³¨é‡Š | 19 å¤„ | ğŸŸ¡ ä½ |

### é¢„è®¡æ¸…ç†æ•ˆæœ

- **åˆ é™¤æ–‡ä»¶**ï¼šçº¦ 4-6 ä¸ªæ–‡ä»¶
- **å‡å°‘ä»£ç è¡Œæ•°**ï¼šçº¦ 500-800 è¡Œ
- **æå‡ä»£ç è´¨é‡**ï¼šå‡å°‘æ··æ·†ï¼Œæé«˜å¯ç»´æŠ¤æ€§
- **é™ä½æŠ€æœ¯å€ºåŠ¡**ï¼šç»Ÿä¸€ä»£ç é£æ ¼å’Œæ¶æ„

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³æ‰§è¡Œ**ï¼ˆå®‰å…¨æ“ä½œï¼‰ï¼š
   - åˆ é™¤ `.bak` å’Œ `.new` å¤‡ä»½æ–‡ä»¶
   - ç§»åŠ¨æµ‹è¯•æ–‡ä»¶åˆ°ä¸“é—¨ç›®å½•

2. **è®¡åˆ’æ‰§è¡Œ**ï¼ˆéœ€è¦æµ‹è¯•ï¼‰ï¼š
   - ç»Ÿä¸€ Context ä½¿ç”¨
   - åˆå¹¶ç›®å½•ç»“æ„
   - å†³å®šå®‰å…¨å­˜å‚¨æ–¹æ¡ˆ

3. **é•¿æœŸä¼˜åŒ–**ï¼ˆæŒç»­æ”¹è¿›ï¼‰ï¼š
   - æå– Dashboard å…±äº«ç»„ä»¶
   - ç»Ÿä¸€åŠ å¯†æ¥å£
   - æ¸…ç† TODO æ³¨é‡Š

---

## é™„å½•

### ç›¸å…³å‘½ä»¤

```bash
# æœç´¢æ‰€æœ‰ import è¯­å¥
grep -r "^import" src/ | wc -l

# ç»Ÿè®¡æ–‡ä»¶æ•°é‡
find src/ -type f -name "*.tsx" -o -name "*.ts" | wc -l

# æŸ¥æ‰¾å¤§æ–‡ä»¶
find src/ -type f -exec du -h {} + | sort -rh | head -20

# æŸ¥æ‰¾æœªä½¿ç”¨çš„å¯¼å‡ºï¼ˆéœ€è¦å·¥å…·æ”¯æŒï¼‰
npx ts-prune

# æŸ¥æ‰¾å¾ªç¯ä¾èµ–
npx madge --circular src/
```

### æ¨èå·¥å…·

1. **ts-prune**ï¼šæŸ¥æ‰¾æœªä½¿ç”¨çš„å¯¼å‡º
2. **madge**ï¼šåˆ†æä¾èµ–å…³ç³»å’Œå¾ªç¯ä¾èµ–
3. **depcheck**ï¼šæŸ¥æ‰¾æœªä½¿ç”¨çš„ä¾èµ–
4. **eslint-plugin-unused-imports**ï¼šæŸ¥æ‰¾æœªä½¿ç”¨çš„å¯¼å…¥

---

**æŠ¥å‘Šç»“æŸ**

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„åˆ†æï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

