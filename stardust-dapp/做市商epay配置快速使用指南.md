# 做市商 Epay 配置快速使用指南

## 📋 更新概要

本次更新为做市商系统添加了完整的 Epay 支付网关配置功能，包括：
- ✅ 新增 `epay_port` 端口配置字段
- ✅ 新增专用配置管理页面
- ✅ 优化申请流程，支持完整 epay 配置
- ✅ 委员会审批页面显示端口信息

---

## 🚀 快速开始

### 1️⃣ 新做市商申请（含 epay 配置）

**页面路径**: `#/otc/create-mm`

**操作步骤**:
1. **步骤1 - 质押保证金**:
   - 输入质押金额（最少 1000 MEMO）
   - 点击"签名质押"
   - 等待交易确认

2. **步骤2 - 提交资料**:
   
   **基础资料**:
   - 公开资料根 CID
   - 私密资料根 CID
   - 费率（bps）
   - 最小下单额（MEMO）

   **🆕 Epay 支付网关配置**:
   ```
   网关地址: http://111.170.145.41
   端口: 80
   商户ID: 123456
   商户密钥: ********
   首购资金池: 10000000.00 MEMO（一千万）
   ```

3. **提交并等待审核**:
   - 点击"提交资料"
   - 等待委员会审核（约1-3天）
   - 审核通过后自动激活

### 2️⃣ 已激活做市商配置管理

**页面路径**: `#/otc/mm-config` 🆕

**功能特性**:
- ✅ 查看当前配置和资金池状态
- ✅ 更新 epay 配置（立即生效）
- ✅ 充值首购资金池
- ✅ 实时监控服务数据

**使用方法**:

#### 查看配置
页面自动加载并显示：
- 做市商 ID 和状态
- Epay 网关地址和端口
- Epay 商户ID
- 首购资金池状态（总额/已用/冻结/可用）
- 已服务用户数

#### 更新配置
1. 修改需要更新的字段（其他留空）
2. 密钥字段需要重新输入完整密钥
3. 点击"保存配置"
4. 签名确认后立即生效

#### 充值资金池
1. 点击"充值首购资金池"按钮
2. 输入充值金额（例如：1000.00）
3. 签名确认
4. 资金转入专用账户

---

## 📝 表单字段说明

### Epay 支付网关地址
- **格式**: `http://` 或 `https://` 开头的 URL
- **示例**: `http://111.170.145.41`
- **说明**: 您的 epay 支付网关服务器地址

### Epay 支付网关端口
- **范围**: 1-65535
- **常用端口**:
  - `80`: HTTP 标准端口
  - `443`: HTTPS 标准端口（推荐）
  - `8080`: 常见的 HTTP 替代端口
- **示例**: `80`

### Epay 商户ID (PID)
- **格式**: 数字或字符串
- **示例**: `123456`
- **说明**: 您在 epay 平台注册的商户账号ID

### Epay 商户密钥
- **格式**: 字符串（通常为32-64位）
- **安全**: 加密存储在链上，仅用于验签
- **示例**: `a1b2c3d4e5f6...`（不公开显示）

### 首购资金池
- **最小值**: 10,000,000 MEMO（一千万 MEMO）
- **用途**: 为新用户提供首次购买优惠
- **管理**: 由 pallet 自动管理，不可提取

---

## 🔐 安全注意事项

### ✅ 密钥安全
- 密钥加密存储在链上
- 前端不显示已保存的密钥
- 修改时需要重新输入完整密钥
- 仅用于支付验签，不会明文传输

### ✅ 配置验证
- 网关地址需要有效的 URL 格式
- 端口范围：1-65535
- 商户ID和密钥不能为空
- 首购资金池最少 10,000,000 MEMO（一千万）

### ✅ 权限控制
- 只有 owner 可以更新配置
- Active 状态才能使用配置管理
- 充值资金后不可提取

---

## 🎯 使用场景示例

### 场景1: 首次申请做市商
```
操作流程:
1. 准备好 epay 账号信息
2. 访问申请页面 (#/otc/create-mm)
3. 完成质押（例如：1000 MEMO）
4. 填写资料和 epay 配置:
   - 网关: http://111.170.145.41
   - 端口: 80
   - PID: 123456
   - 密钥: ********
   - 资金池: 10000000 MEMO（一千万）
5. 提交并等待委员会审核
6. 审核通过后自动激活
```

### 场景2: 更换支付网关服务器
```
操作流程:
1. 访问配置管理页面 (#/otc/mm-config)
2. 修改网关地址和端口:
   - 网关: http://new-server.com
   - 端口: 443
3. 其他字段留空
4. 点击"保存配置"
5. 签名确认，立即生效
```

### 场景3: 更新商户密钥
```
操作流程:
1. 访问配置管理页面 (#/otc/mm-config)
2. 在密钥字段输入新密钥
3. 其他字段留空
4. 点击"保存配置"
5. 签名确认，立即生效
```

### 场景4: 充值首购资金池
```
操作流程:
1. 访问配置管理页面 (#/otc/mm-config)
2. 查看资金池状态（可用金额）
3. 点击"充值首购资金池"
4. 输入充值金额（例如：1000.00）
5. 签名确认
6. 资金转入专用账户
```

---

## ❓ 常见问题

### Q: 如何访问配置管理页面？
**A**: 直接访问 `#/otc/mm-config`，或在浏览器地址栏输入该路径。

### Q: 端口配置有什么要求？
**A**: 端口范围 1-65535，推荐使用 80 (HTTP) 或 443 (HTTPS)。

### Q: 更新配置后多久生效？
**A**: 使用配置管理页面更新，立即生效，无需审核。

### Q: 首购资金池可以提取吗？
**A**: 不可以，充值后资金由 pallet 自动管理，用于首购服务，确保用户权益。

### Q: 密钥安全吗？
**A**: 非常安全！密钥加密存储在链上，前端不显示，仅用于支付验签。

### Q: 申请时填错了怎么办？
**A**: 
- 在 `DepositLocked` 或 `PendingReview` 状态下可以使用申请页面的"更新资料"功能
- 在 `Active` 状态下使用配置管理页面更新

---

## 📞 技术支持

如遇到问题，请联系：
- **邮箱**: support@stardust.com
- **文档**: `/docs/做市商epay配置更新说明.md`
- **开发团队**: starDust 开发团队

---

## 📚 相关链接

- [做市商申请页面](#/otc/create-mm)
- [做市商配置管理](#/otc/mm-config)
- [委员会审批页面](#/gov/mm-review)
- [详细使用说明](/docs/做市商epay配置更新说明.md)

---

**最后更新**: 2025-10-14  
**版本**: v1.0.0

