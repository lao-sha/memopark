<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…«å­—æšä¸¾æ˜ å°„è¯Šæ–­å·¥å…·</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
      background: #f5f5f5;
    }
    h1 {
      color: #1890ff;
      border-bottom: 2px solid #1890ff;
      padding-bottom: 10px;
    }
    .test-section {
      background: white;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .test-case {
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .pass {
      background: #f6ffed;
      border-color: #b7eb8f;
    }
    .fail {
      background: #fff2e8;
      border-color: #ffbb96;
    }
    .result {
      font-weight: bold;
      margin-top: 5px;
    }
    code {
      background: #f5f5f5;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
    .info {
      background: #e6f7ff;
      border: 1px solid #91d5ff;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .warning {
      background: #fffbe6;
      border: 1px solid #ffe58f;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .success {
      background: #f6ffed;
      border: 1px solid #b7eb8f;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    button {
      background: #1890ff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #40a9ff;
    }
  </style>
</head>
<body>
  <h1>ğŸ” å…«å­—æšä¸¾æ˜ å°„è¯Šæ–­å·¥å…·</h1>

  <div class="info">
    <strong>ğŸ“‹ ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
    1. ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è¿è¡Œæµ‹è¯•<br>
    2. æ£€æŸ¥æ‰€æœ‰æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼ˆç»¿è‰²èƒŒæ™¯ï¼‰<br>
    3. å¦‚æœæœ‰å¤±è´¥ï¼ˆæ©™è‰²èƒŒæ™¯ï¼‰ï¼Œè¯·æˆªå›¾åé¦ˆ<br>
    4. æœ€åä¸€ä¸ªæµ‹è¯•ä¼šæ£€æŸ¥ä½ çš„å®é™…é¡µé¢æ•°æ®
  </div>

  <div class="test-section">
    <h2>1ï¸âƒ£ æšä¸¾æ˜ å°„é€»è¾‘æµ‹è¯•</h2>
    <button onclick="runMappingTests()">è¿è¡Œæ˜ å°„æµ‹è¯•</button>
    <div id="mapping-results"></div>
  </div>

  <div class="test-section">
    <h2>2ï¸âƒ£ æ•°æ®æ ¼å¼æµ‹è¯•</h2>
    <button onclick="runFormatTests()">è¿è¡Œæ ¼å¼æµ‹è¯•</button>
    <div id="format-results"></div>
  </div>

  <div class="test-section">
    <h2>3ï¸âƒ£ æµè§ˆå™¨ç¼“å­˜æ£€æµ‹</h2>
    <button onclick="checkCache()">æ£€æµ‹ç¼“å­˜</button>
    <div id="cache-results"></div>
  </div>

  <div class="test-section">
    <h2>4ï¸âƒ£ å®é™…æ•°æ®æµ‹è¯•</h2>
    <div class="warning">
      <strong>âš ï¸ æ³¨æ„ï¼š</strong>è¯·ç¡®ä¿å·²ç»æ‰“å¼€äº† <a href="http://localhost:5173/#/bazi/1" target="_blank">å…«å­—è¯¦æƒ…é¡µé¢</a>
    </div>
    <button onclick="fetchRealData()">è·å–å®é™…æ•°æ®</button>
    <div id="real-results"></div>
  </div>

  <script>
    // æšä¸¾æ˜ å°„è¡¨ï¼ˆä¸ä»£ç ä¸­ä¸€è‡´ï¼‰
    const nameMap = {
      // æ ¼å±€ï¼ˆ8ç§ï¼‰
      'ZhengGe': 'æ­£æ ¼',
      'CongQiangGe': 'ä»å¼ºæ ¼',
      'CongRuoGe': 'ä»å¼±æ ¼',
      'CongCaiGe': 'ä»è´¢æ ¼',
      'CongGuanGe': 'ä»å®˜æ ¼',
      'CongErGe': 'ä»å„¿æ ¼',
      'HuaQiGe': 'åŒ–æ°”æ ¼',
      'TeShuge': 'ç‰¹æ®Šæ ¼å±€',
      // å¼ºå¼±ï¼ˆ5ç§ï¼‰
      'ShenWang': 'èº«æ—º',
      'ShenRuo': 'èº«å¼±',
      'ZhongHe': 'ä¸­å’Œ',
      'TaiWang': 'å¤ªæ—º',
      'TaiRuo': 'å¤ªå¼±',
      // ç”¨ç¥ç±»å‹ï¼ˆ4ç§ï¼‰
      'FuYi': 'æ‰¶æŠ‘ç”¨ç¥',
      'DiaoHou': 'è°ƒå€™ç”¨ç¥',
      'TongGuan': 'é€šå…³ç”¨ç¥',
      'ZhuanWang': 'ä¸“æ—ºç”¨ç¥',
      // äº”è¡Œï¼ˆ5ç§ï¼‰
      'Jin': 'é‡‘',
      'Mu': 'æœ¨',
      'Shui': 'æ°´',
      'Huo': 'ç«',
      'Tu': 'åœŸ',
    };

    // ç´¢å¼•æ˜ å°„è¡¨
    const geJuByIndex = ['æ­£æ ¼', 'ä»å¼ºæ ¼', 'ä»å¼±æ ¼', 'ä»è´¢æ ¼', 'ä»å®˜æ ¼', 'ä»å„¿æ ¼', 'åŒ–æ°”æ ¼', 'ç‰¹æ®Šæ ¼å±€'];
    const qiangRuoByIndex = ['èº«æ—º', 'èº«å¼±', 'ä¸­å’Œ', 'å¤ªæ—º', 'å¤ªå¼±'];
    const wuXingByIndex = ['é‡‘', 'æœ¨', 'æ°´', 'ç«', 'åœŸ'];
    const yongShenTypeByIndex = ['æ‰¶æŠ‘ç”¨ç¥', 'è°ƒå€™ç”¨ç¥', 'é€šå…³ç”¨ç¥', 'ä¸“æ—ºç”¨ç¥'];

    // parseEnum å‡½æ•°ï¼ˆä¸ä»£ç ä¸­ä¸€è‡´ï¼‰
    function parseEnum(value, byIndex) {
      if (value === null || value === undefined) {
        return 'æœªçŸ¥';
      }

      // æƒ…å†µ1ï¼šæ•°å­—ç´¢å¼•
      if (typeof value === 'number') {
        return byIndex[value] || `æœªçŸ¥(${value})`;
      }

      // æƒ…å†µ2ï¼šå¯¹è±¡æ ¼å¼ { EnumName: null }
      if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
        const key = Object.keys(value)[0];
        return nameMap[key] || key || 'æœªçŸ¥';
      }

      // æƒ…å†µ3ï¼šå­—ç¬¦ä¸²æ ¼å¼
      if (typeof value === 'string') {
        return nameMap[value] || value;
      }

      return String(value);
    }

    // æµ‹è¯•ç”¨ä¾‹
    function runMappingTests() {
      const tests = [
        { input: 'ZhengGe', expected: 'æ­£æ ¼', desc: 'å­—ç¬¦ä¸²: ZhengGe', byIndex: geJuByIndex },
        { input: 'TaiRuo', expected: 'å¤ªå¼±', desc: 'å­—ç¬¦ä¸²: TaiRuo', byIndex: qiangRuoByIndex },
        { input: 'Huo', expected: 'ç«', desc: 'å­—ç¬¦ä¸²: Huo', byIndex: wuXingByIndex },
        { input: 'Mu', expected: 'æœ¨', desc: 'å­—ç¬¦ä¸²: Mu', byIndex: wuXingByIndex },
        { input: 'FuYi', expected: 'æ‰¶æŠ‘ç”¨ç¥', desc: 'å­—ç¬¦ä¸²: FuYi', byIndex: yongShenTypeByIndex },
        { input: { ZhengGe: null }, expected: 'æ­£æ ¼', desc: 'å¯¹è±¡: { ZhengGe: null }', byIndex: geJuByIndex },
        { input: { TaiRuo: null }, expected: 'å¤ªå¼±', desc: 'å¯¹è±¡: { TaiRuo: null }', byIndex: qiangRuoByIndex },
        { input: 0, expected: 'æ­£æ ¼', desc: 'æ•°å­—: 0', byIndex: geJuByIndex },
        { input: 3, expected: 'å¤ªæ—º', desc: 'æ•°å­—: 3', byIndex: qiangRuoByIndex },
      ];

      const container = document.getElementById('mapping-results');
      container.innerHTML = '';

      let passCount = 0;
      let failCount = 0;

      tests.forEach((test, idx) => {
        const result = parseEnum(test.input, test.byIndex);
        const pass = result === test.expected;

        if (pass) passCount++;
        else failCount++;

        container.innerHTML += `
          <div class="test-case ${pass ? 'pass' : 'fail'}">
            <strong>æµ‹è¯• ${idx + 1}: ${test.desc}</strong><br>
            è¾“å…¥: <code>${JSON.stringify(test.input)}</code><br>
            æœŸæœ›: <code>${test.expected}</code><br>
            å®é™…: <code>${result}</code><br>
            <div class="result">${pass ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}</div>
          </div>
        `;
      });

      const summary = passCount === tests.length
        ? `<div class="success"><strong>âœ… å…¨éƒ¨é€šè¿‡ï¼</strong> (${passCount}/${tests.length})</div>`
        : `<div class="warning"><strong>âš ï¸ éƒ¨åˆ†å¤±è´¥ï¼</strong> é€šè¿‡: ${passCount}/${tests.length}, å¤±è´¥: ${failCount}</div>`;

      container.innerHTML = summary + container.innerHTML;
    }

    // æ•°æ®æ ¼å¼æµ‹è¯•
    function runFormatTests() {
      const container = document.getElementById('format-results');
      container.innerHTML = '<div class="info">æ­£åœ¨æ£€æµ‹æ•°æ®æ ¼å¼...</div>';

      const formats = [
        { type: 'å­—ç¬¦ä¸²', example: '"ZhengGe"', value: 'ZhengGe' },
        { type: 'å¯¹è±¡', example: '{ ZhengGe: null }', value: { ZhengGe: null } },
        { type: 'æ•°å­—', example: '0', value: 0 },
      ];

      let html = '<h3>æ”¯æŒçš„æ•°æ®æ ¼å¼ï¼š</h3>';
      formats.forEach((fmt, idx) => {
        const result = parseEnum(fmt.value, geJuByIndex);
        html += `
          <div class="test-case pass">
            <strong>${idx + 1}. ${fmt.type}æ ¼å¼</strong><br>
            ç¤ºä¾‹: <code>${fmt.example}</code><br>
            è§£æç»“æœ: <code>${result}</code><br>
            âœ… æ”¯æŒ
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // æµè§ˆå™¨ç¼“å­˜æ£€æµ‹
    function checkCache() {
      const container = document.getElementById('cache-results');
      const timestamp = Date.now();
      const buildTime = '2025-12-14T09:32:00'; // å½“å‰æ„å»ºæ—¶é—´

      let html = '<h3>ç¼“å­˜çŠ¶æ€æ£€æµ‹ï¼š</h3>';

      // æ£€æŸ¥ localStorage
      const hasCache = localStorage.getItem('bazi-cache-check');
      if (hasCache) {
        html += `
          <div class="warning">
            <strong>âš ï¸ æ£€æµ‹åˆ°ç¼“å­˜æ•°æ®</strong><br>
            ä¸Šæ¬¡è®¿é—®æ—¶é—´: ${new Date(parseInt(hasCache)).toLocaleString()}<br>
            å»ºè®®ï¼šæŒ‰ <code>Ctrl+Shift+R</code> (Windows/Linux) æˆ– <code>Cmd+Shift+R</code> (Mac) å¼ºåˆ¶åˆ·æ–°
          </div>
        `;
      } else {
        html += `
          <div class="success">
            <strong>âœ… é¦–æ¬¡è®¿é—®æˆ–å·²æ¸…é™¤ç¼“å­˜</strong><br>
            æ—¶é—´æˆ³: ${new Date(timestamp).toLocaleString()}
          </div>
        `;
      }

      localStorage.setItem('bazi-cache-check', timestamp.toString());

      // æ£€æŸ¥ Service Worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
          if (registrations.length > 0) {
            html += `
              <div class="warning">
                <strong>âš ï¸ æ£€æµ‹åˆ° Service Worker</strong><br>
                å¯èƒ½ç¼“å­˜äº†æ—§ç‰ˆæœ¬ä»£ç <br>
                <button onclick="clearServiceWorker()">æ¸…é™¤ Service Worker</button>
              </div>
            `;
          } else {
            html += '<div class="success">âœ… æœªæ£€æµ‹åˆ° Service Worker</div>';
          }
          container.innerHTML = html;
        });
      } else {
        container.innerHTML = html;
      }
    }

    // æ¸…é™¤ Service Worker
    async function clearServiceWorker() {
      if ('serviceWorker' in navigator) {
        const registrations = await navigator.serviceWorker.getRegistrations();
        for (let registration of registrations) {
          await registration.unregister();
        }
        alert('âœ… Service Worker å·²æ¸…é™¤ï¼Œè¯·åˆ·æ–°é¡µé¢');
        window.location.reload();
      }
    }

    // è·å–å®é™…æ•°æ®
    async function fetchRealData() {
      const container = document.getElementById('real-results');
      container.innerHTML = '<div class="info">æ­£åœ¨è¿æ¥åˆ°åŒºå—é“¾èŠ‚ç‚¹...</div>';

      try {
        // è¿™é‡Œéœ€è¦å®é™…è¿æ¥åˆ° Polkadot.js API
        // ç®€åŒ–ç‰ˆæœ¬ï¼šæ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®
        container.innerHTML = `
          <div class="warning">
            <strong>âš ï¸ æ‰‹åŠ¨æ£€æŸ¥æ­¥éª¤ï¼š</strong><br>
            1. æ‰“å¼€ <a href="http://localhost:5173/#/bazi/1" target="_blank">å…«å­—è¯¦æƒ…é¡µé¢</a><br>
            2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·<br>
            3. åˆ‡æ¢åˆ° Console æ ‡ç­¾<br>
            4. æŒ‰ Ctrl+Shift+R å¼ºåˆ¶åˆ·æ–°<br>
            5. æœç´¢ <code>[parseEnum]</code> æŸ¥çœ‹æ—¥å¿—<br>
            6. æ£€æŸ¥ "è¾“å…¥å€¼" å’Œ "ç»“æœ" æ˜¯å¦æ­£ç¡®<br><br>
            <strong>å¦‚æœçœ‹åˆ°ï¼š</strong><br>
            - è¾“å…¥å€¼: "ZhengGe" â†’ ç»“æœåº”è¯¥æ˜¯ "æ­£æ ¼" âœ…<br>
            - è¾“å…¥å€¼: { ZhengGe: null } â†’ ç»“æœåº”è¯¥æ˜¯ "æ­£æ ¼" âœ…<br>
            - å¦‚æœç»“æœä»æ˜¯ "ZhengGe" âŒ è¯·æˆªå›¾æ§åˆ¶å°
          </div>
        `;
      } catch (error) {
        container.innerHTML = `
          <div class="fail">
            <strong>âŒ è¿æ¥å¤±è´¥</strong><br>
            ${error.message}
          </div>
        `;
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæ˜ å°„æµ‹è¯•
    window.addEventListener('load', () => {
      runMappingTests();
    });
  </script>
</body>
</html>
