# çºªå¿µé¦†ç»¼åˆé¡µé¢ä½¿ç”¨è¯´æ˜

> **ç»„ä»¶**: MemorialComprehensive.tsx  
> **è·¯ç”±**: `#/memorial/comprehensive/{id}`  
> **è®¾è®¡å‚è€ƒ**: äº‘ä¸Šæ€å¿µç½‘ç«™  
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-08

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

çºªå¿µé¦†ç»¼åˆé¡µé¢æ˜¯å‚è€ƒäº‘ä¸Šæ€å¿µç½‘ç«™è®¾è®¡çš„ä¸€ä½“åŒ–çºªå¿µé¦†å±•ç¤ºé¡µé¢ï¼Œé›†æˆäº†é€è€…ä¿¡æ¯ã€ä¾›å¥‰è®°å½•ã€ä¾›å¥‰å“æµè§ˆç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [çºªå¿µé¦†]              [åŠ å…¥äº²å‹å›¢]  â”‚  â† é¡¶éƒ¨æ“ä½œæ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚       é™ˆä¹¦å…ƒ & ç´¢é•¿ç´                â”‚  â† é€è€…ä¿¡æ¯
â”‚       1921-1980 | 1927-1986         â”‚
â”‚                                     â”‚
â”‚  ä»–ä»¬ä¸­æœ€ä¹…çš„å·²ç»ç¦»å¼€æˆ‘ä»¬45å¹´äº†      â”‚  â† ç»Ÿè®¡ä¿¡æ¯
â”‚  äº²å‹ä»¬å·²ç¥­æ‹œ14æ¬¡ï¼Œå·²ç‚¹äº®èœ¡çƒ›3æ¬¡    â”‚
â”‚  ğŸ“… è·å¿Œæ—¥è¿˜æœ‰56å¤©ï¼Œè·ç”Ÿè¾°è¿˜æœ‰346å¤©  â”‚
â”‚                                     â”‚
â”‚      [ğŸ”¥ ç‚¹äº®èœ¡çƒ›]                  â”‚  â† å¿«æ·æ“ä½œ
â”‚      å·²ç‚¹äº®3æ”¯èœ¡çƒ›                  â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [è‡ªåŠ¨ä¾›å¥‰] [ç¥ˆç¦ç¥­å“]               â”‚  â† å¿«æ·å…¥å£
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¦å…¨éƒ¨ ğŸå¥—é¤ ğŸ•¯ï¸é¦™çƒ› ğŸŒ¸èŠ±æœ ...     â”‚  â† ç±»åˆ«æ ‡ç­¾
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”             â”‚
â”‚  â”‚èœ¡çƒ›â”‚ â”‚é²œèŠ±â”‚ â”‚æ°´æœâ”‚             â”‚  â† ä¾›å¥‰å“ç½‘æ ¼
â”‚  â”‚å…è´¹â”‚ â”‚3å…ƒ â”‚ â”‚8å…ƒ â”‚             â”‚     (3åˆ—)
â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜             â”‚
â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”             â”‚
â”‚  â”‚...  â”‚ â”‚...  â”‚ â”‚...  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚        (æ›´å¤šä¾›å¥‰å“...)              â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ•¯ï¸]  [ğŸ]  [ğŸ’¬]  [ğŸ‘¤]           â”‚  â† åº•éƒ¨å›ºå®šæ“ä½œæ 
â”‚ èœ¡çƒ›   ç¥­å“   ç•™è¨€   ç”Ÿå¹³           â”‚     (always visible)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ è®¾è®¡ç‰¹ç‚¹

### 1. äº‘ä¸Šæ€å¿µé£æ ¼

- **ç§»åŠ¨ç«¯ä¼˜å…ˆ**: 3åˆ—ç½‘æ ¼å¸ƒå±€ï¼Œé€‚é…æ‰‹æœºå±å¹•
- **çºªå¿µä¸»é¢˜è‰²**: 
  - ä¸»è‰²ï¼šæ·±é‡‘è‰² `#B8860B`
  - è¾…è‰²ï¼šå¢¨ç»¿è‰² `#2F4F4F`
  - å¼ºè°ƒè‰²ï¼šæœ±çº¢è‰² `#DC143C`
  - èƒŒæ™¯ï¼šç±³ç™½è‰² `#F5F5DC`

### 2. å¸ƒå±€ç»“æ„

- **é¡¶éƒ¨å›ºå®š**: æ ‡é¢˜æ å’Œæ“ä½œæŒ‰é’®ï¼ˆstickyï¼‰
- **ä¿¡æ¯é›†ä¸­**: é€è€…ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®åœ¨é¡¶éƒ¨
- **å¿«æ·æ“ä½œ**: ç‚¹äº®èœ¡çƒ›ã€è‡ªåŠ¨ä¾›å¥‰ç­‰å¸¸ç”¨åŠŸèƒ½
- **æ»šåŠ¨æµè§ˆ**: ç±»åˆ«æ ‡ç­¾æ¨ªå‘æ»šåŠ¨
- **åº•éƒ¨å›ºå®š**: 4ä¸ªæ ¸å¿ƒæ“ä½œï¼ˆèœ¡çƒ›/ç¥­å“/ç•™è¨€/ç”Ÿå¹³ï¼‰

### 3. äº¤äº’è®¾è®¡

- **ä¸€é”®ç‚¹äº®**: å¿«é€Ÿç‚¹äº®èœ¡çƒ›è¡¨è¾¾æ€å¿µ
- **åˆ†ç±»æµè§ˆ**: æ»šåŠ¨æ ‡ç­¾å¿«é€Ÿåˆ‡æ¢ç±»åˆ«
- **ç½‘æ ¼å±•ç¤º**: 3åˆ—ç½‘æ ¼æ¸…æ™°å±•ç¤ºä¾›å¥‰å“
- **ç‚¹å‡»è´­ä¹°**: ç‚¹å‡»ä¾›å¥‰å“å¡ç‰‡è¿›å…¥è´­ä¹°æµç¨‹

---

## ğŸ’» æŠ€æœ¯å®ç°

### æ•°æ®åŠ è½½

```typescript
// ä»é“¾ç«¯åŠ è½½ä¾›å¥‰å“
const api = await getApi()
const entries = await api.query.memorial.sacrificeOf.entries()

// è§£ææ•°æ®
const offerings = entries.map(([key, value]) => {
  const id = key.args[0].toNumber()
  const data = value.unwrap()
  return {
    id,
    name: decode(data.name),
    resourceUrl: decode(data.resourceUrl),
    category: data.category.toNumber(),
    // ...
  }
})
```

### ç±»åˆ«ç­›é€‰

```typescript
// å‰ç«¯ç­›é€‰
const filteredOfferings = offerings.filter(item => {
  if (selectedCategory === 'all') return true
  return item.category === CHAIN_CATEGORY_MAP[selectedCategory]
})
```

### ä¾›å¥‰æ“ä½œ

```typescript
// ç‚¹äº®èœ¡çƒ›ï¼ˆä½¿ç”¨èœ¡çƒ›ä¾›å¥‰å“ï¼‰
await signAndSendLocalFromKeystore(
  'memorial',
  'offerBySacrifice',
  [[domain, targetId], candleItemId, [], null]
)

// ä¾›å¥‰ç¥­å“
await signAndSendLocalFromKeystore(
  'memorial',
  'offerBySacrifice',
  [[domain, targetId], sacrificeId, [], duration]
)
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### è®¿é—®é¡µé¢

```
http://127.0.0.1:5173/#/memorial/comprehensive/1
```

å…¶ä¸­ `1` æ˜¯çºªå¿µé¦† ID

### æ“ä½œæµç¨‹

1. **æµè§ˆä¾›å¥‰å“**
   - ç‚¹å‡»ç±»åˆ«æ ‡ç­¾åˆ‡æ¢åˆ†ç±»
   - æ»šåŠ¨æŸ¥çœ‹æ‰€æœ‰ä¾›å¥‰å“

2. **ç‚¹äº®èœ¡çƒ›**
   - ç‚¹å‡»é¡¶éƒ¨"ç‚¹äº®èœ¡çƒ›"æŒ‰é’®
   - è‡ªåŠ¨ä½¿ç”¨å…è´¹èœ¡çƒ›ä¾›å¥‰å“

3. **ä¾›å¥‰ç¥­å“**
   - ç‚¹å‡»ä»»æ„ä¾›å¥‰å“å¡ç‰‡
   - å¡«å†™ä¾›å¥‰ä¿¡æ¯
   - ç¡®è®¤ä¾›å¥‰

4. **åº•éƒ¨æ“ä½œ**
   - èœ¡çƒ›ï¼šå¿«é€Ÿç‚¹äº®èœ¡çƒ›
   - ç¥­å“ï¼šæµè§ˆä¾›å¥‰å“
   - ç•™è¨€ï¼šå‘è¡¨çºªå¿µç•™è¨€
   - ç”Ÿå¹³ï¼šæŸ¥çœ‹é€è€…ç”Ÿå¹³

---

## ğŸ”§ ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

### 1. é€è€…ä¿¡æ¯

```typescript
// ä»çºªå¿µé¦†å…³è”çš„é€è€…åŠ è½½ä¿¡æ¯
const deceasedIds = await api.query.grave.deceasedOf(memorialId)

for (const deceasedId of deceasedIds) {
  const deceased = await api.query.deceased.deceasedRecords(deceasedId)
  // è§£æå¹¶æ˜¾ç¤º
}
```

### 2. ä¾›å¥‰è®°å½•

```typescript
// ä» Memorial pallet è·å–ä¾›å¥‰è®°å½•
const offeringIds = await api.query.memorial.offeringsByTarget([domain, memorialId])

for (const offeringId of offeringIds) {
  const record = await api.query.memorial.offeringRecords(offeringId)
  // æ˜¾ç¤ºåœ¨æ—¶é—´çº¿
}
```

### 3. ç»Ÿè®¡æ•°æ®

```typescript
// ä» Ledger pallet è·å–ç»Ÿè®¡
const stats = await api.query.graveLedger.stats([domain, memorialId])

// candleCount: ç‚¹äº®èœ¡çƒ›æ¬¡æ•°
// offeringCount: æ€»ä¾›å¥‰æ¬¡æ•°
// visitCount: è®¿é—®æ¬¡æ•°
```

---

## ğŸ“± å“åº”å¼è®¾è®¡

### ç§»åŠ¨ç«¯ (< 768px)

- 3åˆ—ç½‘æ ¼å¸ƒå±€
- ç´§å‡‘é—´è·ï¼ˆ8pxï¼‰
- åº•éƒ¨å›ºå®šæ“ä½œæ 
- ç±»åˆ«æ ‡ç­¾æ¨ªå‘æ»šåŠ¨

### å¹³æ¿/æ¡Œé¢ç«¯ (>= 768px)

- å¯æ‰©å±•åˆ° 4-6 åˆ—
- æ›´å¤§çš„å¡ç‰‡å°ºå¯¸
- ä¾§è¾¹æ å¯¼èˆªï¼ˆå¯é€‰ï¼‰

---

## ğŸ¯ ä¸äº‘ä¸Šæ€å¿µçš„å¯¹æ¯”

### ç›¸åŒç‚¹ âœ…

- âœ… é€è€…ä¿¡æ¯å±•ç¤º
- âœ… ç»Ÿè®¡æ•°æ®ï¼ˆç¥­æ‹œæ¬¡æ•°ã€èœ¡çƒ›ç­‰ï¼‰
- âœ… ç±»åˆ«æ ‡ç­¾æ¨ªå‘æ»šåŠ¨
- âœ… 3åˆ—ä¾›å¥‰å“ç½‘æ ¼
- âœ… åº•éƒ¨å›ºå®šæ“ä½œæ ï¼ˆ4ä¸ªæŒ‰é’®ï¼‰
- âœ… å¿«æ·æ“ä½œï¼ˆç‚¹äº®èœ¡çƒ›ï¼‰

### å·®å¼‚ç‚¹ ğŸ”„

- ğŸ”„ **åŒºå—é“¾å­˜å‚¨**: Stardust ä½¿ç”¨é“¾ä¸Šæ•°æ®ï¼Œæ°¸ä¹…ä¿å­˜
- ğŸ”„ **å»ä¸­å¿ƒåŒ–**: æ— éœ€ä¸­å¿ƒåŒ–æœåŠ¡å™¨
- ğŸ”„ **é’±åŒ…é›†æˆ**: ä½¿ç”¨æœ¬åœ°é’±åŒ…ï¼Œæ— éœ€æ‰©å±•
- ğŸ”„ **IPFS å­˜å‚¨**: å›¾ç‰‡å’Œåª’ä½“å­˜å‚¨åœ¨ IPFS

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: useMemo é”™è¯¯

**åŸå› **: æµè§ˆå™¨ç¼“å­˜äº†æ—§ç‰ˆæœ¬

**è§£å†³**:
```bash
# æ–¹æ³•1: æµè§ˆå™¨ç¡¬åˆ·æ–°
Ctrl + Shift + R

# æ–¹æ³•2: æ¸…é™¤ Vite ç¼“å­˜
cd /home/xiaodong/æ–‡æ¡£/stardust/stardust-dapp
rm -rf .vite node_modules/.vite
npm run dev
```

### é—®é¢˜2: ä¾›å¥‰å“åˆ—è¡¨ä¸ºç©º

**åŸå› **: é“¾ç«¯æ•°æ®è¿˜æœªåˆå§‹åŒ–å®Œæˆ

**è§£å†³**:
```bash
# æ£€æŸ¥åˆå§‹åŒ–è¿›åº¦
cd /home/xiaodong/æ–‡æ¡£/stardust/scripts
tail -f init-progress.log

# æˆ–æŸ¥çœ‹å½“å‰æ•°é‡
node verify-data.js
```

### é—®é¢˜3: å›¾ç‰‡åŠ è½½å¤±è´¥

**åŸå› **: ä½¿ç”¨äº†äº‘ä¸Šæ€å¿µçš„å›¾ç‰‡URLï¼ˆå¯èƒ½æœ‰è·¨åŸŸé™åˆ¶ï¼‰

**è§£å†³**: 
- ç­‰å¾… IPFS ä¸Šä¼ å®Œæˆ
- æˆ–ä½¿ç”¨æœ¬åœ°ä¸‹è½½çš„å›¾ç‰‡

---

## ğŸ“Š å½“å‰è¿›åº¦

### é“¾ç«¯æ•°æ®

```bash
# æŸ¥çœ‹ä¾›å¥‰å“æ•°é‡
cd /home/xiaodong/æ–‡æ¡£/stardust/scripts
node verify-data.js
```

### åå°åˆå§‹åŒ–

```bash
# æŸ¥çœ‹è¿›åº¦
tail -20 /home/xiaodong/æ–‡æ¡£/stardust/scripts/init-progress.log
```

---

## ğŸŒ è®¿é—®åœ°å€

```
# çºªå¿µé¦†ç»¼åˆé¡µé¢ï¼ˆæ–°ï¼‰
http://127.0.0.1:5173/#/memorial/comprehensive/1

# ä¾›å¥‰å“ç›®å½•é¡µé¢
http://127.0.0.1:5173/#/browse/category
```

---

## ğŸ“ å¾…å®ç°åŠŸèƒ½

- [ ] ä»é“¾ç«¯åŠ è½½çœŸå®é€è€…ä¿¡æ¯
- [ ] åŠ è½½ä¾›å¥‰è®°å½•æ—¶é—´çº¿
- [ ] å®ç°ç‚¹äº®èœ¡çƒ›åŠŸèƒ½
- [ ] æ·»åŠ ç•™è¨€åŠŸèƒ½
- [ ] æ˜¾ç¤ºç”Ÿå¹³ä¿¡æ¯
- [ ] è®¡ç®—è·å¿Œæ—¥/ç”Ÿè¾°å¤©æ•°
- [ ] æ·»åŠ è‡ªåŠ¨ä¾›å¥‰åŠŸèƒ½

---

**ç»´æŠ¤è€…**: Stardust Team  
**æœ€åæ›´æ–°**: 2025-11-08 15:40

