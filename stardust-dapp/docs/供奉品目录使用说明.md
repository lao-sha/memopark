# ä¾›å¥‰å“ç›®å½•ä½¿ç”¨è¯´æ˜

> **ç»„ä»¶**: OfferingsCatalog  
> **è·¯ç”±**: `#/browse/category`  
> **æ›´æ–°æ—¥æœŸ**: 2025-11-08  
> **é€‚é…**: Memorial Pallet ç²¾ç®€ç‰ˆ

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ä¾›å¥‰å“ç›®å½•ç»„ä»¶æä¾›å®Œæ•´çš„ä¾›å¥‰å“æµè§ˆå’Œè´­ä¹°åŠŸèƒ½ï¼Œé€‚é…æ–°çš„ Memorial pallet ç²¾ç®€ç‰ˆã€‚

### æ ¸å¿ƒåŠŸèƒ½

- âœ… å±•ç¤ºæ‰€æœ‰ä¾›å¥‰å“ï¼ˆä»é“¾ç«¯å®æ—¶è·å–ï¼‰
- âœ… æŒ‰ç±»åˆ«ç­›é€‰ï¼ˆé²œèŠ±/é¦™çƒ›/é£Ÿå“/ç©å…·/å…¶ä»–ï¼‰
- âœ… æœç´¢åŠŸèƒ½ï¼ˆæŒ‰åç§°/æè¿°æœç´¢ï¼‰
- âœ… æŸ¥çœ‹ä¾›å¥‰å“è¯¦æƒ…
- âœ… åœ¨çº¿è´­ä¹°ä¾›å¥‰

---

## ğŸ¯ ä¸æ—§ç‰ˆçš„åŒºåˆ«

### æ—§ç‰ˆ (CategoryBrowse.tsx)

ä½¿ç”¨å¤æ‚çš„ç±»åˆ«ç´¢å¼•ç³»ç»Ÿï¼š
```typescript
// âŒ æ—§æ¥å£ï¼ˆå·²ç§»é™¤ï¼‰
api.query.memoSacrifice.categoryOf.entries()
api.query.memoSacrifice.childrenByCategory()
api.query.memoSacrifice.sacrificesBySecondary()
```

### æ–°ç‰ˆ (OfferingsCatalog.tsx)

ä½¿ç”¨ç®€åŒ–çš„æ¥å£ï¼Œå‰ç«¯åˆ†ç±»ï¼š
```typescript
// âœ… æ–°æ¥å£
api.query.memorial.sacrificeOf.entries()  // è·å–æ‰€æœ‰ç¥­ç¥€å“
// å‰ç«¯æŒ‰ category å­—æ®µåˆ†ç±»
```

---

## ğŸ¨ ç•Œé¢å¸ƒå±€

### 1. æœç´¢æ 
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” æœç´¢ä¾›å¥‰å“åç§°...            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ç±»åˆ«æ ‡ç­¾é¡µ
```
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…¨éƒ¨ â”‚ ğŸŒ¸ èŠ±æœ â”‚ ğŸ•¯ï¸ é¦™çƒ› â”‚ ğŸ· é…’èœ â”‚ ... â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ä¾›å¥‰å“ç½‘æ ¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å›¾ç‰‡   â”‚ â”‚  å›¾ç‰‡   â”‚ â”‚  å›¾ç‰‡   â”‚ â”‚  å›¾ç‰‡   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ğŸŒ¸ é²œèŠ±  â”‚ â”‚ğŸ•¯ï¸ èœ¡çƒ›  â”‚ â”‚ğŸ· ç¾é…’  â”‚ â”‚ğŸ§¸ ç©å…·  â”‚
â”‚  3 DUST â”‚ â”‚ å…è´¹    â”‚ â”‚ 5 DUST  â”‚ â”‚ 8 DUST  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. è¯¦æƒ…æŠ½å±‰ï¼ˆç‚¹å‡»åï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é²œèŠ± #1                    [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  [ä¾›å¥‰å“å›¾ç‰‡]                   â”‚
â”‚                                 â”‚
â”‚  åç§°: é²œèŠ±                     â”‚
â”‚  æè¿°: ğŸŒ¸ é²œèŠ±                  â”‚
â”‚  ç±»åˆ«: ğŸŒ¸ èŠ±æœ                  â”‚
â”‚  ä»·æ ¼: 3 DUST                   â”‚
â”‚                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  ç«‹å³ä¾›å¥‰                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  Domain (åŸŸ): [ 1 ]             â”‚
â”‚  Target ID: [ 123 ]             â”‚
â”‚                                 â”‚
â”‚  [ ç¡®è®¤ä¾›å¥‰ ]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» æŠ€æœ¯å®ç°

### æ•°æ®åŠ è½½

```typescript
// ä»é“¾ç«¯è·å–æ‰€æœ‰ç¥­ç¥€å“
const entries = await api.query.memorial.sacrificeOf.entries()

for (const [key, value] of entries) {
  const id = key.args[0].toNumber()
  const data = value.unwrap()
  
  const offering = {
    id,
    name: decode(data.name),
    resourceUrl: decode(data.resourceUrl),
    category: data.category.toNumber(),
    // ... å…¶ä»–å­—æ®µ
  }
  
  offerings.push(offering)
}
```

### ç±»åˆ«ç­›é€‰

```typescript
// å‰ç«¯ç­›é€‰é€»è¾‘
const filteredOfferings = allOfferings.filter(item => {
  // ç±»åˆ«ç­›é€‰
  if (selectedCategory !== 'all' && item.category !== selectedCategory) {
    return false
  }
  
  // å…³é”®è¯æœç´¢
  if (searchKeyword && !item.name.includes(searchKeyword)) {
    return false
  }
  
  return true
})
```

### è´­ä¹°ä¾›å¥‰

```typescript
// è°ƒç”¨é“¾ç«¯ offerBySacrifice å‡½æ•°
const txHash = await signAndSendLocalFromKeystore(
  'memorial',
  'offerBySacrifice',
  [
    [domain, targetId],  // target: (u8, u64)
    sacrificeId,         // sacrifice_id
    [],                  // media (ç©ºæ•°ç»„)
    duration             // duration (å¯é€‰)
  ]
)
```

---

## ğŸ“Š ç±»åˆ«æ˜ å°„

| é“¾ç«¯ä»£ç  | ç±»åˆ«åç§° | å›¾æ ‡ | é¢œè‰² |
|---------|---------|------|------|
| 0 | èŠ±æœ | ğŸŒ¸ | #ff69b4 |
| 1 | é¦™çƒ› | ğŸ•¯ï¸ | #ffa500 |
| 2 | é…’èœ | ğŸ· | #dc143c |
| 3 | ç©å…· | ğŸ§¸ | #4169e1 |
| 4 | å…¶ä»– | âœ¨ | #9370db |

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ç”¨æˆ·ç«¯

1. **æµè§ˆä¾›å¥‰å“**
   - è®¿é—® `#/browse/category`
   - é€‰æ‹©ç±»åˆ«æ ‡ç­¾é¡µ
   - æˆ–ä½¿ç”¨æœç´¢æ¡†

2. **æŸ¥çœ‹è¯¦æƒ…**
   - ç‚¹å‡»ä»»æ„ä¾›å¥‰å“å¡ç‰‡
   - æŸ¥çœ‹å›¾ç‰‡ã€ä»·æ ¼ã€æè¿°

3. **è´­ä¹°ä¾›å¥‰**
   - å¡«å†™ Domainï¼ˆ1=é€è€…, 2=å® ç‰©ç­‰ï¼‰
   - å¡«å†™ Target IDï¼ˆç›®æ ‡å¯¹è±¡çš„IDï¼‰
   - å¦‚æœæ˜¯æŒ‰å‘¨è®¡è´¹ï¼Œå¡«å†™æ—¶é•¿
   - ç‚¹å‡»"ç¡®è®¤ä¾›å¥‰"

### ç®¡ç†å‘˜ç«¯

ç®¡ç†å‘˜éœ€è¦é€šè¿‡è„šæœ¬åˆå§‹åŒ–ä¾›å¥‰å“æ•°æ®ï¼š

```bash
cd /home/xiaodong/æ–‡æ¡£/stardust/scripts

# ä¸‹è½½å›¾ç‰‡
node download-offerings-images.js

# åˆå§‹åŒ–ä¾›å¥‰å“ï¼ˆä½¿ç”¨ Sudo æƒé™ï¼‰
node init-all-sacrifices.js
```

---

## ğŸ”§ ä¸é“¾ç«¯äº¤äº’

### æŸ¥è¯¢ä¾›å¥‰å“

```javascript
// è·å–æ‰€æœ‰ä¾›å¥‰å“
const entries = await api.query.memorial.sacrificeOf.entries()

// è·å–å•ä¸ªä¾›å¥‰å“
const sacrifice = await api.query.memorial.sacrificeOf(id)
```

### è´­ä¹°ä¾›å¥‰

```javascript
// é€šè¿‡ç¥­ç¥€å“IDè´­ä¹°
api.tx.memorial.offerBySacrifice(
  [domain, targetId],  // ç›®æ ‡
  sacrificeId,         // ç¥­ç¥€å“ID
  [],                  // åª’ä½“åˆ—è¡¨
  duration             // æ—¶é•¿ï¼ˆå¯é€‰ï¼‰
)
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å›¾ç‰‡åŠ è½½ä¼˜åŒ–

```typescript
// ä½¿ç”¨ fallback å›¾ç‰‡
<Image
  src={item.resourceUrl}
  fallback="data:image/png;base64,..."
  preview={false}
/>
```

### 2. ä»·æ ¼æ˜¾ç¤º

```typescript
const formatPrice = (item: SacrificeItem): string => {
  if (item.fixedPrice) {
    const dust = Number(item.fixedPrice) / 1_000_000_000_000_000
    return dust === 0 ? 'å…è´¹' : `${dust.toFixed(2)} DUST`
  }
  if (item.unitPricePerWeek) {
    const dust = Number(item.unitPricePerWeek) / 1_000_000_000_000_000
    return `${dust.toFixed(2)} DUST/å‘¨`
  }
  return 'æœªå®šä»·'
}
```

### 3. é”™è¯¯å¤„ç†

```typescript
try {
  const txHash = await signAndSendLocalFromKeystore(...)
  message.success(`ä¾›å¥‰æˆåŠŸï¼${txHash.substring(0, 10)}...`)
} catch (error: any) {
  // æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
  message.error(error?.message || 'ä¾›å¥‰å¤±è´¥')
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **VIP ä¸“å±ä¾›å¥‰å“**: éœ€è¦ç”¨æˆ·æœ‰æœ‰æ•ˆçš„ä¼šå‘˜èµ„æ ¼
2. **æŒ‰å‘¨è®¡è´¹**: å¿…é¡»å¡«å†™æ—¶é•¿å­—æ®µ
3. **å›ºå®šä»·æ ¼**: ä¸éœ€è¦æ—¶é•¿å­—æ®µ
4. **ç›®æ ‡éªŒè¯**: Domain å’Œ Target ID å¿…é¡»åœ¨é“¾ä¸Šå­˜åœ¨

---

## ğŸ“¦ ç›¸å…³ç»„ä»¶

- **OfferingCardSelector** - å¿«æ·é€‰æ‹©å™¨ï¼ˆç”¨äºçºªå¿µé¦†é¡µé¢ï¼‰
- **OfferingsTimeline** - ä¾›å¥‰æ—¶é—´çº¿
- **MyOrders** - æˆ‘çš„ä¾›å¥‰è®¢å•

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Memorial Pallet README](/home/xiaodong/æ–‡æ¡£/stardust/pallets/memorial/README.md)
- [ä¾›å¥‰å“åˆå§‹åŒ–æŒ‡å—](/home/xiaodong/æ–‡æ¡£/stardust/docs/ä¾›å¥‰å“åˆå§‹åŒ–æŒ‡å—.md)
- [ä¾›å¥‰å“æ•°æ®è„šæœ¬](/home/xiaodong/æ–‡æ¡£/stardust/scripts/README.md)

---

**ç»´æŠ¤è€…**: Stardust Team  
**æœ€åæ›´æ–°**: 2025-11-08

