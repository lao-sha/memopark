# 创建逝者档案页面设计说明

> **设计参考**: 云上思念（https://m.yssn.cn）  
> **设计时间**: 2024-01-15  
> **页面路由**: `#/deceased/create`

---

## 📋 设计目标

1. **清晰的信息层次** - 分组展示不同类型的信息
2. **便捷的输入体验** - 使用日期选择器等现代组件
3. **完善的使用指引** - 详细的填写说明和注意事项
4. **统一的视觉风格** - 符合 Stardust 主题设计
5. **优秀的交互反馈** - 流畅的动画和状态提示

---

## 🎨 页面结构

### 1. 顶部导航栏

**功能：**
- ✅ 返回按钮（带悬停效果）
- ✅ 页面标题："创建逝者档案"
- ✅ 粘性定位，滚动时保持可见

**样式特点：**
- 渐变背景
- 阴影效果
- 底部装饰线

### 2. 进度指示器

**功能：**
- ✅ 3 步进度展示
  - 步骤 1：填写信息
  - 步骤 2：提交上链
  - 步骤 3：创建完成

**样式特点：**
- 卡片化设计
- 图标化展示
- 深金色高亮当前步骤
- 墨绿色标记完成步骤

### 3. 提示信息区域

**逝者档案说明（蓝绿色）：**
- 需要关联纪念馆
- 一馆多人说明
- 唯一标识说明

**钱包连接提示（黄色）：**
- 仅在未连接钱包时显示
- 提示需要先连接钱包

**样式特点：**
- 渐变背景
- 悬停上浮
- 图标化提示

### 4. IPFS Pin 状态显示

**功能：**
- ✅ 显示自动固定状态
- ✅ 成功/失败提示
- ✅ 只在创建成功后显示

**样式特点：**
- 独立卡片
- 突出显示状态

### 5. 创建表单

**表单分组：**

**（1）关联信息**
- **关联纪念馆**（必填）
  - 下拉选择框
  - 显示：#ID · 名称 · Slug
  - 刷新按钮
  - 搜索功能

**（2）基本信息**
- **逝者姓名**（必填）
  - 文本输入框
  - 用于生成唯一标识

- **性别**（可选）
  - 单选按钮组
  - 选项：男/女/保密
  - 默认：保密

**（3）重要日期**
- **出生日期**（必填）
  - 日期选择器
  - 格式：YYYYMMDD
  - 支持手动输入

- **离世日期**（必填）
  - 日期选择器
  - 格式：YYYYMMDD
  - 支持手动输入

**（4）扩展信息（可选）**
- **完整姓名 CID**
  - IPFS/HTTPS 标识
  - 用于链下存储详细信息

- **外部链接**（最多 8 条）
  - 动态表单列表
  - 支持添加/删除
  - 支持 https 和 ipfs 协议

### 6. 提交按钮

**功能：**
- 创建逝者档案
- 显示加载状态
- 完成后禁用

**样式特点：**
- 大尺寸（48px）
- 深金色渐变
- 悬停动画
- 圆角设计

### 7. 密码确认弹窗

**功能：**
- 输入签名密码
- 确认提交
- 取消操作

**样式特点：**
- 居中显示
- 渐变标题背景
- 圆角设计
- 深金色确认按钮

### 8. 使用说明卡片

**包含三个章节：**

**（1）必填信息**
- 关联纪念馆
- 逝者姓名
- 出生日期
- 离世日期

**（2）可选信息**
- 性别
- 完整姓名 CID
- 外部链接

**（3）重要提示**
- Token 生成说明
- 权限要求
- 日期格式说明
- 数量限制说明

**（4）创建后操作**
- 4 个步骤的后续指引

---

## 🎨 设计特点

### 色彩方案

**主题色：**
- 深金色：`#B8860B` - 主要按钮、强调元素
- 墨绿色：`#2F4F4F` - 标题、重要文字
- 朱红色：`#DC143C` - 必填标记、警示
- 米白色：`#F5F5DC` - 页面背景

**渐变效果：**
- 卡片背景：`linear-gradient(135deg, #FFFFFF 0%, #FEFAF5 100%)`
- 按钮背景：`linear-gradient(135deg, #B8860B 0%, #D4AF37 100%)`
- 必填图标：`linear-gradient(135deg, #DC143C 0%, #F08080 100%)`
- 可选图标：`linear-gradient(135deg, #4682B4 0%, #87CEEB 100%)`

### 信息分组

**使用 Divider 分隔：**
1. 关联信息
2. 基本信息
3. 重要日期
4. 扩展信息

**好处：**
- 信息层次清晰
- 便于理解和填写
- 视觉上更整洁

### 表单优化

**日期选择器：**
- 使用 Ant Design DatePicker
- 支持可视化选择
- 自动格式化为 YYYYMMDD
- 也支持手动输入

**性别选择：**
- 使用按钮组形式
- 图标化展示（男/女图标）
- 视觉更直观

**外部链接：**
- 动态表单列表
- 带图标的输入框
- 友好的添加/删除交互
- 空状态提示

### 交互增强

**悬停效果：**
- 卡片上浮
- 阴影加深
- 颜色变化

**焦点状态：**
- 深金色边框
- 光晕效果
- 清晰的视觉反馈

**加载状态：**
- 按钮 loading
- 消息提示
- 进度更新

---

## 📱 响应式设计

### 桌面端（> 768px）
- 最大宽度：900px
- 日期选择器：2 列布局
- 充足的内边距
- 完整的动画效果

### 平板端（≤ 768px）
- 适中的内边距
- 日期选择器保持 2 列
- 调整字号大小

### 移动端（≤ 576px）
- 最小化内边距
- 日期选择器改为 1 列
- 优化按钮和输入框
- 减小字号

---

## 🔧 核心功能

### 1. 纪念馆选择

**功能实现：**
- 自动加载当前账户的纪念馆
- 下拉框搜索功能
- 刷新列表按钮
- 错误提示

**显示格式：**
```
#123 · 张氏纪念馆 · 1234567890
ID    名称         Slug
```

### 2. 日期处理

**两种输入方式：**

**方式1：DatePicker 选择**
```tsx
<DatePicker 
  format="YYYYMMDD"
  onChange={(date) => {
    form.setFieldsValue({ birth_ts: date.format('YYYYMMDD') })
  }}
/>
```

**方式2：手动输入**
- 同时保留 birth_ts 和 death_ts 字段
- 支持直接输入 8 位数字
- 格式验证：YYYYMMDD

### 3. 外部链接管理

**动态列表：**
- Form.List 实现
- 最多 8 条
- 支持添加/删除
- 空状态提示

**链接格式：**
- https:// 开头
- ipfs:// 开头

### 4. 提交流程

**步骤：**
1. 表单验证
2. 日期格式转换
3. 字节数组转换
4. 弹出密码框
5. 签名提交
6. 等待事件
7. 显示 Pin 状态
8. 自动跳转

---

## 💡 设计亮点

### 1. 信息分组清晰

**使用 Divider 分隔：**
- ✅ 关联信息
- ✅ 基本信息
- ✅ 重要日期
- ✅ 扩展信息

**好处：**
- 信息结构一目了然
- 填写顺序符合逻辑
- 减少认知负担

### 2. 日期选择优化

**DatePicker 的优势：**
- ✅ 可视化日历选择
- ✅ 自动格式化
- ✅ 减少输入错误
- ✅ 更好的用户体验

**保留手动输入：**
- ✅ 支持快速输入
- ✅ 兼容老用户习惯
- ✅ 双重验证

### 3. 性别选择优化

**按钮组形式：**
- ✅ 图标化展示
- ✅ 视觉更直观
- ✅ 点击区域更大
- ✅ 渐变背景高亮

### 4. 外部链接优化

**动态列表：**
- ✅ 灵活添加/删除
- ✅ 空状态友好提示
- ✅ 带图标的输入框
- ✅ 悬停动画

### 5. 使用说明优化

**三色标签系统：**
- 🔴 必填（红色渐变）
- 🔵 可选（蓝色渐变）
- 🟡 注意（金色渐变）

**信息完整：**
- 必填字段说明
- 可选字段说明
- 重要提示
- 后续操作指引

---

## 📊 与旧版对比

### 视觉效果

| 对比项 | 旧版 | 新版 | 改进 |
|-------|-----|------|------|
| 整体风格 | 简单表单 | 卡片分组 | ⭐⭐⭐⭐⭐ |
| 色彩方案 | 默认 | 主题色 | ⭐⭐⭐⭐⭐ |
| 信息层次 | 平面 | 分层分组 | ⭐⭐⭐⭐⭐ |
| 动画效果 | 无 | 错峰进入 | ⭐⭐⭐⭐⭐ |

### 交互体验

| 对比项 | 旧版 | 新版 | 改进 |
|-------|-----|------|------|
| 日期输入 | 纯文本 | DatePicker | ⭐⭐⭐⭐⭐ |
| 性别选择 | 单选框 | 按钮组 | ⭐⭐⭐⭐ |
| 进度展示 | 无 | 3步进度条 | ⭐⭐⭐⭐⭐ |
| 使用说明 | 简单文字 | 分类指南 | ⭐⭐⭐⭐⭐ |

### 功能完善

| 对比项 | 旧版 | 新版 | 改进 |
|-------|-----|------|------|
| 纪念馆选择 | 下拉框 | 带刷新的下拉 | ⭐⭐⭐⭐ |
| 外部链接 | 基础列表 | 优化的列表 | ⭐⭐⭐⭐ |
| Pin状态 | 有显示 | 卡片化显示 | ⭐⭐⭐⭐ |
| 错误提示 | 标准提示 | 详细引导 | ⭐⭐⭐⭐⭐ |

---

## 🔧 技术实现

### 核心改进

**1. 日期处理**
```tsx
// 支持 DatePicker 和手动输入
<DatePicker 
  format="YYYYMMDD"
  onChange={(date) => {
    if (date) {
      form.setFieldsValue({ birth_ts: date.format('YYYYMMDD') })
    }
  }}
/>

// 隐藏字段存储格式化结果
<Form.Item name="birth_ts" hidden>
  <Input />
</Form.Item>
```

**2. 性别选择**
```tsx
<Radio.Group className="gender-radio">
  <Radio.Button value={0}>
    <ManOutlined /> 男
  </Radio.Button>
  <Radio.Button value={1}>
    <WomanOutlined /> 女
  </Radio.Button>
  <Radio.Button value={2}>
    保密
  </Radio.Button>
</Radio.Group>
```

**3. 外部链接**
```tsx
<Form.List name="links">
  {(fields, { add, remove }) => (
    <>
      {fields.map((field) => (
        <div className="link-item">
          <Form.Item {...field}>
            <Input prefix={<LinkOutlined />} />
          </Form.Item>
          <Button onClick={() => remove(field.name)}>
            删除
          </Button>
        </div>
      ))}
    </>
  )}
</Form.List>
```

### 状态管理

**组件状态：**
- `currentStep` - 当前步骤
- `submitting` - 提交中
- `pwdOpen` - 密码弹窗
- `graveLoading` - 加载纪念馆列表
- `latestDeceasedId` - 最新创建的逝者ID
- `pinStatusShown` - Pin状态显示标记

---

## 📐 响应式适配

### 日期选择器布局

**桌面/平板端：**
```tsx
<Row gutter={16}>
  <Col xs={24} sm={12}>
    {/* 出生日期 */}
  </Col>
  <Col xs={24} sm={12}>
    {/* 离世日期 */}
  </Col>
</Row>
```

**移动端：**
- 自动变为单列
- 保持良好的间距

### 外部链接布局

**所有设备：**
- 单列显示
- 悬停右移动画
- 便于触摸操作

---

## ✅ 用户体验优化

### 1. 智能预填

**纪念馆ID：**
- 从 localStorage 读取上次选择
- 创建纪念馆时可存储
- 减少重复操作

### 2. 验证提示

**友好的错误信息：**
- "请选择纪念馆"
- "请填写逝者姓名"
- "出生日期需为 YYYYMMDD 格式"
- "最多添加 8 条链接"

### 3. 加载反馈

**多层次反馈：**
- 按钮 loading 状态
- 消息提示
- 进度条更新
- Pin 状态显示

### 4. 自动跳转

**成功后：**
1. 显示成功消息
2. 检测 IPFS Pin 状态（3秒）
3. 延迟 2 秒自动跳转
4. 跳转到"我的纪念馆"

---

## 📋 填写示例

### 完整示例

**关联纪念馆：**
```
#123 · 李氏祠堂 · 9876543210
```

**基本信息：**
- 逝者姓名：李大爷
- 性别：男

**重要日期：**
- 出生日期：19451001
- 离世日期：20230315

**扩展信息：**
- 完整姓名 CID：ipfs://QmXxx...
- 外部链接：
  - https://example.com/memorial
  - ipfs://QmYyy...

---

## 🎯 设计原则

### 1. 信息分组

**原则：**
- 相关信息放在一起
- 使用分割线区分
- 标题明确清晰

**效果：**
- 减少认知负担
- 提高填写效率
- 降低出错率

### 2. 渐进增强

**基本 → 扩展：**
- 必填信息在前
- 可选信息在后
- 逐步完善档案

**好处：**
- 用户可快速完成基础创建
- 后续慢慢补充详细信息
- 降低使用门槛

### 3. 即时反馈

**每个操作都有反馈：**
- 输入验证
- 提交状态
- 成功提示
- 错误说明

**提升：**
- 用户操作信心
- 减少焦虑感
- 提高成功率

---

## 🔄 后续优化建议

### 1. 功能增强
- [ ] 添加照片上传
- [ ] 支持生平简介输入
- [ ] 添加职业、籍贯等字段
- [ ] 支持批量创建

### 2. 体验优化
- [ ] 表单草稿保存
- [ ] 智能日期建议
- [ ] 关系快速设置
- [ ] 模板快速填充

### 3. 视觉优化
- [ ] 添加背景装饰
- [ ] 优化移动端布局
- [ ] 增加成功动画
- [ ] 丰富图标使用

---

## 📄 文件说明

**组件文件：** `src/features/deceased/CreateDeceasedPage.tsx`  
**样式文件：** `src/features/deceased/CreateDeceasedPage.css`  
**路由配置：** `#/deceased/create`  
**旧版路由：** `#/deceased/create-old`

---

**设计完成时间**: 2024-01-15  
**设计人员**: AI Assistant  
**参考来源**: 云上思念（https://m.yssn.cn）

