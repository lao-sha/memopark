# 做市商信用仪表板 - 使用说明

**功能**: 做市商信用评分查询和管理  
**路由**: `#/market-maker/credit`  
**创建日期**: 2025-10-22

---

## 📋 功能概述

做市商信用仪表板提供以下功能：

1. **信用总览** - 信用分、等级、风险分、服务状态
2. **信用分组成** - 6个维度详细评分
3. **统计数据** - 订单数、响应时间、违约次数
4. **风险分衰减** - 30天自动衰减进度
5. **违约历史** - 最近30条违约记录

---

## 🚀 快速开始

### 方式1：通过做市商中心访问

```
1. 登录做市商账户
2. 访问首页 → 做市商中心
3. 在"信用管理"面板点击"💎 信用仪表板"
```

### 方式2：直接访问URL

```
http://localhost:5173/#/market-maker/credit
```

---

## 📊 页面模块说明

### 1. 信用总览卡片

展示4个核心指标：

#### 信用分（800-1000）
- **计算公式**: 基础分 + 履约表现 + 服务质量 + 资金充足 + 活跃度 + 买家评价 - 风险扣分
- **初始值**: 800分
- **更新时机**: 每次订单完成/违约/仲裁

#### 信用等级（5个等级）
| 等级 | 图标 | 分数范围 | 颜色 | 背景渐变 |
|------|------|---------|------|---------|
| 钻石 | 💎 | 950-1000 | `#00d9ff` | `#00d9ff → #0099cc` |
| 铂金 | 💍 | 900-949 | `#b4b4dc` | `#b4b4dc → #8e8eb8` |
| 黄金 | 🥇 | 850-899 | `#ffd700` | `#ffd700 → #ccac00` |
| 白银 | 🥈 | 800-849 | `#c0c0c0` | `#c0c0c0 → #999999` |
| 青铜 | 🥉 | 750-799 | `#cd7f32` | `#cd7f32 → #a66328` |

#### 风险分（0-1000）
- **初始值**: 0分
- **增加**: 超时违约 +10，争议败诉 +30
- **衰减**: 每30天自动 -10%

#### 服务状态（3种状态）
| 状态 | 图标 | 信用分范围 | 说明 |
|------|------|-----------|------|
| 正常服务 | ✅ | ≥ 800 | 可正常接单 |
| 警告状态 | ⚠️ | 750-799 | 即将暂停接单 |
| 暂停服务 | 🚫 | < 750 | 暂停接单 |

---

### 2. 信用分组成明细

6个维度详细评分：

#### 基础分（800分）
- **固定值**: 800分
- **说明**: 所有做市商的基础信用分

#### 履约表现（0-250分）
- **计算公式**: `250 - (超时违约 × 5 + 争议败诉 × 15)`
- **影响因素**: 超时违约、争议败诉
- **扣分规则**:
  - 超时违约：-5分/次
  - 争议败诉：-15分/次

#### 服务质量（0-200分）
- **计算公式**: `200 - (平均响应时间 / 60 × 2)`
- **影响因素**: 平均响应时间（秒）
- **扣分规则**: 每超过60秒 -2分

#### 资金充足（0-150分）
- **当前值**: 150分（假设所有做市商资金充足）
- **未来优化**: 根据质押金额动态计算

#### 活跃度（0-100分）
- **计算公式**: `min(100, 累计订单数 × 2)`
- **影响因素**: 累计完成订单数
- **加分规则**: 每完成1笔订单 +2分（上限100分）

#### 买家评价（0-100分）
- **当前值**: 基于订单数估算
- **未来优化**: 实现买家评分系统

#### 风险扣分（动态）
- **计算公式**: `风险分 / 10`
- **影响因素**: 风险分累计值
- **示例**: 风险分 300 → 扣 30分

---

### 3. 统计数据

4个核心指标：

| 指标 | 说明 | 更新时机 |
|------|------|---------|
| 累计订单 | 成功完成的订单总数 | 订单完成时 +1 |
| 平均响应时间 | 从订单创建到确认的平均时间（秒） | 订单完成时更新 |
| 超时违约 | 超时未确认的订单次数 | 订单超时时 +1 |
| 争议败诉 | 仲裁败诉的订单次数 | 仲裁败诉时 +1 |

---

### 4. 风险分衰减进度

- **衰减周期**: 30天
- **衰减比例**: 每周期 -10%
- **衰减公式**: `新风险分 = 旧风险分 × 0.9`
- **触发方式**: 链上自动执行（每个区块检查）
- **进度条**: 显示距离下次衰减的进度（0-100%）

**示例**：
```
初始风险分: 300
30天后: 300 × 0.9 = 270
60天后: 270 × 0.9 = 243
90天后: 243 × 0.9 = 218.7
```

---

### 5. 违约历史表格

展示最近30条违约记录：

| 列名 | 说明 | 数据类型 |
|------|------|---------|
| 违约类型 | ⏰ 超时 / ⚖️ 争议败诉 | Tag (橙色/红色) |
| 订单ID | 违约订单的ID | 数字 |
| 违约时间 | 违约发生的时间 | 时间戳（格式化） |
| 信用分扣除 | 扣除的信用分 | -5 或 -15 |
| 风险分增加 | 增加的风险分 | +10 或 +30 |

**分页**: 每页10条，支持翻页

---

## 🎨 UI 设计说明

### 渐变背景（根据信用等级动态变化）

- **钻石**: `linear-gradient(135deg, #00d9ff 0%, #0099cc 100%)`
- **铂金**: `linear-gradient(135deg, #b4b4dc 0%, #8e8eb8 100%)`
- **黄金**: `linear-gradient(135deg, #ffd700 0%, #ccac00 100%)`
- **白银**: `linear-gradient(135deg, #c0c0c0 0%, #999999 100%)`
- **青铜**: `linear-gradient(135deg, #cd7f32 0%, #a66328 100%)`

### 响应式布局

#### 移动端（xs < 576px）
- 单列布局
- 卡片垂直堆叠
- 表格支持横向滚动

#### 平板端（576px ≤ sm < 768px）
- 2列布局
- 统计卡片水平排列
- 表格完整显示

#### 桌面端（md ≥ 768px）
- 4-6列布局
- 信用分组成横向展示
- 表格分页显示

---

## 🔗 链上数据查询

### 查询信用记录

```typescript
import { getCreditRecord } from './services/makerCreditService'

const credit = await getCreditRecord(api, makerId)
console.log('信用分:', credit.creditScore)
console.log('信用等级:', credit.level)
console.log('服务状态:', credit.serviceStatus)
```

### 查询违约历史

```typescript
import { getDefaultHistory } from './services/makerCreditService'

const history = await getDefaultHistory(api, makerId)
console.log('违约次数:', history.length)
```

### 计算信用分组成

```typescript
import { getCreditBreakdown } from './services/makerCreditService'

const breakdown = getCreditBreakdown(credit)
console.log('履约表现:', breakdown.fulfillmentScore)
console.log('服务质量:', breakdown.serviceScore)
```

---

## ⚠️ 错误处理

### 错误1：未找到做市商ID

**错误信息**: "您不是活跃的做市商，无法查看信用记录"

**原因**: 当前账户不是活跃的做市商

**解决方案**:
1. 确认账户已申请成为做市商
2. 确认做市商申请已通过审核（状态为 Active）
3. 检查账户地址是否正确

### 错误2：未找到信用记录

**错误信息**: "未找到信用记录"

**原因**: 做市商审核通过后，信用记录尚未初始化

**解决方案**:
1. 等待链上信用初始化完成（通常在审核通过后的下一个区块）
2. 刷新页面重新查询

### 错误3：查询失败

**错误信息**: "加载信用数据失败"

**原因**: 链节点不可达或网络问题

**解决方案**:
1. 检查链节点是否运行
2. 检查前端配置的 `wsEndpoint` 是否正确
3. 刷新页面重新连接

---

## 🔧 开发调试

### 开启调试日志

```typescript
// 在浏览器控制台
localStorage.setItem('DEBUG', 'maker-credit:*')
```

### 模拟数据测试

```typescript
// 修改 makerCreditService.ts
export async function getCreditRecord(api, makerId) {
  // 返回模拟数据
  return {
    makerId: 1,
    creditScore: 850,
    riskScore: 100,
    level: 'Gold',
    serviceStatus: 'Active',
    totalOrders: 50,
    avgResponseTime: 300,
    timeoutDefaults: 2,
    disputeLosses: 1,
    lastUpdated: Math.floor(Date.now() / 1000),
    lastDecay: Math.floor(Date.now() / 1000) - 15 * 24 * 60 * 60,
  }
}
```

---

## 📱 移动端优化

### 触摸优化
- 卡片间距增大（更易点击）
- 按钮最小高度 44px（符合 iOS 设计规范）
- 表格支持横向滚动

### 性能优化
- 懒加载（React.lazy）
- 图片/图标延迟加载
- 虚拟滚动（长列表）

---

## 🎯 最佳实践

### 1. 定期查看信用仪表板
- **建议频率**: 每周至少1次
- **关注指标**: 风险分、违约次数、服务状态
- **预警阈值**: 信用分 < 800（警告），< 750（暂停）

### 2. 及时处理违约
- **超时违约**: 尽快确认订单，避免累积
- **争议败诉**: 提升服务质量，减少纠纷

### 3. 提升信用等级
- **完成更多订单**: 活跃度 +2分/单
- **快速响应**: 平均响应时间 < 60分钟
- **避免违约**: 减少超时和争议

---

## 📞 技术支持

如有问题，请查看：
- **链端文档**: `pallets/maker-credit/README.md`
- **设计方案**: `docs/做市商信用体系设计方案.md`
- **前端集成报告**: `stardust-dapp/做市商信用体系-前端集成完成报告.md`

---

**最后更新**: 2025-10-22  
**版本**: v1.0.0  
**状态**: ✅ 生产就绪

