# 做市商提交资料错误排查指南

## 🎯 快速诊断

如果提交做市商资料时遇到错误，请按以下步骤操作：

---

## ✅ 第一步：检查余额

### 需要准备的余额

```
保证金（第一步质押）:     10,000 MEMO
首购资金池（第二步提交）:  10,000 MEMO
交易费用:                 约 0.01 MEMO
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
总计:                    至少 20,000.01 MEMO
```

### 如何检查

1. 打开浏览器控制台（按 F12）
2. 提交资料时会自动显示：
   ```
   💰 [余额检查]
     可用余额: XXX MEMO
     已锁定: YYY MEMO
     需要锁定: ZZZ MEMO
   ```
3. 确保：**可用余额 >= 需要锁定的金额**

### 如果余额不足

- **方法 1**：从其他账户转账
- **方法 2**：降低首购资金池金额（最低 10,000 MEMO）
- **方法 3**：联系团队获取测试币

---

## ✅ 第二步：检查参数格式

### epay 配置要求

| 字段 | 要求 | 示例 |
|------|------|------|
| **epay 网关** | 不超过 128 字节 | `http://127.0.0.1` |
| **epay 端口** | 1-65535 | `8080` |
| **epay 商户ID** | 不超过 64 字节 | `test12345` |
| **epay 商户密钥** | 不超过 64 字节 | `testkey123` |

### 其他参数要求

| 字段 | 要求 | 示例 |
|------|------|------|
| **首购资金池** | >= 10,000 MEMO | `10000` |
| **费率** | 0-10000 bps | `100` |
| **最小下单额** | > 0 MEMO | `100` |

---

## ✅ 第三步：查看控制台日志

### 打开控制台

- **Windows**: 按 `F12` 或 `Ctrl+Shift+I`
- **Mac**: 按 `Cmd+Option+I`

### 应该看到的日志

```
💰 [余额检查]
  可用余额: 50000.00 MEMO
  已锁定: 10000.00 MEMO
  需要锁定: 10000 MEMO（首购资金池）

📤 [submitInfo] 提交参数详情
  mmId: 0
  fee: 100 (u16)
  minAmt: 100 MEMO → formatted: 100000000000000
  pool: 10000 MEMO → formatted: 10000000000000000000
  epay_gateway: http://127.0.0.1 → bytes: 16 字节
  epay_port: 8080 (u16)
  epay_pid: test12345 → bytes: 9 字节
  epay_key: testkey*** → bytes: 10 字节
```

### 检查异常值

| 问题 | 日志显示 | 解决方法 |
|------|---------|---------|
| 余额不足 | 可用余额 < 需要锁定 | 充值或降低金额 |
| 字段超长 | bytes > 限制 | 缩短字符串 |
| 端口错误 | port > 65535 | 修正端口号 |

---

## 🔧 常见错误及解决方法

### 错误 1：余额不足

**错误提示**:
```
余额不足：可用 5000.00 MEMO，但需要 10000 MEMO
```

**解决方法**:
1. 查看当前余额
2. 充值或转账至少 10,000 MEMO
3. 重新提交

---

### 错误 2：字段超长

**错误提示**:
```
epay 支付网关地址超过 128 字节限制
```

**解决方法**:
1. 查看控制台日志：`epay_gateway: ... → bytes: X 字节`
2. 缩短网关地址（例如使用 IP 而不是域名）
3. 确保不超过 128 字节
4. 重新提交

---

### 错误 3：端口号错误

**错误提示**:
```
epay 端口必须小于等于 65535
```

**解决方法**:
1. 检查端口号是否正确
2. 确保在 1-65535 范围内
3. 重新输入正确的端口号
4. 重新提交

---

### 错误 4：wasm unreachable（已修复）

**如果仍然遇到此错误**:

1. 确保使用的是最新版本代码（v1.1.0+）
2. 刷新页面（Ctrl+F5 强制刷新）
3. 清除缓存
4. 按照上述步骤逐一检查
5. 如果还是失败，复制控制台日志联系技术支持

---

## 📋 提交前检查清单

在点击"提交"按钮前，请确认：

- [ ] 账户余额 >= 20,000 MEMO
- [ ] epay 网关地址不超过 128 字节
- [ ] epay 端口号在 1-65535 范围内
- [ ] epay 商户ID不超过 64 字节
- [ ] epay 商户密钥不超过 64 字节
- [ ] 首购资金池 >= 10,000 MEMO
- [ ] 已打开浏览器控制台（F12）
- [ ] 已填写有效的 IPFS CID

---

## 🧪 测试配置（推荐）

如果你是首次测试，可以使用以下配置：

```
公开资料 CID: QmTest1111111111111111111111111111111111111111111
私密资料 CID: QmTest2222222222222222222222222222222222222222222
费率（bps）: 100
最小下单额: 100
epay 支付网关: http://127.0.0.1
epay 端口: 8080
epay 商户ID: test12345
epay 商户密钥: testkey123
首购资金池: 10000
```

**注意**：上述配置仅供测试，生产环境请使用真实配置。

---

## 💡 常见问题 FAQ

### Q1: 为什么需要 20,000 MEMO？

A: 因为需要：
- 10,000 MEMO 保证金（第一步质押）
- 10,000 MEMO 首购资金池（第二步提交）
- 约 0.01 MEMO 交易费用

### Q2: 首购资金池可以降低吗？

A: 最低 10,000 MEMO，不能更低。这是为了：
- 可服务约 100 个新用户（100 MEMO/人）
- 10-20 天充值一次（合理的运营频率）
- 保证服务稳定性

### Q3: epay 配置从哪里获取？

A: 
- **测试环境**: 使用上面推荐的测试配置即可
- **生产环境**: 联系 epay 服务商获取真实配置

### Q4: 提交后可以修改吗？

A: 可以！在审核前可以调用 `update_info` 修改资料。

### Q5: 如何清除错误状态重新开始？

A: 在控制台执行：
```javascript
localStorage.removeItem('mm_apply_id')
localStorage.removeItem('mm_apply_deadline')
localStorage.removeItem('mm_apply_step')
location.reload()
```

---

## 📞 需要帮助？

如果以上方法都无法解决问题：

1. **截图控制台日志**（包括红色错误）
2. **记录你的输入参数**
3. **联系技术支持**，并提供：
   - 控制台日志截图
   - 错误完整文本
   - 你的输入参数
   - 账户地址（可选）

---

## 📚 相关文档

- `docs/Wasm_Unreachable错误快速解决指南.md` - 详细诊断指南
- `docs/首购资金池最小值合理性分析.md` - 为什么是 10,000 MEMO
- `docs/做市商NotFound错误诊断和解决方案.md` - NotFound 错误专项

---

**最后更新**: 2025-10-14  
**版本**: v1.1.0  
**状态**: ✅ 可用

