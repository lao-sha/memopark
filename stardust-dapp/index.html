<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- 开发模式下移除 CSP 等强限制，避免 Vite HMR/React Refresh 被拦截导致白屏。
         线上部署再由网关/服务器注入严格安全头。 -->
    
    <title>星尘玄鉴-国学排盘</title>
  </head>
  <body>
    <div id="root">
      <div style="padding:16px;font-family:system-ui,-apple-system,Segoe UI,Roboto;">
        正在启动应用… 如果一直停留在此，请按 F12 打开控制台截图给我们。
      </div>
    </div>
    <script>
      // 开发自检：确认浏览器脚本是否能执行
      try {
        const el = document.getElementById('root')
        if (el) {
          const now = new Date().toLocaleTimeString()
          el.firstElementChild && (el.firstElementChild.textContent = `脚本已执行(${now})，开始加载应用…`)
          console.log('[memopark] Inline script executed at', now)
        }
      } catch (e) {
        console.error('[memopark] Inline script error', e)
      }
    </script>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      // 后备加载：若 /src/main.tsx 未执行，则带重试地尝试动态导入并回显状态
      (function setupFallbackLoader() {
        const MAX_RETRY = 4
        const BASE_DELAY = 200

        function tryImport(attempt) {
          if ((window).__memopark_main_loaded__) return

          const root = document.getElementById('root')
          if (root && root.firstElementChild) {
            root.firstElementChild.textContent = `尝试后备加载 main.tsx … (第 ${attempt} 次)`
          }

          import('/src/main.tsx')
            .then(() => {
            console.log('[memopark] Fallback dynamic import succeeded')
            })
            .catch((err) => {
              console.error('[memopark] Fallback dynamic import failed', err)
              if ((window).__memopark_main_loaded__) return

              if (attempt < MAX_RETRY) {
                const delay = Math.min(1500, BASE_DELAY * Math.pow(2, attempt - 1))
                setTimeout(() => tryImport(attempt + 1), delay)
              } else if (root && root.firstElementChild) {
                root.firstElementChild.textContent = '加载失败：' + (err && (err.message || err))
              }
            })
          }

        window.addEventListener('load', () => {
          if ((window).__memopark_main_loaded__) return
          setTimeout(() => tryImport(1), BASE_DELAY)
        })
      })()
    </script>
  </body>
</html>
