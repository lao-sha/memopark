# Pallet Membership

**å¹´è´¹ä¼šå‘˜ç³»ç»Ÿ - å®Œæ•´æ–‡æ¡£**

## æ¨¡å—æ¦‚è¿°

**pallet-membership** æ˜¯ Stardust çºªå¿µå…¬å›­ç”Ÿæ€ç³»ç»Ÿçš„æ ¸å¿ƒå¹´è´¹ä¼šå‘˜ç³»ç»Ÿï¼Œå®ç°äº†å®Œæ•´çš„å››çº§ä¼šå‘˜ä½“ç³»ã€æ¨èå…³ç³»ç®¡ç†ã€åŠ¨æ€ä»£æ•°å¢é•¿æœºåˆ¶å’Œä¼šå‘˜æŠ˜æ‰£ç®¡ç†ã€‚è¯¥æ¨¡å—ä¸ `pallet-affiliate`ï¼ˆè”ç›Ÿè®¡é…¬ç³»ç»Ÿï¼‰å’Œ `pallet-pricing`ï¼ˆå®šä»·ç³»ç»Ÿï¼‰ç´§å¯†é›†æˆï¼Œæä¾›ç¨³å®šçš„ USDT å®šä»·å’Œçµæ´»çš„æ¨èå¥–åŠ±æœºåˆ¶ã€‚

### æ ¸å¿ƒç‰¹æ€§

1. **å››çº§ä¼šå‘˜åˆ¶åº¦**ï¼šYear1ï¼ˆ1å¹´ï¼‰ã€Year3ï¼ˆ3å¹´ï¼‰ã€Year5ï¼ˆ5å¹´ï¼‰ã€Year10ï¼ˆ10å¹´ï¼‰
2. **USDT å›ºå®šå®šä»·**ï¼šåŸºäºç¨³å®šå¸å®šä»·ï¼ŒDUST æ•°é‡åŠ¨æ€è®¡ç®—ï¼ˆ2025-11-10 æ–°å¢ï¼‰
3. **æŒå¸é—¨æ§›éªŒè¯**ï¼šæœ‰æ•ˆä¼šå‘˜éœ€æŒæœ‰ä»·å€¼â‰¥100ç¾å…ƒçš„ DUSTï¼ˆ2025-11-10 æ–°å¢ï¼‰
4. **åŠ¨æ€ä»£æ•°å¢é•¿**ï¼šæ¨èè¶Šå¤šæ‹¿è¶Šå¤šï¼Œæœ€å¤š15ä»£
5. **ä¼šå‘˜æŠ˜æ‰£ç®¡ç†**ï¼šé»˜è®¤2æŠ˜ä¼˜æƒ ï¼Œé€‚ç”¨äºä¾›å¥‰ç­‰æ¶ˆè´¹åœºæ™¯
6. **è¡¥å‡çº§æœºåˆ¶**ï¼šä½ç­‰çº§ä¼šå‘˜å¯è¡¥å·®ä»·å‡çº§åˆ°10å¹´ä¼šå‘˜
7. **è”ç›Ÿè®¡é…¬é›†æˆ**ï¼šè´­ä¹°ä¼šå‘˜æ—¶è§¦å‘100%æ¨èé“¾åˆ†æˆ

---

## æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. å››çº§ä¼šå‘˜åˆ¶åº¦

#### 1.1 ä¼šå‘˜ç­‰çº§å®šä¹‰

| ç­‰çº§ | USDT ä»·æ ¼ | åŠ¨æ€ DUST | æœ‰æ•ˆæœŸ | åŸºç¡€ä»£æ•° | æ¨èå¢é•¿ç©ºé—´ |
|-----|----------|----------|-------|---------|------------|
| **Year1** | $50 USD | åŠ¨æ€è®¡ç®— | 1å¹´ | 6ä»£ | å¯å¢é•¿è‡³15ä»£ï¼ˆ+9ä»£ï¼‰ |
| **Year3** | $100 USD | åŠ¨æ€è®¡ç®— | 3å¹´ | 9ä»£ | å¯å¢é•¿è‡³15ä»£ï¼ˆ+6ä»£ï¼‰ |
| **Year5** | $200 USD | åŠ¨æ€è®¡ç®— | 5å¹´ | 12ä»£ | å¯å¢é•¿è‡³15ä»£ï¼ˆ+3ä»£ï¼‰ |
| **Year10** | $300 USD | åŠ¨æ€è®¡ç®— | 10å¹´ | 15ä»£ | å·²æ»¡çº§ï¼Œæ— å¢é•¿ç©ºé—´ |

#### 1.2 ä¼šå‘˜æƒç›Šå¯¹æ¯”

| æƒç›Šé¡¹ | Year1 | Year3 | Year5 | Year10 |
|-------|-------|-------|-------|--------|
| **ä¾›å¥‰æŠ˜æ‰£** | âœ… 2æŠ˜ | âœ… 2æŠ˜ | âœ… 2æŠ˜ | âœ… 2æŠ˜ |
| **OTCäº¤æ˜“è´¹ç”¨æŠ˜æ‰£** | âœ… | âœ… | âœ… | âœ… |
| **æ¨èæ”¶ç›Š** | æœ€å¤š15ä»£ | æœ€å¤š15ä»£ | æœ€å¤š15ä»£ | å›ºå®š15ä»£ |
| **æœ‰æ•ˆæœŸ** | 1å¹´ | 3å¹´ | 5å¹´ | 10å¹´ |
| **åˆå§‹ä»£æ•°** | 6ä»£ | 9ä»£ | 12ä»£ | 15ä»£ï¼ˆæ»¡çº§ï¼‰ |
| **æ¨èå¢é•¿æ½œåŠ›** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ | â­ï¼ˆå·²æ»¡çº§ï¼‰ |
| **æ€§ä»·æ¯”** | å…¥é—¨é¦–é€‰ | è¿›é˜¶é¦–é€‰ | é«˜çº§é¦–é€‰ | ç»ˆèº«é¦–é€‰ |

#### 1.3 é€‚ç”¨åœºæ™¯å»ºè®®

**Year1ï¼ˆå…¥é—¨çº§ï¼‰**ï¼š
- é€‚åˆï¼šåˆæ¬¡ä½“éªŒç”¨æˆ·ã€è§‚æœ›è€…
- ä¼˜ç‚¹ï¼šä»·æ ¼ä½å»‰ã€é—¨æ§›ä½
- ç¼ºç‚¹ï¼šæœ‰æ•ˆæœŸçŸ­ã€åˆå§‹ä»£æ•°å°‘
- æ¨èäººç¾¤ï¼šæ–°ç”¨æˆ·ã€å°é¢æŠ•èµ„è€…

**Year3ï¼ˆè¿›é˜¶çº§ï¼‰**ï¼š
- é€‚åˆï¼šé•¿æœŸè§„åˆ’ç”¨æˆ·ã€ä¸­ç­‰æŠ•å…¥è€…
- ä¼˜ç‚¹ï¼šæ€§ä»·æ¯”é«˜ã€æœ‰æ•ˆæœŸé€‚ä¸­ã€åˆå§‹ä»£æ•°9ä»£
- ç¼ºç‚¹ï¼šéœ€è¦æ¨è6äººæ‰èƒ½æ»¡çº§
- æ¨èäººç¾¤ï¼šæœ‰æ¨å¹¿èƒ½åŠ›çš„ç”¨æˆ·ã€å›¢é˜Ÿé¢†å¯¼è€…

**Year5ï¼ˆé«˜çº§ï¼‰**ï¼š
- é€‚åˆï¼šå›¢é˜Ÿæ ¸å¿ƒæˆå‘˜ã€å¤§é¢æŠ•èµ„è€…
- ä¼˜ç‚¹ï¼šæœ‰æ•ˆæœŸé•¿ã€åˆå§‹ä»£æ•°é«˜ï¼ˆ12ä»£ï¼‰
- ç¼ºç‚¹ï¼šä»·æ ¼è¾ƒé«˜
- æ¨èäººç¾¤ï¼šç¤¾åŒºæ´»è·ƒç”¨æˆ·ã€KOL

**Year10ï¼ˆç»ˆèº«çº§ï¼‰**ï¼š
- é€‚åˆï¼šé¡¹ç›®æ·±åº¦å‚ä¸è€…ã€é¡¶çº§æ¨å¹¿è€…
- ä¼˜ç‚¹ï¼šæœ‰æ•ˆæœŸæœ€é•¿ï¼ˆ10å¹´ï¼‰ã€åˆå§‹æ»¡çº§ï¼ˆ15ä»£ï¼‰ã€æ— éœ€æ¨èå¢é•¿
- ç¼ºç‚¹ï¼šä»·æ ¼æœ€é«˜
- æ¨èäººç¾¤ï¼šé¡¹ç›®æ–¹æ ¸å¿ƒä¼™ä¼´ã€è¶…çº§èŠ‚ç‚¹ã€ç¤¾åŒºé¢†è¢–

---

### 2. USDT åŠ¨æ€å®šä»·æœºåˆ¶ï¼ˆ2025-11-10 æ–°å¢ï¼‰

#### 2.1 å®šä»·æ¨¡å¼å˜é©

**æ—§æ¨¡å¼ï¼ˆå·²åºŸå¼ƒï¼‰**ï¼š
```
å›ºå®š DUST æ•°é‡ â†’ æµ®åŠ¨ USD ä»·å€¼
é—®é¢˜ï¼šDUST ä»·æ ¼æ³¢åŠ¨å¯¼è‡´å®é™…æ”¯ä»˜ä»·å€¼ä¸ç¨³å®š
```

**æ–°æ¨¡å¼ï¼ˆå·²å®æ–½ï¼‰**ï¼š
```
å›ºå®š USD ä»·å€¼ â†’ æµ®åŠ¨ DUST æ•°é‡
ä¼˜åŠ¿ï¼šç”¨æˆ·å§‹ç»ˆæ”¯ä»˜ç›¸åŒçš„ç¾å…ƒä»·å€¼ï¼Œå…¬å¹³æ€§é«˜
```

#### 2.2 å®šä»·è®¡ç®—å…¬å¼

**æ ¸å¿ƒå…¬å¼**ï¼š
```rust
éœ€è¦DUST = (USDTä»·æ ¼ Ã— UNITS) / DUSTå¸‚åœºä»·æ ¼
```

**è¯¦ç»†è¯´æ˜**ï¼š
- **USDTä»·æ ¼**ï¼šå›ºå®šä»·æ ¼ï¼ˆYear1=$50, Year3=$100, Year5=$200, Year10=$300ï¼‰
- **UNITS**ï¼šDUST ä»£å¸ç²¾åº¦ï¼ˆ1 DUST = 10^12ï¼‰
- **DUSTå¸‚åœºä»·æ ¼**ï¼šä» `pallet-pricing` è·å–çš„åŠ æƒå¹³å‡ä»·æ ¼ï¼ˆç²¾åº¦ 10^6ï¼‰

#### 2.3 å®šä»·ç¤ºä¾‹

å‡è®¾ DUST å¸‚åœºä»·æ ¼ä¸º **0.0001 USDT/DUST**ï¼ˆå³ 100ï¼Œç²¾åº¦ 10^6ï¼‰ï¼š

| ç­‰çº§ | USDTä»·æ ¼ | DUSTå¸‚åœºä»·æ ¼ | è®¡ç®—å…¬å¼ | éœ€è¦ DUST |
|-----|---------|------------|---------|----------|
| Year1 | $50 | 0.0001 | (50,000,000 Ã— 10^12) / 100 | 500,000 DUST |
| Year3 | $100 | 0.0001 | (100,000,000 Ã— 10^12) / 100 | 1,000,000 DUST |
| Year5 | $200 | 0.0001 | (200,000,000 Ã— 10^12) / 100 | 2,000,000 DUST |
| Year10 | $300 | 0.0001 | (300,000,000 Ã— 10^12) / 100 | 3,000,000 DUST |

**ä»·æ ¼è‡ªé€‚åº”ç¤ºä¾‹**ï¼š

| DUSTä»·æ ¼å˜åŒ– | Year1 éœ€è¦ DUST | Year3 éœ€è¦ DUST | Year5 éœ€è¦ DUST | Year10 éœ€è¦ DUST |
|-------------|----------------|----------------|----------------|-----------------|
| 0.0001 USDT | 500,000 | 1,000,000 | 2,000,000 | 3,000,000 |
| 0.0002 USDT | 250,000 | 500,000 | 1,000,000 | 1,500,000 |
| 0.00005 USDT | 1,000,000 | 2,000,000 | 4,000,000 | 6,000,000 |

#### 2.4 å®šä»·ç­–ç•¥ï¼ˆä¸‰çº§å›é€€æœºåˆ¶ï¼‰

```rust
// ç­–ç•¥1ï¼šåŠ¨æ€ USDT å®šä»·ï¼ˆä¼˜å…ˆï¼‰
match Self::calculate_dust_amount_from_usdt(level) {
    Ok(dynamic_price) => return dynamic_price,
    Err(_) => {
        // ç­–ç•¥2ï¼šå­˜å‚¨ä»·æ ¼ï¼ˆæ²»ç†è®¾ç½®ï¼‰
        if let Some(stored_price) = MembershipPrices::<T>::get(level) {
            return stored_price;
        }

        // ç­–ç•¥3ï¼šé»˜è®¤ä»·æ ¼ï¼ˆç¡¬ç¼–ç å›é€€ï¼‰
        return default_price;
    }
}
```

**å›é€€ä¼˜å…ˆçº§**ï¼š
1. **åŠ¨æ€ USDT å®šä»·**ï¼šåŸºäº `pallet-pricing` å®æ—¶å¸‚åœºä»·æ ¼è®¡ç®—ï¼ˆæ¨èï¼‰
2. **å­˜å‚¨ä»·æ ¼**ï¼šæ²»ç†é€šè¿‡ `set_membership_price` è®¾ç½®çš„å›ºå®šä»·æ ¼
3. **é»˜è®¤ä»·æ ¼**ï¼šç¡¬ç¼–ç çš„å›é€€ä»·æ ¼ï¼ˆYear1=400 DUST, Year3=800 DUST, ç­‰ï¼‰

#### 2.5 ä»·æ ¼æŸ¥è¯¢äº‹ä»¶

```rust
// æˆåŠŸäº‹ä»¶ï¼šåŠ¨æ€ä»·æ ¼è®¡ç®—å®Œæˆ
Event::DynamicPriceCalculated {
    level_id: 0,
    usdt_price: 50_000_000,          // $50 USD
    dust_market_price: 100,          // 0.0001 USDT/DUST
    dust_amount: 500_000_000_000_000_000, // 500,000 DUST
}

// å›é€€äº‹ä»¶ï¼šä½¿ç”¨å›é€€ä»·æ ¼
Event::PriceCalculationFallback {
    level_id: 0,
    fallback_price: 400_000_000_000_000_000, // 400 DUSTï¼ˆé»˜è®¤ä»·æ ¼ï¼‰
}
```

---

### 3. æŒå¸é—¨æ§›æœºåˆ¶ï¼ˆ2025-11-10 æ–°å¢ï¼‰

#### 3.1 æ ¸å¿ƒå˜æ›´

**åŸæœ‰æœºåˆ¶**ï¼š
- éªŒè¯ç»´åº¦ï¼šä¼šå‘˜å­˜åœ¨æ€§ + æ—¶æ•ˆæ€§
- é—¨æ§›ï¼šæ— æŒå¸è¦æ±‚

**æ–°æœºåˆ¶ï¼ˆå·²å®æ–½ï¼‰**ï¼š
- éªŒè¯ç»´åº¦ï¼šä¼šå‘˜å­˜åœ¨æ€§ + æ—¶æ•ˆæ€§ + **æŒå¸ä»·å€¼**
- é—¨æ§›ï¼šæŒå¸ä»·å€¼ â‰¥ **$100 USD**ï¼ˆåŠ¨æ€è®¡ç®—ï¼‰
- ä»·æ ¼æ¥æºï¼š`pallet-pricing` åŠ æƒå¹³å‡ä»·æ ¼

#### 3.2 æŒå¸ä»·å€¼è®¡ç®—

**è®¡ç®—å…¬å¼**ï¼š
```rust
æŒå¸ä»·å€¼(ç¾åˆ†) = (ä½™é¢ Ã— DUSTä»·æ ¼ Ã— 100) / (10^12 Ã— 10^6)
              = (ä½™é¢ Ã— DUSTä»·æ ¼) / 10^16
```

**å‚æ•°è¯´æ˜**ï¼š
- **ä½™é¢**ï¼šè´¦æˆ· DUST ä½™é¢ï¼ˆç²¾åº¦ 10^12ï¼‰
- **DUSTä»·æ ¼**ï¼šUSDT/DUST å¸‚åœºä»·æ ¼ï¼ˆç²¾åº¦ 10^6ï¼‰
- **10^16**ï¼šç²¾åº¦æ¢ç®—å› å­ï¼ˆ10^12 Ã— 10^6 / 100ï¼‰

**ç¤ºä¾‹è®¡ç®—**ï¼š
```
ä½™é¢ï¼š1,000,000 DUSTï¼ˆ= 1,000,000 Ã— 10^12ï¼‰
DUSTä»·æ ¼ï¼š0.0001 USDTï¼ˆ= 100 Ã— 10^6 ç²¾åº¦ï¼‰
æŒå¸ä»·å€¼ï¼š(1,000,000 Ã— 10^12 Ã— 100 Ã— 100) / 10^18 = 100 ç¾å…ƒ âœ…
```

#### 3.3 æŒå¸é—¨æ§›éªŒè¯é€»è¾‘

```rust
pub fn is_member_valid(who: &T::AccountId) -> bool {
    if let Some(membership) = Memberships::<T>::get(who) {
        // éªŒè¯1ï¼šä¼šå‘˜æœªè¿‡æœŸ
        let current_block = <frame_system::Pallet<T>>::block_number();
        if current_block > membership.valid_until {
            return false;
        }

        // éªŒè¯2ï¼šæŒå¸ä»·å€¼ â‰¥ $100 USD
        Self::check_holding_value(who)
    } else {
        false
    }
}

fn check_holding_value(who: &T::AccountId) -> bool {
    let balance = T::Currency::free_balance(who);
    let dust_price_usdt = pallet_pricing::Pallet::<T::PricingConfig>::get_dust_market_price_weighted();
    let holding_value_cents = balance
        .saturating_mul(dust_price_usdt)
        .saturating_mul(100)
        .checked_div(10^18)
        .unwrap_or(0);

    holding_value_cents >= 10000 // $100 USD = 10000 ç¾åˆ†
}
```

#### 3.4 æŒå¸ä»·å€¼æŸ¥è¯¢

**æŸ¥è¯¢å‡½æ•°**ï¼š
```rust
// è·å–è´¦æˆ·æŒå¸ä»·å€¼ï¼ˆç¾å…ƒï¼Œä¸¤ä½å°æ•°ï¼‰
pub fn get_holding_value_usd(who: &T::AccountId) -> (u64, u32);
```

**è¿”å›å€¼**ï¼š
- `(dollars, cents)`ï¼šä¾‹å¦‚ `(123, 45)` è¡¨ç¤º $123.45

**ç¤ºä¾‹**ï¼š
```rust
let (dollars, cents) = Membership::get_holding_value_usd(&alice);
println!("æŒå¸ä»·å€¼ï¼š${}.{:02}", dollars, cents);
// è¾“å‡ºï¼šæŒå¸ä»·å€¼ï¼š$123.45
```

#### 3.5 å½±å“è¯´æ˜

| ç”¨æˆ·ç±»å‹ | å½±å“ | åº”å¯¹æªæ–½ |
|---------|-----|---------|
| **ç°æœ‰ä¼šå‘˜** | éœ€ä¿æŒä½™é¢ä½¿å¾—æŒå¸ä»·å€¼â‰¥$100 | åŠæ—¶å……å€¼ï¼Œä¿æŒä½™é¢ |
| **æ–°ä¼šå‘˜** | è´­ä¹°ä¼šå‘˜åéœ€æŒæœ‰è¶³å¤ŸDUST | è´­ä¹°æ—¶è®¡ç®—æ‰€éœ€ä½™é¢ |
| **ä½™é¢ä¸è¶³ç”¨æˆ·** | æš‚æ—¶å¤±å»æƒç›Šï¼ˆæŠ˜æ‰£ã€æ¨èæ”¶ç›Šï¼‰ | å……å€¼åè‡ªåŠ¨æ¢å¤æƒç›Š |
| **é«˜ä½™é¢ç”¨æˆ·** | æ— å½±å“ | æ— éœ€æ“ä½œ |

---

### 4. åŠ¨æ€ä»£æ•°å¢é•¿æœºåˆ¶

#### 4.1 å¢é•¿è§„åˆ™

**æ ¸å¿ƒå…¬å¼**ï¼š
```
æ€»ä»£æ•° = åŸºç¡€ä»£æ•° + å¥–åŠ±ä»£æ•°ï¼ˆæœ€å¤š15ä»£ï¼‰
å¥–åŠ±ä»£æ•° = æ¨èäººæ•°ï¼ˆæ¯æ¨è1äºº+1ä»£ï¼‰
```

**çº¦æŸæ¡ä»¶**ï¼š
- æ€»ä»£æ•°ä¸Šé™ï¼š**15ä»£**
- 10å¹´ä¼šå‘˜ï¼šåˆå§‹å³15ä»£ï¼Œä¸å†å¢é•¿

#### 4.2 å¢é•¿ç¤ºä¾‹

**Year1 ä¼šå‘˜ï¼ˆåŸºç¡€6ä»£ï¼‰**ï¼š

| æ¨èäººæ•° | å¥–åŠ±ä»£æ•° | æ€»ä»£æ•° | è¯´æ˜ |
|---------|---------|--------|-----|
| 0 | 0 | 6 | åˆå§‹çŠ¶æ€ |
| 1 | 1 | 7 | æ¨è1äºº |
| 5 | 5 | 11 | æ¨è5äºº |
| 9 | 9 | 15 | æ¨è9äººï¼Œè¾¾åˆ°ä¸Šé™ |
| 10+ | 9 | 15 | è¶…è¿‡9äººä¸å†å¢é•¿ |

**Year3 ä¼šå‘˜ï¼ˆåŸºç¡€9ä»£ï¼‰**ï¼š

| æ¨èäººæ•° | å¥–åŠ±ä»£æ•° | æ€»ä»£æ•° | è¯´æ˜ |
|---------|---------|--------|-----|
| 0 | 0 | 9 | åˆå§‹çŠ¶æ€ |
| 3 | 3 | 12 | æ¨è3äºº |
| 6 | 6 | 15 | æ¨è6äººï¼Œè¾¾åˆ°ä¸Šé™ |
| 7+ | 6 | 15 | è¶…è¿‡6äººä¸å†å¢é•¿ |

**Year5 ä¼šå‘˜ï¼ˆåŸºç¡€12ä»£ï¼‰**ï¼š

| æ¨èäººæ•° | å¥–åŠ±ä»£æ•° | æ€»ä»£æ•° | è¯´æ˜ |
|---------|---------|--------|-----|
| 0 | 0 | 12 | åˆå§‹çŠ¶æ€ |
| 1 | 1 | 13 | æ¨è1äºº |
| 3 | 3 | 15 | æ¨è3äººï¼Œè¾¾åˆ°ä¸Šé™ |
| 4+ | 3 | 15 | è¶…è¿‡3äººä¸å†å¢é•¿ |

**Year10 ä¼šå‘˜ï¼ˆåŸºç¡€15ä»£ï¼‰**ï¼š

| æ¨èäººæ•° | å¥–åŠ±ä»£æ•° | æ€»ä»£æ•° | è¯´æ˜ |
|---------|---------|--------|-----|
| ä»»æ„ | 0 | 15 | åˆå§‹å³æ»¡çº§ï¼Œä¸å†å¢é•¿ |

#### 4.3 å¢é•¿ç®—æ³•å®ç°

```rust
fn increase_referrer_generation(referrer: &T::AccountId) -> DispatchResult {
    Memberships::<T>::try_mutate(referrer, |maybe_membership| -> DispatchResult {
        if let Some(ref mut membership) = maybe_membership {
            // æ¯æ¨èä¸€ä¸ªä¼šå‘˜ï¼Œå¢åŠ 1ä»£
            membership.bonus_generations = membership.bonus_generations.saturating_add(1);

            // é‡æ–°è®¡ç®—æ€»ä»£æ•°ï¼ˆæœ€å¤š15ä»£ï¼‰
            membership.total_generations = 15u8.min(
                membership.base_generations.saturating_add(membership.bonus_generations)
            );

            // å¢åŠ æ¨èè®¡æ•°
            membership.referral_count = membership.referral_count.saturating_add(1);

            // å‘å‡ºäº‹ä»¶
            Self::deposit_event(Event::GenerationIncreased {
                who: referrer.clone(),
                bonus: membership.bonus_generations,
                total: membership.total_generations,
            });
        }
        Ok(())
    })
}
```

#### 4.4 ä»£æ•°åº”ç”¨åœºæ™¯

**è”ç›Ÿè®¡é…¬åˆ†é…**ï¼š
```rust
// è·å–ä¼šå‘˜å¯æ‹¿ä»£æ•°
let generations = Membership::get_member_generations(&alice);

// åˆ†é…æ—¶ä½¿ç”¨è¯¥ä»£æ•°
if let Some(gen) = generations {
    // æœ€å¤šåˆ†é… gen ä»£æ¨èäºº
    for i in 0..gen {
        // åˆ†é…é€»è¾‘
    }
}
```

---

### 5. ä¼šå‘˜æŠ˜æ‰£ç®¡ç†

#### 5.1 é»˜è®¤æŠ˜æ‰£

- **é»˜è®¤å€¼**ï¼š20%ï¼ˆå³2æŠ˜ï¼‰
- **é…ç½®èŒƒå›´**ï¼š0-100ï¼ˆ0% åˆ° 100%ï¼‰
- **åº”ç”¨åœºæ™¯**ï¼š
  - ä¾›å¥‰ç³»ç»Ÿï¼ˆ`pallet-memorial`ï¼‰
  - OTCäº¤æ˜“ç³»ç»Ÿï¼ˆ`pallet-otc-order`ï¼‰
  - å…¶ä»–æ¶ˆè´¹åœºæ™¯

#### 5.2 æŠ˜æ‰£è®¡ç®—ç¤ºä¾‹

| åŸä»· | æŠ˜æ‰£æ¯”ä¾‹ | æŠ˜åä»· |
|-----|---------|--------|
| 100 DUST | 20% | 20 DUST |
| 500 DUST | 20% | 100 DUST |
| 1000 DUST | 20% | 200 DUST |

#### 5.3 æŠ˜æ‰£æŸ¥è¯¢

```rust
// è·å–ä¼šå‘˜æŠ˜æ‰£æ¯”ä¾‹
let discount = Membership::get_discount(); // è¿”å› 20

// è®¡ç®—æŠ˜åä»·
let original_price = 100_000_000_000_000; // 100 DUST
let discounted_price = original_price
    .saturating_mul(discount as u128)
    .saturating_div(100);
// discounted_price = 20_000_000_000_000 (20 DUST)
```

#### 5.4 æŠ˜æ‰£æ›´æ–°ï¼ˆRootæƒé™ï¼‰

```rust
// è®¾ç½®ä¼šå‘˜æŠ˜æ‰£ä¸º 30%ï¼ˆ3æŠ˜ï¼‰
membership.set_member_discount(root_origin, 30)?;

// äº‹ä»¶ï¼šDiscountUpdated { discount: 30 }
```

---

### 6. è¡¥å‡çº§æœºåˆ¶

#### 6.1 å‡çº§è§„åˆ™

**é€‚ç”¨å¯¹è±¡**ï¼šYear1/Year3/Year5 ä¼šå‘˜

**å‡çº§ä»·æ ¼è®¡ç®—ï¼ˆåŸºäº USDTï¼‰**ï¼š
```rust
// å‡çº§ä»·æ ¼ = Year10ä»·æ ¼ - å½“å‰ç­‰çº§ä»·æ ¼ + æœåŠ¡è´¹(20%)
let current_usdt = membership.level.price_in_usdt();
let year10_usdt = MembershipLevel::Year10.price_in_usdt();
let price_diff = year10_usdt.saturating_sub(current_usdt);
let service_fee = price_diff.saturating_mul(20).saturating_div(100);
let total_usdt_price = price_diff.saturating_add(service_fee);
```

#### 6.2 å‡çº§ä»·æ ¼ç¤ºä¾‹ï¼ˆå‡è®¾ DUST = 0.0001 USDTï¼‰

| å½“å‰ç­‰çº§ | å½“å‰ä»·æ ¼ | Year10ä»·æ ¼ | å·®ä»· | æœåŠ¡è´¹(20%) | æ€»USDT | éœ€è¦DUST |
|---------|---------|-----------|-----|-----------|--------|---------|
| Year1 | $50 | $300 | $250 | $50 | $300 | 3,000,000 |
| Year3 | $100 | $300 | $200 | $40 | $240 | 2,400,000 |
| Year5 | $200 | $300 | $100 | $20 | $120 | 1,200,000 |

#### 6.3 å‡çº§æ•ˆæœ

| æ•ˆæœé¡¹ | å˜åŒ– |
|-------|-----|
| **ä¼šå‘˜ç­‰çº§** | â†’ Year10 |
| **æœ‰æ•ˆæœŸ** | ä»å½“å‰æ—¶é—´é‡æ–°è®¡ç®—10å¹´ |
| **åŸºç¡€ä»£æ•°** | â†’ 15ä»£ |
| **æ€»ä»£æ•°** | â†’ 15ä»£ï¼ˆå›ºå®šï¼‰ |
| **æ¨èå¢é•¿** | ä¸å†äº«å—ä»£æ•°å¢é•¿å¥–åŠ± |

#### 6.4 å‡çº§æµç¨‹

```rust
// ç”¨æˆ·è°ƒç”¨å‡çº§æ¥å£
membership.upgrade_to_year10(origin)?;

// å†…éƒ¨æµç¨‹ï¼š
// 1. è·å–å½“å‰ä¼šå‘˜ä¿¡æ¯
// 2. éªŒè¯ä¸æ˜¯å·²ç»æ˜¯10å¹´ä¼šå‘˜
// 3. è®¡ç®—å‡çº§è´¹ç”¨ï¼ˆåŸºäºUSDTåŠ¨æ€è®¡ç®—DUSTï¼‰
// 4. æ‰£è´¹åˆ°å›½åº“è´¦æˆ·
// 5. æ›´æ–°ä¼šå‘˜ä¿¡æ¯ï¼ˆç­‰çº§ã€ä»£æ•°ã€æœ‰æ•ˆæœŸï¼‰
// 6. æ›´æ–°ç»Ÿè®¡æ•°æ®
// 7. å‘å‡ºäº‹ä»¶
```

---

## æ•°æ®ç»“æ„

### 1. å­˜å‚¨é¡¹

| å­˜å‚¨ | ç±»å‹ | æè¿° | é»˜è®¤å€¼ |
|-----|------|-----|-------|
| `Memberships` | `StorageMap<AccountId, MembershipInfo>` | ä¼šå‘˜ä¿¡æ¯æ˜ å°„ | - |
| `TotalMembers` | `StorageMap<MembershipLevel, u32>` | ä¼šå‘˜ç»Ÿè®¡ï¼ˆæŒ‰ç­‰çº§ï¼‰ | 0 |
| `MemberDiscount` | `u8` | ä¼šå‘˜æŠ˜æ‰£æ¯”ä¾‹ï¼ˆ0-100ï¼‰ | 20 |
| `MembershipPrices` | `StorageMap<MembershipLevel, Balance>` | ä¼šå‘˜ä»·æ ¼å­˜å‚¨ï¼ˆæ²»ç†è®¾ç½®ï¼‰ | None |

### 2. MembershipInfo ç»“æ„

```rust
pub struct MembershipInfo<AccountId, BlockNumber> {
    /// ä¼šå‘˜ç­‰çº§ï¼ˆYear1/Year3/Year5/Year10ï¼‰
    pub level: MembershipLevel,

    /// è´­ä¹°æ—¶é—´ï¼ˆåŒºå—é«˜åº¦ï¼‰
    pub purchased_at: BlockNumber,

    /// æœ‰æ•ˆæœŸè‡³ï¼ˆåŒºå—é«˜åº¦ï¼‰
    pub valid_until: BlockNumber,

    /// åŸºç¡€ä»£æ•°ï¼ˆæ ¹æ®ç­‰çº§å›ºå®šï¼š6/9/12/15ï¼‰
    pub base_generations: u8,

    /// å¥–åŠ±ä»£æ•°ï¼ˆé€šè¿‡æ¨èè·å¾—ï¼šæ¯æ¨è1äºº+1ä»£ï¼‰
    pub bonus_generations: u8,

    /// æ€»ä»£æ•°ï¼ˆbase + bonusï¼Œæœ€å¤š15ä»£ï¼‰
    pub total_generations: u8,

    /// æ¨èäººè´¦æˆ·ï¼ˆå¯é€‰ï¼Œåˆ›å§‹ä¼šå‘˜/ç§å­ä¼šå‘˜æ— æ¨èäººï¼‰
    pub referrer: Option<AccountId>,

    /// å·²æ¨èä¼šå‘˜æ•°é‡
    pub referral_count: u32,
}
```

### 3. MembershipLevel æšä¸¾

```rust
pub enum MembershipLevel {
    /// å¹´è´¹ä¼šå‘˜ï¼š$50 USDTï¼ŒåŸºç¡€6ä»£ï¼Œæœ‰æ•ˆæœŸ1å¹´
    Year1,

    /// 3å¹´ä¼šå‘˜ï¼š$100 USDTï¼ŒåŸºç¡€9ä»£ï¼Œæœ‰æ•ˆæœŸ3å¹´
    Year3,

    /// 5å¹´ä¼šå‘˜ï¼š$200 USDTï¼ŒåŸºç¡€12ä»£ï¼Œæœ‰æ•ˆæœŸ5å¹´
    Year5,

    /// 10å¹´ä¼šå‘˜ï¼š$300 USDTï¼ŒåŸºç¡€15ä»£ï¼Œæœ‰æ•ˆæœŸ10å¹´
    Year10,
}
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```rust
impl MembershipLevel {
    // ğŸ†• è·å– USDT ä»·æ ¼ï¼ˆç²¾åº¦ 10^6ï¼‰
    pub fn price_in_usdt(&self) -> u64;

    // âš ï¸ å·²åºŸå¼ƒï¼šè·å– DUST ä»·æ ¼ï¼ˆä¿ç•™å…¼å®¹æ€§ï¼‰
    #[deprecated]
    pub fn price_in_units(&self) -> u128;

    // è·å–åŸºç¡€ä»£æ•°ï¼ˆ6/9/12/15ï¼‰
    pub fn base_generations(&self) -> u8;

    // è·å–æœ‰æ•ˆæœŸï¼ˆå¹´ï¼‰
    pub fn years(&self) -> u32;

    // è½¬æ¢ä¸º IDï¼ˆ0/1/2/3ï¼‰
    pub fn to_id(&self) -> u8;
}
```

---

## ä¸»è¦è°ƒç”¨æ–¹æ³•ï¼ˆAPIï¼‰

### 1. ç”¨æˆ·æ¥å£

#### 1.1 è´­ä¹°ä¼šå‘˜

```rust
#[pallet::call_index(0)]
pub fn purchase_membership(
    origin: OriginFor<T>,
    level_id: u8,           // 0=Year1, 1=Year3, 2=Year5, 3=Year10
    referral_code: Vec<u8>, // æ¨èç ï¼ˆå¿…å¡«ï¼‰
) -> DispatchResult;
```

**å‚æ•°è¯´æ˜**ï¼š
- `level_id`ï¼šä¼šå‘˜ç­‰çº§ï¼ˆ0=Year1, 1=Year3, 2=Year5, 3=Year10ï¼‰
- `referral_code`ï¼šæ¨èç ï¼ˆå¿…å¡«ï¼Œ6-20å­—ç¬¦ï¼‰

**æµç¨‹**ï¼š
1. éªŒè¯ä¸èƒ½é‡å¤è´­ä¹°
2. éªŒè¯æ¨èç åˆæ³•æ€§ï¼ˆé€šè¿‡ `pallet-affiliate` æŸ¥è¯¢ï¼‰
3. éªŒè¯æ¨èäººæ˜¯æœ‰æ•ˆä¼šå‘˜
4. è®¡ç®—ä»·æ ¼ï¼ˆåŸºäº USDT åŠ¨æ€è®¡ç®— DUST æ•°é‡ï¼‰
5. è½¬è´¦åˆ°è”ç›Ÿæ‰˜ç®¡è´¦æˆ·ï¼ˆ`pallet-affiliate`ï¼‰
6. ç»‘å®šæ¨èå…³ç³»ï¼ˆ`pallet-affiliate::bind_sponsor_internal`ï¼‰
7. åˆ›å»ºä¼šå‘˜ä¿¡æ¯
8. å¢åŠ æ¨èäººçš„å¥–åŠ±ä»£æ•°
9. è§¦å‘è”ç›Ÿè®¡é…¬åˆ†é…ï¼ˆ100%æ¨èé“¾ï¼‰
10. å‘å‡º `MembershipPurchased` äº‹ä»¶

**é”™è¯¯**ï¼š
- `AlreadyMember`ï¼šå·²ç»æ˜¯ä¼šå‘˜
- `InvalidReferralCode`ï¼šæ¨èç ä¸å­˜åœ¨æˆ–æ— æ•ˆ
- `ReferrerNotValid`ï¼šæ¨èäººä¸æ˜¯æœ‰æ•ˆä¼šå‘˜

#### 1.2 è¡¥å‡çº§åˆ°10å¹´ä¼šå‘˜

```rust
#[pallet::call_index(1)]
pub fn upgrade_to_year10(origin: OriginFor<T>) -> DispatchResult;
```

**é€‚ç”¨å¯¹è±¡**ï¼šYear1/Year3/Year5 ä¼šå‘˜

**æµç¨‹**ï¼š
1. è·å–å½“å‰ä¼šå‘˜ä¿¡æ¯
2. éªŒè¯ä¸æ˜¯å·²ç»æ˜¯10å¹´ä¼šå‘˜
3. è®¡ç®—å‡çº§è´¹ç”¨ï¼ˆåŸºäº USDT åŠ¨æ€è®¡ç®— DUSTï¼‰
4. æ‰£è´¹åˆ°å›½åº“è´¦æˆ·
5. æ›´æ–°ä¼šå‘˜ä¿¡æ¯ï¼ˆç­‰çº§ã€ä»£æ•°ã€æœ‰æ•ˆæœŸï¼‰
6. æ›´æ–°ç»Ÿè®¡æ•°æ®
7. å‘å‡º `MembershipUpgraded` äº‹ä»¶

**é”™è¯¯**ï¼š
- `NotMember`ï¼šä¸æ˜¯ä¼šå‘˜
- `AlreadyYear10`ï¼šå·²ç»æ˜¯10å¹´ä¼šå‘˜
- `CannotUpgrade`ï¼šæ— æ³•å‡çº§

---

### 2. æ²»ç†æ¥å£ï¼ˆRoot/å§”å‘˜ä¼šæƒé™ï¼‰

#### 2.1 è®¾ç½®ä¼šå‘˜æŠ˜æ‰£

```rust
#[pallet::call_index(2)]
pub fn set_member_discount(
    origin: OriginFor<T>,
    discount: u8, // æŠ˜æ‰£æ¯”ä¾‹ï¼ˆ0-100ï¼‰
) -> DispatchResult;
```

**æƒé™**ï¼šRoot

**ç¤ºä¾‹**ï¼š
```rust
// è®¾ç½®ä¼šå‘˜æŠ˜æ‰£ä¸º 30%ï¼ˆ3æŠ˜ï¼‰
membership.set_member_discount(root_origin, 30)?;
```

**é”™è¯¯**ï¼š
- `InvalidDiscount`ï¼šæŠ˜æ‰£æ¯”ä¾‹è¶…å‡ºèŒƒå›´ï¼ˆå¿…é¡»0-100ï¼‰

#### 2.2 è®¾ç½®å•ä¸ªä¼šå‘˜ä»·æ ¼

```rust
#[pallet::call_index(3)]
pub fn set_membership_price(
    origin: OriginFor<T>,
    level_id: u8,       // 0=Year1, 1=Year3, 2=Year5, 3=Year10
    price_units: u128,  // ä»·æ ¼ï¼ˆDUST å•ä½æ•°ï¼Œéæœ€å°å•ä½ï¼‰
) -> DispatchResult;
```

**æƒé™**ï¼šæ²»ç†èµ·æºï¼ˆRoot æˆ–å§”å‘˜ä¼š 2/3 å¤šæ•°ï¼‰

**ç¤ºä¾‹**ï¼š
```rust
// è®¾ç½® Year1 ä»·æ ¼ä¸º 400 DUST
membership.set_membership_price(gov_origin, 0, 400)?;
```

**çº¦æŸ**ï¼š
- ä»·æ ¼å¿…é¡»åœ¨ `MinMembershipPrice` å’Œ `MaxMembershipPrice` ä¹‹é—´

**é”™è¯¯**ï¼š
- `PriceOutOfRange`ï¼šä»·æ ¼è¶…å‡ºå…è®¸èŒƒå›´

#### 2.3 æ‰¹é‡è®¾ç½®ä¼šå‘˜ä»·æ ¼

```rust
#[pallet::call_index(4)]
pub fn set_all_membership_prices(
    origin: OriginFor<T>,
    year1_units: u128,
    year3_units: u128,
    year5_units: u128,
    year10_units: u128,
) -> DispatchResult;
```

**æƒé™**ï¼šæ²»ç†èµ·æºï¼ˆRoot æˆ–å§”å‘˜ä¼š 2/3 å¤šæ•°ï¼‰

**ç¤ºä¾‹**ï¼š
```rust
// æ‰¹é‡è®¾ç½®ï¼š400, 800, 1600, 2000 DUST
membership.set_all_membership_prices(gov_origin, 400, 800, 1600, 2000)?;
```

#### 2.4 æ·»åŠ ç§å­ä¼šå‘˜

```rust
#[pallet::call_index(5)]
pub fn add_seed_member(
    origin: OriginFor<T>,
    who: T::AccountId,
    level_id: u8,       // 0=Year1, 1=Year3, 2=Year5, 3=Year10
) -> DispatchResult;
```

**æƒé™**ï¼šRoot

**ç”¨é€”**ï¼šåˆ›å»ºåˆå§‹ç§å­ä¼šå‘˜ï¼ˆå¦‚ï¼šé¡¹ç›®æ–¹è´¦æˆ·ã€KOLè´¦æˆ·ï¼‰

**ç‰¹ç‚¹**ï¼š
- æ— éœ€æ¨èäºº
- æ— éœ€æ”¯ä»˜è´¹ç”¨
- ç”¨äºå¯åŠ¨æ¨èç½‘ç»œ

**ç¤ºä¾‹**ï¼š
```rust
// æ·»åŠ ç§å­ä¼šå‘˜ï¼ˆYear10ï¼‰
membership.add_seed_member(root_origin, alice_account, 3)?;
```

---

### 3. æŸ¥è¯¢æ¥å£

#### 3.1 æ£€æŸ¥ä¼šå‘˜æœ‰æ•ˆæ€§

```rust
pub fn is_member_valid(who: &T::AccountId) -> bool;
```

**ğŸ†• 2025-11-10 å˜æ›´**ï¼šæ–°å¢æŒå¸é—¨æ§›éªŒè¯

**éªŒè¯é€»è¾‘**ï¼š
1. ä¼šå‘˜å­˜åœ¨æ€§éªŒè¯
2. ä¼šå‘˜æ—¶æ•ˆæ€§éªŒè¯ï¼ˆæœªè¿‡æœŸï¼‰
3. **æŒå¸ä»·å€¼éªŒè¯**ï¼ˆâ‰¥ $100 USDï¼‰

**è¿”å›å€¼**ï¼š
- `true`ï¼šæœ‰æ•ˆä¼šå‘˜ï¼ˆå·²è´­ä¹°ã€æœªè¿‡æœŸã€æŒå¸ä»·å€¼â‰¥$100ï¼‰
- `false`ï¼šä¸æ˜¯ä¼šå‘˜ã€å·²è¿‡æœŸæˆ–æŒå¸ä»·å€¼ä¸è¶³

#### 3.2 è·å–ä¼šå‘˜å¯æ‹¿ä»£æ•°

```rust
pub fn get_member_generations(who: &T::AccountId) -> Option<u8>;
```

**è¿”å›å€¼**ï¼š
- `Some(ä»£æ•°)`ï¼šæœ‰æ•ˆä¼šå‘˜çš„æ€»ä»£æ•°ï¼ˆç”¨äºè”ç›Ÿè®¡é…¬åˆ†é…ï¼‰
- `None`ï¼šä¸æ˜¯ä¼šå‘˜æˆ–å·²è¿‡æœŸ

#### 3.3 è·å–ä¼šå‘˜æŠ˜æ‰£

```rust
pub fn get_discount() -> u8;
```

**è¿”å›å€¼**ï¼šæŠ˜æ‰£æ¯”ä¾‹ï¼ˆ0-100ï¼Œä¾‹å¦‚20è¡¨ç¤º20%ï¼‰

#### 3.4 è·å–ä¼šå‘˜ä»·æ ¼

```rust
pub fn get_membership_price(level: MembershipLevel) -> BalanceOf<T>;
```

**è¿”å›å€¼**ï¼šä»·æ ¼ï¼ˆæœ€å°å•ä½ï¼‰

**å®šä»·ç­–ç•¥ï¼ˆä¸‰çº§å›é€€ï¼‰**ï¼š
1. **åŠ¨æ€ USDT å®šä»·**ï¼šåŸºäº `pallet-pricing` å®æ—¶å¸‚åœºä»·æ ¼è®¡ç®—ï¼ˆä¼˜å…ˆï¼‰
2. **å­˜å‚¨ä»·æ ¼**ï¼šæ²»ç†è®¾ç½®çš„å›ºå®šä»·æ ¼
3. **é»˜è®¤ä»·æ ¼**ï¼šç¡¬ç¼–ç çš„å›é€€ä»·æ ¼

#### 3.5 è·å–æŒå¸ä»·å€¼ï¼ˆğŸ†• 2025-11-10ï¼‰

```rust
pub fn get_holding_value_usd(who: &T::AccountId) -> (u64, u32);
```

**è¿”å›å€¼**ï¼š`(dollars, cents)`ï¼Œä¾‹å¦‚ `(123, 45)` è¡¨ç¤º $123.45

**ç”¨é€”**ï¼š
- å‰ç«¯æ˜¾ç¤ºç”¨æˆ·æŒå¸ä»·å€¼
- ç›‘æ§æŒå¸é—¨æ§›çŠ¶æ€
- ç”¨æˆ·å®æ—¶æŸ¥çœ‹æ˜¯å¦æ»¡è¶³100ç¾å…ƒé—¨æ§›

---

## äº‹ä»¶å®šä¹‰

| äº‹ä»¶å | å‚æ•° | æè¿° |
|-------|-----|-----|
| `MembershipPurchased` | `who`, `level_id`, `valid_until`, `referrer` | è´­ä¹°ä¼šå‘˜æˆåŠŸ |
| `MembershipUpgraded` | `who`, `from_id`, `to_id`, `new_valid_until` | ä¼šå‘˜å‡çº§æˆåŠŸ |
| `GenerationIncreased` | `who`, `bonus`, `total` | æ¨èä»£æ•°å¢åŠ  |
| `DiscountUpdated` | `discount` | ä¼šå‘˜æŠ˜æ‰£æ›´æ–° |
| `MembershipPriceUpdated` | `level_id`, `price` | ä¼šå‘˜ä»·æ ¼æ›´æ–° |
| `BatchPricesUpdated` | `count` | æ‰¹é‡ä»·æ ¼æ›´æ–° |
| `SeedMemberAdded` | `who`, `level_id` | ç§å­ä¼šå‘˜å·²æ·»åŠ  |
| ğŸ†• `DynamicPriceCalculated` | `level_id`, `usdt_price`, `dust_market_price`, `dust_amount` | åŠ¨æ€ä»·æ ¼è®¡ç®—å®Œæˆ |
| ğŸ†• `PriceCalculationFallback` | `level_id`, `fallback_price` | ä»·æ ¼è®¡ç®—å¤±è´¥ï¼Œä½¿ç”¨å›é€€ä»·æ ¼ |

---

## é”™è¯¯å®šä¹‰

| é”™è¯¯ | æè¿° |
|-----|-----|
| `AlreadyMember` | å·²ç»æ˜¯ä¼šå‘˜ï¼ˆä¸å…è®¸é‡å¤è´­ä¹°ï¼‰ |
| `NotMember` | ä¸æ˜¯ä¼šå‘˜ |
| `InvalidReferralCode` | æ— æ•ˆçš„æ¨èç  |
| `ReferralCodeTooLong` | æ¨èç å¤ªé•¿ |
| `ReferrerNotValid` | æ¨èäººæ— æ•ˆï¼ˆä¸æ˜¯ä¼šå‘˜æˆ–å·²è¿‡æœŸï¼‰ |
| `AlreadyYear10` | å·²ç»æ˜¯10å¹´ä¼šå‘˜ï¼Œæ— æ³•å‡çº§ |
| `CannotUpgrade` | æ— æ³•å‡çº§ |
| `MembershipExpired` | ä¼šå‘˜å·²è¿‡æœŸ |
| `InvalidDiscount` | æŠ˜æ‰£æ¯”ä¾‹æ— æ•ˆï¼ˆå¿…é¡»0-100ï¼‰ |
| `ReferralCodeExists` | æ¨èç å·²å­˜åœ¨ |
| `PriceOutOfRange` | ä»·æ ¼è¶…å‡ºå…è®¸èŒƒå›´ï¼ˆè¿‡ä½æˆ–è¿‡é«˜ï¼‰ |
| `PriceNotSet` | ä»·æ ¼æœªè®¾ç½®ï¼ˆæ²»ç†éœ€è¦åˆå§‹åŒ–ï¼‰ |
| ğŸ†• `MarketPriceNotAvailable` | å¸‚åœºä»·æ ¼ä¸å¯ç”¨ï¼ˆpallet-pricing æœªåˆå§‹åŒ–æˆ–ä¸º0ï¼‰ |
| ğŸ†• `PriceCalculationFailed` | ä»·æ ¼è®¡ç®—å¤±è´¥ï¼ˆæº¢å‡ºæˆ–è®¡ç®—é”™è¯¯ï¼‰ |

---

## é…ç½®å‚æ•°

### Runtime é…ç½®

```rust
impl pallet_membership::Config for Runtime {
    /// è´§å¸ç³»ç»Ÿï¼ˆMEMOä»£å¸ï¼‰
    type Currency = Balances;

    /// Pallet IDï¼Œç”¨äºæ´¾ç”Ÿå›½åº“è´¦æˆ·
    type PalletId = MembershipPalletId;

    /// æ¯å¹´çš„åŒºå—æ•°ï¼ˆç”¨äºè®¡ç®—æœ‰æ•ˆæœŸï¼‰
    /// å‡è®¾6ç§’ä¸€ä¸ªå—ï¼š365 * 24 * 60 * 60 / 6 â‰ˆ 5,256,000
    type BlocksPerYear = ConstU32<5_256_000>;

    /// DUST ä»£å¸å•ä½ï¼ˆ1 DUST = 10^12ï¼‰
    type Units = ConstU128<1_000_000_000_000>;

    /// è”ç›Ÿè®¡é…¬ç³»ç»Ÿå…³è”ç±»å‹
    type AffiliateConfig = Runtime;

    /// æ²»ç†èµ·æºï¼ˆRoot æˆ–å§”å‘˜ä¼š 2/3 å¤šæ•°ï¼‰
    type GovernanceOrigin = EnsureRootOrTwoThirdsCouncil;

    /// æœ€ä½ä¼šå‘˜ä»·æ ¼ï¼ˆé˜²æ­¢è®¾ç½®ä¸º0æˆ–è¿‡ä½ï¼‰
    type MinMembershipPrice = ConstU128<100_000_000_000_000>; // 100 DUST

    /// æœ€é«˜ä¼šå‘˜ä»·æ ¼ï¼ˆé˜²æ­¢æ¶æ„è®¾ç½®è¿‡é«˜ï¼‰
    type MaxMembershipPrice = ConstU128<10_000_000_000_000_000>; // 10,000 DUST

    /// è”ç›Ÿè®¡é…¬ PalletId
    type AffiliatePalletId = AffiliatePalletId;

    /// ğŸ†• 2025-11-10ï¼šä»·æ ¼æŸ¥è¯¢ç³»ç»Ÿï¼ˆæŒ‡å‘ Runtimeï¼‰
    type PricingConfig = Runtime;

    /// ğŸ†• 2025-11-10ï¼šæœ€ä½æŒå¸ä»·å€¼ï¼ˆç¾åˆ†ï¼Œé»˜è®¤10000=100ç¾å…ƒï¼‰
    type MinHoldingValueCents = ConstU64<10_000>; // $100 USD

    /// æƒé‡ä¿¡æ¯
    type WeightInfo = pallet_membership::weights::SubstrateWeight<Runtime>;
}
```

---

## ä½¿ç”¨ç¤ºä¾‹

### 1. è´­ä¹°ä¼šå‘˜

#### ç¤ºä¾‹1ï¼šè´­ä¹° Year1 ä¼šå‘˜

```rust
use frame_support::assert_ok;

// Alice ä½¿ç”¨ Bob çš„æ¨èç è´­ä¹° Year1 ä¼šå‘˜
let referral_code = b"BOB_CODE".to_vec();

assert_ok!(Membership::purchase_membership(
    RuntimeOrigin::signed(alice_account),
    0, // level_id: Year1
    referral_code,
));

// éªŒè¯ä¼šå‘˜ä¿¡æ¯
let membership = Membership::memberships(&alice_account).unwrap();
assert_eq!(membership.level, MembershipLevel::Year1);
assert_eq!(membership.base_generations, 6);
assert_eq!(membership.total_generations, 6);

// éªŒè¯æ¨èäººçš„ä»£æ•°å¢é•¿
let bob_membership = Membership::memberships(&bob_account).unwrap();
assert_eq!(bob_membership.bonus_generations, 1); // +1ä»£
assert_eq!(bob_membership.referral_count, 1); // æ¨è1äºº
```

#### ç¤ºä¾‹2ï¼šè´­ä¹° Year10 ä¼šå‘˜ï¼ˆç»ˆèº«çº§ï¼‰

```rust
assert_ok!(Membership::purchase_membership(
    RuntimeOrigin::signed(charlie_account),
    3, // level_id: Year10
    referral_code,
));

// éªŒè¯ä¼šå‘˜ä¿¡æ¯
let membership = Membership::memberships(&charlie_account).unwrap();
assert_eq!(membership.level, MembershipLevel::Year10);
assert_eq!(membership.base_generations, 15); // æ»¡çº§
assert_eq!(membership.total_generations, 15); // æ»¡çº§ï¼Œä¸å†å¢é•¿
```

---

### 2. è¡¥å‡çº§åˆ°10å¹´ä¼šå‘˜

```rust
// Aliceï¼ˆYear1ä¼šå‘˜ï¼‰è¡¥å‡çº§åˆ° Year10
assert_ok!(Membership::upgrade_to_year10(
    RuntimeOrigin::signed(alice_account),
));

// éªŒè¯å‡çº§ç»“æœ
let membership = Membership::memberships(&alice_account).unwrap();
assert_eq!(membership.level, MembershipLevel::Year10);
assert_eq!(membership.base_generations, 15); // å‡çº§åæ»¡çº§
assert_eq!(membership.total_generations, 15); // å‡çº§åæ»¡çº§
```

---

### 3. è®¾ç½®ä¼šå‘˜ä»·æ ¼ï¼ˆæ²»ç†ï¼‰

#### ç¤ºä¾‹1ï¼šå•ä¸ªä»·æ ¼è®¾ç½®

```rust
// æ²»ç†è®¾ç½® Year1 ä»·æ ¼ä¸º 500 DUST
assert_ok!(Membership::set_membership_price(
    RuntimeOrigin::root(),
    0, // level_id: Year1
    500, // 500 DUST
));

// éªŒè¯ä»·æ ¼
let price = Membership::membership_price(MembershipLevel::Year1).unwrap();
assert_eq!(price, 500 * UNITS); // 500 DUSTï¼ˆæœ€å°å•ä½ï¼‰
```

#### ç¤ºä¾‹2ï¼šæ‰¹é‡ä»·æ ¼è®¾ç½®

```rust
// æ²»ç†æ‰¹é‡è®¾ç½®ï¼š400, 800, 1600, 2000 DUST
assert_ok!(Membership::set_all_membership_prices(
    RuntimeOrigin::root(),
    400,  // Year1
    800,  // Year3
    1600, // Year5
    2000, // Year10
));
```

---

### 4. æ·»åŠ ç§å­ä¼šå‘˜ï¼ˆRootï¼‰

```rust
// Root æ·»åŠ  Alice ä¸ºç§å­ä¼šå‘˜ï¼ˆYear10ï¼‰
assert_ok!(Membership::add_seed_member(
    RuntimeOrigin::root(),
    alice_account,
    3, // level_id: Year10
));

// éªŒè¯ç§å­ä¼šå‘˜
let membership = Membership::memberships(&alice_account).unwrap();
assert_eq!(membership.level, MembershipLevel::Year10);
assert!(membership.referrer.is_none()); // æ— æ¨èäºº
```

---

### 5. æŸ¥è¯¢ä¼šå‘˜ä¿¡æ¯

#### ç¤ºä¾‹1ï¼šæ£€æŸ¥ä¼šå‘˜æœ‰æ•ˆæ€§

```rust
// æ£€æŸ¥ Alice æ˜¯å¦æ˜¯æœ‰æ•ˆä¼šå‘˜
let is_valid = Membership::is_member_valid(&alice_account);
assert!(is_valid);

// æ£€æŸ¥æŒå¸ä»·å€¼æ˜¯å¦æ»¡è¶³é—¨æ§›
let (dollars, cents) = Membership::get_holding_value_usd(&alice_account);
println!("æŒå¸ä»·å€¼ï¼š${}.{:02}", dollars, cents);
// ç¤ºä¾‹è¾“å‡ºï¼šæŒå¸ä»·å€¼ï¼š$123.45
```

#### ç¤ºä¾‹2ï¼šè·å–ä¼šå‘˜å¯æ‹¿ä»£æ•°

```rust
// è·å– Alice çš„å¯æ‹¿ä»£æ•°
let generations = Membership::get_member_generations(&alice_account);
assert_eq!(generations, Some(6)); // Year1 åˆå§‹6ä»£
```

#### ç¤ºä¾‹3ï¼šè·å–ä¼šå‘˜æŠ˜æ‰£

```rust
// è·å–ä¼šå‘˜æŠ˜æ‰£æ¯”ä¾‹
let discount = Membership::get_discount();
assert_eq!(discount, 20); // é»˜è®¤20%ï¼ˆ2æŠ˜ï¼‰
```

#### ç¤ºä¾‹4ï¼šè·å–ä¼šå‘˜ä»·æ ¼

```rust
// è·å– Year1 ä»·æ ¼ï¼ˆåŠ¨æ€è®¡ç®—ï¼‰
let price = Membership::get_membership_price(MembershipLevel::Year1);
println!("Year1 ä»·æ ¼ï¼š{} DUST", price / UNITS);
// ç¤ºä¾‹è¾“å‡ºï¼šYear1 ä»·æ ¼ï¼š500000 DUSTï¼ˆå‡è®¾ DUST = 0.0001 USDTï¼‰
```

---

### 6. å‰ç«¯é›†æˆç¤ºä¾‹

#### ç¤ºä¾‹1ï¼šæ˜¾ç¤ºä¼šå‘˜ä¿¡æ¯

```typescript
import { api } from '@/lib/providers';

// æŸ¥è¯¢ä¼šå‘˜ä¿¡æ¯
const membership = await api.query.membership.memberships(alice_address);

if (membership.isSome) {
    const info = membership.unwrap();
    console.log('ä¼šå‘˜ç­‰çº§ï¼š', info.level.toString());
    console.log('æœ‰æ•ˆæœŸè‡³ï¼š', info.validUntil.toString());
    console.log('æ€»ä»£æ•°ï¼š', info.totalGenerations.toString());
    console.log('æ¨èäººæ•°ï¼š', info.referralCount.toString());
}
```

#### ç¤ºä¾‹2ï¼šè´­ä¹°ä¼šå‘˜ï¼ˆå‰ç«¯ï¼‰

```typescript
// è´­ä¹° Year1 ä¼šå‘˜
const tx = api.tx.membership.purchaseMembership(
    0, // level_id: Year1
    'BOB_CODE', // æ¨èç 
);

await tx.signAndSend(alice_account, ({ status, events }) => {
    if (status.isInBlock) {
        console.log('äº¤æ˜“å·²æ‰“åŒ…åˆ°åŒºå—');

        // ç›‘å¬ MembershipPurchased äº‹ä»¶
        events.forEach(({ event }) => {
            if (api.events.membership.MembershipPurchased.is(event)) {
                const [who, level_id, valid_until, referrer] = event.data;
                console.log(`${who} è´­ä¹°äº† ${level_id} çº§ä¼šå‘˜`);
            }
        });
    }
});
```

#### ç¤ºä¾‹3ï¼šæ˜¾ç¤ºæŒå¸ä»·å€¼ï¼ˆğŸ†• 2025-11-10ï¼‰

```typescript
// æŸ¥è¯¢æŒå¸ä»·å€¼
const [dollars, cents] = await api.query.membership.getHoldingValueUsd(alice_address);
const holdingValue = `$${dollars}.${cents.toString().padStart(2, '0')}`;

// UI æç¤º
if (dollars < 100) {
    return (
        <Alert type="warning">
            å½“å‰æŒå¸ä»·å€¼ï¼š{holdingValue}
            <br />
            è·ç¦»é—¨æ§›è¿˜éœ€ï¼š${(100 - dollars).toFixed(2)}
            <Button onClick={handleDeposit}>ç«‹å³å……å€¼</Button>
        </Alert>
    );
}
```

---

## é›†æˆè¯´æ˜

### 1. ä¸ pallet-affiliate é›†æˆ

#### 1.1 æ¨èå…³ç³»ç®¡ç†

```rust
// è´­ä¹°ä¼šå‘˜æ—¶ç»‘å®šæ¨èå…³ç³»
pallet_affiliate::Pallet::<T::AffiliateConfig>::bind_sponsor_internal(&who, &referrer);
```

#### 1.2 æ¨èç æŸ¥è¯¢

```rust
// éªŒè¯æ¨èç 
let referrer_account = pallet_affiliate::Pallet::<T::AffiliateConfig>::find_account_by_code(&code_bounded)
    .ok_or(Error::<T>::InvalidReferralCode)?;
```

#### 1.3 è”ç›Ÿè®¡é…¬åˆ†é…

```rust
// è´­ä¹°ä¼šå‘˜æ—¶è§¦å‘100%æ¨èé“¾åˆ†æˆ
// TODO: pallet-affiliate éœ€è¦å®ç° distribute_membership_rewards å…¬å¼€æ–¹æ³•
// pallet_affiliate::Pallet::<T>::do_distribute_membership_rewards(&who, price.into())?;
```

---

### 2. ä¸ pallet-pricing é›†æˆï¼ˆğŸ†• 2025-11-10ï¼‰

#### 2.1 åŠ¨æ€ä»·æ ¼è®¡ç®—

```rust
// è·å– DUST å¸‚åœºä»·æ ¼ï¼ˆUSDT/DUSTï¼Œç²¾åº¦ 10^6ï¼‰
let dust_market_price = pallet_pricing::Pallet::<T::PricingConfig>::get_dust_market_price_weighted();

// è®¡ç®—æ‰€éœ€ DUST æ•°é‡
let usdt_price = level.price_in_usdt();
let dust_amount = (usdt_price as u128)
    .saturating_mul(units)
    .checked_div(dust_market_price as u128)
    .ok_or(Error::<T>::PriceCalculationFailed)?;
```

#### 2.2 æŒå¸ä»·å€¼è®¡ç®—

```rust
// è·å–è´¦æˆ·ä½™é¢
let balance = T::Currency::free_balance(who);

// è·å– DUST å¸‚åœºä»·æ ¼
let dust_price_usdt = pallet_pricing::Pallet::<T::PricingConfig>::get_dust_market_price_weighted();

// è®¡ç®—æŒå¸ä»·å€¼ï¼ˆç¾åˆ†ï¼‰
let holding_value_cents = balance
    .saturating_mul(dust_price_usdt)
    .saturating_mul(100)
    .checked_div(10^18)
    .unwrap_or(0);
```

---

### 3. ä¸ pallet-memorial é›†æˆ

#### 3.1 ä¼šå‘˜æŠ˜æ‰£éªŒè¯

```rust
// åœ¨ä¾›å¥‰ç³»ç»Ÿä¸­åº”ç”¨ä¼šå‘˜æŠ˜æ‰£
let is_member = pallet_membership::Pallet::<T>::is_member_valid(&who);

if is_member {
    let discount = pallet_membership::Pallet::<T>::get_discount();
    let discounted_price = original_price
        .saturating_mul(discount as u128)
        .saturating_div(100);
    // ä½¿ç”¨æŠ˜åä»·
} else {
    // ä½¿ç”¨åŸä»·
}
```

---

### 4. ä¸ pallet-otc-order é›†æˆ

#### 4.1 OTCäº¤æ˜“è´¹ç”¨æŠ˜æ‰£

```rust
// åœ¨OTCäº¤æ˜“ä¸­åº”ç”¨ä¼šå‘˜æŠ˜æ‰£
let is_member = pallet_membership::Pallet::<T>::is_member_valid(&who);

if is_member {
    // ä¼šå‘˜äº«å—äº¤æ˜“è´¹ç”¨æŠ˜æ‰£
    let discount = pallet_membership::Pallet::<T>::get_discount();
    let discounted_fee = original_fee
        .saturating_mul(discount as u128)
        .saturating_div(100);
}
```

---

## æœ€ä½³å®è·µ

### 1. ä¼šå‘˜è´­ä¹°å»ºè®®

**å…¥é—¨ç”¨æˆ·**ï¼š
- æ¨èè´­ä¹° Year1ï¼ˆ$50 USDTï¼‰
- ä½æˆæœ¬ä½“éªŒä¼šå‘˜æƒç›Š
- è§‚å¯Ÿæ¨èæ”¶ç›Šæƒ…å†µ

**é•¿æœŸç”¨æˆ·**ï¼š
- æ¨èè´­ä¹° Year3ï¼ˆ$100 USDTï¼‰
- æ€§ä»·æ¯”æœ€é«˜
- æœ‰æ•ˆæœŸ3å¹´ï¼Œæ— éœ€é¢‘ç¹ç»­è´¹

**æ¨å¹¿è€…**ï¼š
- æ¨èè´­ä¹° Year5 æˆ– Year10
- åˆå§‹ä»£æ•°é«˜ï¼Œæ¨èæ”¶ç›Šæ›´å¤š
- Year10 åˆå§‹å³æ»¡çº§ï¼ˆ15ä»£ï¼‰

**é¡¹ç›®æ–¹/KOL**ï¼š
- æ¨èè´­ä¹° Year10ï¼ˆ$300 USDTï¼‰
- ç»ˆèº«çº§ä¼šå‘˜ï¼Œæœ‰æ•ˆæœŸ10å¹´
- æ»¡çº§15ä»£ï¼Œæ¨èæ”¶ç›Šæœ€å¤§åŒ–

---

### 2. ä»£æ•°å¢é•¿ç­–ç•¥

**Year1 ä¼šå‘˜ï¼ˆåŸºç¡€6ä»£ï¼‰**ï¼š
- ç›®æ ‡ï¼šæ¨è9äººè¾¾åˆ°15ä»£
- ç­–ç•¥ï¼šç§¯ææ¨å¹¿ï¼Œå¿«é€Ÿå¢é•¿ä»£æ•°
- å»ºè®®ï¼šè¾¾åˆ°15ä»£åè€ƒè™‘å‡çº§åˆ° Year10

**Year3 ä¼šå‘˜ï¼ˆåŸºç¡€9ä»£ï¼‰**ï¼š
- ç›®æ ‡ï¼šæ¨è6äººè¾¾åˆ°15ä»£
- ç­–ç•¥ï¼šç¨³å®šæ¨å¹¿ï¼Œä¸­æœŸå¢é•¿
- å»ºè®®ï¼šè¾¾åˆ°15ä»£åä¿æŒæ´»è·ƒåº¦

**Year5 ä¼šå‘˜ï¼ˆåŸºç¡€12ä»£ï¼‰**ï¼š
- ç›®æ ‡ï¼šæ¨è3äººè¾¾åˆ°15ä»£
- ç­–ç•¥ï¼šç²¾å‡†æ¨å¹¿ï¼Œå¿«é€Ÿæ»¡çº§
- å»ºè®®ï¼šè¾¾åˆ°15ä»£åäº«å—æœ€å¤§æ”¶ç›Š

**Year10 ä¼šå‘˜ï¼ˆåŸºç¡€15ä»£ï¼‰**ï¼š
- ç›®æ ‡ï¼šæ— éœ€å¢é•¿ï¼Œåˆå§‹å³æ»¡çº§
- ç­–ç•¥ï¼šä¸“æ³¨æ¨å¹¿ï¼Œäº«å—æ»¡çº§æ”¶ç›Š
- å»ºè®®ï¼šæŒç»­æ¨å¹¿ï¼Œæœ€å¤§åŒ–æ”¶ç›Š

---

### 3. å‡çº§æ—¶æœºé€‰æ‹©

**ä½•æ—¶å‡çº§åˆ° Year10ï¼Ÿ**

| å½“å‰ç­‰çº§ | æ¨èå‡çº§æ—¶æœº |
|---------|------------|
| Year1 | æ¨èäººæ•°â‰¥9äººï¼ˆå·²è¾¾15ä»£ï¼‰ï¼Œæˆ–éœ€è¦é•¿æœŸæœ‰æ•ˆæœŸ |
| Year3 | æ¨èäººæ•°â‰¥6äººï¼ˆå·²è¾¾15ä»£ï¼‰ï¼Œæˆ–éœ€è¦é•¿æœŸæœ‰æ•ˆæœŸ |
| Year5 | æ¨èäººæ•°â‰¥3äººï¼ˆå·²è¾¾15ä»£ï¼‰ï¼Œæˆ–éœ€è¦é•¿æœŸæœ‰æ•ˆæœŸ |

**å‡çº§ä¼˜åŠ¿**ï¼š
- æœ‰æ•ˆæœŸä»å½“å‰æ—¶é—´é‡æ–°è®¡ç®—10å¹´
- ä»£æ•°ç«‹å³æå‡è‡³15ä»£ï¼ˆæ— éœ€æ¨èå¢é•¿ï¼‰
- äº«å—ç»ˆèº«çº§ä¼šå‘˜æƒç›Š

---

### 4. æŒå¸é—¨æ§›ç®¡ç†ï¼ˆğŸ†• 2025-11-10ï¼‰

**å¦‚ä½•ä¿æŒæœ‰æ•ˆä¼šå‘˜ï¼Ÿ**

1. **å®æ—¶ç›‘æ§**ï¼šå®šæœŸæŸ¥è¯¢æŒå¸ä»·å€¼ `get_holding_value_usd`
2. **ä½™é¢é¢„è­¦**ï¼šæŒå¸ä»·å€¼ä½äº $100 æ—¶åŠæ—¶å……å€¼
3. **ä»·æ ¼æ³¢åŠ¨**ï¼šDUST ä»·æ ¼ä¸‹è·Œæ—¶ï¼Œéœ€è¦æŒæœ‰æ›´å¤š DUST
4. **è‡ªåŠ¨å……å€¼**ï¼šè®¾ç½®è‡ªåŠ¨å……å€¼æœºåˆ¶ï¼Œä¿æŒä½™é¢

**ç¤ºä¾‹**ï¼š
```rust
// æŸ¥è¯¢æŒå¸ä»·å€¼
let (dollars, cents) = Membership::get_holding_value_usd(&alice);

// é¢„è­¦é€»è¾‘
if dollars < 100 {
    // å‘é€é€šçŸ¥ï¼Œæé†’ç”¨æˆ·å……å€¼
    send_notification(&alice, "æŒå¸ä»·å€¼ä¸è¶³ï¼Œè¯·åŠæ—¶å……å€¼");
}
```

---

### 5. å‰ç«¯é›†æˆæœ€ä½³å®è·µ

#### 5.1 ä¼šå‘˜ä¿¡æ¯å±•ç¤º

```typescript
// æ˜¾ç¤ºä¼šå‘˜ç­‰çº§å¾½ç« 
const levelBadge = {
    0: { name: 'Year1', color: 'blue' },
    1: { name: 'Year3', color: 'green' },
    2: { name: 'Year5', color: 'orange' },
    3: { name: 'Year10', color: 'gold' },
};

<Badge color={levelBadge[membership.level].color}>
    {levelBadge[membership.level].name}
</Badge>
```

#### 5.2 æœ‰æ•ˆæœŸå€’è®¡æ—¶

```typescript
// è®¡ç®—å‰©ä½™å¤©æ•°
const currentBlock = await api.query.system.number();
const remainingBlocks = membership.validUntil - currentBlock;
const remainingDays = Math.floor(remainingBlocks * 6 / 86400); // 6ç§’/å—

<Text>å‰©ä½™æœ‰æ•ˆæœŸï¼š{remainingDays} å¤©</Text>
```

#### 5.3 æ¨èä»£æ•°å¯è§†åŒ–

```typescript
// æ˜¾ç¤ºä»£æ•°è¿›åº¦æ¡
const progress = (membership.totalGenerations / 15) * 100;

<Progress
    percent={progress}
    format={() => `${membership.totalGenerations}/15 ä»£`}
/>
```

#### 5.4 æŒå¸ä»·å€¼ç›‘æ§

```typescript
// å®æ—¶æ˜¾ç¤ºæŒå¸ä»·å€¼
const [dollars, cents] = await api.query.membership.getHoldingValueUsd(alice);
const holdingValue = `$${dollars}.${cents.toString().padStart(2, '0')}`;
const isValid = dollars >= 100;

<Card>
    <Statistic
        title="æŒå¸ä»·å€¼"
        value={holdingValue}
        valueStyle={{ color: isValid ? '#3f8600' : '#cf1322' }}
        prefix={isValid ? <CheckCircleOutlined /> : <CloseCircleOutlined />}
    />
</Card>
```

---

## æœªæ¥æ‰©å±•

### 1. ä¼šå‘˜ç»­è´¹æœºåˆ¶

- **è‡ªåŠ¨ç»­è´¹**ï¼šåˆ°æœŸå‰è‡ªåŠ¨æé†’ç»­è´¹
- **ç»­è´¹æŠ˜æ‰£**ï¼šè€ä¼šå‘˜ç»­è´¹äº«å—ç‰¹æ®ŠæŠ˜æ‰£
- **æ‰¹é‡ç»­è´¹**ï¼šæ”¯æŒå¤šå¹´ç»­è´¹ä¼˜æƒ 

### 2. ä¼šå‘˜ç‰¹æƒæ‰©å±•

- **VIPä¸“å±ç¥­ç¥€å“**ï¼šä¼šå‘˜ä¸“å±ä¾›å¥‰å“
- **ä¼˜å…ˆå®¢æœ**ï¼šä¼šå‘˜äº«å—ä¼˜å…ˆå®¢æœæœåŠ¡
- **ä¸“å±æ´»åŠ¨**ï¼šä¼šå‘˜ä¸“å±çº¿ä¸Š/çº¿ä¸‹æ´»åŠ¨

### 3. ä¼šå‘˜ç­‰çº§å‡çº§è·¯å¾„ä¼˜åŒ–

- **æ¸è¿›å¼å‡çº§**ï¼šæ”¯æŒ Year1â†’Year3â†’Year5â†’Year10 çš„æ¸è¿›å¼å‡çº§
- **å‡çº§æŠ˜æ‰£**ï¼šå¤šæ¬¡å‡çº§äº«å—æŠ˜æ‰£ä¼˜æƒ 
- **çµæ´»å‡çº§**ï¼šæ”¯æŒå»¶é•¿æœ‰æ•ˆæœŸè€Œä¸æ”¹å˜ç­‰çº§

### 4. ä¼šå‘˜NFTå¾½ç« 

- **é“¸é€ å¾½ç« **ï¼šé“¸é€ ä¼šå‘˜ç­‰çº§NFTå¾½ç« 
- **å±•ç¤ºç³»ç»Ÿ**ï¼šåœ¨ä¸ªäººä¸»é¡µå±•ç¤ºNFTå¾½ç« 
- **äº¤æ˜“å¸‚åœº**ï¼šæ”¯æŒNFTå¾½ç« äº¤æ˜“

### 5. æ¨èæ’è¡Œæ¦œ

- **æ¨èç»Ÿè®¡**ï¼šç»Ÿè®¡æ¨èäººæ•°æ’è¡Œ
- **æ¿€åŠ±æœºåˆ¶**ï¼šTopæ¨å¹¿è€…é¢å¤–å¥–åŠ±
- **ç¤¾åŒºå±•ç¤º**ï¼šæ’è¡Œæ¦œå…¬å¼€å±•ç¤º

### 6. ä¼šå‘˜ç§¯åˆ†ç³»ç»Ÿ

- **ç§¯åˆ†ç´¯ç§¯**ï¼šæ ¹æ®ä¼šå‘˜æ´»è·ƒåº¦ç´¯ç§¯ç§¯åˆ†
- **æƒç›Šå…‘æ¢**ï¼šç§¯åˆ†å…‘æ¢ä¼šå‘˜æƒç›Š
- **ç­‰çº§åŠ æˆ**ï¼šé«˜ç­‰çº§ä¼šå‘˜ç§¯åˆ†åŠ æˆ

---

## æŠ€æœ¯ç»†èŠ‚

### 1. åŒºå—é«˜åº¦è®¡ç®—

```rust
// å‡è®¾6ç§’ä¸€ä¸ªå—
// 1å¹´ = 365 * 24 * 60 * 60 / 6 â‰ˆ 5,256,000 å—

// è®¡ç®—æœ‰æ•ˆæœŸ
let blocks_per_year = T::BlocksPerYear::get(); // 5,256,000
let valid_until = current_block.saturating_add(blocks_per_year.saturating_mul(level.years().into()));
```

### 2. è´§å¸è½¬è´¦

```rust
// è½¬è´¦åˆ°è”ç›Ÿæ‰˜ç®¡è´¦æˆ·
T::Currency::transfer(
    &who,
    &affiliate_account,
    price,
    ExistenceRequirement::KeepAlive,
)?;
```

### 3. ä»£æ•°å¢é•¿ç®—æ³•

```rust
// æ€»ä»£æ•° = min(åŸºç¡€ä»£æ•° + å¥–åŠ±ä»£æ•°, 15)
membership.total_generations = 15u8.min(
    membership.base_generations.saturating_add(membership.bonus_generations)
);
```

### 4. USDT åŠ¨æ€å®šä»·ç®—æ³•

```rust
// éœ€è¦DUST = (USDTä»·æ ¼ Ã— UNITS) / DUSTå¸‚åœºä»·æ ¼
let usdt_price = level.price_in_usdt(); // ç²¾åº¦ 10^6
let dust_market_price = pallet_pricing::get_dust_market_price_weighted(); // ç²¾åº¦ 10^6
let units: u128 = T::Units::get().saturated_into(); // 10^12

let dust_amount_u128 = (usdt_price as u128)
    .saturating_mul(units)
    .checked_div(dust_market_price as u128)
    .ok_or(Error::<T>::PriceCalculationFailed)?;
```

### 5. æŒå¸ä»·å€¼è®¡ç®—ç®—æ³•

```rust
// æŒå¸ä»·å€¼(ç¾åˆ†) = (ä½™é¢ Ã— DUSTä»·æ ¼ Ã— 100) / 10^18
let balance_u128: u128 = balance.saturated_into(); // ç²¾åº¦ 10^12
let dust_price_usdt = pallet_pricing::get_dust_market_price_weighted(); // ç²¾åº¦ 10^6

let holding_value_cents = balance_u128
    .saturating_mul(dust_price_usdt as u128)
    .saturating_mul(100) // è½¬æ¢ä¸ºç¾åˆ†
    .checked_div(1_000_000_000_000_000_000) // é™¤ä»¥ 10^18
    .unwrap_or(0);
```

---

## æ•…éšœæ’æŸ¥

### 1. è´­ä¹°ä¼šå‘˜å¤±è´¥

**é—®é¢˜**ï¼šè°ƒç”¨ `purchase_membership` å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- æ¨èç æ— æ•ˆï¼ˆ`InvalidReferralCode`ï¼‰
- æ¨èäººä¸æ˜¯æœ‰æ•ˆä¼šå‘˜ï¼ˆ`ReferrerNotValid`ï¼‰
- å·²ç»æ˜¯ä¼šå‘˜ï¼ˆ`AlreadyMember`ï¼‰
- ä½™é¢ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ¨èç æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æ¨èäººæ˜¯æœ‰æ•ˆä¼šå‘˜ï¼ˆæœªè¿‡æœŸã€æŒå¸ä»·å€¼â‰¥$100ï¼‰
3. æ£€æŸ¥è´¦æˆ·ä½™é¢æ˜¯å¦è¶³å¤Ÿ

---

### 2. ä¼šå‘˜éªŒè¯å¤±è´¥

**é—®é¢˜**ï¼š`is_member_valid` è¿”å› `false`

**å¯èƒ½åŸå› **ï¼š
- ä¼šå‘˜å·²è¿‡æœŸ
- æŒå¸ä»·å€¼ä¸è¶³ï¼ˆ< $100 USDï¼‰
- ä¸æ˜¯ä¼šå‘˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ä¼šå‘˜æœ‰æ•ˆæœŸ
2. æŸ¥è¯¢æŒå¸ä»·å€¼ `get_holding_value_usd`
3. å¦‚æœæŒå¸ä»·å€¼ä¸è¶³ï¼ŒåŠæ—¶å……å€¼

---

### 3. ä»·æ ¼è®¡ç®—å¤±è´¥

**é—®é¢˜**ï¼šè´­ä¹°ä¼šå‘˜æ—¶ä»·æ ¼å¼‚å¸¸

**å¯èƒ½åŸå› **ï¼š
- `pallet-pricing` æœªåˆå§‹åŒ–
- DUST å¸‚åœºä»·æ ¼ä¸º0
- ä»·æ ¼è®¡ç®—æº¢å‡º

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ `pallet-pricing` å·²æ­£ç¡®åˆå§‹åŒ–
2. æ£€æŸ¥ DUST å¸‚åœºä»·æ ¼æ˜¯å¦æœ‰æ•ˆ
3. æŸ¥çœ‹ `PriceCalculationFallback` äº‹ä»¶ï¼Œç¡®è®¤ä½¿ç”¨çš„å›é€€ä»·æ ¼

---

### 4. å‡çº§å¤±è´¥

**é—®é¢˜**ï¼šè°ƒç”¨ `upgrade_to_year10` å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- å·²ç»æ˜¯10å¹´ä¼šå‘˜ï¼ˆ`AlreadyYear10`ï¼‰
- ä¸æ˜¯ä¼šå‘˜ï¼ˆ`NotMember`ï¼‰
- ä½™é¢ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å½“å‰ä¼šå‘˜ç­‰çº§
2. ç¡®è®¤è´¦æˆ·ä½™é¢æ˜¯å¦è¶³å¤Ÿæ”¯ä»˜å‡çº§è´¹ç”¨

---

## ç›¸å…³èµ„æº

- **ä»£ç ä»“åº“**ï¼š`/home/xiaodong/æ–‡æ¡£/stardust/pallets/membership`
- **è”ç›Ÿè®¡é…¬ç³»ç»Ÿ**ï¼š`/home/xiaodong/æ–‡æ¡£/stardust/pallets/affiliate`
- **å®šä»·ç³»ç»Ÿ**ï¼š`/home/xiaodong/æ–‡æ¡£/stardust/pallets/pricing`
- **ä¾›å¥‰ç³»ç»Ÿ**ï¼š`/home/xiaodong/æ–‡æ¡£/stardust/pallets/memorial`
- **å‰ç«¯åº”ç”¨**ï¼š`/home/xiaodong/æ–‡æ¡£/stardust/stardust-dapp`

---

**ç»´æŠ¤è€…**ï¼šStardust Team
**æœ€åæ›´æ–°**ï¼š2025-11-10
**ç‰ˆæœ¬**ï¼šv4.0.0ï¼ˆæ”¯æŒ USDT åŠ¨æ€å®šä»· + æŒå¸é—¨æ§›ï¼‰

---

## å˜æ›´æ—¥å¿—

### v4.0.0ï¼ˆ2025-11-10ï¼‰
- ğŸ†• æ–°å¢ USDT å›ºå®šå®šä»·æœºåˆ¶ï¼ˆåŸºäº `pallet-pricing` åŠ¨æ€è®¡ç®— DUST æ•°é‡ï¼‰
- ğŸ†• æ–°å¢æŒå¸é—¨æ§›éªŒè¯ï¼ˆæŒå¸ä»·å€¼â‰¥$100 USDï¼‰
- ğŸ†• æ–°å¢ `get_holding_value_usd` æŸ¥è¯¢æ¥å£
- ğŸ†• æ–°å¢ `DynamicPriceCalculated` å’Œ `PriceCalculationFallback` äº‹ä»¶
- ğŸ†• æ–°å¢ `MarketPriceNotAvailable` å’Œ `PriceCalculationFailed` é”™è¯¯
- ğŸ”§ é‡æ„ä»·æ ¼è®¡ç®—é€»è¾‘ï¼ˆä¸‰çº§å›é€€æœºåˆ¶ï¼‰
- ğŸ”§ æ›´æ–° `is_member_valid` å‡½æ•°ï¼ˆå¢åŠ æŒå¸ä»·å€¼éªŒè¯ï¼‰
- ğŸ”§ æ›´æ–°å‡çº§ä»·æ ¼è®¡ç®—ï¼ˆåŸºäº USDT ä»·æ ¼å·®ï¼‰

### v3.0.0ï¼ˆ2025-10-28ï¼‰
- ğŸ”§ é‡æ„æ¨èå…³ç³»ç®¡ç†ï¼ˆä¸ `pallet-affiliate` é›†æˆï¼‰
- ğŸ—‘ï¸ ç§»é™¤ `ReferralCodeToAccount` å­˜å‚¨
- ğŸ—‘ï¸ ç§»é™¤æ¨èç ç”Ÿæˆé€»è¾‘ï¼ˆç»Ÿä¸€ç”± `pallet-affiliate` ç®¡ç†ï¼‰
- ğŸ†• æ–°å¢ `add_seed_member` æ¥å£ï¼ˆRootæƒé™ï¼‰

### v2.0.0ï¼ˆ2025-10-01ï¼‰
- ğŸ†• æ–°å¢æ²»ç†ä»·æ ¼è®¾ç½®æ¥å£ï¼ˆ`set_membership_price`, `set_all_membership_prices`ï¼‰
- ğŸ†• æ–°å¢ä»·æ ¼èŒƒå›´éªŒè¯ï¼ˆ`MinMembershipPrice`, `MaxMembershipPrice`ï¼‰
- ğŸ”§ ä¼˜åŒ–ä»·æ ¼å­˜å‚¨æœºåˆ¶

### v1.0.0ï¼ˆ2025-09-01ï¼‰
- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… å®ç°å››çº§ä¼šå‘˜åˆ¶åº¦
- âœ… å®ç°åŠ¨æ€ä»£æ•°å¢é•¿æœºåˆ¶
- âœ… å®ç°ä¼šå‘˜æŠ˜æ‰£ç®¡ç†
- âœ… å®ç°è¡¥å‡çº§æœºåˆ¶
