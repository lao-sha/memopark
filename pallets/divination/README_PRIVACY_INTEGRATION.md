# å åœç³»ç»Ÿéšç§æ¨¡å¼é›†æˆ - å¿«é€Ÿå¯¼èˆª

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### ğŸš€ [æ‰§è¡Œæ‘˜è¦](./PRIVACY_INTEGRATION_SUMMARY.md)
**æ¨èé˜…è¯»æ—¶é—´**: 5 åˆ†é’Ÿ
å¿«é€Ÿäº†è§£æ ¸å¿ƒè®¾è®¡ã€å®æ–½è·¯å¾„å’ŒæŠ€æœ¯äº®ç‚¹

### ğŸ“– [å®Œæ•´è®¾è®¡æ–‡æ¡£](./UNIFIED_PRIVACY_INTEGRATION_DESIGN.md)
**æ¨èé˜…è¯»æ—¶é—´**: 20 åˆ†é’Ÿ
è¯¦ç»†çš„æŠ€æœ¯æ–¹æ¡ˆã€å®ç°ç»†èŠ‚å’Œé£é™©è¯„ä¼°

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡äº®ç‚¹

### ç»Ÿä¸€è®¡ç®—æ–¹æ¡ˆï¼šå‰ç«¯ä¼ å‚ + Runtime API

**è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ**

ä¼ ç»Ÿæ–¹æ¡ˆè¦ä¹ˆå…¨éƒ¨æ˜æ–‡ï¼ˆæ— éšç§ï¼‰ï¼Œè¦ä¹ˆéœ€è¦å¤æ‚çš„ ZK è¯æ˜ï¼ˆå¼€å‘æˆæœ¬é«˜ï¼‰ã€‚æ–°æ–¹æ¡ˆå®ç°äº†**ç®€å•é«˜æ•ˆ**ï¼š

```
Public/Partial æ¨¡å¼ï¼š
å‰ç«¯ â”€â”€(chartId)â”€â”€> Runtime API â”€â”€è¯»å–é“¾ä¸Šæ˜æ–‡â”€â”€> è¿”å›ç»“æœ

Private æ¨¡å¼ï¼š
å‰ç«¯ â”€â”€è§£å¯†â”€â”€> å‰ç«¯ â”€â”€(å‚æ•°)â”€â”€> Runtime API â”€â”€> è¿”å›ç»“æœ
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- âœ… é›¶æœåŠ¡å™¨æˆæœ¬
- âœ… é›¶ä»£ç é‡å¤ï¼ˆå¤ç”¨é“¾ä¸Šç®—æ³•ï¼‰
- âœ… é“¾ç«¯æ›´æ–°è‡ªåŠ¨åŒæ­¥
- âœ… å³æ—¶è®¡ç®—ï¼Œæ— ç­‰å¾…
- âœ… å¼€å‘æˆæœ¬ä½ï¼ˆ38 äººæ—¥ï¼‰

---

## ğŸ“Š ä¸‰ç§æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | Public | Partial â­ | Private |
|------|--------|-----------|---------|
| **æ•æ„Ÿæ•°æ®** | æ˜æ–‡ | åŠ å¯† | åŠ å¯† |
| **è®¡ç®—æ•°æ®** | æ˜æ–‡ | æ˜æ–‡ | åŠ å¯† |
| **è®¡ç®—æ–¹å¼** | Runtime API (chartId) | Runtime API (chartId) | Runtime API (å‰ç«¯ä¼ å‚) |
| **æˆæƒèƒ½åŠ›** | âŒ æ—  | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **å­˜å‚¨å¼€é”€** | 0 | +50 bytes | +50 bytes |
| **æ¨èåœºæ™¯** | å…¬å¼€å±•ç¤º | **å¥‡é—¨éç”²ã€å‘½è¿æ¡£æ¡ˆ** | é«˜åº¦æ•æ„Ÿæ•°æ® |

**Private æ¨¡å¼éšç§ä¿æŠ¤**ï¼š
- **å…¬å…± RPC**ï¼šRPC èŠ‚ç‚¹å¯è§ä¼ å…¥å‚æ•°ï¼ˆéœ€ä¿¡ä»»æœåŠ¡å•†ï¼‰
- **è‡ªå»º RPC**ï¼šå®Œå…¨éšç§ï¼ˆä¼ä¸šç”¨æˆ·æ¨èï¼‰

> ğŸ’¡ **å»ºè®®**ï¼šå¤§å¤šæ•°ç”¨æˆ·ä½¿ç”¨ Partial æ¨¡å¼å³å¯æ»¡è¶³éšç§éœ€æ±‚

---

## ğŸ”§ å®æ–½ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å¯åŠ¨ï¼‰

**qimen (å¥‡é—¨éç”²)** å’Œ **ziwei (ç´«å¾®æ–—æ•°)**

**åŸå› **:
- æ•æ„Ÿæ•°æ®æ˜æ–‡å­˜å‚¨ï¼Œéšç§é£é™©é«˜
- ç”¨æˆ·é‡å¤§ï¼Œå½±å“èŒƒå›´å¹¿
- Partial æ¨¡å¼æ•ˆæœæœ€æ˜æ˜¾

**å·¥ä½œé‡**: 15 äººæ—¥

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆ2-3 å‘¨å†…ï¼‰

**liuyao, xiaoliuren, daliuren, meihua**

**åŸå› **:
- å½“å‰ä¾èµ– IPFS é“¾ä¸‹å­˜å‚¨ï¼Œä¸å¤Ÿç»Ÿä¸€
- æ”¹é€ éš¾åº¦ä½ï¼Œå¯å¿«é€Ÿå®Œæˆ

**å·¥ä½œé‡**: 17 äººæ—¥

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆå¯å»¶åï¼‰

**tarot (å¡”ç½—ç‰Œ)** + **å‰ç«¯ UI å®Œå–„**

**åŸå› **:
- å·²é‡‡ç”¨é—®é¢˜å“ˆå¸Œå­˜å‚¨ï¼Œéšç§è¾ƒå¥½
- æ”¹é€ å·¥ä½œé‡å°ï¼ˆä»…æ›¿æ¢ is_public ä¸º privacy_modeï¼‰

**å·¥ä½œé‡**: 6 äººæ—¥

---

## ğŸ’¡ å¿«é€Ÿå¼€å§‹

### 1. äº†è§£æ ¸å¿ƒæ¦‚å¿µ

**ä¸‰ç§éšç§æ¨¡å¼**ï¼š
- **Public**: å…¨éƒ¨æ˜æ–‡ï¼Œé€‚åˆå…¬å¼€å±•ç¤º
- **Partial** â­: è®¡ç®—æ•°æ®æ˜æ–‡ + æ•æ„Ÿæ•°æ®åŠ å¯†ï¼ˆæ¨èï¼‰
- **Private**: å…¨éƒ¨åŠ å¯†ï¼Œæœ€é«˜éšç§çº§åˆ«

**è®¡ç®—æ–¹å¼**ï¼š
- **Public/Partial**: å‰ç«¯ä¼  chartId â†’ Runtime API è¯»å–é“¾ä¸Šæ•°æ® â†’ è¿”å›ç»“æœ
- **Private**: å‰ç«¯è§£å¯† â†’ ä¼ å‚æ•° â†’ Runtime API è®¡ç®— â†’ è¿”å›ç»“æœ

### 2. é˜…è¯»è®¾è®¡æ–‡æ¡£

```bash
# æ‰§è¡Œæ‘˜è¦ï¼ˆ5 åˆ†é’Ÿï¼‰
cat PRIVACY_INTEGRATION_SUMMARY.md

# å®Œæ•´è®¾è®¡ï¼ˆ20 åˆ†é’Ÿï¼‰
cat UNIFIED_PRIVACY_INTEGRATION_DESIGN.md
```

### 3. æŸ¥çœ‹ç°æœ‰é›†æˆæ¡ˆä¾‹

```bash
# Bazi æ¨¡å—ï¼ˆå·²å®Œæˆé›†æˆï¼‰
cat bazi/docs/BAZI_CHART_STRUCT_MODIFICATIONS.md

# Privacy æ¨¡å—æ–‡æ¡£
cat privacy/README.md
```

### 4. å¯åŠ¨æ”¹é€ 

**ä»»åŠ¡æ¸…å•**ï¼š

1. æ·»åŠ  `privacy_mode`, `encrypted_fields` å­—æ®µ
2. æ•æ„Ÿå­—æ®µæ”¹ä¸º `Option` ç±»å‹
3. æ–°å¢ `create_chart_encrypted` æ¥å£
4. å®ç° Runtime APIï¼ˆå«ä¼ å‚ç‰ˆæœ¬ï¼‰
5. å‰ç«¯åŠ å¯†/è§£å¯†æœåŠ¡
6. å•å…ƒæµ‹è¯•

### 5. å‰ç«¯é›†æˆ

**æ ¸å¿ƒæœåŠ¡ç±»**ï¼ˆè¯¦è§å®Œæ•´è®¾è®¡æ–‡æ¡£ "ğŸ” Privacy Pallet é›†æˆè¯¦è§£"ï¼‰ï¼š

```typescript
// å¯†é’¥ç®¡ç†
class EncryptionKeyService {
  getOrCreateKeyPair()      // ç”Ÿæˆ/è·å– X25519 å¯†é’¥å¯¹
  registerEncryptionKey()   // æ³¨å†Œå…¬é’¥åˆ°é“¾ä¸Š
}

// åŠ å¯†æœåŠ¡
class DivinationEncryptionService {
  createEncryptedRecord()   // åˆ›å»ºåŠ å¯†è®°å½•
  decryptSensitiveData()    // è§£å¯†æ•æ„Ÿæ•°æ®
}

// æˆæƒç®¡ç†
class AuthorizationService {
  grantAccess()             // æˆæƒä»–äººè®¿é—®
  revokeAccess()            // æ’¤é”€æˆæƒ
  listAuthorizations()      // æŸ¥è¯¢æˆæƒåˆ—è¡¨
}
```

---

## ğŸ“ å…³é”®æ¦‚å¿µ

### 1. PrivacyMode (éšç§æ¨¡å¼)

```rust
pub enum PrivacyMode {
    Public = 0,   // å…¬å¼€ - æ‰€æœ‰äººå¯è§
    Partial = 1,  // éƒ¨åˆ†åŠ å¯† - è®¡ç®—æ•°æ®æ˜æ–‡ + æ•æ„Ÿæ•°æ®åŠ å¯† â­
    Private = 2,  // å®Œå…¨ç§å¯† - å…¨éƒ¨æ•°æ®åŠ å¯†
}
```

### 2. EncryptedFields (åŠ å¯†å­—æ®µæ ‡å¿—)

ä½¿ç”¨ bit flags æ ‡è¯†å“ªäº›å­—æ®µè¢«åŠ å¯†ï¼š

```rust
let fields = EncryptedFields::NAME | EncryptedFields::QUESTION;
// fields = 0b0011 (NAME=0b0001, QUESTION=0b0010)
```

### 3. Runtime API è°ƒç”¨

```typescript
// Partial æ¨¡å¼ï¼šä¼  chartId
const result = await api.call.qimenApi.interpretChart(chartId);

// Private æ¨¡å¼ï¼šå‰ç«¯è§£å¯†åè°ƒç”¨ä¸´æ—¶æ’ç›˜ API
const decrypted = await decryptWithPrivateKey(encryptedRecord, privateKey);
const result = await api.call.qimenApi.computeChart(
  decrypted.solarYear,
  decrypted.solarMonth,
  decrypted.solarDay,
  decrypted.solarHour,
  decrypted.solarMinute,
);
```

### 4. æ ¸å¿ƒæ•°æ®ç»“æ„

**Private æ¨¡å¼åŠ å¯†æ•°æ®**ï¼š
```rust
pub struct PrivateEncryptedData {
    pub name: Option<String>,
    pub question: Option<String>,
    pub solar_year: u16,    // ç”¨äº compute_chart
    pub solar_month: u8,
    pub solar_day: u8,
    pub solar_hour: u8,
    pub solar_minute: u8,
}
```

**ä¸´æ—¶æ’ç›˜ç»“æœ**ï¼š
```rust
pub struct QimenChartResult {
    pub year_ganzhi: GanZhi,
    pub palaces: [Palace; 9],
    pub fortune: Option<Fortune>,
    // ...
}
```

---

## ğŸ“ è”ç³»ä¸åé¦ˆ

- **æŠ€æœ¯è®¨è®º**: æäº¤ Issue åˆ° GitHub
- **è®¾è®¡åé¦ˆ**: ä¿®æ”¹è®¾è®¡æ–‡æ¡£å¹¶æäº¤ PR
- **å®æ–½è¿›åº¦**: å‚è€ƒ PRIVACY_INTEGRATION_SUMMARY.md ä¸­çš„ Phase åˆ’åˆ†

---

## ğŸ† æˆåŠŸæ ‡å‡†

### çŸ­æœŸç›®æ ‡ï¼ˆ2 å‘¨ï¼‰

- âœ… qimen å’Œ ziwei å®Œæˆæ”¹é€ 
- âœ… Runtime APIï¼ˆå«ä¼ å‚ç‰ˆæœ¬ï¼‰ä¸Šçº¿
- âœ… å‰ç«¯åŠ å¯†æœåŠ¡å±‚ä¸Šçº¿

### ä¸­æœŸç›®æ ‡ï¼ˆ4 å‘¨ï¼‰

- âœ… æ‰€æœ‰å åœæ¨¡å—å®Œæˆé›†æˆ
- âœ… å‰ç«¯ UI ç»„ä»¶å®Œå–„
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 90%

### é•¿æœŸç›®æ ‡ï¼ˆ6 å‘¨ï¼‰

- âœ… Partial æ¨¡å¼æˆä¸ºé»˜è®¤æ¨è
- âœ… ä¼ä¸šç”¨æˆ·è‡ªå»º RPC æŒ‡å—
- âœ… ç”¨æˆ·æ•™è‚²å’Œæœ€ä½³å®è·µæ–‡æ¡£

---

**æœ€åæ›´æ–°**: 2025-12-26
**ç‰ˆæœ¬**: v3.4
**ç»´æŠ¤è€…**: Stardust æŠ€æœ¯å›¢é˜Ÿ
