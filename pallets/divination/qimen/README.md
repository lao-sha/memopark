# pallet-qimen

## å¥‡é—¨éç”²æ’ç›˜ç³»ç»Ÿ - åŒºå—é“¾ç„å­¦å åœæ¨¡å—

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Substrate](https://img.shields.io/badge/Substrate-stable2506-blue)](https://github.com/paritytech/polkadot-sdk)

## æ¦‚è¿°

`pallet-qimen` æ˜¯ Stardust åŒºå—é“¾ä¸Šçš„å¥‡é—¨éç”²æ’ç›˜ç³»ç»Ÿï¼Œå®ç°äº†å®Œæ•´çš„å¥‡é—¨éç”²å››ç›˜æ’å¸ƒç®—æ³•ã€‚æœ¬æ¨¡å—æ”¯æŒå¤šç§èµ·å±€æ–¹å¼ï¼Œå¹¶ä¸é€šç”¨å åœç³»ç»Ÿï¼ˆ`pallet-divination-*`ï¼‰æ·±åº¦é›†æˆï¼Œæä¾› NFT é“¸é€ ã€AI è§£è¯»ã€æœåŠ¡å¸‚åœºç­‰æ‰©å±•åŠŸèƒ½ã€‚

### ä»€ä¹ˆæ˜¯å¥‡é—¨éç”²ï¼Ÿ

å¥‡é—¨éç”²æ˜¯ä¸­å›½å¤ä»£æœ€é«˜å±‚æ¬¡çš„é¢„æµ‹å­¦ï¼Œä¸å¤ªä¹™ç¥æ•°ã€å…­å£¬ç¥è¯¾å¹¶ç§°"ä¸‰å¼"ã€‚å…¶æ ¸å¿ƒæ˜¯é€šè¿‡å¤©æ—¶ã€åœ°åˆ©ã€äººå’Œã€ç¥åŠ©å››ä¸ªç»´åº¦çš„ç»¼åˆåˆ†æï¼Œé¢„æµ‹äº‹ç‰©å‘å±•è¶‹åŠ¿ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ å››ç§èµ·å±€æ–¹å¼

| æ–¹å¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **æ—¶é—´èµ·å±€** | æ ¹æ®å½“å‰åŒºå—æ—¶é—´æˆ³è‡ªåŠ¨è®¡ç®—å››æŸ±ï¼Œç¡®å®šé˜´é˜³éå’Œå±€æ•° | æœ€ä¼ ç»Ÿã€æœ€å¸¸ç”¨çš„èµ·å±€æ–¹å¼ |
| **æ•°å­—èµ·å±€** | ç”¨æˆ·è¾“å…¥ä¸¤ä¸ªæ•°å­—ï¼Œé…åˆåŒºå—å“ˆå¸Œç”Ÿæˆå¦è±¡ | å¿ƒå¿µèµ·å±€ã€å³æ—¶å†³ç­– |
| **éšæœºèµ·å±€** | ä½¿ç”¨é“¾ä¸Šéšæœºæ•°å®Œå…¨éšæœºç”Ÿæˆ | å¨±ä¹æ€§å åœã€æµ‹è¯•ç”¨é€” |
| **æ‰‹åŠ¨æŒ‡å®š** | ç›´æ¥æŒ‡å®šé˜´é˜³éç±»å‹å’Œå±€æ•°ï¼ˆ1-9ï¼‰ | ä¸“ä¸šç”¨æˆ·ã€æ•™å­¦æ¼”ç¤º |

### ğŸ›ï¸ å®Œæ•´çš„å››ç›˜ç³»ç»Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¥‡é—¨éç”²å››ç›˜ç»“æ„                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¤©ç›˜ï¼ˆä¹æ˜Ÿï¼‰    åœ°ç›˜ï¼ˆä¸‰å¥‡å…­ä»ªï¼‰   äººç›˜ï¼ˆå…«é—¨ï¼‰   ç¥ç›˜ï¼ˆå…«ç¥ï¼‰ â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”‚
â”‚  â”‚å·½4â”‚ç¦»9â”‚å¤2â”‚  â”‚ä¹™ â”‚ä¸™ â”‚ä¸ â”‚  â”‚æœ â”‚æ™¯ â”‚æ­» â”‚  â”‚è…¾è›‡â”‚å¤ªé˜´â”‚å…­åˆâ”‚ â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤ â”‚
â”‚  â”‚éœ‡3â”‚ä¸­5â”‚å…‘7â”‚  â”‚æˆŠ â”‚å·± â”‚åºš â”‚  â”‚ä¼¤ â”‚  â”‚æƒŠ â”‚  â”‚ç™½è™â”‚  â”‚ç„æ­¦â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤ â”‚
â”‚  â”‚è‰®8â”‚å1â”‚ä¹¾6â”‚  â”‚è¾› â”‚å£¬ â”‚ç™¸ â”‚  â”‚ç”Ÿ â”‚ä¼‘ â”‚å¼€ â”‚  â”‚ä¹åœ°â”‚ä¹å¤©â”‚å€¼ç¬¦â”‚ â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”® ä¹å®«æ ¼å±€

åŸºäºæ´›ä¹¦ä¹å®«ï¼Œæ¯ä¸ªå®«ä½åŒ…å«å®Œæ•´çš„å››ç›˜ä¿¡æ¯ï¼š

| å®«ä½ | æ–¹ä½ | äº”è¡Œ | åå¤©å…«å¦ |
|------|------|------|----------|
| åä¸€å®« | åŒ— | æ°´ | å |
| å¤äºŒå®« | è¥¿å— | åœŸ | å¤ |
| éœ‡ä¸‰å®« | ä¸œ | æœ¨ | éœ‡ |
| å·½å››å®« | ä¸œå— | æœ¨ | å·½ |
| ä¸­äº”å®« | ä¸­å¤® | åœŸ | - |
| ä¹¾å…­å®« | è¥¿åŒ— | é‡‘ | ä¹¾ |
| å…‘ä¸ƒå®« | è¥¿ | é‡‘ | å…‘ |
| è‰®å…«å®« | ä¸œåŒ— | åœŸ | è‰® |
| ç¦»ä¹å®« | å— | ç« | ç¦» |

## æŠ€æœ¯æ¶æ„

### æ¨¡å—ä¾èµ–

```
pallet-qimen
    â”œâ”€â”€ pallet-divination-common  (é€šç”¨å åœç±»å‹)
    â”œâ”€â”€ pallet-timestamp          (æ—¶é—´æˆ³è·å–)
    â”œâ”€â”€ frame-support             (Substrate æ¡†æ¶)
    â””â”€â”€ frame-system              (ç³»ç»Ÿæ¨¡å—)
```

### ä¸é€šç”¨å åœç³»ç»Ÿé›†æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é€šç”¨å åœç”Ÿæ€ç³»ç»Ÿ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ pallet-qimenâ”‚  â”‚pallet-meihuaâ”‚  â”‚ pallet-tarotâ”‚     â”‚
â”‚  â”‚  (å¥‡é—¨éç”²) â”‚  â”‚  (æ¢…èŠ±æ˜“æ•°) â”‚  â”‚   (å¡”ç½—ç‰Œ)  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                â”‚                â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                          â”‚                              â”‚
â”‚                          â–¼                              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â”‚pallet-divination-   â”‚                    â”‚
â”‚              â”‚      common         â”‚                    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                         â”‚                               â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚         â–¼               â–¼               â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ divination â”‚  â”‚ divination â”‚  â”‚ divination â”‚        â”‚
â”‚  â”‚    -nft    â”‚  â”‚    -ai     â”‚  â”‚   -market  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®ç»“æ„

### QimenChartï¼ˆå¥‡é—¨ç›˜ï¼‰

```rust
pub struct QimenChart<AccountId, BlockNumber, Moment> {
    /// æ’ç›˜ ID
    pub id: u64,
    /// åˆ›å»ºè€…è´¦æˆ·
    pub creator: AccountId,
    /// åˆ›å»ºåŒºå—
    pub created_at: BlockNumber,
    /// æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
    pub timestamp: Moment,
    /// é˜´é˜³éç±»å‹
    pub dun_type: DunType,
    /// å±€æ•°ï¼ˆ1-9ï¼‰
    pub ju_number: u8,
    /// ä¸‰å…ƒï¼ˆä¸Š/ä¸­/ä¸‹ï¼‰
    pub san_yuan: SanYuan,
    /// èŠ‚æ°”
    pub jie_qi: JieQi,
    /// ä¹å®«æ’å¸ƒ
    pub palaces: [Palace; 9],
    /// å€¼ç¬¦æ˜Ÿ
    pub zhi_fu_xing: JiuXing,
    /// å€¼ä½¿é—¨
    pub zhi_shi_men: BaMen,
    /// æ—¬é¦–
    pub xun_shou: TianGan,
    /// æ˜¯å¦å…¬å¼€
    pub is_public: bool,
    /// AI è§£è¯» CID
    pub ai_interpretation_cid: Option<BoundedVec<u8, MaxCidLen>>,
}
```

### Palaceï¼ˆå®«ä½ï¼‰

```rust
pub struct Palace {
    /// å®«ä½ç¼–å·ï¼ˆ1-9ï¼‰
    pub position: JiuGong,
    /// å¤©ç›˜æ˜Ÿ
    pub tian_pan: JiuXing,
    /// åœ°ç›˜å¹²
    pub di_pan: TianGan,
    /// äººç›˜é—¨
    pub ren_pan: BaMen,
    /// ç¥ç›˜ç¥
    pub shen_pan: BaShen,
    /// æ˜¯å¦ä¸ºç©ºäº¡
    pub is_kong: bool,
    /// æ˜¯å¦ä¸ºé©¬æ˜Ÿ
    pub is_ma: bool,
}
```

### æ ¸å¿ƒæšä¸¾ç±»å‹

```rust
/// é˜´é˜³é
pub enum DunType {
    Yang,  // é˜³éï¼ˆå†¬è‡³åï¼Œé¡ºè¡Œï¼‰
    Yin,   // é˜´éï¼ˆå¤è‡³åï¼Œé€†è¡Œï¼‰
}

/// ä¹æ˜Ÿ
pub enum JiuXing {
    TianPeng,  // å¤©è“¬æ˜Ÿï¼ˆåä¸€å®«ï¼‰
    TianRui,   // å¤©èŠ®æ˜Ÿï¼ˆå¤äºŒå®«ï¼‰
    TianChong, // å¤©å†²æ˜Ÿï¼ˆéœ‡ä¸‰å®«ï¼‰
    TianFu,    // å¤©è¾…æ˜Ÿï¼ˆå·½å››å®«ï¼‰
    TianQin,   // å¤©ç¦½æ˜Ÿï¼ˆä¸­äº”å®«ï¼‰
    TianXin,   // å¤©å¿ƒæ˜Ÿï¼ˆä¹¾å…­å®«ï¼‰
    TianZhu,   // å¤©æŸ±æ˜Ÿï¼ˆå…‘ä¸ƒå®«ï¼‰
    TianRen,   // å¤©ä»»æ˜Ÿï¼ˆè‰®å…«å®«ï¼‰
    TianYing,  // å¤©è‹±æ˜Ÿï¼ˆç¦»ä¹å®«ï¼‰
}

/// å…«é—¨
pub enum BaMen {
    Xiu,   // ä¼‘é—¨ï¼ˆåä¸€å®«ï¼‰- å‰
    Si,    // æ­»é—¨ï¼ˆå¤äºŒå®«ï¼‰- å‡¶
    Shang, // ä¼¤é—¨ï¼ˆéœ‡ä¸‰å®«ï¼‰- å‡¶
    Du,    // æœé—¨ï¼ˆå·½å››å®«ï¼‰- å¹³
    Jing,  // æ™¯é—¨ï¼ˆç¦»ä¹å®«ï¼‰- å¹³
    Kai,   // å¼€é—¨ï¼ˆä¹¾å…­å®«ï¼‰- å‰
    Jing2, // æƒŠé—¨ï¼ˆå…‘ä¸ƒå®«ï¼‰- å‡¶
    Sheng, // ç”Ÿé—¨ï¼ˆè‰®å…«å®«ï¼‰- å‰
}

/// å…«ç¥
pub enum BaShen {
    ZhiFu,   // å€¼ç¬¦ï¼ˆæœ€å‰ï¼‰
    TengShe, // è…¾è›‡ï¼ˆæƒŠæï¼‰
    TaiYin,  // å¤ªé˜´ï¼ˆé˜´ç§ï¼‰
    LiuHe,   // å…­åˆï¼ˆå’Œåˆï¼‰
    BaiHu,   // ç™½è™ï¼ˆå‡¶é™©ï¼‰
    XuanWu,  // ç„æ­¦ï¼ˆç›—è´¼ï¼‰
    JiuDi,   // ä¹åœ°ï¼ˆæŸ”é¡ºï¼‰
    JiuTian, // ä¹å¤©ï¼ˆåˆšå¥ï¼‰
}

/// äºŒåå››èŠ‚æ°”
pub enum JieQi {
    DongZhi,    // å†¬è‡³ï¼ˆé˜³éèµ·ç‚¹ï¼‰
    XiaoHan,    // å°å¯’
    DaHan,      // å¤§å¯’
    LiChun,     // ç«‹æ˜¥
    YuShui,     // é›¨æ°´
    JingZhe,    // æƒŠè›°
    ChunFen,    // æ˜¥åˆ†
    QingMing,   // æ¸…æ˜
    GuYu,       // è°·é›¨
    LiXia,      // ç«‹å¤
    XiaoMan,    // å°æ»¡
    MangZhong,  // èŠ’ç§
    XiaZhi,     // å¤è‡³ï¼ˆé˜´éèµ·ç‚¹ï¼‰
    XiaoShu,    // å°æš‘
    DaShu,      // å¤§æš‘
    LiQiu,      // ç«‹ç§‹
    ChuShu,     // å¤„æš‘
    BaiLu,      // ç™½éœ²
    QiuFen,     // ç§‹åˆ†
    HanLu,      // å¯’éœ²
    ShuangJiang,// éœœé™
    LiDong,     // ç«‹å†¬
    XiaoXue,    // å°é›ª
    DaXue,      // å¤§é›ª
}
```

## Extrinsicsï¼ˆå¯è°ƒç”¨å‡½æ•°ï¼‰

### 1. divine_by_time - æ—¶é—´èµ·å±€

```rust
/// æ ¹æ®å½“å‰æ—¶é—´è‡ªåŠ¨è®¡ç®—å››æŸ±ï¼Œç¡®å®šé˜´é˜³éå’Œå±€æ•°
///
/// # å‚æ•°
/// - `origin`: ç­¾åè´¦æˆ·
///
/// # è´¹ç”¨
/// - æ¯æ—¥å‰ 3 æ¬¡å…è´¹ï¼Œä¹‹åæ¶ˆè€— Gas
///
/// # äº‹ä»¶
/// - `ChartCreated { chart_id, creator, dun_type, ju_number }`
#[pallet::call_index(0)]
pub fn divine_by_time(origin: OriginFor<T>) -> DispatchResult;
```

### 2. divine_by_numbers - æ•°å­—èµ·å±€

```rust
/// ä½¿ç”¨ä¸¤ä¸ªæ•°å­—é…åˆåŒºå—å“ˆå¸Œç”Ÿæˆå¥‡é—¨ç›˜
///
/// # å‚æ•°
/// - `origin`: ç­¾åè´¦æˆ·
/// - `num1`: ç¬¬ä¸€ä¸ªæ•°å­—ï¼ˆ1-100ï¼‰
/// - `num2`: ç¬¬äºŒä¸ªæ•°å­—ï¼ˆ1-100ï¼‰
///
/// # é€»è¾‘
/// - é˜´é˜³éï¼š(num1 + num2 + block_hash) % 2
/// - å±€æ•°ï¼š((num1 * num2) % 9) + 1
#[pallet::call_index(1)]
pub fn divine_by_numbers(
    origin: OriginFor<T>,
    num1: u32,
    num2: u32,
) -> DispatchResult;
```

### 3. divine_random - éšæœºèµ·å±€

```rust
/// ä½¿ç”¨é“¾ä¸Šéšæœºæ•°å®Œå…¨éšæœºç”Ÿæˆå¥‡é—¨ç›˜
///
/// # å‚æ•°
/// - `origin`: ç­¾åè´¦æˆ·
///
/// # éšæœºæ€§æ¥æº
/// - ä½¿ç”¨ frame_support::traits::Randomness
/// - ç»“åˆè´¦æˆ· ID å’ŒåŒºå—å·ä½œä¸º subject
#[pallet::call_index(2)]
pub fn divine_random(origin: OriginFor<T>) -> DispatchResult;
```

### 4. divine_manual - æ‰‹åŠ¨æŒ‡å®š

```rust
/// ç›´æ¥æŒ‡å®šé˜´é˜³éç±»å‹å’Œå±€æ•°
///
/// # å‚æ•°
/// - `origin`: ç­¾åè´¦æˆ·
/// - `dun_type`: é˜´éæˆ–é˜³é
/// - `ju_number`: å±€æ•°ï¼ˆ1-9ï¼‰
///
/// # é”™è¯¯
/// - `InvalidJuNumber`: å±€æ•°ä¸åœ¨ 1-9 èŒƒå›´å†…
#[pallet::call_index(3)]
pub fn divine_manual(
    origin: OriginFor<T>,
    dun_type: DunType,
    ju_number: u8,
) -> DispatchResult;
```

### 5. request_ai_interpretation - è¯·æ±‚ AI è§£è¯»

```rust
/// ä¸ºæŒ‡å®šå¥‡é—¨ç›˜è¯·æ±‚ AI æ™ºèƒ½è§£è¯»
///
/// # å‚æ•°
/// - `origin`: ç­¾åè´¦æˆ·ï¼ˆå¿…é¡»æ˜¯ç›˜ä¸»ï¼‰
/// - `chart_id`: å¥‡é—¨ç›˜ ID
///
/// # è´¹ç”¨
/// - 15 DUSTï¼ˆè½¬å…¥å›½åº“è´¦æˆ·ï¼‰
///
/// # æµç¨‹
/// 1. ç”¨æˆ·æ”¯ä»˜è´¹ç”¨
/// 2. å‘å‡º AiInterpretationRequested äº‹ä»¶
/// 3. é“¾ä¸‹é¢„è¨€æœºèŠ‚ç‚¹ç›‘å¬äº‹ä»¶
/// 4. é¢„è¨€æœºè°ƒç”¨ AI æœåŠ¡ç”Ÿæˆè§£è¯»
/// 5. é¢„è¨€æœºæäº¤è§£è¯»ç»“æœï¼ˆIPFS CIDï¼‰
#[pallet::call_index(4)]
pub fn request_ai_interpretation(
    origin: OriginFor<T>,
    chart_id: u64,
) -> DispatchResult;
```

### 6. submit_ai_interpretation - æäº¤ AI è§£è¯»

```rust
/// é¢„è¨€æœºæäº¤ AI è§£è¯»ç»“æœ
///
/// # å‚æ•°
/// - `origin`: Root æƒé™ï¼ˆé¢„è¨€æœºï¼‰
/// - `chart_id`: å¥‡é—¨ç›˜ ID
/// - `cid`: IPFS å†…å®¹æ ‡è¯†ç¬¦
///
/// # æƒé™
/// - ä»… AiOracleOriginï¼ˆRootï¼‰å¯è°ƒç”¨
#[pallet::call_index(5)]
pub fn submit_ai_interpretation(
    origin: OriginFor<T>,
    chart_id: u64,
    cid: BoundedVec<u8, T::MaxCidLen>,
) -> DispatchResult;
```

### 7. set_chart_visibility - è®¾ç½®å¯è§æ€§

```rust
/// ä¿®æ”¹å¥‡é—¨ç›˜çš„å…¬å¼€/ç§æœ‰çŠ¶æ€
///
/// # å‚æ•°
/// - `origin`: ç­¾åè´¦æˆ·ï¼ˆå¿…é¡»æ˜¯ç›˜ä¸»ï¼‰
/// - `chart_id`: å¥‡é—¨ç›˜ ID
/// - `is_public`: æ˜¯å¦å…¬å¼€
///
/// # è¯´æ˜
/// - å…¬å¼€çš„ç›˜ä¼šå‡ºç°åœ¨ PublicCharts åˆ—è¡¨ä¸­
/// - ç§æœ‰çš„ç›˜ä»…åˆ›å»ºè€…å¯è§
#[pallet::call_index(6)]
pub fn set_chart_visibility(
    origin: OriginFor<T>,
    chart_id: u64,
    is_public: bool,
) -> DispatchResult;
```

## å­˜å‚¨é¡¹

| å­˜å‚¨é¡¹ | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `NextChartId` | `u64` | ä¸‹ä¸€ä¸ªå¥‡é—¨ç›˜ ID |
| `Charts` | `Map<u64, QimenChart>` | æ‰€æœ‰å¥‡é—¨ç›˜æ•°æ® |
| `UserCharts` | `Map<AccountId, Vec<u64>>` | ç”¨æˆ·çš„å¥‡é—¨ç›˜åˆ—è¡¨ |
| `PublicCharts` | `Vec<u64>` | å…¬å¼€çš„å¥‡é—¨ç›˜åˆ—è¡¨ |
| `DailyChartCount` | `Map<(AccountId, u32), u32>` | ç”¨æˆ·æ¯æ—¥èµ·ç›˜æ¬¡æ•° |
| `AiInterpretationRequests` | `Map<u64, bool>` | AI è§£è¯»è¯·æ±‚çŠ¶æ€ |
| `UserStatsStorage` | `Map<AccountId, UserStats>` | ç”¨æˆ·ç»Ÿè®¡æ•°æ® |

## äº‹ä»¶

```rust
/// å¥‡é—¨ç›˜åˆ›å»ºæˆåŠŸ
ChartCreated {
    chart_id: u64,
    creator: T::AccountId,
    dun_type: DunType,
    ju_number: u8,
}

/// è¯·æ±‚ AI è§£è¯»
AiInterpretationRequested {
    chart_id: u64,
    requester: T::AccountId,
}

/// AI è§£è¯»å®Œæˆ
AiInterpretationSubmitted {
    chart_id: u64,
    cid: Vec<u8>,
}

/// å¯è§æ€§å˜æ›´
VisibilityChanged {
    chart_id: u64,
    is_public: bool,
}
```

## é”™è¯¯ç±»å‹

```rust
/// å¥‡é—¨ç›˜ä¸å­˜åœ¨
ChartNotFound,
/// æ— æƒæ“ä½œï¼ˆéç›˜ä¸»ï¼‰
NotChartOwner,
/// æ— æ•ˆçš„å±€æ•°ï¼ˆå¿…é¡» 1-9ï¼‰
InvalidJuNumber,
/// è¶…è¿‡æ¯æ—¥èµ·ç›˜ä¸Šé™
DailyLimitExceeded,
/// è¶…è¿‡ç”¨æˆ·å­˜å‚¨ä¸Šé™
UserChartLimitExceeded,
/// è¶…è¿‡å…¬å¼€åˆ—è¡¨ä¸Šé™
PublicChartLimitExceeded,
/// AI è§£è¯»å·²è¯·æ±‚
AiInterpretationAlreadyRequested,
/// AI è§£è¯»æœªè¯·æ±‚
AiInterpretationNotRequested,
/// ä½™é¢ä¸è¶³
InsufficientBalance,
/// æ— æ•ˆçš„æ•°å­—è¾“å…¥
InvalidNumberInput,
```

## é…ç½®å‚æ•°

```rust
#[pallet::config]
pub trait Config: frame_system::Config + pallet_timestamp::Config {
    /// è´§å¸ç±»å‹
    type Currency: Currency<Self::AccountId>;

    /// éšæœºæ•°ç”Ÿæˆå™¨
    type Randomness: Randomness<Self::Hash, BlockNumberFor<Self>>;

    /// æ¯ç”¨æˆ·æœ€å¤§å¥‡é—¨ç›˜æ•°é‡
    #[pallet::constant]
    type MaxUserCharts: Get<u32>;  // é»˜è®¤: 100

    /// å…¬å¼€åˆ—è¡¨æœ€å¤§é•¿åº¦
    #[pallet::constant]
    type MaxPublicCharts: Get<u32>;  // é»˜è®¤: 1000

    /// æ¯æ—¥å…è´¹èµ·ç›˜æ¬¡æ•°
    #[pallet::constant]
    type DailyFreeCharts: Get<u32>;  // é»˜è®¤: 3

    /// æ¯æ—¥æœ€å¤§èµ·ç›˜æ¬¡æ•°
    #[pallet::constant]
    type MaxDailyCharts: Get<u32>;  // é»˜è®¤: 20

    /// AI è§£è¯»è´¹ç”¨
    #[pallet::constant]
    type AiInterpretationFee: Get<BalanceOf<Self>>;  // é»˜è®¤: 15 DUST

    /// å›½åº“è´¦æˆ·
    type TreasuryAccount: Get<Self::AccountId>;

    /// AI é¢„è¨€æœºæƒé™
    type AiOracleOrigin: EnsureOrigin<Self::RuntimeOrigin>;

    /// IPFS CID æœ€å¤§é•¿åº¦
    #[pallet::constant]
    type MaxCidLen: Get<u32>;  // é»˜è®¤: 64
}
```

## ç®—æ³•è¯´æ˜

### é˜´é˜³éåˆ¤å®š

```
å†¬è‡³ â†’ å¤è‡³ï¼šé˜³éï¼ˆé¡ºè¡Œï¼‰
å¤è‡³ â†’ å†¬è‡³ï¼šé˜´éï¼ˆé€†è¡Œï¼‰

é˜³éï¼šç”²å­ â†’ ç”²æˆŒ â†’ ç”²ç”³ â†’ ç”²åˆ â†’ ç”²è¾° â†’ ç”²å¯… â†’ ç”²å­...
é˜´éï¼šç”²å­ â†’ ç”²å¯… â†’ ç”²è¾° â†’ ç”²åˆ â†’ ç”²ç”³ â†’ ç”²æˆŒ â†’ ç”²å­...
```

### å±€æ•°è¡¨

**é˜³éå±€æ•°ï¼ˆå†¬è‡³åï¼‰ï¼š**

| èŠ‚æ°” | ä¸Šå…ƒ | ä¸­å…ƒ | ä¸‹å…ƒ |
|------|------|------|------|
| å†¬è‡³ | 1 | 7 | 4 |
| å°å¯’ | 2 | 8 | 5 |
| å¤§å¯’ | 3 | 9 | 6 |
| ç«‹æ˜¥ | 8 | 5 | 2 |
| é›¨æ°´ | 9 | 6 | 3 |
| æƒŠè›° | 1 | 7 | 4 |
| æ˜¥åˆ† | 3 | 9 | 6 |
| æ¸…æ˜ | 4 | 1 | 7 |
| è°·é›¨ | 5 | 2 | 8 |
| ç«‹å¤ | 4 | 1 | 7 |
| å°æ»¡ | 5 | 2 | 8 |
| èŠ’ç§ | 6 | 3 | 9 |

**é˜´éå±€æ•°ï¼ˆå¤è‡³åï¼‰ï¼š**

| èŠ‚æ°” | ä¸Šå…ƒ | ä¸­å…ƒ | ä¸‹å…ƒ |
|------|------|------|------|
| å¤è‡³ | 9 | 3 | 6 |
| å°æš‘ | 8 | 2 | 5 |
| å¤§æš‘ | 7 | 1 | 4 |
| ç«‹ç§‹ | 2 | 5 | 8 |
| å¤„æš‘ | 1 | 4 | 7 |
| ç™½éœ² | 9 | 3 | 6 |
| ç§‹åˆ† | 7 | 1 | 4 |
| å¯’éœ² | 6 | 9 | 3 |
| éœœé™ | 5 | 8 | 2 |
| ç«‹å†¬ | 6 | 9 | 3 |
| å°é›ª | 5 | 8 | 2 |
| å¤§é›ª | 4 | 7 | 1 |

### ä¹æ˜Ÿé£å¸ƒ

```
é˜³éé¡ºåºï¼šå1 â†’ å¤2 â†’ éœ‡3 â†’ å·½4 â†’ ä¸­5 â†’ ä¹¾6 â†’ å…‘7 â†’ è‰®8 â†’ ç¦»9
é˜´éé€†åºï¼šå1 â†’ ç¦»9 â†’ è‰®8 â†’ å…‘7 â†’ ä¹¾6 â†’ ä¸­5 â†’ å·½4 â†’ éœ‡3 â†’ å¤2
```

### å…«é—¨é£å¸ƒ

å…«é—¨éšå€¼ä½¿é—¨è½¬åŠ¨ï¼Œé˜³éé¡ºé£ï¼Œé˜´éé€†é£ã€‚

### å…«ç¥é£å¸ƒ

å…«ç¥å›ºå®šé¡ºåºï¼šå€¼ç¬¦ â†’ è…¾è›‡ â†’ å¤ªé˜´ â†’ å…­åˆ â†’ ç™½è™ â†’ ç„æ­¦ â†’ ä¹åœ° â†’ ä¹å¤©

ä»å€¼ç¬¦è½å®«å¼€å§‹ï¼Œé˜³éé¡ºå¸ƒï¼Œé˜´éé€†å¸ƒã€‚

## ä½¿ç”¨ç¤ºä¾‹

### Polkadot.js API

```javascript
// æ—¶é—´èµ·å±€
await api.tx.qimen.divineByTime().signAndSend(alice);

// æ•°å­—èµ·å±€
await api.tx.qimen.divineByNumbers(7, 8).signAndSend(alice);

// éšæœºèµ·å±€
await api.tx.qimen.divineRandom().signAndSend(alice);

// æ‰‹åŠ¨æŒ‡å®šï¼ˆé˜³éä¸€å±€ï¼‰
await api.tx.qimen.divineManual('Yang', 1).signAndSend(alice);

// è¯·æ±‚ AI è§£è¯»
await api.tx.qimen.requestAiInterpretation(chartId).signAndSend(alice);

// æŸ¥è¯¢å¥‡é—¨ç›˜
const chart = await api.query.qimen.charts(chartId);
console.log('é˜´é˜³é:', chart.dunType);
console.log('å±€æ•°:', chart.juNumber);
console.log('å€¼ç¬¦æ˜Ÿ:', chart.zhiFuXing);
console.log('å€¼ä½¿é—¨:', chart.zhiShiMen);

// æŸ¥è¯¢ç”¨æˆ·ç»Ÿè®¡
const stats = await api.query.qimen.userStatsStorage(alice.address);
console.log('æ€»èµ·ç›˜æ•°:', stats.totalCharts);
```

### å‰ç«¯é›†æˆç¤ºä¾‹

```typescript
import { ApiPromise } from '@polkadot/api';

// åˆ›å»ºå¥‡é—¨ç›˜å¹¶ç›‘å¬äº‹ä»¶
async function createQimenChart(api: ApiPromise, account: string) {
  return new Promise((resolve, reject) => {
    api.tx.qimen.divineByTime()
      .signAndSend(account, ({ events, status }) => {
        if (status.isInBlock) {
          events.forEach(({ event }) => {
            if (api.events.qimen.ChartCreated.is(event)) {
              const [chartId, creator, dunType, juNumber] = event.data;
              resolve({
                chartId: chartId.toString(),
                dunType: dunType.toString(),
                juNumber: juNumber.toNumber(),
              });
            }
          });
        }
      });
  });
}
```

## æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test -p pallet-qimen

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test -p pallet-qimen test_divine_by_time

# æ˜¾ç¤ºæµ‹è¯•è¾“å‡º
cargo test -p pallet-qimen -- --nocapture
```

### æµ‹è¯•è¦†ç›–

- âœ… æ—¶é—´èµ·å±€åŠŸèƒ½
- âœ… æ•°å­—èµ·å±€åŠŸèƒ½
- âœ… éšæœºèµ·å±€åŠŸèƒ½
- âœ… æ‰‹åŠ¨æŒ‡å®šåŠŸèƒ½
- âœ… æ¯æ—¥é™åˆ¶æ£€æŸ¥
- âœ… AI è§£è¯»æµç¨‹
- âœ… å¯è§æ€§è®¾ç½®
- âœ… ç±»å‹éªŒè¯ï¼ˆé˜´é˜³éã€å±€æ•°ã€ä¹æ˜Ÿã€å…«é—¨ã€å…«ç¥ï¼‰
- âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯•

## è®¸å¯è¯

MIT License

## æ›´æ–°æ—¥å¿—

### v0.1.0 (2025-12-01)

- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… å®ç°å››ç§èµ·å±€æ–¹å¼
- âœ… å®Œæ•´çš„å››ç›˜æ’å¸ƒç®—æ³•
- âœ… AI è§£è¯»é›†æˆ
- âœ… ä¸ pallet-divination-common é›†æˆ
- âœ… 28 ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

## å‚è€ƒèµ„æ–™

- ã€Šå¥‡é—¨éç”²ã€‹å¤ç±
- ã€Šå¥‡é—¨é¢„æµ‹å­¦ã€‹å¼ å¿—æ˜¥
- ã€Šç¥å¥‡ä¹‹é—¨ã€‹å¼ å¿—æ˜¥
- [Polkadot SDK æ–‡æ¡£](https://docs.substrate.io/)
