# ä¸´æ—¶æ’ç›˜æ¥å£ï¼ˆRuntime APIï¼‰å¯è¡Œæ€§åˆ†æ

> åˆ†ææ—¥æœŸï¼š2025-12-21
> å®ç°çŠ¶æ€ï¼šâœ… å·²å®Œæˆ

## å®ç°æ‘˜è¦

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `bazi/src/runtime_api.rs` | æ–°å¢ `calculate_bazi_temp` API å®šä¹‰ |
| `bazi/src/lib.rs` | å®ç° `calculate_bazi_temp` è®¡ç®—é€»è¾‘ |
| `bazi/src/kongwang.rs` | æ–°å¢ `calculate_all_kongwang_temp` å‡½æ•° |
| `bazi/src/xingyun.rs` | æ–°å¢ `calculate_xingyun_temp` å‡½æ•° |
| `bazi/src/shensha.rs` | æ–°å¢ `calculate_shensha_list_temp` å‡½æ•° |
| `runtime/src/apis.rs` | æ³¨å†Œ Runtime API å®ç° |

## ä¸€ã€èƒŒæ™¯ä¸éœ€æ±‚

### 1.1 é—®é¢˜æè¿°

å½“å‰å…«å­—æ’ç›˜ç³»ç»Ÿè¦æ±‚ç”¨æˆ·å¿…é¡»å…ˆé€šè¿‡äº¤æ˜“ï¼ˆExtrinsicï¼‰åˆ›å»ºå‘½ç›˜ï¼Œæ‰èƒ½æŸ¥è¯¢æ’ç›˜ç»“æœã€‚è¿™æ„å‘³ç€ï¼š

- **æ¯æ¬¡æ’ç›˜éƒ½éœ€è¦æ”¯ä»˜ Gas è´¹ç”¨**
- **æ¯æ¬¡æ’ç›˜éƒ½ä¼šå ç”¨é“¾ä¸Šå­˜å‚¨ç©ºé—´**
- **ç”¨æˆ·æ— æ³•"è¯•ç”¨"åŠŸèƒ½**

### 1.2 ç”¨æˆ·éœ€æ±‚

| åœºæ™¯ | éœ€æ±‚ | å½“å‰æ–¹æ¡ˆ | Gasè´¹ç”¨ |
|------|------|---------|---------|
| **ä¸´æ—¶æ’ç›˜** | åªçœ‹ç»“æœï¼Œä¸ä¿å­˜ | âŒ å¿…é¡»å…ˆåˆ›å»º | éœ€è¦ |
| **æ°¸ä¹…å­˜å‚¨** | ä¿å­˜åˆ°é“¾ä¸Š | âœ… å·²æ”¯æŒ | éœ€è¦ |

**æ ¸å¿ƒè¯‰æ±‚**ï¼šç”¨æˆ·åªæƒ³"è¯•æ’ä¸€ä¸‹"çœ‹çœ‹ç»“æœï¼Œä¸æƒ³å­˜å‚¨ä¹Ÿä¸æƒ³èŠ± gasã€‚

---

## äºŒã€å½“å‰æ¶æ„åˆ†æ

### 2.1 ç°æœ‰æ¥å£

#### äº¤æ˜“æ¥å£ï¼ˆéœ€è¦ Gasï¼‰

```rust
// åˆ›å»ºå…«å­—å¹¶å­˜å‚¨
fn create_bazi_chart(
    origin,
    year, month, day, hour, minute,
    gender, zishi_mode,
    longitude, latitude,
) -> DispatchResult;

// åˆ›å»ºåŠ å¯†å…«å­—å¹¶å­˜å‚¨
fn create_encrypted_chart(
    origin,
    sizhu_index, gender,
    encrypted_data, encrypted_name, data_hash,
) -> DispatchResult;

// ç¼“å­˜è§£ç›˜ç»“æœ
fn cache_interpretation(origin, chart_id) -> DispatchResult;
```

#### Runtime APIï¼ˆå…è´¹ï¼Œä½†éœ€è¦ chart_idï¼‰

```rust
// æŸ¥è¯¢å·²å­˜å‚¨å‘½ç›˜çš„è§£ç›˜
fn get_interpretation(chart_id: u64) -> Option<FullInterpretation>;

// æŸ¥è¯¢å®Œæ•´å‘½ç›˜æ•°æ®
fn get_full_bazi_chart(chart_id: u64) -> Option<String>;
```

### 2.2 æ¶æ„é—®é¢˜

```
å½“å‰æµç¨‹ï¼ˆå¿…é¡»ä»˜è´¹ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¾“å…¥ â”‚â”€â”€â”€â”€â–¶â”‚ åˆ›å»ºäº¤æ˜“    â”‚â”€â”€â”€â”€â–¶â”‚ æŸ¥è¯¢ç»“æœ    â”‚
â”‚ å‡ºç”Ÿæ—¶é—´ â”‚     â”‚ (éœ€è¦Gas)   â”‚     â”‚ (å…è´¹)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
               å­˜å‚¨åˆ°é“¾ä¸Šï¼ˆå ç”¨ç©ºé—´ï¼‰
```

**ç—›ç‚¹**ï¼šæ’ç›˜æ˜¯"è®¡ç®—"ï¼Œå­˜å‚¨æ˜¯"æŒä¹…åŒ–"ï¼Œä½†å½“å‰æ¶æ„å°†ä¸¤è€…å¼ºåˆ¶ç»‘å®šã€‚

---

## ä¸‰ã€è§£å†³æ–¹æ¡ˆè®¾è®¡

### 3.1 æ–°å¢ Runtime API

```rust
/// ä¸´æ—¶æ’ç›˜æ¥å£ï¼ˆä¸å­˜å‚¨ï¼Œä¸æ¶ˆè€— Gasï¼‰
///
/// # å‚æ•°
/// - year: å…¬å†å¹´ä»½ (1900-2100)
/// - month: å…¬å†æœˆä»½ (1-12)
/// - day: å…¬å†æ—¥æœŸ (1-31)
/// - hour: å°æ—¶ (0-23)
/// - minute: åˆ†é’Ÿ (0-59)
/// - gender: æ€§åˆ«
/// - zishi_mode: å­æ—¶æ¨¡å¼ï¼ˆä¼ ç»Ÿæ´¾/ç°ä»£æ´¾ï¼‰
///
/// # è¿”å›
/// - Some(FullBaziChartForApi): å®Œæ•´å‘½ç›˜æ•°æ®
/// - None: è¾“å…¥å‚æ•°æ— æ•ˆ
///
/// # ç‰¹ç‚¹
/// - âœ… å®Œå…¨å…è´¹ï¼ˆçº¯è®¡ç®—ï¼Œä¸ä¸Šé“¾ï¼‰
/// - âœ… å“åº”å¿«é€Ÿï¼ˆ< 100msï¼‰
/// - âŒ ä¸å­˜å‚¨ï¼ˆå…³é—­é¡µé¢åæ•°æ®ä¸¢å¤±ï¼‰
fn calculate_bazi_temp(
    year: u16,
    month: u8,
    day: u8,
    hour: u8,
    minute: u8,
    gender: Gender,
    zishi_mode: ZiShiMode,
) -> Option<FullBaziChartForApi>;
```

### 3.2 å¯é€‰æ‰©å±•æ¥å£

```rust
/// ä¸´æ—¶æ’ç›˜ + è§£ç›˜ï¼ˆä¸€æ¬¡è°ƒç”¨è¿”å›å…¨éƒ¨æ•°æ®ï¼‰
fn calculate_bazi_with_interpretation(
    year: u16,
    month: u8,
    day: u8,
    hour: u8,
    minute: u8,
    gender: Gender,
    zishi_mode: ZiShiMode,
) -> Option<(FullBaziChartForApi, FullInterpretation)>;

/// ä»å†œå†ä¸´æ—¶æ’ç›˜
fn calculate_bazi_from_lunar_temp(
    lunar_year: u16,
    lunar_month: u8,
    lunar_day: u8,
    is_leap_month: bool,
    hour: u8,
    minute: u8,
    gender: Gender,
    zishi_mode: ZiShiMode,
) -> Option<FullBaziChartForApi>;

/// ä»å››æŸ±ç›´æ¥ä¸´æ—¶æ’ç›˜
fn calculate_bazi_from_sizhu_temp(
    year_gz: u8,    // å¹´æŸ±ç´¢å¼• 0-59
    month_gz: u8,   // æœˆæŸ±ç´¢å¼• 0-59
    day_gz: u8,     // æ—¥æŸ±ç´¢å¼• 0-59
    hour_gz: u8,    // æ—¶æŸ±ç´¢å¼• 0-59
    gender: Gender,
) -> Option<FullBaziChartForApi>;
```

### 3.3 æ–°æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å…«å­—æ’ç›˜ç³»ç»Ÿ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  ä¸´æ—¶æ’ç›˜        â”‚         â”‚  æ°¸ä¹…å­˜å‚¨                     â”‚  â”‚
â”‚   â”‚  (Runtime API)  â”‚         â”‚  (Extrinsic)                â”‚  â”‚
â”‚   â”‚                 â”‚         â”‚                             â”‚  â”‚
â”‚   â”‚  calculate_     â”‚ â”€â”€æƒ³ä¿å­˜â†’â”‚  create_bazi_chart()       â”‚  â”‚
â”‚   â”‚  bazi_temp()    â”‚         â”‚                             â”‚  â”‚
â”‚   â”‚                 â”‚         â”‚  éœ€è¦ Gas âœ“                  â”‚  â”‚
â”‚   â”‚  å…è´¹ âœ“         â”‚         â”‚  é“¾ä¸Šå­˜å‚¨ âœ“                  â”‚  â”‚
â”‚   â”‚  ä¸å­˜å‚¨ âœ“       â”‚         â”‚  å¯æŸ¥è¯¢ âœ“                    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€å¯è¡Œæ€§åˆ†æ

### 4.1 æŠ€æœ¯å¯è¡Œæ€§

| æŒ‡æ ‡ | è¯„ä¼° | è¯´æ˜ |
|------|------|------|
| **Runtime API æ”¯æŒ** | âœ… | Substrate Runtime API æœ¬èº«å°±æ˜¯çº¯è®¡ç®—æ¥å£ |
| **Gas è´¹ç”¨** | âœ… å…è´¹ | Runtime API è°ƒç”¨ä¸æ¶ˆè€— gasï¼Œä¸ä¸Šé“¾ |
| **è®¡ç®—å¤æ‚åº¦** | âœ… | æ’ç›˜è®¡ç®— < 1msï¼Œä¸ä¼šé˜»å¡èŠ‚ç‚¹ |
| **ä»£ç å¤ç”¨** | âœ… | å¤ç”¨ç°æœ‰ `build_sizhu`ã€`calculate_dayun` ç­‰å‡½æ•° |

### 4.2 å®‰å…¨æ€§åˆ†æ

| é£é™©ç‚¹ | é£é™©ç­‰çº§ | ç¼“è§£æªæ–½ |
|--------|---------|---------|
| **DoS æ”»å‡»** | ä½ | RPC å±‚é™æµï¼ˆå¦‚ 10 æ¬¡/åˆ†é’Ÿ/IPï¼‰ |
| **çŠ¶æ€ç¯¡æ”¹** | æ—  | Runtime API åªè¯»ï¼Œä¸ä¿®æ”¹é“¾ä¸ŠçŠ¶æ€ |
| **èµ„æºè€—å°½** | ä½ | å•æ¬¡è®¡ç®— < 1msï¼Œå¯è®¾ç½®è¶…æ—¶ |

### 4.3 æ€§èƒ½åˆ†æ

```
æ’ç›˜è®¡ç®—æ—¶é—´åˆ†è§£ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¡ç®—é¡¹                       â”‚ è€—æ—¶     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å››æŸ±è®¡ç®—                     â”‚ < 100Î¼s  â”‚
â”‚ å¤§è¿æ¨ç®—                     â”‚ < 200Î¼s  â”‚
â”‚ äº”è¡Œå¼ºåº¦                     â”‚ < 50Î¼s   â”‚
â”‚ ç¥ç…è®¡ç®—                     â”‚ < 100Î¼s  â”‚
â”‚ ç©ºäº¡åˆ¤æ–­                     â”‚ < 10Î¼s   â”‚
â”‚ è§£ç›˜è®¡ç®—                     â”‚ < 50Î¼s   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ€»è®¡                         â”‚ < 1ms    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€ä¸šåŠ¡åˆç†æ€§åˆ†æ

### 5.1 ä¼˜ç‚¹

1. **é™ä½ä½¿ç”¨é—¨æ§›**
   - ç”¨æˆ·å¯ä»¥å…è´¹è¯•ç”¨
   - å†³å®šè¦ä¿å­˜æ—¶å†ä»˜è´¹å­˜å‚¨

2. **èŠ‚çœé“¾ä¸Šå­˜å‚¨**
   - å¤§é‡"åªæ˜¯çœ‹çœ‹"çš„éœ€æ±‚ä¸å†å ç”¨é“¾ä¸Šç©ºé—´
   - å‡å°‘å­˜å‚¨è†¨èƒ€

3. **ç¬¦åˆä¸šåŠ¡é€»è¾‘**
   - æ’ç›˜æ˜¯"è®¡ç®—"
   - å­˜å‚¨æ˜¯"æŒä¹…åŒ–"
   - åˆ†ç¦»åˆç†

4. **æå‡ç”¨æˆ·ä½“éªŒ**
   - å³æ—¶åé¦ˆï¼Œæ— éœ€ç­‰å¾…äº¤æ˜“ç¡®è®¤
   - å‰ç«¯ç®€åŒ–ï¼Œæ— éœ€"å…ˆåˆ›å»ºå†æŸ¥è¯¢"æµç¨‹

### 5.2 å•†ä¸šæ¨¡å¼å…¼å®¹æ€§

| å•†ä¸šåœºæ™¯ | å½±å“ | è¯´æ˜ |
|---------|------|------|
| **å…è´¹è¯•ç”¨** | âœ… æ”¯æŒ | ä¸´æ—¶æ’ç›˜å…è´¹ |
| **ä»˜è´¹å­˜å‚¨** | âœ… ä¸å˜ | æ°¸ä¹…ä¿å­˜ä»éœ€ gas |
| **VIP åŠŸèƒ½** | âœ… å¯æ‰©å±• | å¯é™åˆ¶ä¸´æ—¶æ’ç›˜æ¬¡æ•°æˆ–åŠŸèƒ½ |
| **NFT é“¸é€ ** | âœ… ä¸å˜ | åªæœ‰å­˜å‚¨çš„å‘½ç›˜æ‰èƒ½é“¸é€  |

---

## å…­ã€å®ç°æ–¹æ¡ˆ

### 6.1 æ¥å£å®šä¹‰ï¼ˆruntime_api.rsï¼‰

```rust
sp_api::decl_runtime_apis! {
    pub trait BaziChartApi<AccountId>
    where
        AccountId: Codec,
    {
        // ... ç°æœ‰æ¥å£ ...

        /// ä¸´æ—¶æ’ç›˜ï¼ˆä¸å­˜å‚¨ï¼Œå…è´¹ï¼‰
        ///
        /// # å‚æ•°
        /// - year: å…¬å†å¹´ä»½ (1900-2100)
        /// - month: å…¬å†æœˆä»½ (1-12)
        /// - day: å…¬å†æ—¥æœŸ (1-31)
        /// - hour: å°æ—¶ (0-23)
        /// - minute: åˆ†é’Ÿ (0-59)
        /// - gender: æ€§åˆ« (0=Male, 1=Female)
        /// - zishi_mode: å­æ—¶æ¨¡å¼ (0=Traditional, 1=Modern)
        ///
        /// # è¿”å›
        /// - Some(String): JSON æ ¼å¼çš„å®Œæ•´å‘½ç›˜æ•°æ®
        /// - None: è¾“å…¥å‚æ•°æ— æ•ˆ
        fn calculate_bazi_temp(
            year: u16,
            month: u8,
            day: u8,
            hour: u8,
            minute: u8,
            gender: u8,
            zishi_mode: u8,
        ) -> Option<String>;
    }
}
```

### 6.2 å®ç°é€»è¾‘ï¼ˆlib.rsï¼‰

```rust
impl<T: Config> Pallet<T> {
    /// ä¸´æ—¶æ’ç›˜ï¼ˆä¸å­˜å‚¨ï¼‰
    pub fn calculate_bazi_temp_impl(
        year: u16,
        month: u8,
        day: u8,
        hour: u8,
        minute: u8,
        gender: Gender,
        zishi_mode: ZiShiMode,
    ) -> Option<FullBaziChartForApi> {
        // 1. éªŒè¯è¾“å…¥å‚æ•°
        if year < 1900 || year > 2100 { return None; }
        if month < 1 || month > 12 { return None; }
        if day < 1 || day > 31 { return None; }
        if hour >= 24 { return None; }
        if minute >= 60 { return None; }

        // 2. è®¡ç®—å››æŸ±ï¼ˆå¤ç”¨ç°æœ‰é€»è¾‘ï¼‰
        use crate::calculations::*;

        let day_ganzhi = calculate_day_ganzhi(year, month, day)?;
        let year_ganzhi = calculate_year_ganzhi(year, month, day)?;
        let month_ganzhi = calculate_month_ganzhi(year, month, day, year_ganzhi.gan.0)?;
        let (hour_ganzhi, _) = calculate_hour_ganzhi(hour, day_ganzhi.gan.0, zishi_mode)?;

        // 3. æ„å»ºå››æŸ±
        let sizhu = Self::build_sizhu_temp(year_ganzhi, month_ganzhi, day_ganzhi, hour_ganzhi)?;

        // 4. è®¡ç®—å¤§è¿
        let dayun = Self::calculate_dayun_temp(&sizhu, year, gender)?;

        // 5. è®¡ç®—å…¶ä»–ä¿¡æ¯
        let kongwang = crate::kongwang::calculate_all_kongwang_temp(&sizhu);
        let shensha = crate::shensha::calculate_shensha_list_temp(&sizhu);
        let xingyun = crate::xingyun::calculate_xingyun_temp(&sizhu);
        let wuxing = calculate_wuxing_strength(&year_ganzhi, &month_ganzhi, &day_ganzhi, &hour_ganzhi);
        let xiyong = determine_xiyong_shen(&wuxing, day_ganzhi.gan);

        // 6. ç»„è£…è¿”å›ç»“æœ
        Some(FullBaziChartForApi {
            chart_id: 0,  // ä¸´æ—¶å‘½ç›˜ï¼ŒID ä¸º 0
            owner: [0u8; 32],  // æ— æ‰€æœ‰è€…
            birth_time: BirthTime { year, month, day, hour, minute },
            // ... å…¶ä»–å­—æ®µ
        })
    }
}
```

### 6.3 Runtime æ³¨å†Œï¼ˆruntime/src/apis.rsï¼‰

```rust
impl_runtime_apis! {
    impl pallet_bazi::runtime_api::BaziChartApi<Block, AccountId> for Runtime {
        // ... ç°æœ‰å®ç° ...

        fn calculate_bazi_temp(
            year: u16,
            month: u8,
            day: u8,
            hour: u8,
            minute: u8,
            gender: u8,
            zishi_mode: u8,
        ) -> Option<String> {
            let gender = match gender {
                0 => pallet_bazi::types::Gender::Male,
                1 => pallet_bazi::types::Gender::Female,
                _ => return None,
            };
            let zishi_mode = match zishi_mode {
                0 => pallet_bazi::types::ZiShiMode::Traditional,
                1 => pallet_bazi::types::ZiShiMode::Modern,
                _ => return None,
            };

            pallet_bazi::Pallet::<Runtime>::calculate_bazi_temp_impl(
                year, month, day, hour, minute, gender, zishi_mode
            ).map(|chart| serde_json::to_string(&chart).ok()).flatten()
        }
    }
}
```

### 6.4 å‰ç«¯è°ƒç”¨ç¤ºä¾‹

```typescript
// ä¸´æ—¶æ’ç›˜ï¼ˆå…è´¹ï¼Œä¸å­˜å‚¨ï¼‰
const tempChart = await api.call.baziChartApi.calculateBaziTemp(
  1990,  // year
  5,     // month
  15,    // day
  14,    // hour
  30,    // minute
  0,     // gender: 0=Male, 1=Female
  1,     // zishi_mode: 0=Traditional, 1=Modern
);

if (tempChart.isSome) {
  const chart = JSON.parse(tempChart.unwrap());
  console.log('å››æŸ±:', chart.sizhu);
  console.log('å¤§è¿:', chart.dayun);
  console.log('ç¥ç…:', chart.shenshaList);

  // ç”¨æˆ·å†³å®šä¿å­˜
  if (userWantsToSave) {
    // è°ƒç”¨äº¤æ˜“åˆ›å»ºæ°¸ä¹…å‘½ç›˜
    await api.tx.baziChart.createBaziChart(
      1990, 5, 15, 14, 30,
      { Male: null },
      { Modern: null },
      null, null
    ).signAndSend(account);
  }
}
```

---

## ä¸ƒã€å‰ç«¯é›†æˆå»ºè®®

### 7.1 ç”¨æˆ·æµç¨‹ä¼˜åŒ–

```
æ–°ç”¨æˆ·æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å…¥æ—¶é—´ â”‚â”€â”€â”€â”€â–¶â”‚ ä¸´æ—¶æ’ç›˜    â”‚â”€â”€â”€â”€â–¶â”‚ æŸ¥çœ‹ç»“æœ    â”‚â”€â”€â”€â”€â–¶â”‚ æ˜¯å¦ä¿å­˜ï¼Ÿ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ (å…è´¹)      â”‚     â”‚ (å³æ—¶æ˜¾ç¤º)  â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                                                               â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚                                 â”‚
                                              â–¼                                 â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ å¦ï¼šå…³é—­    â”‚                   â”‚ æ˜¯ï¼šä»˜è´¹å­˜å‚¨ â”‚
                                    â”‚ (æ•°æ®ä¸¢å¤±)  â”‚                   â”‚ (æ°¸ä¹…ä¿å­˜)  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 UI å»ºè®®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…«å­—æ’ç›˜                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  å‡ºç”Ÿæ—¶é—´ï¼š1990å¹´5æœˆ15æ—¥ 14:30                  â”‚
â”‚  æ€§åˆ«ï¼šç”·                                       â”‚
â”‚  å­æ—¶æ¨¡å¼ï¼šç°ä»£æ´¾                               â”‚
â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   ä¸´æ—¶æ’ç›˜   â”‚  â”‚   ä¿å­˜å‘½ç›˜   â”‚           â”‚
â”‚  â”‚   (å…è´¹)    â”‚  â”‚  (éœ€è¦Gas)   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                â”‚
â”‚  ğŸ’¡ ä¸´æ—¶æ’ç›˜å…è´¹ï¼Œç»“æœä¸ä¿å­˜                    â”‚
â”‚     ä¿å­˜åå¯éšæ—¶æŸ¥çœ‹ã€é“¸é€ NFT                   â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…«ã€æ€»ç»“ä¸å»ºè®®

### 8.1 ç»“è®º

| è¯„ä¼°ç»´åº¦ | ç»“è®º | è¯´æ˜ |
|---------|------|------|
| **æŠ€æœ¯å¯è¡Œæ€§** | âœ… å®Œå…¨å¯è¡Œ | Runtime API æ”¯æŒçº¯è®¡ç®—ï¼Œæ— éœ€ gas |
| **ä¸šåŠ¡åˆç†æ€§** | âœ… éå¸¸åˆç† | è¯•ç”¨å…è´¹ã€å­˜å‚¨ä»˜è´¹ï¼Œç¬¦åˆç”¨æˆ·é¢„æœŸ |
| **å®‰å…¨æ€§** | âœ… æ— é£é™© | åªè¯»æ“ä½œï¼Œå¯é€šè¿‡é™æµé˜²æ»¥ç”¨ |
| **å®ç°éš¾åº¦** | âœ… è¾ƒä½ | å¤ç”¨ç°æœ‰è®¡ç®—é€»è¾‘ |

### 8.2 å»ºè®®

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šå®ç°åŸºç¡€ `calculate_bazi_temp` æ¥å£
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šæ·»åŠ å†œå†ã€å››æŸ±ç›´æ¥è¾“å…¥ç­‰æ‰©å±•æ¥å£
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šå‰ç«¯ä¼˜åŒ–ï¼Œæä¾›æ›´å¥½çš„"è¯•ç”¨â†’ä¿å­˜"ç”¨æˆ·ä½“éªŒ

### 8.3 é¢„æœŸæ”¶ç›Š

- **ç”¨æˆ·è½¬åŒ–ç‡æå‡**ï¼šå…è´¹è¯•ç”¨é™ä½é—¨æ§›
- **é“¾ä¸Šå­˜å‚¨ä¼˜åŒ–**ï¼šå‡å°‘æ— æ•ˆæ•°æ®å ç”¨
- **ç”¨æˆ·ä½“éªŒæ”¹å–„**ï¼šå³æ—¶åé¦ˆï¼Œæ— éœ€ç­‰å¾…äº¤æ˜“ç¡®è®¤

---

## é™„å½•ï¼šç›¸å…³æ–‡ä»¶

- `pallets/divination/bazi/src/lib.rs` - Pallet ä¸»é€»è¾‘
- `pallets/divination/bazi/src/runtime_api.rs` - Runtime API å®šä¹‰
- `runtime/src/apis.rs` - Runtime API æ³¨å†Œ
- `stardust-dapp/src/services/baziChainService.ts` - å‰ç«¯æœåŠ¡å±‚
