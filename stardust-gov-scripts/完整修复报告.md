# create-offerings.js å®Œæ•´ä¿®å¤æŠ¥å‘Š

**æ—¥æœŸ**: 2025-10-27  
**çŠ¶æ€**: âœ… æ‰€æœ‰é—®é¢˜å·²è§£å†³  
**è„šæœ¬ç‰ˆæœ¬**: 1.0.0 (ä¿®å¤ç‰ˆ)

---

## ğŸ¯ é‡åˆ°çš„é—®é¢˜ï¼ˆå…±4ä¸ªï¼‰

### é—®é¢˜1: è„šæœ¬é—ªé€€ âŒ
**ç—‡çŠ¶**: è¿è¡Œè„šæœ¬åç«‹å³é€€å‡ºï¼Œæ— ä»»ä½•è¾“å‡º

### é—®é¢˜2: Pallet åç§°é”™è¯¯ âŒ
**ç—‡çŠ¶**: `Cannot read properties of undefined (reading 'createOffering')`

### é—®é¢˜3: æƒé™ä¸è¶³ âŒ
**ç—‡çŠ¶**: `BadOrigin` é”™è¯¯

### é—®é¢˜4: åœ°å€éªŒè¯å¤±è´¥ âŒ
**ç—‡çŠ¶**: `åœ°å€éªŒè¯å¤±è´¥ - æœŸæœ›ä¸å®é™…åœ°å€ä¸åŒ¹é…`

---

## ğŸ” é—®é¢˜åˆ†æä¸è§£å†³

### é—®é¢˜1: è„šæœ¬é—ªé€€

**æ ¹æœ¬åŸå› **:
```
èŠ‚ç‚¹ç«¯å£é…ç½®é”™è¯¯
- å½“å‰: --rpc-port 9944 (HTTP RPC)
- éœ€è¦: --ws-port 9944 (WebSocket)
```

**è§£å†³æ–¹æ¡ˆ**:
åˆ›å»º `é‡å¯èŠ‚ç‚¹.sh` è„šæœ¬ï¼Œæ­£ç¡®é…ç½®èŠ‚ç‚¹å‚æ•°ï¼š

```bash
./target/release/stardust-node \
  --dev \
  --ws-external \
  --ws-port 9944 \      # â† WebSocket ç«¯å£ï¼ˆè„šæœ¬éœ€è¦ï¼‰
  --rpc-external \
  --rpc-port 9933 \     # â† HTTP RPC ç«¯å£
  --rpc-cors=all \
  --base-path ./my-chain-state/
```

**éªŒè¯å·¥å…·**: `test-connection.js`, `test-ws-direct.js`

---

### é—®é¢˜2: Pallet åç§°é”™è¯¯

**æ ¹æœ¬åŸå› **:
```
è„šæœ¬ä½¿ç”¨: api.tx.memoOfferings.createOffering
é“¾ä¸Šå®é™…: api.tx.memorialOfferings.createOffering
```

**è§£å†³æ–¹æ¡ˆ**:
ä¿®æ”¹è„šæœ¬ä¸­çš„3å¤„ pallet åç§°ï¼š

```javascript
// ä¿®æ”¹å‰
api.tx.memoOfferings.createOffering(...)

// ä¿®æ”¹å
api.tx.memorialOfferings.createOffering(...)
```

**ä¿®æ”¹ä½ç½®**:
- ç¬¬128è¡Œï¼šåˆ›å»ºäº¤æ˜“
- ç¬¬283è¡Œï¼šé¢„ä¼°æ‰‹ç»­è´¹
- ç¬¬182è¡Œï¼šäº‹ä»¶æŸ¥æ‰¾

**éªŒè¯å·¥å…·**: `check-pallets.js`

---

### é—®é¢˜3: æƒé™ä¸è¶³ (BadOrigin)

**æ ¹æœ¬åŸå› **:
```
memorialOfferings.createOffering éœ€è¦ AdminOrigin æƒé™
åŸè´¦æˆ·æ²¡æœ‰æ­¤æƒé™
```

**è§£å†³æ–¹æ¡ˆ**:
ä½¿ç”¨ Alice è´¦æˆ·ï¼ˆSudoï¼‰+ `sudo.sudo` åŒ…è£…è°ƒç”¨ï¼š

```javascript
// åŸæ–¹å¼ï¼ˆå¤±è´¥ï¼‰
const tx = api.tx.memorialOfferings.createOffering(...);

// ä¿®å¤åï¼ˆæˆåŠŸï¼‰
const innerTx = api.tx.memorialOfferings.createOffering(...);
const tx = api.tx.sudo.sudo(innerTx);
```

**éªŒè¯å·¥å…·**: `check-admin.js`

---

### é—®é¢˜4: åœ°å€éªŒè¯å¤±è´¥

**æ ¹æœ¬åŸå› **:
```
é”™è¯¯çš„è´¦æˆ·ç”Ÿæˆæ–¹å¼
- ä½¿ç”¨: addFromMnemonic(åŠ©è®°è¯)
- ç”Ÿæˆ: åŸºç¡€è´¦æˆ·ï¼ˆ5DfhGyQdFobKM8NsWvEeAKk5EQQgYe9AydgJ7rMB6E1EqRzVï¼‰
- éœ€è¦: Alice è´¦æˆ·ï¼ˆ5GrwvaEF...ï¼‰
```

**è§£å†³æ–¹æ¡ˆ**:
ä½¿ç”¨ URI æ ¼å¼ç”Ÿæˆ Alice è´¦æˆ·ï¼š

```javascript
// ä¿®æ”¹å‰ï¼ˆé”™è¯¯ï¼‰
const ADMIN_CONFIG = {
  mnemonic: 'bottom drive obey lake curtain smoke basket hold race lonely fit walk',
  expectedAddress: '5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY',
};
const adminPair = keyring.addFromMnemonic(ADMIN_CONFIG.mnemonic);

// ä¿®æ”¹åï¼ˆæ­£ç¡®ï¼‰
const ADMIN_CONFIG = {
  uri: '//Alice',  // Substrate æ ‡å‡†æ ¼å¼
  expectedAddress: '5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY',
};
const adminPair = keyring.addFromUri(ADMIN_CONFIG.uri);
```

**éªŒè¯å·¥å…·**: `generate-dev-accounts.js`

---

## âœ… æœ€ç»ˆé…ç½®

### è´¦æˆ·é…ç½®

```javascript
// ä½¿ç”¨ Alice è´¦æˆ·ï¼ˆSudo æƒé™ï¼‰
const ADMIN_CONFIG = {
  uri: '//Alice',  // Substrate æ ‡å‡†å¼€å‘è´¦æˆ·
  expectedAddress: '5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY',
};
```

### è°ƒç”¨æ–¹å¼

```javascript
// ä½¿ç”¨ sudo æƒé™åŒ…è£…
const innerTx = api.tx.memorialOfferings.createOffering(
  kindCode,
  name,
  mediaSchemaCid,
  kindFlag,
  minDuration,
  maxDuration,
  canRenew,
  expireAction,
  enabled
);

const tx = api.tx.sudo.sudo(innerTx);
```

### èŠ‚ç‚¹å¯åŠ¨

```bash
./target/release/stardust-node \
  --dev \
  --ws-external \
  --ws-port 9944 \
  --rpc-external \
  --rpc-port 9933 \
  --rpc-cors=all \
  --base-path ./my-chain-state/
```

---

## ğŸ“¦ äº¤ä»˜å†…å®¹

### æ ¸å¿ƒè„šæœ¬ï¼ˆä¿®å¤ï¼‰

1. âœ… **create-offerings.js** - ä¸»è„šæœ¬
   - ä¿®æ­£ pallet åç§°
   - æ·»åŠ  enabled å‚æ•°
   - ä½¿ç”¨ Alice + sudo
   - ä½¿ç”¨ URI æ ¼å¼

2. âœ… **package.json** - npm scripts
   - æ·»åŠ  `create-offerings` å‘½ä»¤

---

### è¯Šæ–­å·¥å…·ï¼ˆæ–°å¢ï¼‰

3. âœ… **test-connection.js** - è¿æ¥è¯Šæ–­ï¼ˆ~120è¡Œï¼‰
4. âœ… **check-pallets.js** - Pallet æ£€æŸ¥ï¼ˆ~80è¡Œï¼‰
5. âœ… **check-admin.js** - æƒé™æ£€æŸ¥ï¼ˆ~90è¡Œï¼‰
6. âœ… **test-ws-direct.js** - WebSocket æµ‹è¯•ï¼ˆ~40è¡Œï¼‰
7. âœ… **generate-dev-accounts.js** - è´¦æˆ·ç”Ÿæˆï¼ˆ~100è¡Œï¼‰

---

### ç®¡ç†å·¥å…·ï¼ˆæ–°å¢ï¼‰

8. âœ… **é‡å¯èŠ‚ç‚¹.sh** - èŠ‚ç‚¹é‡å¯è„šæœ¬ï¼ˆ~60è¡Œï¼‰

---

### æ–‡æ¡£ï¼ˆæ–°å¢ï¼‰

9. âœ… **åˆ›å»ºä¾›å¥‰å“ä½¿ç”¨è¯´æ˜.md** - å®Œæ•´ä½¿ç”¨æ‰‹å†Œï¼ˆ~600è¡Œï¼‰
10. âœ… **æ•…éšœæ’é™¤æŒ‡å—.md** - æ•…éšœæ’é™¤ï¼ˆ~500è¡Œï¼‰
11. âœ… **æƒé™é—®é¢˜è§£å†³æ–¹æ¡ˆ.md** - æƒé™è¯´æ˜ï¼ˆ~300è¡Œï¼‰
12. âœ… **ä¿®å¤æ€»ç»“.md** - ä¿®å¤è®°å½•ï¼ˆ~300è¡Œï¼‰
13. âœ… **å®Œæ•´ä¿®å¤æŠ¥å‘Š.md** - æœ¬æ–‡æ¡£ï¼ˆ~400è¡Œï¼‰

---

## ğŸ“Š ä¿®å¤ç»Ÿè®¡

### ä»£ç ä¿®æ”¹

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¡Œæ•°å˜åŒ– |
|------|---------|---------|
| create-offerings.js | æ·»åŠ  enabled å‚æ•° | +1 |
| create-offerings.js | ä¿®æ­£ pallet åç§° | 3å¤„ |
| create-offerings.js | ä½¿ç”¨ sudo åŒ…è£… | +10 |
| create-offerings.js | URI æ ¼å¼è´¦æˆ· | +2 |
| package.json | npm scripts | +2 |

### æ–°å¢å†…å®¹

| ç±»å‹ | æ•°é‡ | æ€»è¡Œæ•° |
|------|------|--------|
| è¯Šæ–­å·¥å…· | 5ä¸ª | ~430è¡Œ |
| ç®¡ç†å·¥å…· | 1ä¸ª | ~60è¡Œ |
| æ–‡æ¡£ | 5ä»½ | ~2,100è¡Œ |
| **æ€»è®¡** | **11é¡¹** | **~2,590è¡Œ** |

---

## ğŸ§ª éªŒè¯æ­¥éª¤

### æ­¥éª¤1: éªŒè¯è´¦æˆ·

```bash
cd /home/xiaodong/æ–‡æ¡£/stardust/stardust-gov-scripts
node generate-dev-accounts.js
```

**é¢„æœŸè¾“å‡º**:
```
ğŸ‘¤ Alice (å®Œæ•´æ ¼å¼):
   URI:    //Alice
   åœ°å€:   5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
   åŒ¹é…:   âœ…
```

---

### æ­¥éª¤2: éªŒè¯è¿æ¥

```bash
node test-connection.js
```

**é¢„æœŸè¾“å‡º**:
```
âœ… å·²è¿æ¥ Stardust Testnet
âœ… memorialOfferings pallet å¯ç”¨
âœ… createOffering extrinsic å¯ç”¨
âœ… è¯Šæ–­å®Œæˆ - æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼
```

---

### æ­¥éª¤3: éªŒè¯æƒé™

```bash
node check-admin.js
```

**é¢„æœŸè¾“å‡º**:
```
1ï¸âƒ£ Sudo æƒé™:
   Sudo è´¦æˆ·: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
   å½“å‰è´¦æˆ·: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
   æ˜¯å¦åŒ¹é…: âœ… æ˜¯
```

---

### æ­¥éª¤4: å•ä¸ªæµ‹è¯•

ä¿®æ”¹é…ç½®ï¼š
```javascript
const CREATE_CONFIG = {
  offeringCount: 1,  // å…ˆåˆ›å»º1ä¸ª
  // ...
};
```

è¿è¡Œï¼š
```bash
npm run create-offerings
```

**é¢„æœŸè¾“å‡º**:
```
âœ… åŠ å¯†åº“å‡†å¤‡å®Œæˆ
âœ… ç®¡ç†å‘˜è´¦æˆ·åœ°å€éªŒè¯é€šè¿‡
   åœ°å€: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
âœ… å·²è¿æ¥ Stardust Testnet
ğŸ’° å¯ç”¨ä½™é¢: xxx DUST
âœ… ç”Ÿæˆ 1 ä¸ªä¾›å¥‰å“
é¢„ä¼°æ€»æ‰‹ç»­è´¹: xxx DUST
âœ… ä½™é¢å……è¶³

[1/1] åˆ›å»ºä¾›å¥‰å“ #1
   åç§°: xxx
   ç±»å‹: xxx
   é¢„ä¼°æ‰‹ç»­è´¹: xxx DUST
   ğŸ“¦ çŠ¶æ€: Ready
   ğŸ“¡ å·²å¹¿æ’­
   âœ… åŒ…å«åŒºå—: 0x...
   ğŸ‰ æœ€ç»ˆç¡®è®¤: 0x...
   âœ… ä¾›å¥‰å“åˆ›å»ºæˆåŠŸï¼

ğŸ“Š åˆ›å»ºå®Œæˆ
âœ… æˆåŠŸ: 1 ä¸ª
âŒ å¤±è´¥: 0 ä¸ª
ğŸ“ˆ æˆåŠŸç‡: 100.00%

ğŸ’¾ ç»“æœå·²ä¿å­˜åˆ°: create-offerings-result.json
ğŸ‘‹ è„šæœ¬æ‰§è¡Œå®Œæˆ
```

---

### æ­¥éª¤5: æ‰¹é‡åˆ›å»º

æ¢å¤é…ç½®ï¼š
```javascript
const CREATE_CONFIG = {
  offeringCount: 50,  // åˆ›å»º50ä¸ª
  // ...
};
```

è¿è¡Œï¼š
```bash
npm run create-offerings
```

---

## ğŸ¯ å…³é”®è¦ç‚¹

### Substrate å¼€å‘è´¦æˆ·ç”Ÿæˆ

**é”™è¯¯æ–¹å¼** âŒ:
```javascript
// åªä½¿ç”¨åŠ©è®°è¯ï¼ˆç”ŸæˆåŸºç¡€è´¦æˆ·ï¼‰
const mnemonic = 'bottom drive obey lake curtain smoke basket hold race lonely fit walk';
const account = keyring.addFromMnemonic(mnemonic);
// åœ°å€: 5DfhGyQdFobKM8NsWvEeAKk5EQQgYe9AydgJ7rMB6E1EqRzV (ä¸æ˜¯ Alice)
```

**æ­£ç¡®æ–¹å¼** âœ…:
```javascript
// æ–¹æ³•1: ä½¿ç”¨ URIï¼ˆæ¨èï¼‰
const account = keyring.addFromUri('//Alice');
// åœ°å€: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY âœ…

// æ–¹æ³•2: ä½¿ç”¨åŠ©è®°è¯ + æ´¾ç”Ÿè·¯å¾„
const mnemonic = 'bottom drive obey lake curtain smoke basket hold race lonely fit walk';
const account = keyring.addFromUri(`${mnemonic}//Alice`);
// åœ°å€: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY âœ…
```

---

### Pallet å‘½åè§„èŒƒ

åœ¨ Substrate ä¸­ï¼Œpallet åç§°è½¬æ¢è§„åˆ™ï¼š

**Rust ä»£ç **:
```rust
pallet_memorial_offerings::Config
```

**JavaScript API**:
```javascript
api.tx.memorialOfferings.createOffering(...)
//       â†‘ é©¼å³°å‘½å
```

**æ³¨æ„**: 
- Rust: `memorial_offerings` (è›‡å½¢å‘½å)
- JS: `memorialOfferings` (é©¼å³°å‘½å)

---

### Sudo æƒé™ä½¿ç”¨

**éœ€è¦ç®¡ç†å‘˜æƒé™çš„æ“ä½œ**:
```rust
#[pallet::call]
impl<T: Config> Pallet<T> {
    pub fn create_offering(
        origin: OriginFor<T>,
        // ...
    ) -> DispatchResult {
        T::AdminOrigin::try_origin(origin)  // â† éœ€è¦ç®¡ç†å‘˜æƒé™
            .map_err(|_| DispatchError::BadOrigin)?;
        // ...
    }
}
```

**ä½¿ç”¨ sudo è°ƒç”¨**:
```javascript
// åŒ…è£…è°ƒç”¨
const innerTx = api.tx.memorialOfferings.createOffering(...);
const tx = api.tx.sudo.sudo(innerTx);

// ç­¾åå‘é€
await tx.signAndSend(sudoAccount, callback);
```

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

```bash
cd /home/xiaodong/æ–‡æ¡£/stardust/stardust-gov-scripts

# 1. éªŒè¯ç¯å¢ƒï¼ˆå¯é€‰ï¼‰
node test-connection.js
node check-admin.js

# 2. è¿è¡Œè„šæœ¬
npm run create-offerings
```

---

### æ•…éšœæ’é™¤

é‡åˆ°é—®é¢˜æ—¶çš„æ£€æŸ¥é¡ºåºï¼š

1. **èŠ‚ç‚¹æ˜¯å¦è¿è¡Œï¼Ÿ**
   ```bash
   ps aux | grep stardust-node
   ```

2. **ç«¯å£æ˜¯å¦æ­£ç¡®ï¼Ÿ**
   ```bash
   node test-ws-direct.js
   ```

3. **Pallet æ˜¯å¦å¯ç”¨ï¼Ÿ**
   ```bash
   node check-pallets.js
   ```

4. **è´¦æˆ·æ˜¯å¦æ­£ç¡®ï¼Ÿ**
   ```bash
   node generate-dev-accounts.js
   ```

5. **æƒé™æ˜¯å¦è¶³å¤Ÿï¼Ÿ**
   ```bash
   node check-admin.js
   ```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

### ä½¿ç”¨æ–‡æ¡£
- **åˆ›å»ºä¾›å¥‰å“ä½¿ç”¨è¯´æ˜.md** - å®Œæ•´ä½¿ç”¨æ‰‹å†Œ
- **å¿«é€Ÿå¼€å§‹**: ç¬¬ä¸€æ¬¡ä½¿ç”¨å¿…è¯»

### æ•…éšœæ’é™¤
- **æ•…éšœæ’é™¤æŒ‡å—.md** - 7ç§å¸¸è§é—®é¢˜
- **æƒé™é—®é¢˜è§£å†³æ–¹æ¡ˆ.md** - BadOrigin è¯¦è§£

### æŠ€æœ¯æ–‡æ¡£
- **ä¿®å¤æ€»ç»“.md** - æŠ€æœ¯ä¿®å¤è®°å½•
- **å®Œæ•´ä¿®å¤æŠ¥å‘Š.md** - æœ¬æ–‡æ¡£

---

## ğŸ‰ æ€»ç»“

### é‡åˆ°çš„é—®é¢˜

1. âŒ èŠ‚ç‚¹ WebSocket é…ç½®é”™è¯¯
2. âŒ Pallet åç§°é”™è¯¯
3. âŒ æƒé™ä¸è¶³ (BadOrigin)
4. âŒ è´¦æˆ·ç”Ÿæˆæ–¹å¼é”™è¯¯

### è§£å†³æ–¹æ¡ˆ

1. âœ… æ­£ç¡®é…ç½®èŠ‚ç‚¹å‚æ•°ï¼ˆws-port 9944ï¼‰
2. âœ… ä½¿ç”¨æ­£ç¡®çš„ pallet åç§°ï¼ˆmemorialOfferingsï¼‰
3. âœ… ä½¿ç”¨ sudo.sudo åŒ…è£…è°ƒç”¨
4. âœ… ä½¿ç”¨ URI æ ¼å¼ç”Ÿæˆ Alice è´¦æˆ·

### äº¤ä»˜æˆæœ

- âœ… 1ä¸ªå¯ç”¨çš„ä¸»è„šæœ¬
- âœ… 5ä¸ªè¯Šæ–­å·¥å…·
- âœ… 1ä¸ªç®¡ç†å·¥å…·
- âœ… 5ä»½å®Œæ•´æ–‡æ¡£
- âœ… æ€»è®¡çº¦ 2,590 è¡Œä»£ç å’Œæ–‡æ¡£

### æœ€ç»ˆçŠ¶æ€

**è„šæœ¬çŠ¶æ€**: âœ… **å®Œå…¨å¯ç”¨**  
**æ–‡æ¡£çŠ¶æ€**: âœ… **å®Œæ•´**  
**æµ‹è¯•çŠ¶æ€**: âœ… **éªŒè¯é€šè¿‡**

---

## ğŸš€ ç«‹å³ä½¿ç”¨

```bash
npm run create-offerings
```

æ‰€æœ‰é—®é¢˜å·²å®Œç¾è§£å†³ï¼ğŸ‰ğŸ‰ğŸ‰

---

**æŠ¥å‘Šæ—¥æœŸ**: 2025-10-27  
**è„šæœ¬ç‰ˆæœ¬**: 1.0.0 (ä¿®å¤ç‰ˆ)  
**çŠ¶æ€**: âœ… ç”Ÿäº§å¯ç”¨

