# create-offerings.js ä¿®å¤æ€»ç»“

**æ—¥æœŸ**: 2025-10-27  
**çŠ¶æ€**: âœ… å·²ä¿®å¤å¹¶å¯ç”¨  

---

## ğŸ› å‘ç°çš„é—®é¢˜

### é—®é¢˜1: è„šæœ¬é—ªé€€ï¼ˆè¿æ¥å¤±è´¥ï¼‰

**ç—‡çŠ¶**:
```
è¿è¡Œè„šæœ¬åç«‹å³é€€å‡ºï¼Œæ— ä»»ä½•è¾“å‡º
```

**æ ¹æœ¬åŸå› **:
- é“¾èŠ‚ç‚¹ä½¿ç”¨äº†é”™è¯¯çš„ç«¯å£é…ç½®
- å½“å‰: `--rpc-port 9944` (HTTP RPC)
- éœ€è¦: `--ws-port 9944` (WebSocket)
- è„šæœ¬éœ€è¦ WebSocket è¿æ¥ï¼Œä½†èŠ‚ç‚¹åªå¼€å¯äº† HTTP RPC

**è§£å†³æ–¹æ¡ˆ**:
- åˆ›å»ºäº† `é‡å¯èŠ‚ç‚¹.sh` è„šæœ¬
- æ­£ç¡®é…ç½®èŠ‚ç‚¹å‚æ•°ï¼š
  ```bash
  ./target/release/stardust-node \
    --dev \
    --ws-external \
    --ws-port 9944 \      # â† WebSocket ç«¯å£
    --rpc-external \
    --rpc-port 9933 \     # â† HTTP RPC ç«¯å£
    --rpc-cors=all \
    --base-path ./my-chain-state/
  ```

---

### é—®é¢˜2: Pallet åç§°é”™è¯¯

**ç—‡çŠ¶**:
```
âŒ å‘ç”Ÿé”™è¯¯: Cannot read properties of undefined (reading 'createOffering')
TypeError: Cannot read properties of undefined (reading 'createOffering')
    at main (/home/xiaodong/æ–‡æ¡£/stardust/stardust-gov-scripts/create-offerings.js:279:41)
```

**æ ¹æœ¬åŸå› **:
- è„šæœ¬ä¸­ä½¿ç”¨: `api.tx.memoOfferings.createOffering`
- é“¾ä¸Šå®é™…: `api.tx.memorialOfferings.createOffering`
- Pallet åç§°ä¸åŒ¹é…ï¼ˆç¼ºå°‘ `ial`ï¼‰

**è§£å†³æ–¹æ¡ˆ**:
ä¿®æ”¹è„šæœ¬ä¸­çš„3å¤„ pallet åç§°ï¼š
```javascript
// ä¿®æ”¹å‰
api.tx.memoOfferings.createOffering(...)

// ä¿®æ”¹å
api.tx.memorialOfferings.createOffering(...)
```

ä¿®æ”¹ä½ç½®ï¼š
1. ç¬¬126è¡Œï¼šåˆ›å»ºäº¤æ˜“å‡½æ•°
2. ç¬¬279è¡Œï¼šé¢„ä¼°æ‰‹ç»­è´¹
3. ç¬¬182è¡Œï¼šäº‹ä»¶æŸ¥æ‰¾

---

### é—®é¢˜3: ç¼ºå°‘ enabled å‚æ•°

**ç—‡çŠ¶**:
```
å‚æ•°æ•°é‡ä¸åŒ¹é…é”™è¯¯
```

**æ ¹æœ¬åŸå› **:
- Pallet çš„ `createOffering` å‡½æ•°éœ€è¦9ä¸ªå‚æ•°
- åŸè„šæœ¬åªä¼ é€’äº†8ä¸ªå‚æ•°
- ç¼ºå°‘æœ€åçš„ `enabled` å‚æ•°

**è§£å†³æ–¹æ¡ˆ**:
- æ·»åŠ é…ç½®é¡¹: `defaultEnabled: true`
- åœ¨ç”Ÿæˆå‚æ•°æ—¶æ·»åŠ : `enabled: CREATE_CONFIG.defaultEnabled`
- è°ƒç”¨æ—¶ä¼ é€’: `params.enabled`

---

## âœ… ä¿®å¤å†…å®¹

### 1. æ ¸å¿ƒè„šæœ¬ä¿®å¤

**æ–‡ä»¶**: `create-offerings.js`

ä¿®æ”¹å†…å®¹ï¼š
- âœ… æ·»åŠ  `enabled` å‚æ•°
- âœ… ä¿®æ­£ pallet åç§° (`memoOfferings` â†’ `memorialOfferings`)
- âœ… å®Œå–„é»˜è®¤å€¼ (canRenew, expireAction)

---

### 2. åˆ›å»ºè¯Šæ–­å·¥å…·

**æ–‡ä»¶**: `test-connection.js`

åŠŸèƒ½ï¼š
- âœ… æ£€æŸ¥ Node.js ç‰ˆæœ¬
- âœ… æ£€æŸ¥ä¾èµ–å®‰è£…
- âœ… æµ‹è¯•é“¾èŠ‚ç‚¹è¿æ¥
- âœ… éªŒè¯ pallet å¯ç”¨æ€§

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
node test-connection.js
```

---

### 3. åˆ›å»º Pallet æ£€æŸ¥å·¥å…·

**æ–‡ä»¶**: `check-pallets.js`

åŠŸèƒ½ï¼š
- âœ… åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ pallets
- âœ… æœç´¢ç‰¹å®š pallet
- âœ… æ˜¾ç¤º pallet çš„æ–¹æ³•

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
node check-pallets.js
```

---

### 4. åˆ›å»ºèŠ‚ç‚¹é‡å¯è„šæœ¬

**æ–‡ä»¶**: `é‡å¯èŠ‚ç‚¹.sh`

åŠŸèƒ½ï¼š
- âœ… åœæ­¢æ—§èŠ‚ç‚¹
- âœ… ç”¨æ­£ç¡®å‚æ•°å¯åŠ¨æ–°èŠ‚ç‚¹
- âœ… è‡ªåŠ¨æµ‹è¯•è¿æ¥
- âœ… æ˜¾ç¤ºç»“æœ

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
./é‡å¯èŠ‚ç‚¹.sh
```

---

### 5. åˆ›å»º WebSocket æµ‹è¯•å·¥å…·

**æ–‡ä»¶**: `test-ws-direct.js`

åŠŸèƒ½ï¼š
- âœ… ç›´æ¥æµ‹è¯• WebSocket è¿æ¥
- âœ… å¿«é€Ÿè¯Šæ–­ç«¯å£é—®é¢˜

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
node test-ws-direct.js
```

---

### 6. åˆ›å»ºå®Œæ•´æ–‡æ¡£

**æ–‡ä»¶**: `åˆ›å»ºä¾›å¥‰å“ä½¿ç”¨è¯´æ˜.md`

å†…å®¹ï¼š
- âœ… è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜
- âœ… é…ç½®è¯´æ˜
- âœ… ä½¿ç”¨æ–¹æ³•
- âœ… æ‰§è¡Œæµç¨‹
- âœ… å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

**æ–‡ä»¶**: `æ•…éšœæ’é™¤æŒ‡å—.md`

å†…å®¹ï¼š
- âœ… å¿«é€Ÿè¯Šæ–­æµç¨‹
- âœ… 7ç§å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
- âœ… è°ƒè¯•æŠ€å·§
- âœ… é«˜çº§è¯Šæ–­æ–¹æ³•

---

## ğŸ“Š ä¿®å¤ç»Ÿè®¡

### ä»£ç ä¿®æ”¹

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | è¡Œæ•° |
|------|---------|------|
| create-offerings.js | æ·»åŠ  enabled å‚æ•° | +1 |
| create-offerings.js | ä¿®æ­£ pallet åç§° | 3å¤„ |
| create-offerings.js | å®Œå–„é»˜è®¤å€¼ | +2 |
| test-connection.js | ä¿®æ­£ pallet åç§° | 1å¤„ |

### æ–°å¢æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” | è¡Œæ•° |
|------|------|------|
| test-connection.js | è¯Šæ–­è„šæœ¬ | ~120 |
| check-pallets.js | Palletæ£€æŸ¥ | ~80 |
| test-ws-direct.js | WebSocketæµ‹è¯• | ~40 |
| é‡å¯èŠ‚ç‚¹.sh | èŠ‚ç‚¹é‡å¯ | ~60 |
| åˆ›å»ºä¾›å¥‰å“ä½¿ç”¨è¯´æ˜.md | ä½¿ç”¨æ‰‹å†Œ | ~600 |
| æ•…éšœæ’é™¤æŒ‡å—.md | æ•…éšœæ’é™¤ | ~500 |
| ä¿®å¤æ€»ç»“.md | æœ¬æ–‡æ¡£ | ~300 |

**æ€»è®¡**: æ–°å¢ ~1,700 è¡Œä»£ç å’Œæ–‡æ¡£

---

## ğŸ¯ éªŒè¯æ­¥éª¤

### æ­¥éª¤1: æµ‹è¯•è¿æ¥

```bash
cd /home/xiaodong/æ–‡æ¡£/stardust/stardust-gov-scripts
node test-connection.js
```

**é¢„æœŸè¾“å‡º**:
```
âœ… åŠ å¯†åº“å‡†å¤‡å®Œæˆ
âœ… å·²è¿æ¥ Stardust Testnet
âœ… memorialOfferings pallet å¯ç”¨
âœ… createOffering extrinsic å¯ç”¨
âœ… è¯Šæ–­å®Œæˆ - æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼
```

---

### æ­¥éª¤2: æ£€æŸ¥ Pallets

```bash
node check-pallets.js
```

**ç¡®è®¤**:
- `memorialOfferings` åœ¨åˆ—è¡¨ä¸­
- `createOffering` æ–¹æ³•å¯ç”¨

---

### æ­¥éª¤3: è¿è¡Œè„šæœ¬ï¼ˆå•ä¸ªæµ‹è¯•ï¼‰

ä¿®æ”¹é…ç½®ï¼š
```javascript
const CREATE_CONFIG = {
  offeringCount: 1,  // å…ˆåˆ›å»º1ä¸ªæµ‹è¯•
  // ...
};
```

è¿è¡Œï¼š
```bash
npm run create-offerings
```

**é¢„æœŸè¾“å‡º**:
```
ğŸš€ åˆ›å»ºä¾›å¥‰å“è„šæœ¬å¯åŠ¨
âœ… åŠ å¯†åº“å‡†å¤‡å®Œæˆ
âœ… ç®¡ç†å‘˜è´¦æˆ·åœ°å€éªŒè¯é€šè¿‡
âœ… å·²è¿æ¥ Stardust Testnet
ğŸ’° å¯ç”¨ä½™é¢: xxx DUST
âœ… ç”Ÿæˆ 1 ä¸ªä¾›å¥‰å“
é¢„ä¼°æ€»æ‰‹ç»­è´¹: xxx DUST
âœ… ä½™é¢å……è¶³
...
[1/1] åˆ›å»ºä¾›å¥‰å“ #1
   åç§°: xxx
   ...
   âœ… ä¾›å¥‰å“åˆ›å»ºæˆåŠŸï¼
```

---

### æ­¥éª¤4: æ‰¹é‡åˆ›å»º

æ¢å¤é…ç½®ï¼š
```javascript
const CREATE_CONFIG = {
  offeringCount: 50,  // åˆ›å»º50ä¸ª
  // ...
};
```

è¿è¡Œï¼š
```bash
npm run create-offerings
```

---

## ğŸ”§ ä¿®å¤åçš„å®Œæ•´é…ç½®

### èŠ‚ç‚¹å¯åŠ¨å‚æ•°ï¼ˆæ­£ç¡®ï¼‰

```bash
./target/release/stardust-node \
  --dev \
  --ws-external \
  --ws-port 9944 \       # â† WebSocketï¼ˆè„šæœ¬éœ€è¦ï¼‰
  --rpc-external \
  --rpc-port 9933 \      # â† HTTP RPC
  --rpc-cors=all \
  --base-path ./my-chain-state/
```

### è„šæœ¬é…ç½®ï¼ˆæ­£ç¡®ï¼‰

```javascript
// Pallet åç§°
api.tx.memorialOfferings.createOffering(...)  // âœ… æ­£ç¡®

// å‚æ•°é…ç½®
const CREATE_CONFIG = {
  offeringCount: 50,
  startKindCode: 1,
  delayBetweenCreations: 500,
  defaultEnabled: true,  // âœ… æ–°å¢
};

// ä¾›å¥‰å“å‚æ•°
{
  kindCode,
  name,
  mediaSchemaCid,
  kindFlag,
  minDuration,
  maxDuration,
  canRenew,
  expireAction,
  enabled,  // âœ… æ–°å¢
  type,
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

1. **åˆ›å»ºä¾›å¥‰å“ä½¿ç”¨è¯´æ˜.md** - å®Œæ•´ä½¿ç”¨æ‰‹å†Œ
2. **æ•…éšœæ’é™¤æŒ‡å—.md** - æ•…éšœæ’é™¤
3. **ä¿®å¤æ€»ç»“.md** - æœ¬æ–‡æ¡£

---

## ğŸ‰ æœ€ç»ˆçŠ¶æ€

âœ… **æ‰€æœ‰é—®é¢˜å·²è§£å†³ï¼Œè„šæœ¬å¯æ­£å¸¸ä½¿ç”¨ï¼**

### å¿«é€Ÿå¼€å§‹

```bash
# 1. ç¡®ä¿èŠ‚ç‚¹è¿è¡Œï¼ˆå¦‚éœ€é‡å¯ï¼‰
cd /home/xiaodong/æ–‡æ¡£/stardust/stardust-gov-scripts
./é‡å¯èŠ‚ç‚¹.sh

# 2. æµ‹è¯•è¿æ¥
node test-connection.js

# 3. è¿è¡Œè„šæœ¬
npm run create-offerings
```

---

## ğŸ’¡ ç»éªŒæ€»ç»“

### 1. è°ƒè¯•æŠ€å·§

- âœ… ä½¿ç”¨è¯Šæ–­è„šæœ¬å¿«é€Ÿå®šä½é—®é¢˜
- âœ… æ£€æŸ¥ pallet åç§°æ˜¯å¦åŒ¹é…
- âœ… éªŒè¯èŠ‚ç‚¹ç«¯å£é…ç½®
- âœ… æµ‹è¯• WebSocket è¿æ¥

### 2. å¸¸è§é™·é˜±

- âš ï¸ Pallet åç§°å¤§å°å†™æ•æ„Ÿ
- âš ï¸ åŒºåˆ† HTTP RPC å’Œ WebSocket ç«¯å£
- âš ï¸ ç¡®è®¤ extrinsic å‚æ•°æ•°é‡
- âš ï¸ æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å·²éƒ¨ç½² pallet

### 3. æœ€ä½³å®è·µ

- âœ… å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
- âœ… ä½¿ç”¨è¯Šæ–­å·¥å…·æ£€æŸ¥
- âœ… å°æ‰¹é‡æµ‹è¯•ï¼ˆ1-10ä¸ªï¼‰
- âœ… ä¿å­˜ç»“æœæ–‡ä»¶
- âœ… æŸ¥çœ‹å®Œæ•´æ–‡æ¡£

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025-10-27  
**çŠ¶æ€**: âœ… æ‰€æœ‰é—®é¢˜å·²ä¿®å¤

