# Stardust 治理与工具脚本 - 当前状态

**更新时间**: 2024年10月17日 23:25  
**项目版本**: 1.0.2  

---

## 📦 脚本清单

### 1. governance-cli.js ✅ 就绪
**功能**: 委员会治理交互式CLI  
**状态**: ✅ 正常  
**最后更新**: 初始版本  
**使用**: `npm run gov` 或 `node governance-cli.js`

**特性**:
- 上下键选择3个委员会成员账户
- 自动检测委员会成员身份
- 主委员会做市商审核
- 提案发起、投票、执行

---

### 2. batch-transfer.js ✅ 就绪（已修复）
**功能**: 批量转账自动化脚本  
**状态**: ✅ 已修复并升级  
**最后更新**: v1.0.2 - 大额转账配置  
**使用**: `npm run transfer` 或 `node batch-transfer.js`

**特性**:
- 自动批量转账到4个地址
- 随机金额生成
- 余额检查和手续费预估

**当前配置**:
```javascript
MIN_AMOUNT = 1_000_000_000_000_000_000_000n  // 1,000,000,000 MEMO (10亿)
```
- **金额范围**: 10亿 ~ 100亿 MEMO
- **转账对象**: 4个预设地址

**修复历史**:
- v1.0.1: 修复 `BelowMinimum` 错误（金额从 0.00001 提升到 1 MEMO）
- v1.0.2: 升级为大额转账配置（1 MEMO → 10亿 MEMO）

---

### 3. create-listing.js ✅ 就绪（已修复）
**功能**: 做市商创建OTC挂单  
**状态**: ✅ 已修复  
**最后更新**: v1.0.2 - 修复做市商查询  
**使用**: `npm run listing` 或 `node create-listing.js`

**特性**:
- 上下键选择2个做市商账户
- 交互式输入12个挂单参数
- 做市商身份自动验证
- 详细的参数说明和验证

**修复历史**:
- v1.0.2: 修复做市商查询错误（使用 `.entries()` 方法）

**挂单参数**（12个）:
1. side - 交易方向
2. base - 基础资产ID
3. quote - 计价资产ID
4. pricingSpreadBps - 价差
5. minQty - 最小数量
6. maxQty - 最大数量
7. total - 总库存
8. partial - 允许部分成交
9. expireAt - 过期时间
10. priceMin - 最低价格
11. priceMax - 最高价格
12. termsCommit - 条款承诺

---

## 🔐 账户配置

### 委员会成员账户（3个）
用于 `governance-cli.js`

| # | 地址 | 用途 |
|---|------|------|
| 1 | 5CrDBEVDgXUwctSuV8EvQEBo2m187PcxoY36V7H7PGErHUW4 | Council主力 + 转账发送 |
| 2 | 5CSepuULuCiDSBjeRqr9ZburDSdTwTk5ro9BgV5u1SbHiQh9 | Council成员 + 转账接收 |
| 3 | 5CotZ9gD2mLLBQ6sqL2b8gRS1Vxo6HfmRcQ2iu3T825DFgSq | Council/委员会 + 转账接收 |

### 做市商账户（2个）
用于 `create-listing.js`

| # | 地址 | 用途 |
|---|------|------|
| 1 | 5C7RjMrgfCJYyscR5Du1BLP99vFGgRDXjAt3ronftJZe39Qo | 做市商1 + 转账接收 |
| 2 | 5CRubhWmwNmJ3z2Ffqs3nf71XQGHBkfKSc1edNvuHZErqvdL | 做市商2 + 转账接收 |

---

## 🐛 已知问题与修复

### ✅ 已修复

#### 问题 #1: 批量转账金额过小
- **错误**: `{"token":"BelowMinimum"}`
- **原因**: 金额 0.00001 MEMO 低于最小限额
- **修复**: 提升到 1 MEMO（v1.0.1）
- **当前**: 10亿 MEMO（v1.0.2）

#### 问题 #2: 创建挂单做市商查询错误
- **错误**: `activeMarketMakers(u64) is a map, requiring 1 arguments`
- **原因**: 错误使用 Map 类型存储查询方法
- **修复**: 使用 `.entries()` 方法遍历（v1.0.2）

---

## 📚 文档文件

| 文档 | 说明 | 大小 |
|------|------|------|
| README.md | 主文档 | 7.1KB |
| 快速开始.md | 快速上手指南 | 5.1KB |
| 批量转账使用说明.md | 批量转账详解 | 7.0KB |
| 创建挂单使用说明.md | 创建挂单详解 | 13KB |
| 大额转账说明.md | 大额转账专项说明 | 5.4KB |
| 使用示例.md | 运行示例 | 8.9KB |
| 使用手册.txt | 完整使用手册 | 15KB |
| 项目说明.txt | 项目总览 | 8.9KB |
| 项目总结.md | 项目总结 | 7.5KB |
| 修复日志.md | 问题修复记录 | 3.7KB |
| 脚本状态.md | 本文件 | - |

**总计**: 11个文档文件，覆盖全面

---

## ✅ 验证状态

### 语法检查
- ✅ governance-cli.js
- ✅ batch-transfer.js
- ✅ create-listing.js

### 可执行权限
- ✅ governance-cli.js (rwxrwxr-x)
- ✅ batch-transfer.js (rwxrwxr-x)
- ✅ create-listing.js (rwxrwxr-x)

### 运行测试
- ⏳ governance-cli.js - 待测试
- ⏳ batch-transfer.js - 已测试有错误，已修复，待重新测试
- ⏳ create-listing.js - 已测试有错误，已修复，待重新测试

---

## 🚀 快速使用

### 安装依赖（首次使用）
```bash
cd /home/xiaodong/文档/stardust/stardust-gov-scripts
npm install
```

### 运行脚本
```bash
# 治理脚本
npm run gov

# 批量转账（大额配置：10亿-100亿 MEMO）
npm run transfer

# 创建挂单
npm run listing
```

### 自定义节点
```bash
STARDUST_WS=ws://192.168.1.100:9944 node governance-cli.js
```

---

## ⚠️ 注意事项

### 批量转账
1. **超大金额**: 当前配置为 10亿-100亿 MEMO/笔
2. **余额要求**: 发送账户需要 ≥200亿 MEMO
3. **测试建议**: 强烈建议先在测试网络验证
4. **不可撤销**: 区块链转账不可撤销

### 创建挂单
1. **做市商身份**: 必须是已激活的做市商
2. **参数准确**: 12个参数需仔细填写
3. **金额单位**: 注意最小单位与 MEMO 的转换
4. **测试先行**: 建议先用小额测试

### 治理操作
1. **委员会权限**: 需要是委员会成员
2. **提案审慎**: 提案一旦发起无法撤回
3. **投票及时**: 注意提案的投票期限
4. **执行条件**: 达到阈值后才能执行

---

## 📊 项目统计

- **JS脚本**: 5个（约 65KB 代码）
- **文档**: 11个（约 70KB 文档）
- **总文件**: 17个
- **账户**: 5个（不重复）
- **版本**: 1.0.2
- **修复次数**: 2次

---

## 🔄 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| 1.0.0 | 2024-10-17 | 初始版本，三个脚本开发完成 |
| 1.0.1 | 2024-10-17 | 修复批量转账金额过小问题 |
| 1.0.2 | 2024-10-17 | 升级大额转账 + 修复挂单查询 |

---

## 📞 技术支持

- **快速上手**: 查看 `快速开始.md`
- **详细说明**: 查看各功能的专项文档
- **问题修复**: 查看 `修复日志.md`
- **使用手册**: 查看 `使用手册.txt`

---

**项目状态**: ✅ 全部脚本就绪，可正常使用  
**更新频率**: 按需更新  
**维护状态**: 活跃维护中

