# create-offerings.js æ•…éšœæ’é™¤æŒ‡å—

**é—®é¢˜**: è¿è¡Œè„šæœ¬æ—¶é—ªé€€  
**è¯Šæ–­å·¥å…·**: `test-connection.js`  
**æœ€åæ›´æ–°**: 2025-10-27

---

## ğŸ” å¿«é€Ÿè¯Šæ–­

### è¿è¡Œè¯Šæ–­è„šæœ¬

```bash
cd /home/xiaodong/æ–‡æ¡£/stardust/stardust-gov-scripts
node test-connection.js
```

è¯Šæ–­è„šæœ¬ä¼šæ£€æŸ¥ï¼š
1. âœ… Node.js ç‰ˆæœ¬
2. âœ… ä¾èµ–å®‰è£…
3. âœ… é“¾èŠ‚ç‚¹è¿æ¥
4. âœ… Pallet å¯ç”¨æ€§

---

## âŒ å¸¸è§é—®é¢˜

### é—®é¢˜1: é“¾èŠ‚ç‚¹æœªå¯åŠ¨ â­â­â­ï¼ˆæœ€å¸¸è§ï¼‰

**ç—‡çŠ¶**:
```
âŒ è¿æ¥è¶…æ—¶ï¼ˆ5ç§’ï¼‰
ğŸ’¡ å¯èƒ½çš„åŸå› :
   1. é“¾èŠ‚ç‚¹æœªå¯åŠ¨
```

**è§£å†³æ–¹æ¡ˆ**:

#### æ­¥éª¤1: æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦è¿è¡Œ

```bash
# æ£€æŸ¥èŠ‚ç‚¹è¿›ç¨‹
ps aux | grep node-template

# æ£€æŸ¥ç«¯å£
netstat -tuln | grep 9944
# æˆ–
lsof -i :9944
```

#### æ­¥éª¤2: å¯åŠ¨é“¾èŠ‚ç‚¹

**å¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼‰**:
```bash
cd /home/xiaodong/æ–‡æ¡£/stardust

# æ¸…ç†æ—§æ•°æ®ï¼ˆå¯é€‰ï¼‰
rm -rf my-chain-state/chains/dev

# å¯åŠ¨å¼€å‘æ¨¡å¼
./target/release/node-template --dev

# æˆ–ä½¿ç”¨è„šæœ¬ï¼ˆå¦‚æœæœ‰ï¼‰
./å¯åŠ¨æ‰€æœ‰æœåŠ¡.sh
```

**ç”Ÿäº§æ¨¡å¼**:
```bash
cd /home/xiaodong/æ–‡æ¡£/stardust

# å¯åŠ¨èŠ‚ç‚¹
./target/release/node-template \
  --base-path ./my-chain-state \
  --chain local \
  --alice \
  --port 30333 \
  --rpc-port 9933 \
  --ws-port 9944 \
  --rpc-cors all
```

#### æ­¥éª¤3: ç­‰å¾…èŠ‚ç‚¹å°±ç»ª

```bash
# ç­‰å¾…10ç§’
sleep 10

# æµ‹è¯•è¿æ¥
node test-connection.js
```

**æˆåŠŸæ ‡å¿—**:
```
âœ… å·²è¿æ¥ Stardust Testnet â€¢ Stardust Node v1.0.0
âœ… memoOfferings pallet å¯ç”¨
âœ… createOffering extrinsic å¯ç”¨
```

---

### é—®é¢˜2: ä¾èµ–æœªå®‰è£…

**ç—‡çŠ¶**:
```
âŒ ä¾èµ–ç¼ºå¤±: Cannot find module '@polkadot/api'
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
cd /home/xiaodong/æ–‡æ¡£/stardust/stardust-gov-scripts

# å®‰è£…ä¾èµ–
npm install

# éªŒè¯å®‰è£…
npm list @polkadot/api
npm list @polkadot/util-crypto
```

**å¦‚æœå®‰è£…å¤±è´¥**:

```bash
# æ¸…ç†ç¼“å­˜
rm -rf node_modules package-lock.json
npm cache clean --force

# é‡æ–°å®‰è£…
npm install

# æˆ–ä½¿ç”¨ yarn
yarn install
```

---

### é—®é¢˜3: WS åœ°å€é”™è¯¯

**ç—‡çŠ¶**:
```
èŠ‚ç‚¹åœ°å€: ws://192.168.1.100:9944
âŒ è¿æ¥è¶…æ—¶ï¼ˆ5ç§’ï¼‰
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ£€æŸ¥èŠ‚ç‚¹å®é™…ç›‘å¬çš„åœ°å€
netstat -tuln | grep 9944

# å¦‚æœèŠ‚ç‚¹åœ¨æœ¬åœ°
export STARDUST_WS=ws://127.0.0.1:9944

# å¦‚æœèŠ‚ç‚¹åœ¨è¿œç¨‹æœåŠ¡å™¨
export STARDUST_WS=ws://192.168.1.100:9944

# è¿è¡Œè„šæœ¬
npm run create-offerings
```

---

### é—®é¢˜4: ç«¯å£è¢«å ç”¨

**ç—‡çŠ¶**:
```
Error: bind EADDRINUSE 0.0.0.0:9944
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :9944

# æˆ–
netstat -tuln | grep 9944

# æ€æ­»è¿›ç¨‹ï¼ˆæ›¿æ¢ PIDï¼‰
kill -9 <PID>

# æˆ–ä½¿ç”¨ä¸åŒç«¯å£å¯åŠ¨èŠ‚ç‚¹
./target/release/node-template --dev --ws-port 9945

# æ›´æ–°ç¯å¢ƒå˜é‡
export STARDUST_WS=ws://127.0.0.1:9945
```

---

### é—®é¢˜5: memo-offerings pallet ä¸å¯ç”¨

**ç—‡çŠ¶**:
```
âœ… å·²è¿æ¥ Stardust Testnet
âŒ memoOfferings pallet ä¸å¯ç”¨
```

**è§£å†³æ–¹æ¡ˆ**:

#### æ£€æŸ¥ runtime é…ç½®

```bash
cd /home/xiaodong/æ–‡æ¡£/stardust

# æ£€æŸ¥ runtime ä¸­æ˜¯å¦åŒ…å« memo-offerings
grep -r "memo_offerings" runtime/src/
```

#### é‡æ–°ç¼–è¯‘ï¼ˆå¦‚æœ pallet ç¼ºå¤±ï¼‰

```bash
cd /home/xiaodong/æ–‡æ¡£/stardust

# ç¡®è®¤ Cargo.toml ä¸­å·²æ·»åŠ  memo-offerings
cat runtime/Cargo.toml | grep memo-offerings

# é‡æ–°ç¼–è¯‘
cargo build --release

# æ¸…ç†æ—§é“¾æ•°æ®
rm -rf my-chain-state/chains/dev

# é‡æ–°å¯åŠ¨
./target/release/node-template --dev
```

---

### é—®é¢˜6: æƒé™ä¸è¶³

**ç—‡çŠ¶**:
```
âŒ åˆ›å»ºå¤±è´¥: system.BadOrigin: Bad origin
```

**è§£å†³æ–¹æ¡ˆ**:

æ£€æŸ¥ç®¡ç†å‘˜è´¦æˆ·é…ç½®ï¼š

```javascript
// create-offerings.js
const ADMIN_CONFIG = {
  mnemonic: 'your admin mnemonic here',  // â† ç¡®ä¿æ˜¯ç®¡ç†å‘˜è´¦æˆ·
  expectedAddress: '5C7R...',
};
```

**éªŒè¯ç®¡ç†å‘˜æƒé™**:

```bash
# ä½¿ç”¨ polkadot.js Apps
# 1. è®¿é—® https://polkadot.js.org/apps
# 2. è¿æ¥åˆ°èŠ‚ç‚¹
# 3. Developer â†’ Chain state
# 4. é€‰æ‹© sudo â†’ key()
# 5. ç¡®è®¤è¿”å›çš„åœ°å€ä¸ ADMIN_CONFIG.expectedAddress ä¸€è‡´
```

---

### é—®é¢˜7: ä½™é¢ä¸è¶³

**ç—‡çŠ¶**:
```
âŒ ä½™é¢ä¸è¶³ï¼
   å¯ç”¨: 0.01 DUST
   éœ€è¦: 0.5 DUST
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ–¹æ³•1: ä»æ°´é¾™å¤´è·å–æµ‹è¯•ä»£å¸ï¼ˆå¦‚æœæœ‰ï¼‰
# è®¿é—®æµ‹è¯•ç½‘æ°´é¾™å¤´

# æ–¹æ³•2: ä»å…¶ä»–è´¦æˆ·è½¬è´¦
# ä½¿ç”¨ batch-transfer.js æˆ–æ‰‹åŠ¨è½¬è´¦

# æ–¹æ³•3: ä½¿ç”¨å¯Œè´¦æˆ·ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
# Alice: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
# Bob: 5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty
```

---

## ğŸ› ï¸ è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—

åœ¨è„šæœ¬ä¸­æ·»åŠ ï¼š

```javascript
// create-offerings.js å¼€å¤´æ·»åŠ 
process.env.DEBUG = '*';

// æˆ–
console.log('DEBUG: é…ç½®è¯¦æƒ…');
console.log(JSON.stringify(CREATE_CONFIG, null, 2));
```

---

### 2. å•æ­¥è°ƒè¯•

```javascript
// åªåˆ›å»º1ä¸ªä¾›å¥‰å“æµ‹è¯•
const CREATE_CONFIG = {
  offeringCount: 1,
  // ...
};
```

---

### 3. ä½¿ç”¨ try-catch æ•è·æ›´å¤šä¿¡æ¯

```javascript
try {
  await createOffering(...);
} catch (error) {
  console.error('è¯¦ç»†é”™è¯¯:', error);
  console.error('é”™è¯¯ç±»å‹:', error.constructor.name);
  console.error('é”™è¯¯å †æ ˆ:', error.stack);
}
```

---

### 4. æ£€æŸ¥é“¾æ—¥å¿—

```bash
# æŸ¥çœ‹èŠ‚ç‚¹è¾“å‡º
tail -f /path/to/node.log

# æˆ–ç›´æ¥åœ¨ç»ˆç«¯è¿è¡ŒèŠ‚ç‚¹æŸ¥çœ‹å®æ—¶æ—¥å¿—
./target/release/node-template --dev
```

---

## ğŸ“‹ å®Œæ•´æ•…éšœæ’é™¤æµç¨‹

### æ­¥éª¤1: è¿è¡Œè¯Šæ–­

```bash
cd /home/xiaodong/æ–‡æ¡£/stardust/stardust-gov-scripts
node test-connection.js
```

---

### æ­¥éª¤2: æ ¹æ®è¯Šæ–­ç»“æœå¤„ç†

**å¦‚æœæ˜¾ç¤ºè¿æ¥è¶…æ—¶**:
â†’ å¯åŠ¨é“¾èŠ‚ç‚¹

**å¦‚æœæ˜¾ç¤ºä¾èµ–ç¼ºå¤±**:
â†’ `npm install`

**å¦‚æœæ˜¾ç¤º pallet ä¸å¯ç”¨**:
â†’ æ£€æŸ¥ runtime é…ç½®å¹¶é‡æ–°ç¼–è¯‘

---

### æ­¥éª¤3: å†æ¬¡è¿è¡Œè¯Šæ–­

```bash
node test-connection.js
```

---

### æ­¥éª¤4: è¿è¡Œè„šæœ¬

```bash
npm run create-offerings
```

---

## ğŸ” é«˜çº§è¯Šæ–­

### æ£€æŸ¥èŠ‚ç‚¹ RPC

```bash
# ä½¿ç”¨ curl æµ‹è¯•
curl -H "Content-Type: application/json" \
     -d '{"id":1, "jsonrpc":"2.0", "method": "system_chain"}' \
     http://127.0.0.1:9933

# åº”è¯¥è¿”å›
{"jsonrpc":"2.0","result":"Stardust Testnet","id":1}
```

---

### æ£€æŸ¥ WebSocket

```bash
# å®‰è£… wscat
npm install -g wscat

# æµ‹è¯• WebSocket
wscat -c ws://127.0.0.1:9944

# å‘é€ RPC è¯·æ±‚
> {"id":1, "jsonrpc":"2.0", "method": "system_chain"}
```

---

### æŸ¥çœ‹é“¾å…ƒæ•°æ®

```javascript
// test-metadata.js
const { ApiPromise, WsProvider } = require('@polkadot/api');

async function checkMetadata() {
  const api = await ApiPromise.create({ 
    provider: new WsProvider('ws://127.0.0.1:9944') 
  });
  
  const metadata = await api.rpc.state.getMetadata();
  const pallets = metadata.asLatest.pallets;
  
  console.log('å¯ç”¨çš„ Pallets:');
  pallets.forEach(p => console.log(`  - ${p.name.toString()}`));
  
  await api.disconnect();
}

checkMetadata();
```

---

## ğŸ“ ä»ç„¶æ— æ³•è§£å†³ï¼Ÿ

### æ”¶é›†ä¿¡æ¯

```bash
# 1. Node.js ç‰ˆæœ¬
node --version

# 2. npm ç‰ˆæœ¬
npm --version

# 3. ä¾èµ–ç‰ˆæœ¬
npm list @polkadot/api
npm list @polkadot/util-crypto

# 4. ç³»ç»Ÿä¿¡æ¯
uname -a

# 5. èŠ‚ç‚¹è¿›ç¨‹
ps aux | grep node-template

# 6. ç«¯å£çŠ¶æ€
netstat -tuln | grep 9944

# 7. è¯Šæ–­ç»“æœ
node test-connection.js > diagnostic.log 2>&1
```

### æä¾›ä»¥ä¸‹ä¿¡æ¯

1. è¯Šæ–­è„šæœ¬è¾“å‡º (`diagnostic.log`)
2. èŠ‚ç‚¹æ—¥å¿—
3. é”™è¯¯æˆªå›¾
4. è¿è¡Œç¯å¢ƒï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰

---

## ğŸ¯ å¿«é€Ÿå‚è€ƒ

| é—®é¢˜ | å¿«é€Ÿè§£å†³ |
|------|---------|
| è¿æ¥è¶…æ—¶ | å¯åŠ¨èŠ‚ç‚¹ï¼š`./target/release/node-template --dev` |
| ä¾èµ–ç¼ºå¤± | `npm install` |
| ç«¯å£å ç”¨ | `lsof -i :9944` ç„¶å `kill -9 <PID>` |
| æƒé™ä¸è¶³ | ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ· |
| ä½™é¢ä¸è¶³ | è½¬å…¥ DUST ä»£å¸ |
| Palletä¸å¯ç”¨ | é‡æ–°ç¼–è¯‘å¹¶æ¸…ç†é“¾æ•°æ® |

---

## ğŸš€ æˆåŠŸæ ‡å¿—

è¿è¡Œ `node test-connection.js` åº”è¯¥çœ‹åˆ°ï¼š

```
âœ… è¯Šæ–­å®Œæˆ - æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼
ğŸ’¡ å¯ä»¥è¿è¡Œ: npm run create-offerings
```

ç„¶åè¿è¡Œè„šæœ¬ï¼š

```
npm run create-offerings
```

åº”è¯¥çœ‹åˆ°ï¼š

```
ğŸš€ åˆ›å»ºä¾›å¥‰å“è„šæœ¬å¯åŠ¨
âœ… åŠ å¯†åº“å‡†å¤‡å®Œæˆ
âœ… ç®¡ç†å‘˜è´¦æˆ·åœ°å€éªŒè¯é€šè¿‡
âœ… å·²è¿æ¥ Stardust Testnet
ğŸ’° å¯ç”¨ä½™é¢: 1000000.0 DUST
...
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025-10-27  
**é€‚ç”¨è„šæœ¬**: create-offerings.js v1.0.0

