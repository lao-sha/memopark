# 委员会提案 UI 使用指南

## 概述

委员会提案 UI 提供了完整的链上治理界面，让委员会成员可以方便地：
- 提交批准/驳回做市商的提案
- 查看所有活跃提案
- 对提案进行投票
- 执行已通过的提案
- 查看个人投票记录

## 访问地址

```
http://localhost:5173/#/gov/council-proposals
```

或通过做市商审核页面的链接进入。

## 功能说明

### 1. 提案列表

**功能**：
- 显示所有活跃的委员会提案
- 实时显示投票进度
- 区分不同类型的提案（批准/驳回）
- 高亮显示可执行的提案

**操作**：
- **投票**：点击"赞成"或"反对"按钮
- **执行**：当提案达到阈值后，点击"执行提案"
- **查看详情**：点击"查看详情"查看完整信息

**状态说明**：
- 🟢 **可执行**：赞成票已达阈值，可以执行
- ✅ **已投赞成**：您已对此提案投赞成票
- ❌ **已投反对**：您已对此提案投反对票

### 2. 提交提案

**功能**：
- 创建新的批准/驳回做市商提案
- 自动加载待审申请列表
- 自动计算提案参数

**步骤**：
1. 选择提案类型（批准/驳回）
2. 从下拉列表选择待审申请
3. 如果是驳回，输入扣罚比例（0-10000 bps）
4. 设置投票阈值（推荐：2，即 2/3 多数）
5. 点击"提交提案"

**注意事项**：
- ⚠️ **仅委员会成员可提交**
- ⚠️ **提案一旦提交无法撤回**
- ⚠️ **提案哈希**需要分享给其他成员用于投票

### 3. 我的投票

**功能**：
- 查看您在所有提案中的投票记录
- 统计赞成/反对票数
- 跟踪提案执行状态

**信息显示**：
- 总投票数
- 赞成票数
- 反对票数
- 每个提案的当前进度

## 使用示例

### 示例 1：提交批准提案

1. **进入提交提案页面**
   - 点击"提交提案"标签

2. **填写表单**
   ```
   提案类型: 批准做市商申请
   申请编号: 选择 #0
   投票阈值: 2
   ```

3. **提交**
   - 点击"提交提案"
   - 输入密码签名
   - 等待确认

4. **记录信息**
   - 复制提案哈希
   - 分享给其他委员会成员

### 示例 2：投票

1. **进入提案列表**
   - 点击"提案列表"标签

2. **查看提案**
   - 查看提案内容（批准 #0）
   - 检查申请详情

3. **投票**
   - 点击"赞成"按钮
   - 确认投票
   - 等待交易确认

### 示例 3：执行提案

1. **检查状态**
   - 提案显示"可执行"标签
   - 赞成票达到阈值（2/2 或更多）

2. **执行**
   - 点击"执行提案"按钮
   - 确认执行
   - 等待交易确认

3. **验证结果**
   - 查看是否触发 `marketMaker.Approved` 事件
   - 前往审核页面验证状态

## 技术细节

### 提案哈希计算

```typescript
const approveCall = api.tx.marketMaker.approve(mmId)
const proposalHash = approveCall.method.hash.toHex()
```

### 投票阈值

- **2/3 多数**：3 成员需要 2 票，5 成员需要 4 票
- **简单多数**：3 成员需要 2 票，5 成员需要 3 票

推荐使用 2/3 多数（阈值 = Math.ceil(成员数 * 2 / 3)）

### Weight 和 Length Bound

执行提案时自动设置：
```typescript
weightBound: {
  refTime: 1_000_000_000,
  proofSize: 1000
}
lengthBound: 1000
```

## 常见问题

### Q: 提交提案失败（BadOrigin）

**原因**：您不是委员会成员

**解决**：
1. 确认您的账户已加入委员会
2. 使用正确的委员会成员账户

### Q: 看不到待审申请

**原因**：
- 没有待审申请（PendingReview 状态）
- API 连接失败

**解决**：
1. 点击"刷新申请列表"
2. 检查链节点是否正常运行
3. 前往做市商申请页面创建测试申请

### Q: 投票后没有反应

**原因**：
- 交易尚未确认
- 网络延迟

**解决**：
1. 等待 6-12 秒（1-2 个区块）
2. 刷新页面
3. 查看浏览器控制台是否有错误

### Q: 执行提案失败

**可能原因**：
- 未达到投票阈值
- Weight bound 不足
- 申请已被处理
- 申请已过期

**解决**：
1. 确认赞成票数 ≥ 阈值
2. 检查申请是否仍处于 PendingReview 状态
3. 查看链上事件获取详细错误信息

### Q: 如何撤回提案？

**答案**：提案无法撤回。

可以：
- 投反对票使其无法达到阈值
- 让其他成员投反对票
- 等待提案过期（默认 7 天）

## 快捷键和技巧

### 快速导航

- **审核页面** → **提案管理**：点击顶部提示中的链接
- **提案管理** → **审核页面**：浏览器后退或直接访问 `#/gov/mm-review`

### 批量操作

如果有多个待审申请：
1. 分别提交提案（不同 mm_id）
2. 所有提案会显示在列表中
3. 可以一次性投票

### 提案哈希分享

提交提案后：
1. 自动弹出提案信息对话框
2. 复制提案哈希
3. 通过安全渠道发送给其他成员
4. 其他成员可以通过哈希搜索提案

## 安全建议

1. **谨慎投票**
   - 仔细审查每个提案
   - 验证申请编号是否正确
   - 确认驳回时的扣罚比例合理

2. **保护账户**
   - 妥善保管私钥
   - 使用硬件钱包（推荐）
   - 定期检查账户活动

3. **验证信息**
   - 通过多个渠道确认提案内容
   - 不要盲目跟投
   - 发现异常及时沟通

## 开发计划

未来功能（规划中）：

- [ ] 提案评论和讨论
- [ ] 邮件/消息通知
- [ ] 提案历史和统计
- [ ] 批量投票
- [ ] 移动端优化
- [ ] 提案模板
- [ ] 自动化执行

## 相关链接

- **审核页面**：`#/gov/mm-review`
- **申请页面**：`#/otc/mm-apply`
- **技术文档**：`pallets/market-maker/README.md`
- **治理机制**：查看 README 的"治理机制"章节

---

**反馈**：如有问题或建议，请联系技术支持。
